# flake8: noqa: E127
from noc.grad.grad.lib.telemetry_helper import (
    parse_jnpr_firewall_ext,
    jnpr_interface_ext,
    jnpr_logical_interface_ext,
    jnpr_packet_stats_ext,
    jnpr_packet_stats_pfe_ext,
    jnpr_fabric_counters,
)
from noc.grad.grad.test.data.telemetry_test_data import (
    JNX_PACKETS_STAT,
    JNX_PACKETS_STAT_PFE,
    JNX_PACKETS_STAT_PFE_RES,
    JNX_PACKETS_STAT_RES,
    JNX_FABRIC,
    JNX_FABRIC_RES,
    JNX_FIREWALL_EXT_RES,
    JNX_FIREWALL_EXT,
)

FWDATA = {
    'firewall_stats': [
        {
            'filter_name': 'BORDER-IN',
            'timestamp': '1549547697',
            'memory_usage': [{'name': 'HEAP', 'allocated': '128444'}],
            'counter_stats': [],
            'policer_stats': [],
            'hierarchical_policer_stats': [],
        },
        {
            'filter_name': 'et-3/3/0.0-o',
            'timestamp': '1551701785',
            'memory_usage': [{'name': 'HEAP', 'allocated': '764'}],
            'counter_stats': [],
            'policer_stats': [],
            'hierarchical_policer_stats': [],
        },
        {
            'filter_name': 'et-8/3/0.0-i',
            'timestamp': '1551701785',
            'memory_usage': [{'name': 'HEAP', 'allocated': '3164'}],
            'counter_stats': [
                {'name': 'DNS-AMP-et-8/3/0.0-i', 'packets': '20044882', 'bytes': '29121329273'},
                {'name': 'MEMC-AMP-et-8/3/0.0-i', 'packets': '566104314', 'bytes': '44236886399'},
                {'name': 'NTP-AMP-et-8/3/0.0-i', 'packets': '231636752', 'bytes': '104147924578'},
                {'name': 'SYN2SLB-et-8/3/0.0-i', 'packets': '1402762359395', 'bytes': '77941363313944'},
                {'name': 'TO-SPIDER-et-8/3/0.0-i', 'packets': '499663465704', 'bytes': '696180355133344'},
                {'name': 'TO-YANDEX-et-8/3/0.0-i', 'packets': '59539183008437', 'bytes': '22986038730321111'},
                {'name': 'UDP-IN-et-8/3/0.0-i', 'packets': '494327875209', 'bytes': '175503022162441'},
                {'name': 'UNEX-IN-et-8/3/0.0-i', 'packets': '15829653', 'bytes': '17024390083'},
                {'name': 'UNEX-UDP-et-8/3/0.0-i', 'packets': '635497353', 'bytes': '239499649609'},
                {'name': 'UNEX-YM-UDP-et-8/3/0.0-i', 'packets': '82252', 'bytes': '28937027'},
            ],
            'policer_stats': [
                {
                    'name': '100Mb-ALLOW-YAMONEY-UDP-et-8/3/0.0-i',
                    'out_of_spec_packets': '30491675',
                    'out_of_spec_bytes': '42993267524',
                }
            ],
            'hierarchical_policer_stats': [],
        },
        {
            'filter_name': 'et-8/3/0.0-o',
            'timestamp': '1551701785',
            'memory_usage': [{'name': 'HEAP', 'allocated': '1076'}],
            'counter_stats': [
                {'name': 'FROM-CDN-et-8/3/0.0-o', 'packets': '11291508561147', 'bytes': '15653050445631094'},
                {'name': 'FROM-STRM-et-8/3/0.0-o', 'packets': '6366861134869', 'bytes': '8933798410896779'},
                {'name': 'UNEX-OUT-et-8/3/0.0-o', 'packets': '168', 'bytes': '7280'},
            ],
            'policer_stats': [],
            'hierarchical_policer_stats': [],
        },
        {
            'filter_name': 'lo0.0-i',
            'timestamp': '1551701786',
            'memory_usage': [{'name': 'HEAP', 'allocated': '166652'}],
            'counter_stats': [
                {'name': 'ICMP_1st_frag-lo0.0-i', 'packets': '144', 'bytes': '35632'},
                {'name': 'ICMP_frag-lo0.0-i', 'packets': '64', 'bytes': '79222'},
                {'name': 'ME-LINKS-lo0.0-i', 'packets': '1021590', 'bytes': '168611060'},
                {'name': 'MTU-EXCEED-lo0.0-i', 'packets': '7', 'bytes': '560'},
            ],
            'policer_stats': [{'name': '160Kb-ICMP-lo0.0-i', 'out_of_spec_packets': '25', 'out_of_spec_bytes': '1740'}],
            'hierarchical_policer_stats': [],
        },
        {
            'filter_name': 'tmp_count',
            'timestamp': '1531760379',
            'memory_usage': [{'name': 'HEAP', 'allocated': '3652'}],
            'counter_stats': [],
            'policer_stats': [],
            'hierarchical_policer_stats': [],
        },
        {
            'filter_name': '__default_arp_policer__',
            'timestamp': '1531760379',
            'memory_usage': [{'name': 'HEAP', 'allocated': '1604'}],
            'counter_stats': [],
            'policer_stats': [],
            'hierarchical_policer_stats': [],
        },
        {
            'filter_name': '1Mb-et-3/3/0.0-inet-arp',
            'timestamp': '1531760379',
            'memory_usage': [{'name': 'HEAP', 'allocated': '1332'}],
            'counter_stats': [],
            'policer_stats': [],
            'hierarchical_policer_stats': [],
        },
    ]
}

JUN_IFDATA = {
    'interface_stats': [
        {
            'if_name': 'et-10/1/0',
            'init_time': '1531433528',
            'snmp_if_index': 910,
            'parent_ae_name': 'ae1',
            'egress_queue_info': [
                {
                    'queueNumber': 0,
                    'packets': '1128445197981',
                    'bytes': '937034186136035',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '8922',
                    'allocated_buffer_size': '186646528',
                },
                {
                    'queueNumber': 1,
                    'packets': '5271464628',
                    'bytes': '2321787677513',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '1468',
                    'allocated_buffer_size': '242221056',
                },
                {
                    'queueNumber': 2,
                    'packets': '56906006442671',
                    'bytes': '39663018195240771',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '14785',
                    'allocated_buffer_size': '566231040',
                },
                {
                    'queueNumber': 3,
                    'packets': '35202824054',
                    'bytes': '15599276249859',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '2067',
                    'allocated_buffer_size': '12648448',
                },
                {
                    'queueNumber': 4,
                    'packets': '3175712195',
                    'bytes': '2345098802757',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '1718',
                    'allocated_buffer_size': '131596288',
                },
                {
                    'queueNumber': 5,
                    'packets': '4500084364',
                    'bytes': '2438581931579',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '1468',
                    'allocated_buffer_size': '131596288',
                },
                {
                    'queueNumber': 6,
                    'packets': '0',
                    'bytes': '0',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '0',
                    'allocated_buffer_size': '32768',
                },
                {
                    'queueNumber': 7,
                    'packets': '0',
                    'bytes': '0',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '0',
                    'allocated_buffer_size': '32768',
                },
            ],
            'ingress_stats': {
                'if_pkts': '82918942470021',
                'if_octets': '75773390873595178',
                'if1secPkts': '3296638',
                'if1sec_octets': '3091313933',
                'if_uc_pkts': '82918904163123',
                'if_mc_pkts': '39994060',
                'if_bc_pkts': '3',
                'if_error': '0',
                'if_pause_pkts': '0',
                'if_unknown_proto_pkts': '0',
            },
            'egress_stats': {
                'if_pkts': '58082598593233',
                'if_octets': '38169614632067567',
                'if1secPkts': '2774489',
                'if1sec_octets': '1664744895',
                'if_uc_pkts': '58082580946412',
                'if_mc_pkts': '19735414',
                'if_bc_pkts': '17526',
                'if_error': '0',
                'if_pause_pkts': '0',
                'if_unknown_proto_pkts': '0',
            },
            'ingress_errors': {
                'if_errors': '1412',
                'if_in_qdrops': '0',
                'if_in_frame_errors': '0',
                'if_discards': '0',
                'if_inRunts': '0',
                'if_in_l3_incompletes': '1412',
                'if_in_l2_chan_errors': '0',
                'if_in_l2_mismatch_timeouts': '0',
                'if_in_fifo_errors': '0',
                'if_in_resource_errors': '0',
            },
            'ifoperational_status': '1 - UP_OPERATION_STAT ',
            'if_transitions': '1',
            'if_last_change': 0,
            'if_high_speed': 100000,
            'ingressQueueInfo': [],
            'if_administration_status': '',
            'if_description': '',
        },
        {
            'if_name': 'et-10/3/0',
            'init_time': '1531433544',
            'snmp_if_index': 913,
            'egress_queue_info': [
                {
                    'queueNumber': 0,
                    'packets': '937730400405',
                    'bytes': '1201027921774889',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '8922',
                    'allocated_buffer_size': '186646528',
                },
                {
                    'queueNumber': 1,
                    'packets': '178541338',
                    'bytes': '70277040125',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '1468',
                    'allocated_buffer_size': '242221056',
                },
                {
                    'queueNumber': 2,
                    'packets': '54270268219499',
                    'bytes': '53371503370284658',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '14946',
                    'allocated_buffer_size': '566231040',
                },
                {
                    'queueNumber': 3,
                    'packets': '1226440502',
                    'bytes': '376481115102',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '1663',
                    'allocated_buffer_size': '12648448',
                },
                {
                    'queueNumber': 4,
                    'packets': '773893715',
                    'bytes': '808115523300',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '2033',
                    'allocated_buffer_size': '131596288',
                },
                {
                    'queueNumber': 5,
                    'packets': '415812823',
                    'bytes': '108494726184',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '1468',
                    'allocated_buffer_size': '131596288',
                },
                {
                    'queueNumber': 6,
                    'packets': '0',
                    'bytes': '0',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '0',
                    'allocated_buffer_size': '32768',
                },
                {
                    'queueNumber': 7,
                    'packets': '0',
                    'bytes': '0',
                    'tail_drop_packets': '0',
                    'rl_drop_packets': '0',
                    'rl_drop_bytes': '0',
                    'red_drop_packets': '0',
                    'redDropBytes': '0',
                    'avgBufferOccupancy': '0',
                    'cur_buffer_occupancy': '0',
                    'peak_buffer_occupancy': '0',
                    'allocated_buffer_size': '32768',
                },
            ],
            'ingress_stats': {
                'if_pkts': '53055722384359',
                'if_octets': '19797942403922336',
                'if1secPkts': '4445502',
                'if1sec_octets': '1551959943',
                'if_uc_pkts': '53055664082191',
                'if_mc_pkts': '71577684',
                'if_bc_pkts': '5032',
                'if_error': '0',
                'if_pause_pkts': '0',
                'if_unknown_proto_pkts': '0',
            },
            'egress_stats': {
                'if_pkts': '55210595215351',
                'if_octets': '52239370411075029',
                'if1secPkts': '4454318',
                'if1sec_octets': '4278479018',
                'if_uc_pkts': '55210543337232',
                'if_mc_pkts': '23116666',
                'if_bc_pkts': '31528033',
                'if_error': '0',
                'if_pause_pkts': '0',
                'if_unknown_proto_pkts': '0',
            },
            'ingress_errors': {
                'if_errors': '361',
                'if_in_qdrops': '0',
                'if_in_frame_errors': '0',
                'if_discards': '0',
                'if_inRunts': '0',
                'if_in_l3_incompletes': '361',
                'if_in_l2_chan_errors': '0',
                'if_in_l2_mismatch_timeouts': '0',
                'if_in_fifo_errors': '0',
                'if_in_resource_errors': '0',
            },
            'ifoperational_status': '1 - UP_OPERATION_STAT ',
            'if_transitions': '1',
            'if_last_change': 0,
            'if_high_speed': 100000,
            'parent_ae_name': '',
            'ingressQueueInfo': [],
            'if_administration_status': '',
            'if_description': '',
        },
    ]
}

JUN_LOGICAL_IFDATA = {
    'interface_info': [
        # down. нет parent_ae_name
        {
            'if_name': 'xe-3/0/0.601',
            'init_time': '1548192215',
            'snmp_if_index': 895,
            'ingress_stats': {'if_packets': '0', 'if_octets': '0'},
            'egress_stats': {'if_packets': '0', 'if_octets': '0'},
            'opState': {'operational_status': 'down'},
        },
        # up. есть parent_ae_name
        {
            'if_name': 'xe-3/0/1.0',
            'init_time': '1548192215',
            'snmp_if_index': 993,
            'parent_ae_name': 'ae3.0',
            'ingress_stats': {
                'if_packets': '138631510',
                'if_octets': '115817876643',
                'if_ucast_packets': '138631506',
                'if_mcast_packets': '4',
            },
            'egress_stats': {
                'if_packets': '421049147568',
                'if_octets': '333738829036835',
                'if_ucast_packets': '421049147568',
                'if_mcast_packets': '0',
            },
            'opState': {'operational_status': 'up'},
        },
        {
            'if_name': 'xe-1/0/1.0',
            'init_time': '1548192215',
            'snmp_if_index': 1993,
            'parent_ae_name': 'ae3.0',
            'ingress_stats': {
                'if_packets': '138631510',
                'if_octets': '115817876643',
                'if_ucast_packets': '138631506',
                'if_mcast_packets': '4',
            },
            'egress_stats': {
                'if_packets': '421049147568',
                'if_octets': '333738829036835',
                'if_ucast_packets': '421049147568',
                'if_mcast_packets': '0',
            },
            'opState': {'operational_status': 'up'},
        },
    ]
}


def test_parse_jnpr_firewall_ext():
    res = parse_jnpr_firewall_ext(FWDATA, 1552482268)
    exp = [
        (
            (
                ('counter', 'DNS-AMP'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            20044882,
            1552482268,
        ),
        (
            (
                ('counter', 'DNS-AMP'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            29121329273,
            1552482268,
        ),
        (
            (
                ('counter', 'MEMC-AMP'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            566104314,
            1552482268,
        ),
        (
            (
                ('counter', 'MEMC-AMP'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            44236886399,
            1552482268,
        ),
        (
            (
                ('counter', 'NTP-AMP'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            231636752,
            1552482268,
        ),
        (
            (
                ('counter', 'NTP-AMP'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            104147924578,
            1552482268,
        ),
        (
            (
                ('counter', 'SYN2SLB'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            1402762359395,
            1552482268,
        ),
        (
            (
                ('counter', 'SYN2SLB'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            77941363313944,
            1552482268,
        ),
        (
            (
                ('counter', 'TO-SPIDER'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            499663465704,
            1552482268,
        ),
        (
            (
                ('counter', 'TO-SPIDER'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            696180355133344,
            1552482268,
        ),
        (
            (
                ('counter', 'TO-YANDEX'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            59539183008437,
            1552482268,
        ),
        (
            (
                ('counter', 'TO-YANDEX'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            22986038730321111,
            1552482268,
        ),
        (
            (
                ('counter', 'UDP-IN'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            494327875209,
            1552482268,
        ),
        (
            (
                ('counter', 'UDP-IN'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            175503022162441,
            1552482268,
        ),
        (
            (
                ('counter', 'UNEX-IN'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            15829653,
            1552482268,
        ),
        (
            (
                ('counter', 'UNEX-IN'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            17024390083,
            1552482268,
        ),
        (
            (
                ('counter', 'UNEX-UDP'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            635497353,
            1552482268,
        ),
        (
            (
                ('counter', 'UNEX-UDP'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            239499649609,
            1552482268,
        ),
        (
            (
                ('counter', 'UNEX-YM-UDP'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            82252,
            1552482268,
        ),
        (
            (
                ('counter', 'UNEX-YM-UDP'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            28937027,
            1552482268,
        ),
        (
            (
                ('counter', '100Mb-ALLOW-YAMONEY-UDP'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            30491675,
            1552482268,
        ),
        (
            (
                ('counter', '100Mb-ALLOW-YAMONEY-UDP'),
                ('direction', 'input'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            42993267524,
            1552482268,
        ),
        (
            (
                ('counter', 'FROM-CDN'),
                ('direction', 'output'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            11291508561147,
            1552482268,
        ),
        (
            (
                ('counter', 'FROM-CDN'),
                ('direction', 'output'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            15653050445631094,
            1552482268,
        ),
        (
            (
                ('counter', 'FROM-STRM'),
                ('direction', 'output'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            6366861134869,
            1552482268,
        ),
        (
            (
                ('counter', 'FROM-STRM'),
                ('direction', 'output'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            8933798410896779,
            1552482268,
        ),
        (
            (
                ('counter', 'UNEX-OUT'),
                ('direction', 'output'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            168,
            1552482268,
        ),
        (
            (
                ('counter', 'UNEX-OUT'),
                ('direction', 'output'),
                ('ifname', 'et-8/3/0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            7280,
            1552482268,
        ),
        (
            (
                ('counter', 'ICMP_1st_frag'),
                ('direction', 'input'),
                ('ifname', 'lo0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            144,
            1552482268,
        ),
        (
            (
                ('counter', 'ICMP_1st_frag'),
                ('direction', 'input'),
                ('ifname', 'lo0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            35632,
            1552482268,
        ),
        (
            (
                ('counter', 'ICMP_frag'),
                ('direction', 'input'),
                ('ifname', 'lo0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            64,
            1552482268,
        ),
        (
            (
                ('counter', 'ICMP_frag'),
                ('direction', 'input'),
                ('ifname', 'lo0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            79222,
            1552482268,
        ),
        (
            (
                ('counter', 'ME-LINKS'),
                ('direction', 'input'),
                ('ifname', 'lo0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            1021590,
            1552482268,
        ),
        (
            (
                ('counter', 'ME-LINKS'),
                ('direction', 'input'),
                ('ifname', 'lo0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            168611060,
            1552482268,
        ),
        (
            (
                ('counter', 'MTU-EXCEED'),
                ('direction', 'input'),
                ('ifname', 'lo0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            7,
            1552482268,
        ),
        (
            (
                ('counter', 'MTU-EXCEED'),
                ('direction', 'input'),
                ('ifname', 'lo0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            560,
            1552482268,
        ),
        (
            (
                ('counter', '160Kb-ICMP'),
                ('direction', 'input'),
                ('ifname', 'lo0.0'),
                ('ifalias', None),
                ('sensor', 'packets'),
            ),
            25,
            1552482268,
        ),
        (
            (
                ('counter', '160Kb-ICMP'),
                ('direction', 'input'),
                ('ifname', 'lo0.0'),
                ('ifalias', None),
                ('sensor', 'traff'),
            ),
            1740,
            1552482268,
        ),
    ]
    assert res == exp


def test_jnpr_interface_ext():
    res = jnpr_interface_ext(JUN_IFDATA, 1552482268)
    exp = [
        ((('ifname', 'et-10/1/0'), ('ifalias', None), ('sensor', 'rx_packets')), 82918942470021, 1552482268),
        ((('ifname', 'et-10/1/0'), ('ifalias', None), ('sensor', 'rx')), 75773390873595178, 1552482268),
        ((('ifname', 'et-10/1/0'), ('ifalias', None), ('sensor', 'rx_unicast')), 82918904163123, 1552482268),
        ((('ifname', 'et-10/1/0'), ('ifalias', None), ('sensor', 'rx_errs')), 0, 1552482268),
        ((('ifname', 'et-10/1/0'), ('ifalias', None), ('sensor', 'tx_packets')), 58082598593233, 1552482268),
        ((('ifname', 'et-10/1/0'), ('ifalias', None), ('sensor', 'tx')), 38169614632067567, 1552482268),
        ((('ifname', 'et-10/1/0'), ('ifalias', None), ('sensor', 'tx_unicast')), 58082580946412, 1552482268),
        ((('ifname', 'et-10/1/0'), ('ifalias', None), ('sensor', 'tx_errs')), 0, 1552482268),
        ((('ifname', 'et-10/3/0'), ('ifalias', None), ('sensor', 'rx_packets')), 53055722384359, 1552482268),
        ((('ifname', 'et-10/3/0'), ('ifalias', None), ('sensor', 'rx')), 19797942403922336, 1552482268),
        ((('ifname', 'et-10/3/0'), ('ifalias', None), ('sensor', 'rx_unicast')), 53055664082191, 1552482268),
        ((('ifname', 'et-10/3/0'), ('ifalias', None), ('sensor', 'rx_errs')), 0, 1552482268),
        ((('ifname', 'et-10/3/0'), ('ifalias', None), ('sensor', 'tx_packets')), 55210595215351, 1552482268),
        ((('ifname', 'et-10/3/0'), ('ifalias', None), ('sensor', 'tx')), 52239370411075029, 1552482268),
        ((('ifname', 'et-10/3/0'), ('ifalias', None), ('sensor', 'tx_unicast')), 55210543337232, 1552482268),
        ((('ifname', 'et-10/3/0'), ('ifalias', None), ('sensor', 'tx_errs')), 0, 1552482268),
        (
            (('ifname', 'ae1'), ('card', 'et-10/1/0'), ('ifalias', None), ('sensor', 'rx_packets')),
            82918942470021,
            1552482268,
        ),
        (
            (('ifname', 'ae1'), ('card', 'et-10/1/0'), ('ifalias', None), ('sensor', 'rx')),
            75773390873595178,
            1552482268,
        ),
        (
            (('ifname', 'ae1'), ('card', 'et-10/1/0'), ('ifalias', None), ('sensor', 'rx_unicast')),
            82918904163123,
            1552482268,
        ),
        ((('ifname', 'ae1'), ('card', 'et-10/1/0'), ('ifalias', None), ('sensor', 'rx_errs')), 0, 1552482268),
        (
            (('ifname', 'ae1'), ('card', 'et-10/1/0'), ('ifalias', None), ('sensor', 'tx_packets')),
            58082598593233,
            1552482268,
        ),
        (
            (('ifname', 'ae1'), ('card', 'et-10/1/0'), ('ifalias', None), ('sensor', 'tx')),
            38169614632067567,
            1552482268,
        ),
        (
            (('ifname', 'ae1'), ('card', 'et-10/1/0'), ('ifalias', None), ('sensor', 'tx_unicast')),
            58082580946412,
            1552482268,
        ),
        ((('ifname', 'ae1'), ('card', 'et-10/1/0'), ('ifalias', None), ('sensor', 'tx_errs')), 0, 1552482268),
    ]
    assert exp == res


def test_jnpr_logical_interface_ext():
    res = jnpr_logical_interface_ext(JUN_LOGICAL_IFDATA, 1552482268)
    exp = [
        ((('ifname', 'xe-3/0/0.601'), ('ifalias', None), ('sensor', 'rx_packets')), 0, 1552482268),
        ((('ifname', 'xe-3/0/0.601'), ('ifalias', None), ('sensor', 'rx')), 0, 1552482268),
        ((('ifname', 'xe-3/0/0.601'), ('ifalias', None), ('sensor', 'tx_packets')), 0, 1552482268),
        ((('ifname', 'xe-3/0/0.601'), ('ifalias', None), ('sensor', 'tx')), 0, 1552482268),
        ((('ifname', 'xe-3/0/1.0'), ('ifalias', None), ('sensor', 'rx_packets')), 138631510, 1552482268),
        ((('ifname', 'xe-3/0/1.0'), ('ifalias', None), ('sensor', 'rx')), 115817876643, 1552482268),
        ((('ifname', 'xe-3/0/1.0'), ('ifalias', None), ('sensor', 'tx_packets')), 421049147568, 1552482268),
        ((('ifname', 'xe-3/0/1.0'), ('ifalias', None), ('sensor', 'tx')), 333738829036835, 1552482268),
        ((('ifname', 'xe-1/0/1.0'), ('ifalias', None), ('sensor', 'rx_packets')), 138631510, 1552482268),
        ((('ifname', 'xe-1/0/1.0'), ('ifalias', None), ('sensor', 'rx')), 115817876643, 1552482268),
        ((('ifname', 'xe-1/0/1.0'), ('ifalias', None), ('sensor', 'tx_packets')), 421049147568, 1552482268),
        ((('ifname', 'xe-1/0/1.0'), ('ifalias', None), ('sensor', 'tx')), 333738829036835, 1552482268),
        (
            (('ifname', 'ae3.0'), ('card', 'xe-3/0/1.0'), ('ifalias', None), ('sensor', 'rx_packets')),
            138631510,
            1552482268,
        ),
        ((('ifname', 'ae3.0'), ('card', 'xe-3/0/1.0'), ('ifalias', None), ('sensor', 'rx')), 115817876643, 1552482268),
        (
            (('ifname', 'ae3.0'), ('card', 'xe-3/0/1.0'), ('ifalias', None), ('sensor', 'tx_packets')),
            421049147568,
            1552482268,
        ),
        (
            (('ifname', 'ae3.0'), ('card', 'xe-3/0/1.0'), ('ifalias', None), ('sensor', 'tx')),
            333738829036835,
            1552482268,
        ),
        (
            (('ifname', 'ae3.0'), ('card', 'xe-1/0/1.0'), ('ifalias', None), ('sensor', 'rx_packets')),
            138631510,
            1552482268,
        ),
        ((('ifname', 'ae3.0'), ('card', 'xe-1/0/1.0'), ('ifalias', None), ('sensor', 'rx')), 115817876643, 1552482268),
        (
            (('ifname', 'ae3.0'), ('card', 'xe-1/0/1.0'), ('ifalias', None), ('sensor', 'tx_packets')),
            421049147568,
            1552482268,
        ),
        (
            (('ifname', 'ae3.0'), ('card', 'xe-1/0/1.0'), ('ifalias', None), ('sensor', 'tx')),
            333738829036835,
            1552482268,
        ),
    ]
    assert exp == res


def test_parse_jnpr_firewall_ext2():
    res = parse_jnpr_firewall_ext(JNX_FIREWALL_EXT, 1552482268)
    assert res == JNX_FIREWALL_EXT_RES


def test_jnpr_packet_stats_ext():
    res = jnpr_packet_stats_ext(JNX_PACKETS_STAT, 0)
    assert JNX_PACKETS_STAT_RES == res
    res_pfe = jnpr_packet_stats_pfe_ext(JNX_PACKETS_STAT_PFE, 0)
    assert JNX_PACKETS_STAT_PFE_RES == res_pfe
    res_pfe = jnpr_fabric_counters(JNX_FABRIC, 0)
    assert JNX_FABRIC_RES == res_pfe
