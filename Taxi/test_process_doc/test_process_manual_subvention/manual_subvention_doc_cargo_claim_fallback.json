{
  "doc": {
    "data": {
      "alias_id": "some_alias_id",
      "billing_contract": {
        "acquiring_percent": "0",
        "currency": "RUB",
        "currency_rate": "1",
        "donate_multiplier": "1",
        "ind_bel_nds_percent": null,
        "offer_currency": "RUB",
        "offer_currency_rate": "1",
        "rebate_percent": "0",
        "subventions_hold_delay": 99999
      },
      "billing_contract_is_set": true,
      "order_id": "some_order_id",
      "performer": {
        "db_id": "e414001e44434a00a93b65cc49548d5e",
        "driver_uuid": "7bc343fc873a49159483e487663ba761"
      },
      "subvention": {
        "amount": "223.5",
        "amount_by_reason": {
          "dryclean": "100",
          "test_reason_1": "123.5"
        },
        "currency": "RUB"
      },
      "version": 2
    },
    "doc_id": 1000,
    "event_at": "2018-11-16T13:00:00+00:00",
    "external_event_ref": "taxi/manual_subvention/some_alias_id/2",
    "external_obj_id": "taxi/manual_subvention/some_alias_id",
    "kind": "manual_subvention",
    "service": "billing-orders",
    "status": "new"
  },
  "existing_docs": [
    {
      "created": "2018-07-02T00:30:00.750000+00:01",
      "data": {
        "claim_info": {
          "billing_at": "2018-07-02T00:30:00.750000+00:00",
          "city_id": "Москва",
          "closed_without_accept": false,
          "completed_at": "2018-07-02T00:40:00.750000+00:00",
          "cost": {
            "amount": "2.0",
            "currency": "RUB"
          },
          "discount": {
            "value": "0.0"
          },
          "donate_multiplier": "1.06",
          "due": "2018-07-02T00:00:00.750000+00:00",
          "fleet_subscription_level": "level3",
          "geo_hierarchy": "russia/moscow",
          "has_co_branding": true,
          "has_lightbox": false,
          "has_sticker": false,
          "is_cargo": false,
          "need_dispatcher_acceptance": false,
          "oebs_mvp_id": "MSKc",
          "park_brandings": [],
          "park_ride_sum": "0",
          "payment_type": "cash",
          "source": "call_center",
          "status": "finished",
          "subvention_geoareas": [
            "moscow"
          ],
          "tags": [
            "some_tag"
          ],
          "tariff_class": "econom",
          "tariff_minimal_cost": "0",
          "taxi_alias_id": "some_alias_id",
          "taxi_order_id": "some_order_id",
          "taxi_status": "complete",
          "time_zone": "Europe/Moscow",
          "transporting_distance_meters": 123,
          "transporting_time_seconds": 60,
          "zone_name": "moscow"
        },
        "driver": {
          "activity_points": 0,
          "available_tariff_classes": [],
          "billing_client_id": "billing_client_id",
          "clid": "clid",
          "driver_license_personal_id": "some_driver_license_personal_id",
          "driver_profile_id": "uuid",
          "park_id": "db_id",
          "unique_driver_id": "0123456789ab0123456789ab",
          "zone_name": "driver_zone"
        },
        "version": 1
      },
      "doc_id": 12345678,
      "entry_ids": [],
      "event_at": "2018-07-02T00:40:00.750000+00:00",
      "external_event_ref": "1",
      "external_obj_id": "some_ext_obj_id",
      "kind": "cargo_claim",
      "process_at": "2018-07-02T00:40:00.750000+00:00",
      "revision": 1,
      "service": "billing-functions",
      "status": "new",
      "tags": [
        "taxi/alias_id/some_alias_id"
      ]
    },
    {
      "created": "2018-07-02T00:30:00.750000+00:01",
      "data": {
        "claim_info": {
          "billing_at": "2018-07-02T00:30:00.750000+00:00",
          "city_id": "Москва",
          "closed_without_accept": false,
          "completed_at": "2018-07-02T00:40:00.750000+00:00",
          "cost": {
            "amount": "23.0",
            "currency": "RUB"
          },
          "discount": {
            "value": "0.0"
          },
          "donate_multiplier": "1.06",
          "due": "2018-07-02T00:00:00.750000+00:00",
          "fleet_subscription_level": "level3",
          "geo_hierarchy": "russia/moscow",
          "has_co_branding": true,
          "has_lightbox": false,
          "has_sticker": false,
          "is_cargo": false,
          "need_dispatcher_acceptance": false,
          "oebs_mvp_id": "MSKc",
          "park_brandings": [],
          "park_ride_sum": "0",
          "payment_type": "cash",
          "source": "call_center",
          "status": "finished",
          "subvention_geoareas": [
            "moscow"
          ],
          "tags": [
            "some_tag"
          ],
          "tariff_class": "econom",
          "tariff_minimal_cost": "0",
          "taxi_alias_id": "some_alias_id",
          "taxi_order_id": "some_order_id",
          "taxi_status": "complete",
          "time_zone": "Europe/Moscow",
          "transporting_distance_meters": 124,
          "transporting_time_seconds": 60,
          "zone_name": "moscow"
        },
        "driver": {
          "activity_points": 0,
          "available_tariff_classes": [],
          "billing_client_id": "billing_client_id",
          "clid": "clid",
          "driver_license_personal_id": "some_driver_license_personal_id",
          "driver_profile_id": "uuid",
          "park_id": "db_id",
          "unique_driver_id": "0123456789ab0123456789ab",
          "zone_name": "driver_zone"
        },
        "version": 2
      },
      "doc_id": 123456782,
      "entry_ids": [],
      "event_at": "2018-07-02T00:40:00.750000+00:00",
      "external_event_ref": "1",
      "external_obj_id": "some_ext_obj_id",
      "kind": "cargo_claim",
      "process_at": "2018-07-02T00:40:00.750000+00:00",
      "revision": 1,
      "service": "billing-functions",
      "status": "new",
      "tags": [
        "taxi/alias_id/some_alias_id"
      ]
    },
    {
      "created": "2018-07-02T00:30:00.750000+00:00",
      "data": {
        "driver": {
          "activity_points": 0,
          "billing_client_id": "billing_client_id",
          "clid": "clid",
          "driver_license_personal_id": "some_driver_license_personal_id",
          "driver_profile_id": "uuid",
          "geo_hierarchy": "russia/moscow",
          "park_id": "db_id",
          "tags": [
            "some_tag"
          ],
          "unique_driver_id": "0123456789ab0123456789ab",
          "zone_name": "driver_zone"
        },
        "order_info": {
          "accepted_by_driver_at": "2018-07-02T00:30:00.750000+00:00",
          "alias_id": "some_alias_id",
          "billing_at": "2018-07-02T00:30:00.750000+00:00",
          "cancelled_with_captcha": false,
          "city_id": "Москва",
          "closed_without_accept": false,
          "completed_at": "2018-07-02T00:40:00.750000+00:00",
          "cost": {
            "amount": "2.0",
            "currency": "RUB"
          },
          "discount": {
            "value": "0.0"
          },
          "donate_multiplier": "1.06",
          "due": "2018-07-02T00:00:00.750000+00:00",
          "fleet_subscription_level": "level3",
          "has_co_branding": true,
          "has_lightbox": false,
          "has_sticker": false,
          "id": "some_order_id",
          "is_mqc": false,
          "need_dispatcher_acceptance": false,
          "oebs_mvp_id": "MSKc",
          "park_brandings": [],
          "park_ride_sum": "0",
          "payment_type": "cash",
          "source": "call_center",
          "status": "finished",
          "subvention_geoareas": [
            "moscow"
          ],
          "tariff_class": "econom",
          "tariff_minimal_cost": "0",
          "taxi_status": "complete",
          "time_zone": "Europe/Moscow",
          "transporting_distance_meters": 123,
          "transporting_time_seconds": 60,
          "zone_name": "moscow"
        },
        "version": 1
      },
      "doc_id": 123456783,
      "entry_ids": [],
      "event_at": "2018-07-02T00:40:00.750000+00:00",
      "external_event_ref": "1",
      "external_obj_id": "taxi/alias_id/some_alias_id",
      "kind": "fake_taxi_order",
      "process_at": "2018-07-02T00:40:00.750000+00:00",
      "revision": 1,
      "service": "billing-functions",
      "status": "new",
      "tags": [
        "taxi/alias_id/some_alias_id"
      ]
    }
  ],
  "expected_accounts": [
    {
      "account_id": 0,
      "agreement_id": "dry/migration/taxi/driver_balance",
      "currency": "RUB",
      "entity_external_id": "taximeter_driver_id/e414001e44434a00a93b65cc49548d5e/7bc343fc873a49159483e487663ba761",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "sub_account": "dry/migration/subvention"
    },
    {
      "account_id": 1,
      "agreement_id": "subvention_agreement/misc",
      "currency": "RUB",
      "entity_external_id": "taximeter_driver_id/e414001e44434a00a93b65cc49548d5e/7bc343fc873a49159483e487663ba761",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "sub_account": "income"
    }
  ],
  "expected_created_docs": [
    {
      "data": {
        "accepted_by_driver_at": "2018-07-02T00:30:00.750000+00:00",
        "activity_points": 0,
        "agglomeration": "MSKc",
        "available_tariff_classes": [],
        "base_doc_id": 1000,
        "billing_client_id": "billing_client_id",
        "billing_v2_id": null,
        "closed_without_accept": false,
        "comment": null,
        "completed_by_dispatcher": false,
        "create_via_py2": false,
        "currency_data": null,
        "db_id": "db_id",
        "discount_details": {
          "amendments": [],
          "discount": "0 RUB"
        },
        "driver_license": null,
        "dry_mode": true,
        "due": "2018-07-02T00:00:00.750000+00:00",
        "force_hold": false,
        "has_co_branding": true,
        "has_lightbox": false,
        "has_sticker": false,
        "hold_config": {
          "delay": 0
        },
        "is_cargo": false,
        "order_alias_id": "some_alias_id",
        "order_completed_at": "2018-07-02T00:40:00.750000+00:00",
        "order_id": "some_order_id",
        "order_payment_type": "cash",
        "park": null,
        "park_id": "clid",
        "rule_details": [
          {
            "extra": {
              "dryclean": "100",
              "test_reason_1": "123.5"
            },
            "is_once": true,
            "limit_ref": null,
            "payment_type": "bonus",
            "rule_id": {
              "group_id": "",
              "id": "subvention_bonus"
            },
            "rule_type": "misc",
            "subvention_geoareas": [],
            "value": "223.5000 RUB"
          }
        ],
        "rule_group": "manual",
        "sub_commission": "0 RUB",
        "subvention_geoareas": [
          "moscow"
        ],
        "tags": [
          "some_tag"
        ],
        "tariff_class": "econom",
        "unique_driver_id": "0123456789ab0123456789ab",
        "unrealized_sub_commission": "0 RUB",
        "uuid": "uuid",
        "value": "223.5000 RUB",
        "zone_name": "moscow"
      },
      "event_at": "2018-11-30T19:31:35.000000+00:00",
      "external_event_ref": "manual_subvention/1000/subventions_input_enrichment_needed",
      "external_obj_id": "alias_id/some_alias_id",
      "journal_entries": [],
      "kind": "subventions_input_enrichment_needed",
      "service": "billing-subventions",
      "status": "new"
    },
    {
      "data": {
        "version": 2
      },
      "event_at": "2018-11-30T19:31:35.000000+00:00",
      "external_event_ref": "taxi/manual_subvention/some_alias_id/2/subvention_handled",
      "external_obj_id": "taxi/manual_subvention/some_alias_id/journal",
      "journal_entries": [
        {
          "account_id": 0,
          "amount": "223.5000",
          "details": {
            "amount_by_reason": {
              "dryclean": "100 RUB",
              "test_reason_1": "123.5 RUB"
            }
          },
          "event_at": "2018-11-30T19:31:35.000000+00:00"
        },
        {
          "account_id": 1,
          "amount": "223.5000",
          "details": {
            "amount_by_reason": {
              "dryclean": "100 RUB",
              "test_reason_1": "123.5 RUB"
            }
          },
          "event_at": "2018-11-30T19:31:35.000000+00:00"
        }
      ],
      "kind": "subvention_journal",
      "service": "billing-subventions",
      "status": "new",
      "tags": [
        "system://parent_doc_id/1000",
        "journal_ancestor_doc_id/1000",
        "taxi/alias_id/some_alias_id"
      ]
    }
  ],
  "expected_created_order_docs": [],
  "expected_created_orders_docs": [],
  "expected_docs_updated_events": [],
  "expected_entities": [
    {
      "external_id": "taximeter_driver_id/e414001e44434a00a93b65cc49548d5e/7bc343fc873a49159483e487663ba761",
      "kind": "driver"
    }
  ],
  "replication_contracts": [
    {
      "CONTRACT_TYPE": 9,
      "COUNTRY": 123,
      "CURRENCY": "USD",
      "DT": "2019-10-01 00:00:00",
      "END_DT": null,
      "EXTERNAL_ID": "GEN/123456",
      "FINISH_DT": null,
      "ID": 123456,
      "IND_BEL_NDS": null,
      "IND_BEL_NDS_PERCENT": null,
      "IS_ACTIVE": 1,
      "IS_CANCELLED": 0,
      "IS_DEACTIVATED": null,
      "IS_FAXED": 1,
      "IS_SIGNED": 1,
      "IS_SUSPENDED": 0,
      "LINK_CONTRACT_ID": null,
      "NDS": 0,
      "NDS_FOR_RECEIPT": null,
      "NETTING": null,
      "NETTING_PCT": null,
      "OFFER_ACCEPTED": null,
      "PARTNER_COMMISSION_PCT": "5",
      "PARTNER_COMMISSION_PCT2": null,
      "PAYMENT_TYPE": null,
      "PERSON_ID": 8486204,
      "SERVICES": [
        111,
        128
      ]
    },
    {
      "CONTRACT_TYPE": 87,
      "COUNTRY": 123,
      "CURRENCY": "USD",
      "DT": "2019-10-01 00:00:00",
      "END_DT": null,
      "EXTERNAL_ID": "SPEND/123456",
      "FINISH_DT": null,
      "ID": 123457,
      "IND_BEL_NDS": null,
      "IND_BEL_NDS_PERCENT": null,
      "IS_ACTIVE": 1,
      "IS_CANCELLED": 0,
      "IS_DEACTIVATED": null,
      "IS_FAXED": 1,
      "IS_SIGNED": 1,
      "IS_SUSPENDED": 0,
      "LINK_CONTRACT_ID": 123456,
      "NDS": 0,
      "NDS_FOR_RECEIPT": null,
      "NETTING": null,
      "NETTING_PCT": null,
      "OFFER_ACCEPTED": null,
      "PARTNER_COMMISSION_PCT": "5",
      "PARTNER_COMMISSION_PCT2": null,
      "PAYMENT_TYPE": null,
      "PERSON_ID": 8486204,
      "SERVICES": [
        651,
        137
      ]
    }
  ]
}
