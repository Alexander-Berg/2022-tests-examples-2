[
  {
    "consumer": "scooters-surge-zoned",
    "name": "polygon_pipeline",
    "stages": [
      {
        "conditions": [],
        "in_bindings": [
          {
            "domain": "input",
            "query": "zone.id{zone_id}"
          }
        ],
        "name": "resource_fetch",
        "resources": [
          {
            "field": "scooters_events",
            "name": "scooters_events"
          }
        ],
        "source_code": "return {scooters_events: {zone_id: zone_id, geometry_type: 'polygon', max_age: 172800, allowed_types:['income', 'relocated-in']}};"
      },
      {
        "conditions": [],
        "in_bindings": [
          {
            "domain": "resource",
            "query": "scooters_events"
          }
        ],
        "name": "calc_surge",
        "out_bindings": [
          {
            "alias": "value",
            "query": "value"
          },
          {
            "alias": "extra",
            "query": "extra"
          },
          {
            "alias": "features",
            "query": "features"
          }
        ],
        "source_code": "let num = scooters_events.length; return {value: num, extra: {'scooters_events': scooters_events}, features: [num]};"
      }
    ],
    "state": "active"
  },
  {
    "consumer": "scooters-surge-zoned",
    "name": "circle_pipeline",
    "stages": [
      {
        "conditions": [],
        "in_bindings": [
          {
            "domain": "input",
            "query": "zone.id{zone_id}"
          }
        ],
        "name": "resource_fetch",
        "resources": [
          {
            "field": "scooters_events",
            "name": "scooters_events"
          }
        ],
        "source_code": "return {scooters_events: {zone_id: zone_id, geometry_type: 'circle', radius_m: 50, max_age: 172800, allowed_types:['income', 'relocated-in']}};"
      },
      {
        "conditions": [],
        "in_bindings": [
          {
            "domain": "resource",
            "query": "scooters_events"
          }
        ],
        "name": "calc_surge",
        "out_bindings": [
          {
            "alias": "value",
            "query": "value"
          },
          {
            "alias": "extra",
            "query": "extra"
          },
          {
            "alias": "features",
            "query": "features"
          }
        ],
        "source_code": "let num = scooters_events.length; return {value: num, extra: {'scooters_events': scooters_events}, features: [num]};"
      }
    ],
    "state": "active"
  },
  {
    "consumer": "scooters-surge-zoned",
    "name": "bbox_pipeline",
    "stages": [
      {
        "conditions": [],
        "in_bindings": [
          {
            "domain": "input",
            "query": "zone.id{zone_id}"
          }
        ],
        "name": "resource_fetch",
        "resources": [
          {
            "field": "scooters_events",
            "name": "scooters_events"
          }
        ],
        "source_code": "return {scooters_events: {zone_id: zone_id, geometry_type: 'bbox', radius_m: 500, max_age: 172800, allowed_types:['income', 'relocated-in']}};"
      },
      {
        "conditions": [],
        "in_bindings": [
          {
            "domain": "resource",
            "query": "scooters_events"
          }
        ],
        "name": "calc_surge",
        "out_bindings": [
          {
            "alias": "value",
            "query": "value"
          },
          {
            "alias": "extra",
            "query": "extra"
          },
          {
            "alias": "features",
            "query": "features"
          }
        ],
        "source_code": "let num = scooters_events.length; return {value: num, extra: {'scooters_events': scooters_events}, features: [num]};"
      }
    ],
    "state": "active"
  }
]
