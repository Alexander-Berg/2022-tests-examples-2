{
  "docs": [
    {
      "data": {
        "cancel_amount": "1500.00",
        "currency": "RUB",
        "periodic_payment_doc_id": 124567890,
        "schema_version": "v1"
      },
      "doc_id": 1010,
      "event_at": "2020-04-05T21:23:11.000000+00:00",
      "external_event_ref": "<external_ref>",
      "external_obj_id": "taxi/periodic_payment_cancel_confirm/clid/40321877546/<transfer_order_number>",
      "journal_entries": [],
      "kind": "periodic_payment_cancel_confirm",
      "service": "billing-orders",
      "status": "new",
      "tags": []
    }
  ],
  "expected_accounts": [
    {
      "account_id": 1,
      "agreement_id": "taxi/periodic_payments/3384",
      "currency": "RUB",
      "entity_external_id": "taximeter_driver_id/46avb74084854ba4ac37a6da264be/a57d409d08a044fc9faab63aca171bf5",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "cancel"
    },
    {
      "account_id": 2,
      "agreement_id": "taxi/park_services",
      "currency": "RUB",
      "entity_external_id": "taximeter_driver_id/46avb74084854ba4ac37a6da264be/a57d409d08a044fc9faab63aca171bf5",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "periodic_payments/cancel"
    },
    {
      "account_id": 3,
      "agreement_id": "taxi/park_services",
      "currency": "RUB",
      "entity_external_id": "taximeter_park_id/46avb74084854ba4ac37a6da264be",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "periodic_payments/cancel"
    },
    {
      "account_id": 4,
      "agreement_id": "taxi/driver_balance",
      "currency": "RUB",
      "entity_external_id": "taximeter_driver_id/46avb74084854ba4ac37a6da264be/a57d409d08a044fc9faab63aca171bf5",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "total"
    }
  ],
  "expected_docs": [
    {
      "data": {
        "amount": "1500.00",
        "base_doc_id": 1010,
        "cancel_amount": "1500.00",
        "cancellation_details": {
          "initiated_at": "2020-09-10T15:20:00.000Z",
          "initiated_by": {
            "identity": "dispatcher",
            "passport_uid": "a0ybf2g43514483c34540a0ee301f7932a1"
          }
        },
        "currency": "RUB",
        "transaction_type": "CANCEL",
        "transfer_order_date": "2020-04-05T21:00:00.000000+00:00",
        "transfer_order_number": "3384"
      },
      "event_at": "2020-04-05T21:23:11.000000+00:00",
      "external_event_ref": "<external_ref>",
      "external_obj_id": "taxi/periodic_payment/clid/40321877546/<transfer_order_number>/<external_ref>",
      "journal_entries": [
        {
          "account_id": 1,
          "amount": "1500.00",
          "details": {
            "cancellation_details": {
              "initiated_at": "2020-09-10T15:20:00.000Z",
              "initiated_by": {
                "identity": "dispatcher",
                "passport_uid": "a0ybf2g43514483c34540a0ee301f7932a1"
              }
            },
            "transfer_order_number": "3384"
          },
          "event_at": "2020-04-05T21:23:11.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 2,
          "amount": "-1500.00",
          "details": {
            "cancellation_details": {
              "initiated_at": "2020-09-10T15:20:00.000Z",
              "initiated_by": {
                "identity": "dispatcher",
                "passport_uid": "a0ybf2g43514483c34540a0ee301f7932a1"
              }
            },
            "transfer_order_number": "3384"
          },
          "event_at": "2020-04-05T21:23:11.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 3,
          "amount": "-1500.00",
          "details": {
            "cancellation_details": {
              "initiated_at": "2020-09-10T15:20:00.000Z",
              "initiated_by": {
                "identity": "dispatcher",
                "passport_uid": "a0ybf2g43514483c34540a0ee301f7932a1"
              }
            },
            "driver": {
              "driver_uuid": "a57d409d08a044fc9faab63aca171bf5"
            },
            "transfer_order_number": "3384"
          },
          "event_at": "2020-04-05T21:23:11.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 4,
          "amount": "-1500.00",
          "details": {},
          "event_at": "2020-04-05T21:23:11.000000+00:00",
          "reason": ""
        }
      ],
      "kind": "periodic_payment_journal",
      "service": "billing-calculators",
      "status": "complete"
    }
  ],
  "expected_entities": [
    {
      "external_id": "taximeter_driver_id/46avb74084854ba4ac37a6da264be/a57d409d08a044fc9faab63aca171bf5",
      "kind": "driver"
    },
    {
      "external_id": "taximeter_park_id/46avb74084854ba4ac37a6da264be",
      "kind": "park"
    }
  ],
  "expected_orders": [],
  "expected_tlog_entries": [],
  "reports": {
    "docs/by_id": {
      "docs": [
        {
          "data": {
            "amount": "1500.00",
            "cancellation_details": {
              "initiated_at": "2020-09-10T15:20:00.000Z",
              "initiated_by": {
                "identity": "dispatcher",
                "passport_uid": "a0ybf2g43514483c34540a0ee301f7932a1"
              }
            },
            "currency": "RUB",
            "driver": {
              "db_id": "46avb74084854ba4ac37a6da264be",
              "uuid": "a57d409d08a044fc9faab63aca171bf5"
            },
            "external_driver": {
              "billing_client_id": "13575401",
              "billing_contract_id": "13575401",
              "clid": "643753730232",
              "db_id": "7ad36bc7560449998acbe2c57a75c293",
              "uuid": "b231234483c34540a0ee39601f7932a1"
            },
            "park": {
              "billing_client_id": "123124",
              "billing_contract_id": "23423423",
              "clid": "40321877546",
              "db_id": "df92c77a05c2a34854ba4ac31"
            },
            "schema_version": "v1",
            "transaction_type": "PAYMENT",
            "transfer_order_date": "2020-04-05T21:00:00Z",
            "transfer_order_number": "3384"
          },
          "doc_id": 124567890,
          "event_at": "2020-04-05T21:23:11.000000+00:00",
          "external_ref": "<external_ref>",
          "journal_entries": [],
          "kind": "periodic_payment",
          "service": "billing-orders",
          "status": "new",
          "tags": [],
          "topic": "taxi/periodic_payment/clid/40321877546/<transfer_order_number>"
        }
      ]
    },
    "docs/select": {
      "docs": []
    },
    "journal/search": {
      "entries": [
        {
          "account": {
            "account_id": 1,
            "agreement_id": "taxi/periodic_payments/3384",
            "currency": "RUB",
            "entity_external_id": "taximeter_driver_id/46avb74084854ba4ac37a6da264be/a57d409d08a044fc9faab63aca171bf5",
            "sub_account": "cancel"
          },
          "amount": "1500.00",
          "details": {
            "cancellation_details": {
              "initiated_at": "2020-09-10T15:20:00.000Z",
              "initiated_by": {
                "identity": "dispatcher",
                "passport_uid": "a0ybf2g43514483c34540a0ee301f7932a1"
              }
            },
            "transfer_order_number": "3384"
          },
          "doc_ref": "2001",
          "entry_id": 1755330111,
          "event_at": "2020-04-05T21:23:11.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 2,
            "agreement_id": "taxi/park_services",
            "currency": "RUB",
            "entity_external_id": "taximeter_driver_id/46avb74084854ba4ac37a6da264be/a57d409d08a044fc9faab63aca171bf5",
            "sub_account": "periodic_payments/cancel"
          },
          "amount": "-1500.00",
          "details": {
            "cancellation_details": {
              "initiated_at": "2020-09-10T15:20:00.000Z",
              "initiated_by": {
                "identity": "dispatcher",
                "passport_uid": "a0ybf2g43514483c34540a0ee301f7932a1"
              }
            },
            "transfer_order_number": "3384"
          },
          "doc_ref": "2001",
          "entry_id": 1755330112,
          "event_at": "2020-04-05T21:23:11.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 3,
            "agreement_id": "taxi/park_services",
            "currency": "RUB",
            "entity_external_id": "taximeter_park_id/46avb74084854ba4ac37a6da264be",
            "sub_account": "periodic_payments/cancel"
          },
          "amount": "-1500.00",
          "details": {
            "cancellation_details": {
              "initiated_at": "2020-09-10T15:20:00.000Z",
              "initiated_by": {
                "identity": "dispatcher",
                "passport_uid": "a0ybf2g43514483c34540a0ee301f7932a1"
              }
            },
            "driver": {
              "driver_uuid": "a57d409d08a044fc9faab63aca171bf5"
            },
            "transfer_order_number": "3384"
          },
          "doc_ref": "2001",
          "entry_id": 1755330113,
          "event_at": "2020-04-05T21:23:11.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 4,
            "agreement_id": "taxi/driver_balance",
            "currency": "RUB",
            "entity_external_id": "taximeter_driver_id/46avb74084854ba4ac37a6da264be/a57d409d08a044fc9faab63aca171bf5",
            "sub_account": "total"
          },
          "amount": "-1500.00",
          "details": {},
          "doc_ref": "2001",
          "entry_id": 1755330114,
          "event_at": "2020-04-05T21:23:11.000000+00:00",
          "reason": ""
        }
      ]
    }
  }
}
