FUNC(abs,ARGS((val,double)),B(CR(res=SL(2,18,2,40,T(SL(2,19,2,26,B(FA(val,double),<,0.000000)),SL(2,30,2,35,U(-,FA(val,double))),SL(2,37,2,40,FA(val,double)))))));FUNC(min,ARGS((a,double),(b,double)),B(CR(res=SL(6,16,6,31,T(SL(6,17,6,22,B(FA(a,double),<,FA(b,double))),SL(6,26,6,28,FA(a,double)),SL(6,30,6,31,FA(b,double)))))));FUNC(max,ARGS((a,double),(b,double)),B(CR(res=SL(10,16,10,31,T(SL(10,17,10,22,B(FA(a,double),>,FA(b,double))),SL(10,26,10,28,FA(a,double)),SL(10,30,10,31,FA(b,double)))))));FUNC(calculateHyperbolaDiscountPercent,ARGS((hyperbolas,clients::discounts::HyperbolasData),(price,double)),B(SV(hyperbola,SL(15,20,17,36,T(SL(15,21,15,49,B(FA(price,double),<,B(FA(hyperbolas,clients::discounts::HyperbolasData),.,F(threshold)))),SL(16,10,17,8,B(FA(hyperbolas,clients::discounts::HyperbolasData),.,F(hyperbola_lower))),SL(17,10,17,36,B(FA(hyperbolas,clients::discounts::HyperbolasData),.,F(hyperbola_upper))))));IF(SL(20,8,20,49,B(B(FC(abs,NT(val=SL(20,16,20,35,B(FA(price,double),+,B(VA(hyperbola),.,F(c))))),R(res=double)),.,F(res)),<,0.000100)),CR(res=SL(21,22,21,23,0.000000)));CR(res=SL(25,18,25,69,B(B(VA(hyperbola),.,F(p)),+,B(B(VA(hyperbola),.,F(a)),/,SL(25,48,25,67,B(FA(price,double),+,B(VA(hyperbola),.,F(c))))))))));FUNC(processTableElement,ARGS((elem,clients::discounts::TableDataA),(first_iteration,bool),(has_result,bool),(prev_elem_coeff,double),(prev_elem_price,double),(price,double),(result,double)),B(IF(SL(36,8,36,18,FA(has_result,bool)),CR(first_iteration=SL(42,30,42,35,false),has_result=SL(38,25,38,29,true),prev_elem_coeff=SL(44,30,45,8,B(FA(elem,clients::discounts::TableDataA),.,F(coeff))),prev_elem_price=SL(43,30,43,40,B(FA(elem,clients::discounts::TableDataA),.,F(price))),price=SL(41,20,41,25,FA(price,double)),result=SL(39,21,39,27,FA(result,double))));IF(SL(49,8,49,45,B(FA(first_iteration,bool),&&,B(FA(price,double),<,B(FA(elem,clients::discounts::TableDataA),.,F(price))))),CR(first_iteration=SL(54,30,54,35,false),has_result=SL(51,25,51,29,true),prev_elem_coeff=SL(56,30,57,8,B(FA(elem,clients::discounts::TableDataA),.,F(coeff))),prev_elem_price=SL(55,30,55,40,B(FA(elem,clients::discounts::TableDataA),.,F(price))),price=SL(53,20,53,25,FA(price,double)),result=SL(52,21,52,31,B(FA(elem,clients::discounts::TableDataA),.,F(coeff)))));IF(SL(61,8,61,74,B(B(U(!,FA(first_iteration,bool)),&&,B(FA(prev_elem_price,double),<=,FA(price,double))),&&,B(FA(price,double),<,B(FA(elem,clients::discounts::TableDataA),.,F(price))))),IF(SL(63,12,63,62,B(B(FC(abs,NT(val=SL(63,20,63,48,B(B(FA(elem,clients::discounts::TableDataA),.,F(price)),-,FA(prev_elem_price,double)))),R(res=double)),.,F(res)),<,0.000100)),CR(first_iteration=SL(68,34,68,39,false),has_result=SL(65,29,65,33,true),prev_elem_coeff=SL(70,34,71,12,B(FA(elem,clients::discounts::TableDataA),.,F(coeff))),prev_elem_price=SL(69,34,69,44,B(FA(elem,clients::discounts::TableDataA),.,F(price))),price=SL(67,24,67,29,FA(price,double)),result=SL(66,25,66,26,0.000000)));CR(first_iteration=SL(80,30,80,35,false),has_result=SL(75,25,75,29,true),prev_elem_coeff=SL(82,30,83,8,B(FA(elem,clients::discounts::TableDataA),.,F(coeff))),prev_elem_price=SL(81,30,81,40,B(FA(elem,clients::discounts::TableDataA),.,F(price))),price=SL(79,20,79,25,FA(price,double)),result=SL(76,21,78,52,B(FA(prev_elem_coeff,double),+,B(B(SL(77,19,77,47,B(B(FA(elem,clients::discounts::TableDataA),.,F(coeff)),-,FA(prev_elem_coeff,double))),*,SL(77,52,77,75,B(FA(price,double),-,FA(prev_elem_price,double)))),/,SL(78,23,78,51,B(B(FA(elem,clients::discounts::TableDataA),.,F(price)),-,FA(prev_elem_price,double))))))));CR(first_iteration=SL(91,26,91,31,false),has_result=SL(88,21,88,26,false),prev_elem_coeff=SL(93,26,94,4,B(FA(elem,clients::discounts::TableDataA),.,F(coeff))),prev_elem_price=SL(92,26,92,36,B(FA(elem,clients::discounts::TableDataA),.,F(price))),price=SL(90,16,90,21,FA(price,double)),result=SL(89,17,89,23,FA(result,double)))));FUNC(calculateTableDiscountPercent,ARGS((price,double),(table,std::vector<clients::discounts::TableDataA>)),B(SV(process_table_result,SL(99,31,106,6,FL(SL(99,36,99,42,FA(table,std::vector<clients::discounts::TableDataA>)),elem,NT(first_iteration=SL(103,26,103,30,true),has_result=SL(100,21,100,26,false),prev_elem_coeff=SL(105,26,106,4,0.000000),prev_elem_price=SL(104,26,104,27,0.000000),price=SL(102,16,102,21,FA(price,double)),result=SL(101,17,101,18,0.000000)),FC(processTableElement,NT(elem=VA(elem),first_iteration=VA(first_iteration),has_result=VA(has_result),prev_elem_coeff=VA(prev_elem_coeff),prev_elem_price=VA(prev_elem_price),price=VA(price),result=VA(result)),R(first_iteration=bool,has_result=bool,prev_elem_coeff=double,prev_elem_price=double,price=double,result=double)))));IF(SL(109,8,109,39,B(VA(process_table_result),.,F(has_result))),CR(res=SL(110,22,110,49,B(VA(process_table_result),.,F(result)))));CR(res=SL(114,18,114,54,B(VA(process_table_result),.,F(prev_elem_coeff))))));FUNC(normalizeToMinMax,ARGS((coeff,double),(restrictions,clients::discounts::DiscountRestrictions)),B(SV(coeff_limited_to_max,SL(119,31,119,86,B(FC(min,NT(a=SL(119,39,119,44,FA(coeff,double)),b=SL(119,50,119,81,B(FA(restrictions,clients::discounts::DiscountRestrictions),.,F(max_discount_coeff)))),R(res=double)),.,F(res))));CR(res=SL(122,14,123,4,T(SL(122,15,122,69,B(VA(coeff_limited_to_max),<,B(FA(restrictions,clients::discounts::DiscountRestrictions),.,F(min_discount_coeff)))),SL(122,73,122,75,0.000000),SL(122,77,123,4,VA(coeff_limited_to_max)))))));FUNC(normalizeByMaxAbsoluteValue,ARGS((coeff,double),(max_absolute_value_opt,std::optional<double>),(price,double)),B(IF(U(?,SL(127,8,127,31,FA(max_absolute_value_opt,std::optional<double>))),IF(SL(128,12,128,64,B(B(B(FA(price,double),*,FA(coeff,double)),>,U(*,SL(127,8,127,31,FA(max_absolute_value_opt,std::optional<double>)))),&&,B(FA(price,double),>,0.000100))),CR(res=SL(130,22,132,12,B(FC(min,NT(a=SL(130,30,130,76,B(FC(max,NT(a=SL(130,38,130,64,B(U(*,SL(127,8,127,31,FA(max_absolute_value_opt,std::optional<double>))),/,FA(price,double))),b=SL(130,70,130,71,0.000000)),R(res=double)),.,F(res))),b=SL(131,30,131,31,1.000000)),R(res=double)),.,F(res))))));CR(res=SL(135,18,135,23,FA(coeff,double)))));IF(U(?,SL(138,4,138,17,B(fix,.,F(discount)))),IF(U(?,SL(141,8,141,40,B(U(*,B(fix,.,F(discount))),.,F(is_price_strikethrough)))),IF(SL(142,12,142,35,U(!,U(*,B(U(*,B(fix,.,F(discount))),.,F(is_price_strikethrough))))),CR(boarding=B(SL(143,19,143,29,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(143,19,143,29,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(143,19,143,29,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(143,19,143,29,B(ride,.,F(price))),.,F(requirements)),time=B(SL(143,19,143,29,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(143,19,143,29,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(143,19,143,29,B(ride,.,F(price))),.,F(waiting)))));SV(restrictions,SL(147,23,147,44,B(U(*,B(fix,.,F(discount))),.,F(restrictions))));SV(meta1,SL(149,16,149,47,MAP("discount_price"=U(*,B(ride,.,F(price))))));SV(affected_price,SL(152,25,154,69,B(B(B(U(*,B(ride,.,F(price))),-,B(B(ride,.,F(price)),.,F(waiting))),-,B(B(ride,.,F(price)),.,F(transit_waiting))),-,B(B(ride,.,F(price)),.,F(destination_waiting)))));SV(percent,SL(156,18,160,15,T(U(?,SL(156,19,156,49,B(U(*,B(fix,.,F(discount))),.,F(calc_data_hyperbolas)))),SL(157,10,158,8,B(FC(calculateHyperbolaDiscountPercent,NT(hyperbolas=SL(157,57,157,60,U(*,B(U(*,B(fix,.,F(discount))),.,F(calc_data_hyperbolas)))),price=SL(157,70,157,84,VA(affected_price))),R(res=double)),.,F(res))),SL(158,10,160,15,T(U(?,SL(158,11,158,41,B(U(*,B(fix,.,F(discount))),.,F(calc_data_table_data)))),SL(159,14,160,12,B(FC(calculateTableDiscountPercent,NT(price=SL(159,65,159,79,VA(affected_price)),table=SL(159,52,159,55,U(*,B(U(*,B(fix,.,F(discount))),.,F(calc_data_table_data))))),R(res=double)),.,F(res))),SL(160,14,160,15,0.000000))))));SV(coeff_initial,SL(162,24,162,38,B(VA(percent),*,0.010000)));SV(coeff1,SL(163,17,163,18,1.000000));SV(coeff2,SL(164,17,164,83,B(FC(normalizeToMinMax,NT(coeff=SL(164,43,164,49,VA(coeff1)),restrictions=SL(164,66,164,78,VA(restrictions))),R(res=double)),.,F(res))));SV(coeff3,SL(165,17,166,106,B(FC(normalizeByMaxAbsoluteValue,NT(coeff=SL(165,53,165,59,VA(coeff2)),max_absolute_value_opt=SL(166,70,166,101,B(VA(restrictions),.,F(max_absolute_value))),price=SL(165,69,165,83,VA(affected_price))),R(res=double)),.,F(res))));IF(SL(167,8,167,19,B(VA(coeff3),<=,0.000000)),CR(boarding=B(SL(168,15,168,25,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(168,15,168,25,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(168,15,168,25,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(168,15,168,25,B(ride,.,F(price))),.,F(requirements)),time=B(SL(168,15,168,25,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(168,15,168,25,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(168,15,168,25,B(ride,.,F(price))),.,F(waiting))));SV(coeff_final,SL(170,22,170,48,B(FC(min,NT(a=SL(170,30,170,36,VA(coeff3)),b=SL(170,42,170,43,1.000000)),R(res=double)),.,F(res))));SV(delta,SL(172,16,172,45,B(U(-,VA(affected_price)),*,VA(coeff_final))));SV(meta2,SL(174,16,178,5,MAP("discount_value"=VA(coeff_final),"discount_delta_raw"=VA(delta))));SV(mult,SL(180,15,180,30,B(1.000000,-,VA(coeff_final))));CR(boarding=SL(182,19,182,45,B(B(B(ride,.,F(price)),.,F(boarding)),*,VA(mult))),destination_waiting=SL(188,30,188,60,B(B(ride,.,F(price)),.,F(destination_waiting))),distance=SL(183,19,183,45,B(B(B(ride,.,F(price)),.,F(distance)),*,VA(mult))),metadata=SL(189,19,190,4,B(VA(meta1),+,VA(meta2))),requirements=SL(185,23,185,53,B(B(B(ride,.,F(price)),.,F(requirements)),*,VA(mult))),time=SL(184,15,184,37,B(B(B(ride,.,F(price)),.,F(time)),*,VA(mult))),transit_waiting=SL(187,26,187,52,B(B(ride,.,F(price)),.,F(transit_waiting))),waiting=SL(186,18,186,36,B(B(ride,.,F(price)),.,F(waiting)))));CR(boarding=B(SL(193,7,193,17,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(193,7,193,17,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(193,7,193,17,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(193,7,193,17,B(ride,.,F(price))),.,F(requirements)),time=B(SL(193,7,193,17,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(193,7,193,17,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(193,7,193,17,B(ride,.,F(price))),.,F(waiting)))