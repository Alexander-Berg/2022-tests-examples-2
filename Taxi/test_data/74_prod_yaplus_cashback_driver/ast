FUNC(getAvailableCashback,ARGS(),B(IF(U(?,SL(2,6,2,37,B(B(fix,.,F(category_data)),.,F(yaplus_coeff)))),CR(enabled=SL(3,20,3,24,true),price_decreasing_coeff=SL(3,70,3,82,U(*,B(B(fix,.,F(category_data)),.,F(yaplus_coeff)))),rate=SL(3,31,3,45,B(1.000000,-,U(*,B(B(fix,.,F(category_data)),.,F(yaplus_coeff)))))));CR(enabled=SL(6,18,6,23,false),price_decreasing_coeff=SL(6,58,6,61,1.000000),rate=SL(6,30,6,33,0.000000))));FUNC(calcCashback,ARGS((base,double),(rate,double)),B(FG(UserMeta,IF(SL(11,8,11,53,B("cashback_fixed_price",in,B(B(ride,.,F(ride)),.,F(user_meta)))),CR(metadata=SL(14,19,16,11,MAP("used_meta"=B(B(B(ride,.,F(ride)),.,F(user_meta)),.,SL(15,45,15,67,"cashback_fixed_price")))),value=SL(13,16,13,59,B(B(B(ride,.,F(ride)),.,F(user_meta)),.,SL(13,36,13,58,"cashback_fixed_price")))));CR(metadata=SL(19,38,19,55,MAP("empty meta"=1.000000)),value=SL(19,18,19,27,B(FA(base,double),*,FA(rate,double)))));CR(metadata=SL(21,36,21,50,MAP("no meta"=1.000000)),value=SL(21,16,21,25,B(FA(base,double),*,FA(rate,double))))));SV(unite_total_price_enabled,SL(25,32,25,72,B("cashback_unite_total_price",in,B(fix,.,F(exps)))));IF(SL(26,4,26,30,U(!,VA(unite_total_price_enabled))),CR(boarding=B(SL(27,9,27,19,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(27,9,27,19,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(27,9,27,19,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(27,9,27,19,B(ride,.,F(price))),.,F(requirements)),time=B(SL(27,9,27,19,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(27,9,27,19,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(27,9,27,19,B(ride,.,F(price))),.,F(waiting))));IF(U(?,SL(30,3,30,20,B(fix,.,F(payment_type)))),SV(corp_type,SL(31,18,31,40,B(U(*,B(fix,.,F(payment_type))),==,"corp")));SV(wallet_type,SL(32,20,32,53,B(U(*,B(fix,.,F(payment_type))),==,"personal_wallet")));SV(corp_acc_type,SL(33,22,33,52,B(U(*,B(fix,.,F(payment_type))),==,"coop_account")));SV(bad_type,SL(34,17,34,58,B(B(VA(corp_type),||,VA(wallet_type)),||,VA(corp_acc_type))));IF(SL(36,6,36,31,U(!,B(B(fix,.,F(user_data)),.,F(has_yaplus)))),CR(boarding=B(SL(37,11,37,21,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(37,11,37,21,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(37,11,37,21,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(37,11,37,21,B(ride,.,F(price))),.,F(requirements)),time=B(SL(37,11,37,21,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(37,11,37,21,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(37,11,37,21,B(ride,.,F(price))),.,F(waiting))));IF(SL(39,6,39,14,VA(bad_type)),CR(boarding=B(SL(40,11,40,21,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(40,11,40,21,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(40,11,40,21,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(40,11,40,21,B(ride,.,F(price))),.,F(requirements)),time=B(SL(40,11,40,21,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(40,11,40,21,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(40,11,40,21,B(ride,.,F(price))),.,F(waiting))));SV(cashback_params,SL(43,24,43,46,FC(getAvailableCashback,NT(),R(enabled=bool,price_decreasing_coeff=double,rate=double))));IF(SL(44,6,44,29,B(VA(cashback_params),.,F(enabled))),IF(SL(46,8,46,40,U(!,B(B(fix,.,F(user_data)),.,F(has_cashback_plus)))),CR(boarding=B(SL(47,13,47,23,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(47,13,47,23,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(47,13,47,23,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(47,13,47,23,B(ride,.,F(price))),.,F(requirements)),time=B(SL(47,13,47,23,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(47,13,47,23,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(47,13,47,23,B(ride,.,F(price))),.,F(waiting))));IF(SL(51,8,51,30,B(U(*,B(fix,.,F(payment_type))),==,"cash")),CR(boarding=B(SL(52,13,52,23,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(52,13,52,23,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(52,13,52,23,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(52,13,52,23,B(ride,.,F(price))),.,F(requirements)),time=B(SL(52,13,52,23,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(52,13,52,23,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(52,13,52,23,B(ride,.,F(price))),.,F(waiting))));IF(U(?,SL(55,8,55,24,B(fix,.,F(complements)))),CR(boarding=B(SL(56,13,56,23,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(56,13,56,23,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(56,13,56,23,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(56,13,56,23,B(ride,.,F(price))),.,F(requirements)),time=B(SL(56,13,56,23,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(56,13,56,23,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(56,13,56,23,B(ride,.,F(price))),.,F(waiting))));IF(SL(65,8,65,53,B(B(VA(cashback_params),.,F(price_decreasing_coeff)),<,0.010000)),CR(boarding=B(SL(66,13,66,23,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(66,13,66,23,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(66,13,66,23,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(66,13,66,23,B(ride,.,F(price))),.,F(requirements)),time=B(SL(66,13,66,23,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(66,13,66,23,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(66,13,66,23,B(ride,.,F(price))),.,F(waiting))));IF(SL(70,8,70,35,B(B(VA(cashback_params),.,F(rate)),<,0.010000)),CR(boarding=B(SL(71,13,71,23,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(71,13,71,23,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(71,13,71,23,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(71,13,71,23,B(ride,.,F(price))),.,F(requirements)),time=B(SL(71,13,71,23,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(71,13,71,23,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(71,13,71,23,B(ride,.,F(price))),.,F(waiting))));SV(cashback_for_plus_available,SL(74,38,74,82,B("cashback_for_plus_availability",in,B(fix,.,F(exps)))));IF(SL(75,8,75,36,U(!,VA(cashback_for_plus_available))),CR(boarding=B(SL(76,13,76,23,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(76,13,76,23,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(76,13,76,23,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(76,13,76,23,B(ride,.,F(price))),.,F(requirements)),time=B(SL(76,13,76,23,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(76,13,76,23,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(76,13,76,23,B(ride,.,F(price))),.,F(waiting))));SV(cashback_rate,SL(79,24,79,44,B(VA(cashback_params),.,F(rate))));SV(price_decreasing_coeff,SL(80,33,80,71,B(VA(cashback_params),.,F(price_decreasing_coeff))));SV(rounded_total_price,SL(82,30,82,72,B(U(*,B(ride,.,F(price))),round_to,B(fix,.,F(rounding_factor)))));SV(calc_res,SL(83,19,83,77,FC(calcCashback,NT(base=SL(83,37,83,56,VA(rounded_total_price)),rate=SL(83,63,83,76,VA(cashback_rate))),R(metadata=std::unordered_map<std::string,double>,value=double))));SV(cashback_price,SL(84,25,84,39,B(VA(calc_res),.,F(value))));SV(rounded_cashback_price,SL(85,33,85,78,B(VA(cashback_price),round_to,B(fix,.,F(rounding_factor)))));SV(rounded_new_ride_price,SL(86,33,86,77,B(VA(rounded_total_price),-,VA(rounded_cashback_price))));SV(new_price_decreasing_coeff,SL(88,37,90,30,T(SL(88,38,88,54,B(U(*,B(ride,.,F(price))),>=,1.000000)),SL(89,8,90,6,B(VA(rounded_new_ride_price),/,SL(89,32,89,43,U(*,B(ride,.,F(price)))))),SL(90,8,90,30,VA(price_decreasing_coeff)))));SV(meta,SL(92,15,92,32,B(VA(calc_res),.,F(metadata))));CR(boarding=B(SL(94,18,94,57,B(B(ride,.,F(price)),*,VA(new_price_decreasing_coeff))),.,F(boarding)),destination_waiting=B(SL(94,18,94,57,B(B(ride,.,F(price)),*,VA(new_price_decreasing_coeff))),.,F(destination_waiting)),distance=B(SL(94,18,94,57,B(B(ride,.,F(price)),*,VA(new_price_decreasing_coeff))),.,F(distance)),metadata=SL(94,69,94,73,VA(meta)),requirements=B(SL(94,18,94,57,B(B(ride,.,F(price)),*,VA(new_price_decreasing_coeff))),.,F(requirements)),time=B(SL(94,18,94,57,B(B(ride,.,F(price)),*,VA(new_price_decreasing_coeff))),.,F(time)),transit_waiting=B(SL(94,18,94,57,B(B(ride,.,F(price)),*,VA(new_price_decreasing_coeff))),.,F(transit_waiting)),waiting=B(SL(94,18,94,57,B(B(ride,.,F(price)),*,VA(new_price_decreasing_coeff))),.,F(waiting)))));CR(boarding=B(SL(98,7,98,17,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(98,7,98,17,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(98,7,98,17,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(98,7,98,17,B(ride,.,F(price))),.,F(requirements)),time=B(SL(98,7,98,17,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(98,7,98,17,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(98,7,98,17,B(ride,.,F(price))),.,F(waiting)))