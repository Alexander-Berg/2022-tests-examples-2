{
  "event": {
    "$order_ready_for_billing_doc": {
      "order": {
        "$order": {
          "accepted_by_driver_at": {
            "$datetime": "2019-11-18T00:00:00+03:00"
          },
          "completed_at": {
            "$datetime": "2019-11-19T01:00:00+03:00"
          },
          "coupon": {
            "$money": "100 RUB"
          },
          "due": {
            "$datetime": "2019-11-18T11:10:00+03:00"
          },
          "payment_type": "cash",
          "performer": {
            "$blueprint:performer": {
              "available_tariff_classes": {
                "$frozenset": [
                  "econom"
                ]
              }
            }
          },
          "status": "cancelled"
        }
      }
    }
  },
  "expected_event_handled": {
    "$blueprint:rule_event_handled": {
      "journal_entries": [
        {
          "$journal_entry": {
            "agreement_id": "subvention_agreement/1/default/_id/driver_fix_rule_id",
            "all_reasons": [
              {
                "$factory:unfit_reason": {
                  "code": "cancelled_by_cash",
                  "details": {
                    "expected": false,
                    "value": true
                  },
                  "sub_kind": "eq"
                }
              }
            ],
            "delta": {
              "$money": "200 RUB"
            },
            "details": {
              "$journal_entry_details": {
                "alias_id": "some_alias_id"
              }
            },
            "entity": {
              "$entity": {
                "external_id": "taximeter_driver_id/some_db_id/some_uuid",
                "kind": "driver"
              }
            },
            "event_at": {
              "$datetime": "2019-11-18T00:00:00+03:00"
            },
            "sub_account": "unfit/income"
          }
        },
        {
          "$journal_entry": {
            "agreement_id": "subvention_agreement/1/default/_id/driver_fix_rule_id",
            "all_reasons": [],
            "delta": {
              "$money": "1500 XXX"
            },
            "details": {
              "$journal_entry_details": {
                "alias_id": "some_alias_id",
                "order_completed_at": "2019-11-18T22:00:00.000000+00:00",
                "order_id": "some_order_id"
              }
            },
            "entity": {
              "$entity": {
                "external_id": "taximeter_driver_id/some_db_id/some_uuid",
                "kind": "driver"
              }
            },
            "event_at": {
              "$datetime": "2019-11-18T00:00:00+03:00"
            },
            "sub_account": "time/on_order_minutes"
          }
        },
        {
          "$journal_entry": {
            "agreement_id": "subvention_agreement/1/default/_id/driver_fix_rule_id",
            "all_reasons": [],
            "delta": {
              "$money": "1500 RUB"
            },
            "details": {
              "$journal_entry_details": {
                "intervals": [
                  {
                    "duration_min": "1500",
                    "rate_per_min": "1"
                  }
                ]
              }
            },
            "entity": {
              "$entity": {
                "external_id": "taximeter_driver_id/some_db_id/some_uuid",
                "kind": "driver"
              }
            },
            "event_at": {
              "$datetime": "2019-11-18T00:00:00+03:00"
            },
            "sub_account": "guarantee"
          }
        },
        {
          "$journal_entry": {
            "agreement_id": "subvention_agreement/1/default/_id/driver_fix_rule_id",
            "all_reasons": [],
            "delta": {
              "$money": "1500 RUB"
            },
            "details": {
              "$journal_entry_details": {
                "intervals": [
                  {
                    "duration_min": "1500",
                    "rate_per_min": "1"
                  }
                ]
              }
            },
            "entity": {
              "$entity": {
                "external_id": "taximeter_driver_id/some_db_id/some_uuid",
                "kind": "driver"
              }
            },
            "event_at": {
              "$datetime": "2019-11-18T00:00:00+03:00"
            },
            "sub_account": "guarantee/on_order"
          }
        }
      ],
      "shift_ended_events": [
        {
          "$blueprint:shift_ended": {
            "agreement_ref": {
              "$agreement_ref": "subvention_agreement/1/default/_id/driver_fix_rule_id"
            },
            "antifraud_rule": {
              "$antifraud_rule": {
                "days_span": 1,
                "kind": "driver_fix",
                "last_shift_date": {
                  "$date": "2019-11-18"
                },
                "zone_name": "moscow"
              }
            },
            "commission_input": null,
            "driver": {
              "$blueprint:driver": {
                "db_id": "some_db_id",
                "park_id": "some_clid",
                "unique_driver_id": {
                  "$oid": "5bab4bf979b9e5513fe5ec4a"
                },
                "uuid": "some_uuid"
              }
            },
            "last_date": {
              "$date": "2019-11-18"
            },
            "pay_after": {
              "$datetime": "2019-11-19T04:00:00+03:00"
            },
            "pay_to": {
              "$entity": {
                "external_id": "taximeter_driver_id/some_db_id/some_uuid",
                "kind": "driver"
              }
            },
            "payment_id": "2019-11-18T21:00:00.000000+00:00",
            "possible_frauder": {
              "$antifraud_driver": {
                "driver_license_personal_ids": [
                  "8hd93jdlakhf84030ejd9390z"
                ],
                "driver_licenses": [],
                "unique_driver_id": {
                  "$oid": "5bab4bf979b9e5513fe5ec4a"
                }
              }
            },
            "rule_data": {
              "$shift_ended_rule_data": {
                "data": {
                  "currency": "RUB",
                  "end": "2019-11-19T00:00:00.000000+03:00",
                  "geoarea": "moscow_center",
                  "group_id": "driver_fix_rule_group_id",
                  "id": "driver_fix_rule_id",
                  "profile_payment_type_restrictions": "any",
                  "profile_tariff_classes": [
                    "econom"
                  ],
                  "rates": [
                    {
                      "rate_per_minute": "1",
                      "starts_at": {
                        "hour": 12,
                        "iso_week_day": 1,
                        "minute": 0
                      }
                    }
                  ],
                  "timezone_id": "Europe/Moscow",
                  "zone_name": "moscow"
                },
                "subvention_type": {
                  "$subvention_type": "driver_fix"
                }
              }
            },
            "shift": {
              "$shift": {
                "end": {
                  "$datetime": "2019-11-19T00:00:00+03:00"
                },
                "start": {
                  "$datetime": "2019-11-18T00:00:00+03:00"
                }
              }
            },
            "use_stats_of": {
              "$entity": {
                "external_id": "taximeter_driver_id/some_db_id/some_uuid",
                "kind": "driver"
              }
            }
          }
        }
      ]
    }
  },
  "rule": {
    "$blueprint:driver_fix_rule": {
      "data": {
        "$blueprint:driver_fix_rule_data": {
          "rate_intervals": {
            "$factory:driver_fix_rate_intervals": [
              "Mon 12:00, 1"
            ]
          }
        }
      },
      "matcher": {
        "$moscow_rule_matcher": {
          "end": {
            "$datetime": "2019-11-19T00:00:00+03:00"
          },
          "start": {
            "$datetime": "2019-11-18T00:00:00+03:00"
          }
        }
      }
    }
  }
}
