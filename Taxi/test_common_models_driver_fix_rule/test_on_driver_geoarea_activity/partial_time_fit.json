{
  "driver_mode_context": {
    "$driver_mode_context": {
      "subscription": {
        "$driver_mode_context_sub": {
          "ref": "sub_ref",
          "shift_close_time": {
            "$time": "12:00:00+03:00"
          },
          "start": {
            "$datetime": "2019-11-17T13:00:00.000000+03:00"
          }
        }
      },
      "work_mode": "driver_fix"
    }
  },
  "event": {
    "$blueprint:driver_geoarea_activity": {
      "geoarea_activities": [
        {
          "$geoarea_activity": {
            "geoareas": [
              "msk-big"
            ],
            "interval": {
              "$factory:datetime_interval": [
                "2019-11-18T11:00:00+03:00",
                "2019-11-18T13:00:00+03:00"
              ]
            }
          }
        },
        {
          "$geoarea_activity": {
            "geoareas": [
              "msk-big"
            ],
            "interval": {
              "$factory:datetime_interval": [
                "2019-11-19T09:00:00+03:00",
                "2019-11-19T13:00:00+03:00"
              ]
            }
          }
        }
      ],
      "time_interval": {
        "$factory:datetime_interval": [
          "2019-11-18T11:00:00+03:00",
          "2019-11-19T15:00:00+03:00"
        ]
      }
    }
  },
  "expected_event_handled": {
    "$blueprint:rule_event_handled": {
      "journal_entries": [
        {
          "$journal_entry": {
            "agreement_id": "subvention_agreement/1/default/_id/driver_fix_rule_id/sub_ref",
            "all_reasons": [],
            "delta": {
              "$money": "360 XXX"
            },
            "details": null,
            "entity": {
              "$entity": {
                "external_id": "taximeter_driver_id/db_id/uuid",
                "kind": "driver"
              }
            },
            "event_at": {
              "$datetime": "2019-11-18T11:00:00+03:00"
            },
            "sub_account": "time/free_minutes"
          }
        },
        {
          "$journal_entry": {
            "agreement_id": "subvention_agreement/1/default/_id/driver_fix_rule_id/sub_ref",
            "all_reasons": [],
            "delta": {
              "$money": "720 RUB"
            },
            "details": {
              "$journal_entry_details": {
                "intervals": [
                  {
                    "duration_min": "120",
                    "rate_per_min": "3"
                  },
                  {
                    "duration_min": "120",
                    "rate_per_min": "1"
                  },
                  {
                    "duration_min": "120",
                    "rate_per_min": "2"
                  }
                ]
              }
            },
            "entity": {
              "$entity": {
                "external_id": "taximeter_driver_id/db_id/uuid",
                "kind": "driver"
              }
            },
            "event_at": {
              "$datetime": "2019-11-18T11:00:00+03:00"
            },
            "sub_account": "guarantee"
          }
        }
      ],
      "shift_ended_events": [
        {
          "$blueprint:shift_ended": {
            "agreement_ref": {
              "$agreement_ref": "subvention_agreement/1/default/_id/driver_fix_rule_id"
            },
            "antifraud_rule": {
              "$antifraud_rule": {
                "days_span": 1,
                "kind": "driver_fix",
                "last_shift_date": {
                  "$date": "2019-11-18"
                },
                "zone_name": "moscow"
              }
            },
            "commission_input": null,
            "driver": {
              "$blueprint:driver": {
                "db_id": "db_id",
                "park_id": "clid",
                "unique_driver_id": {
                  "$oid": "111111111111111111111111"
                },
                "uuid": "uuid"
              }
            },
            "driver_work_mode": "driver_fix",
            "last_date": {
              "$date": "2019-11-18"
            },
            "pay_after": {
              "$datetime": "2019-11-18T16:00:00+03:00"
            },
            "pay_to": {
              "$entity": {
                "external_id": "taximeter_driver_id/db_id/uuid",
                "kind": "driver"
              }
            },
            "payment_id": "2019-11-18T09:00:00.000000+00:00/sub_ref",
            "possible_frauder": {
              "$antifraud_driver": {
                "driver_license_personal_ids": [],
                "driver_licenses": [],
                "unique_driver_id": {
                  "$oid": "111111111111111111111111"
                }
              }
            },
            "rule_data": {
              "$shift_ended_rule_data": {
                "data": {
                  "currency": "RUB",
                  "end": "2019-11-19T11:00:00.000000+03:00",
                  "geoarea": "moscow_center",
                  "group_id": "driver_fix_rule_group_id",
                  "id": "driver_fix_rule_id",
                  "profile_payment_type_restrictions": "any",
                  "profile_tariff_classes": [
                    "econom"
                  ],
                  "rates": [
                    {
                      "rate_per_minute": "1",
                      "starts_at": {
                        "hour": 12,
                        "iso_week_day": 1,
                        "minute": 0
                      }
                    },
                    {
                      "rate_per_minute": "2",
                      "starts_at": {
                        "hour": 10,
                        "iso_week_day": 2,
                        "minute": 0
                      }
                    },
                    {
                      "rate_per_minute": "3",
                      "starts_at": {
                        "hour": 12,
                        "iso_week_day": 2,
                        "minute": 0
                      }
                    }
                  ],
                  "timezone_id": "Europe/Moscow",
                  "zone_name": "moscow"
                },
                "subvention_type": {
                  "$subvention_type": "driver_fix"
                }
              }
            },
            "shift": {
              "$shift": {
                "end": {
                  "$datetime": "2019-11-18T12:00:00+03:00"
                },
                "start": {
                  "$datetime": "2019-11-17T13:00:00+03:00"
                }
              }
            },
            "subscription_ref": "sub_ref",
            "use_stats_of": {
              "$entity": {
                "external_id": "taximeter_driver_id/db_id/uuid",
                "kind": "driver"
              }
            }
          }
        }
      ]
    }
  },
  "rule": {
    "$blueprint:driver_fix_rule": {
      "data": {
        "$blueprint:driver_fix_rule_data": {
          "rate_intervals": {
            "$factory:driver_fix_rate_intervals": [
              "Mon 12:00, 1",
              "Tue 10:00, 2",
              "Tue 12:00, 3"
            ]
          }
        }
      },
      "matcher": {
        "$moscow_rule_matcher": {
          "end": {
            "$datetime": "2019-11-19T11:00:00+03:00"
          },
          "start": {
            "$datetime": "2019-11-18T00:00:00+03:00"
          }
        }
      }
    }
  }
}
