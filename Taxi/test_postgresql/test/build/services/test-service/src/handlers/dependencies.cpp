/* THIS FILE IS AUTOGENERATED, DON'T EDIT! */

#include <userver/storages/postgres/component.hpp>

#include <handlers/dependencies.hpp>
#include <userver/components/component.hpp>
#include <userver/components/statistics_storage.hpp>
#include <userver/concurrent/background_task_storage.hpp>
#include <userver/dynamic_config/fwd.hpp>
#include <userver/dynamic_config/storage/component.hpp>

namespace handlers {

DependenciesFactory::DependenciesFactory(
    [[maybe_unused]] const components::ComponentConfig& config,
    const components::ComponentContext& context)
    : config_source_(
          context.FindComponent<components::DynamicConfig>().GetSource()),
      metrics_storage_(context.FindComponent<components::StatisticsStorage>()
                           .GetMetricsStorage()),
      bts_(),
      custom_dependencies_(config, context)

{
  pg_categories_ =
      context.FindComponent<components::Postgres>("postgresql-categories")
          .GetDatabase();
  pg_misc_ = context.FindComponent<components::Postgres>("postgresql-misc")
                 .GetDatabase();
  pg_orders_ = context.FindComponent<components::Postgres>("postgresql-orders")
                   .GetDatabase();
  pg_shared_ = context.FindComponent<components::Postgres>("postgresql-shared")
                   .GetDatabase();
}

DependenciesFactory::~DependenciesFactory() { bts_->CancelAndWait(); }

Dependencies DependenciesFactory::GetDependencies() const {
  return Dependencies{
      config_source_.GetSnapshot(),
      metrics_storage_,
      *bts_,
      custom_dependencies_.GetExtra(),
      pg_categories_,
      pg_misc_,
      pg_orders_,
      pg_shared_,
  };
}

}  // namespace handlers
