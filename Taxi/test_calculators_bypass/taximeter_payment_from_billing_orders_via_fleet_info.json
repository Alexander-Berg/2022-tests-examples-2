{
  "docs": [
    {
      "created": "2018-10-18T06:30:03.098080+00:00",
      "data": {
        "driver": {
          "db_id": "7f74df",
          "driver_uuid": "1086f4"
        },
        "fleet_transactions_api_info": {
          "created_by": {
            "dispatcher_id": "some_dispatcher_id",
            "dispatcher_name": "some_dispatcher_name",
            "identity": "dispatcher",
            "passport_uid": "some_passport_uid"
          }
        },
        "payment_info": {
          "agreement": "taxi/park_services",
          "amount": "100.0",
          "currency": "RUB",
          "description": "Списание через Qiwi",
          "operator_login": "API 6.0",
          "payslip": "123456",
          "reason": "",
          "service_id": "taximeter",
          "sub_account": "api6_payment/cash",
          "transaction_id": "a343377985d04c7c83739bb0fd71cdf2"
        }
      },
      "doc_id": 1001,
      "event_at": "2018-10-17T09:06:14.000000+00:00",
      "external_event_ref": "taxi/taximeter/payment/a343377985d04c7c83739bb0fd71cdf2",
      "external_obj_id": "taxi/taximeter/payment/a343377985d04c7c83739bb0fd71cdf2",
      "kind": "taximeter_payment",
      "process_at": "2018-10-17T06:30:03.102042+00:00",
      "reason": "",
      "service": "billing-orders",
      "status": "new"
    }
  ],
  "expected_accounts": [
    {
      "account_id": 1,
      "agreement_id": "taxi/park_services",
      "currency": "RUB",
      "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "api6_payment/cash"
    },
    {
      "account_id": 2,
      "agreement_id": "taxi/park_services",
      "currency": "RUB",
      "entity_external_id": "taximeter_park_id/7f74df",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "api6_payment/cash"
    },
    {
      "account_id": 3,
      "agreement_id": "taxi/driver_balance",
      "currency": "RUB",
      "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "total"
    }
  ],
  "expected_docs": [
    {
      "data": {
        "alias_id": null,
        "based_on_doc_id": 1001,
        "driver": {
          "db_id": "7f74df",
          "driver_uuid": "1086f4"
        },
        "taximeter_payment": {
          "description": "Списание через Qiwi",
          "operator_login": "API 6.0",
          "reason": "",
          "service_id": "taximeter"
        },
        "transaction_id": "a343377985d04c7c83739bb0fd71cdf2"
      },
      "event_at": "2018-10-17T09:06:14.000000+00:00",
      "external_event_ref": "taxi/journal/taximeter/payment/a343377985d04c7c83739bb0fd71cdf2",
      "external_obj_id": "taxi/taximeter/payment/a343377985d04c7c83739bb0fd71cdf2",
      "journal_entries": [
        {
          "account_id": 1,
          "amount": "100.0",
          "details": {
            "fleet_transactions_api_info": {
              "created_by": {
                "dispatcher_id": "some_dispatcher_id",
                "dispatcher_name": "some_dispatcher_name",
                "identity": "dispatcher",
                "passport_uid": "some_passport_uid"
              }
            },
            "payment": {
              "description": "Списание через Qiwi",
              "operator_login": "API 6.0",
              "service_id": "taximeter"
            }
          },
          "event_at": "2018-10-17T09:06:14.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 2,
          "amount": "100.0",
          "details": {
            "driver": {
              "driver_uuid": "1086f4"
            },
            "fleet_transactions_api_info": {
              "created_by": {
                "dispatcher_id": "some_dispatcher_id",
                "dispatcher_name": "some_dispatcher_name",
                "identity": "dispatcher",
                "passport_uid": "some_passport_uid"
              }
            },
            "payment": {
              "description": "Списание через Qiwi",
              "operator_login": "API 6.0",
              "service_id": "taximeter"
            }
          },
          "event_at": "2018-10-17T09:06:14.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 3,
          "amount": "100.0",
          "details": null,
          "event_at": "2018-10-17T09:06:14.000000+00:00",
          "reason": ""
        }
      ],
      "kind": "journal",
      "service": "billing-calculators",
      "status": "new"
    },
    {
      "data": {
        "based_on_doc_id": 1001,
        "driver": {
          "db_id": "7f74df",
          "driver_uuid": "1086f4"
        },
        "kind": "taximeter_payment",
        "payments": [
          {
            "agreement": "taxi/park_services",
            "amount": "100.0",
            "currency": "RUB",
            "description": "Списание через Qiwi",
            "operator_login": "API 6.0",
            "payslip": "123456",
            "reason": "",
            "sub_account": "api6_payment/cash"
          }
        ],
        "transaction_id": "a343377985d04c7c83739bb0fd71cdf2"
      },
      "event_at": "2018-10-17T09:06:14.000000+00:00",
      "external_event_ref": "taxi/taximeter_request/taximeter_payment/a343377985d04c7c83739bb0fd71cdf2",
      "external_obj_id": "taxi/taximeter_request/taximeter_payment/a343377985d04c7c83739bb0fd71cdf2",
      "journal_entries": [],
      "kind": "taximeter_request",
      "service": "billing-calculators",
      "status": "new"
    }
  ],
  "expected_entities": [
    {
      "external_id": "taximeter_driver_id/7f74df/1086f4",
      "kind": "driver"
    },
    {
      "external_id": "taximeter_park_id/7f74df",
      "kind": "park"
    }
  ],
  "expected_stq_balance_update_calls": [
    {
      "args": null,
      "eta": null,
      "kwargs": {
        "account": {
          "agreement_id": "taxi/driver_balance",
          "currency": "RUB",
          "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
          "sub_account": "total"
        },
        "log_extra": {},
        "max_entry_id": 1755330113
      },
      "queue": "billing_functions_internal_balance_update",
      "task_id": "doc_id/2001/1755330113"
    }
  ],
  "reports": {
    "journal/search": {
      "entries": [
        {
          "account": {
            "account_id": 1,
            "agreement_id": "taxi/park_services",
            "currency": "RUB",
            "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
            "sub_account": "api6_payment/cash"
          },
          "amount": "100.0",
          "details": {
            "fleet_transactions_api_info": {
              "created_by": {
                "dispatcher_id": "some_dispatcher_id",
                "dispatcher_name": "some_dispatcher_name",
                "identity": "dispatcher",
                "passport_uid": "some_passport_uid"
              }
            },
            "payment": {
              "description": "Списание через Qiwi",
              "operator_login": "API 6.0",
              "service_id": "taximeter"
            }
          },
          "doc_ref": "2001",
          "entry_id": 1755330111,
          "event_at": "2018-10-17T09:06:14.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 2,
            "agreement_id": "taxi/park_services",
            "currency": "RUB",
            "entity_external_id": "taximeter_park_id/7f74df",
            "sub_account": "api6_payment/cash"
          },
          "amount": "100.0",
          "details": {
            "driver": {
              "driver_uuid": "1086f4"
            },
            "fleet_transactions_api_info": {
              "created_by": {
                "dispatcher_id": "some_dispatcher_id",
                "dispatcher_name": "some_dispatcher_name",
                "identity": "dispatcher",
                "passport_uid": "some_passport_uid"
              }
            },
            "payment": {
              "description": "Списание через Qiwi",
              "operator_login": "API 6.0",
              "service_id": "taximeter"
            }
          },
          "doc_ref": "2001",
          "entry_id": 1755330112,
          "event_at": "2018-10-17T09:06:14.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 3,
            "agreement_id": "taxi/driver_balance",
            "currency": "RUB",
            "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
            "sub_account": "total"
          },
          "amount": "100.0",
          "details": null,
          "doc_ref": "2001",
          "entry_id": 1755330113,
          "event_at": "2018-10-17T09:06:14.000000+00:00",
          "reason": ""
        }
      ]
    }
  }
}
