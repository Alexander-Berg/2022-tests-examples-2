{
  "docs": [
    {
      "created": "2018-10-25T16:07:01.594843+00:00",
      "data": {
        "alias_id": "da66a1fc21c444d6a2a56271def84dc1",
        "due": "2018-10-25T15:00:00.000000+00:00",
        "order_id": "74e36bb87180c7fd0d17b6e11392dbed",
        "payment_info": {
          "currency": "KZT",
          "payment_id": "5bd1ddde910d391685119aea",
          "payment_type": "card",
          "ride_sum": "33.9300",
          "sequence_number": 1,
          "tips_sum": "2.01",
          "transaction_id": "a343377985d04c7c83739bb0"
        },
        "performer": {
          "db_id": "7f74df",
          "driver_uuid": "1086f4"
        }
      },
      "doc_id": 1002,
      "event_at": "2018-10-25T15:14:51.000000+00:00",
      "external_event_ref": "order_paid/card/5bd1ddde910d391685119aea/1",
      "external_obj_id": "taxi/payment/da66a1fc21c444d6a2a56271def84dc1",
      "kind": "order_paid",
      "process_at": "2018-10-25T16:07:01.598373+00:00",
      "service": "billing-orders",
      "status": "new"
    }
  ],
  "expected_accounts": [
    {
      "account_id": 1,
      "agreement_id": "taxi/yandex_ride/mode/driver_fix/fact",
      "currency": "KZT",
      "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "payment/card"
    },
    {
      "account_id": 2,
      "agreement_id": "taxi/yandex_ride/mode/driver_fix",
      "currency": "KZT",
      "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "tips/card"
    },
    {
      "account_id": 3,
      "agreement_id": "taxi/yandex_ride/mode/driver_fix/fact",
      "currency": "KZT",
      "entity_external_id": "taximeter_park_id/7f74df",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "payment/card"
    },
    {
      "account_id": 4,
      "agreement_id": "taxi/yandex_ride/mode/driver_fix",
      "currency": "KZT",
      "entity_external_id": "taximeter_park_id/7f74df",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "tips/card"
    },
    {
      "account_id": 5,
      "agreement_id": "taxi/driver_balance",
      "currency": "KZT",
      "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "total"
    },
    {
      "account_id": 6,
      "agreement_id": "taxi/yandex_ride+0/mode/driver_fix",
      "currency": "KZT",
      "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "tips/card"
    }
  ],
  "expected_docs": [
    {
      "data": {
        "alias_id": "da66a1fc21c444d6a2a56271def84dc1",
        "based_on_doc_id": 1002,
        "driver": {
          "db_id": "7f74df",
          "driver_uuid": "1086f4"
        },
        "order_id": "74e36bb87180c7fd0d17b6e11392dbed",
        "sequence_number": 1,
        "transaction_id": "5bd1ddde910d391685119aea"
      },
      "event_at": "2018-10-25T15:14:51.000000+00:00",
      "external_event_ref": "taxi/journal/payment/card/5bd1ddde910d391685119aea/1",
      "external_obj_id": "taxi/payment/da66a1fc21c444d6a2a56271def84dc1",
      "journal_entries": [
        {
          "account_id": 1,
          "amount": "33.9300",
          "details": {
            "alias_id": "da66a1fc21c444d6a2a56271def84dc1"
          },
          "event_at": "2018-10-25T15:14:51.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 2,
          "amount": "2.01",
          "details": {
            "alias_id": "da66a1fc21c444d6a2a56271def84dc1"
          },
          "event_at": "2018-10-25T15:14:51.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 3,
          "amount": "33.9300",
          "details": {
            "alias_id": "da66a1fc21c444d6a2a56271def84dc1",
            "driver": {
              "driver_uuid": "1086f4"
            }
          },
          "event_at": "2018-10-25T15:14:51.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 4,
          "amount": "2.01",
          "details": {
            "alias_id": "da66a1fc21c444d6a2a56271def84dc1",
            "driver": {
              "driver_uuid": "1086f4"
            }
          },
          "event_at": "2018-10-25T15:14:51.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 5,
          "amount": "2.01",
          "details": null,
          "event_at": "2018-10-25T15:14:51.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 6,
          "amount": "2.01",
          "details": {
            "alias_id": "da66a1fc21c444d6a2a56271def84dc1"
          },
          "event_at": "2018-10-25T15:00:00.000000+00:00",
          "reason": ""
        }
      ],
      "kind": "journal",
      "service": "billing-calculators",
      "status": "new",
      "tags": [
        "taxi/alias_id/da66a1fc21c444d6a2a56271def84dc1"
      ]
    },
    {
      "data": {
        "alias_id": "da66a1fc21c444d6a2a56271def84dc1",
        "based_on_doc_id": 1002,
        "driver": {
          "db_id": "7f74df",
          "driver_uuid": "1086f4"
        },
        "kind": "balance_change",
        "order_id": "74e36bb87180c7fd0d17b6e11392dbed",
        "payments": [
          {
            "agreement": "taxi/yandex_ride/mode/driver_fix",
            "amount": "2.01",
            "currency": "KZT",
            "sub_account": "tips/card"
          }
        ],
        "transaction_id": "a343377985d04c7c83739bb0_tips"
      },
      "event_at": "2018-10-25T15:14:51.000000+00:00",
      "external_event_ref": "taxi/taximeter_request/balance_change/a343377985d04c7c83739bb0_tips",
      "external_obj_id": "taxi/taximeter_request/balance_change/a343377985d04c7c83739bb0_tips",
      "journal_entries": [],
      "kind": "taximeter_request",
      "service": "billing-calculators",
      "status": "new",
      "tags": [
        "taxi/alias_id/da66a1fc21c444d6a2a56271def84dc1"
      ]
    }
  ],
  "expected_entities": [
    {
      "external_id": "taximeter_driver_id/7f74df/1086f4",
      "kind": "driver"
    },
    {
      "external_id": "taximeter_park_id/7f74df",
      "kind": "park"
    }
  ],
  "reports": {
    "docs/select": {
      "docs": [
        {
          "created": "2019-11-20T07:53:24.855146+00:00",
          "data": {
            "driver": {
              "driver_id": "769ce26febec46b0a16eee7a560d7eda",
              "park_id": "7ad36bc7560449998acbe2c57a75c293"
            },
            "mode": "driver_fix",
            "settings": {
              "rule_id": "_id/5dcea9e6b8e3f879686e5aad",
              "shift_close_time": "00:00:00+03:00"
            }
          },
          "doc_id": 3316800126,
          "event_at": "2019-11-20T07:53:24.711966+00:00",
          "external_event_ref": "ref",
          "external_obj_id": "taxi/driver_mode_subscription/7f74df/1086f4",
          "kind": "driver_mode_subscription",
          "process_at": "2019-11-20T07:53:24.824118+00:00",
          "service": "billing-orders",
          "status": "complete",
          "tags": []
        }
      ]
    },
    "journal/search": {
      "entries": [
        {
          "account": {
            "account_id": 1,
            "agreement_id": "taxi/yandex_ride/mode/driver_fix",
            "currency": "KZT",
            "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
            "sub_account": "payment/card"
          },
          "amount": "33.9300",
          "details": {
            "alias_id": "da66a1fc21c444d6a2a56271def84dc1"
          },
          "doc_ref": "2001",
          "entry_id": 1755330101,
          "event_at": "2018-10-25T15:14:51.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 2,
            "agreement_id": "taxi/yandex_ride/mode/driver_fix",
            "currency": "KZT",
            "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
            "sub_account": "tips/card"
          },
          "amount": "2.01",
          "details": {
            "alias_id": "da66a1fc21c444d6a2a56271def84dc1"
          },
          "doc_ref": "2001",
          "entry_id": 1755330102,
          "event_at": "2018-10-25T15:14:51.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 3,
            "agreement_id": "taxi/yandex_ride/mode/driver_fix",
            "currency": "KZT",
            "entity_external_id": "taximeter_park_id/7f74df",
            "sub_account": "tips/card"
          },
          "amount": "33.9300",
          "details": {
            "alias_id": "da66a1fc21c444d6a2a56271def84dc1",
            "driver": {
              "driver_uuid": "1086f4"
            }
          },
          "doc_ref": "2001",
          "entry_id": 1755330103,
          "event_at": "2018-10-25T15:14:51.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 4,
            "agreement_id": "taxi/yandex_ride/mode/driver_fix",
            "currency": "KZT",
            "entity_external_id": "taximeter_park_id/7f74df",
            "sub_account": "tips/card"
          },
          "amount": "2.01",
          "details": {
            "alias_id": "da66a1fc21c444d6a2a56271def84dc1",
            "driver": {
              "driver_uuid": "1086f4"
            }
          },
          "doc_ref": "2001",
          "entry_id": 1755330104,
          "event_at": "2018-10-25T15:14:51.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 5,
            "agreement_id": "taxi/driver_balance",
            "currency": "KZT",
            "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
            "sub_account": "total"
          },
          "amount": "35.9400",
          "details": null,
          "doc_ref": "2001",
          "entry_id": 1755330105,
          "event_at": "2018-10-25T15:14:51.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 7,
            "agreement_id": "taxi/yandex_ride+0/mode/driver_fix",
            "currency": "KZT",
            "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
            "sub_account": "tips/card"
          },
          "amount": "2.01",
          "details": {
            "alias_id": "da66a1fc21c444d6a2a56271def84dc1"
          },
          "doc_ref": "2001",
          "entry_id": 1755330107,
          "event_at": "2018-10-25T15:00:00.000000+00:00",
          "reason": ""
        }
      ]
    }
  }
}
