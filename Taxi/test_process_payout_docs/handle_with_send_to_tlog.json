{
  "docs": [
    {
      "data": {
        "contracts": [
          {
            "firm_id": 13,
            "id": 3928042,
            "target": "oebs"
          }
        ],
        "entries": [],
        "payments": [
          {
            "amount": "120.0",
            "billing_client_id": "string",
            "contract_id": "3928042",
            "currency": "RUB",
            "invoice_date": "2019-10-25T00:00:00.0+00:00",
            "payload": {
              "alias_id": "alias_id",
              "billing_type": "card",
              "due": "2019-10-25T00:00:00.0+00:00",
              "external_payment_id": "external_payment_id",
              "order_id": "order_id",
              "payment_type": "card",
              "tariff_class": "econom",
              "terminal_id": 123,
              "transaction_type": "payment"
            },
            "payment_kind": "trip_payment"
          },
          {
            "amount": "10.0",
            "billing_client_id": "string",
            "contract_id": "3928042",
            "currency": "RUB",
            "invoice_date": "2019-10-25T00:00:00.0+00:00",
            "payload": {
              "alias_id": "alias_id",
              "billing_type": "uber",
              "due": "2019-10-25T00:00:00.0+00:00",
              "external_payment_id": "external_payment_id",
              "order_id": "order_id",
              "payment_type": "card",
              "tariff_class": "econom",
              "terminal_id": 123,
              "transaction_type": "payment"
            },
            "payment_kind": "trip_tips"
          }
        ],
        "schema_version": 1,
        "topic_begin_at": "2019-08-08T15:10:00.000000+00:00",
        "version": 1
      },
      "doc_id": 1006,
      "event_at": "2019-08-08T15:13:02.832000+00:00",
      "external_event_ref": "<external_payment_id>/1",
      "external_obj_id": "taxi/invoice_transaction_cleared/<order_id>",
      "journal_entries": [],
      "kind": "invoice_transaction_cleared",
      "service": "billing-orders",
      "status": "new"
    }
  ],
  "expected_accounts": [
    {
      "account_id": 1,
      "agreement_id": "tlog",
      "currency": "RUB",
      "entity_external_id": "billing_client_id/string",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "trip_payment"
    },
    {
      "account_id": 2,
      "agreement_id": "tlog",
      "currency": "RUB",
      "entity_external_id": "billing_client_id/string",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "trip_tips"
    }
  ],
  "expected_docs": [
    {
      "data": {
        "entries_count": 2,
        "entries_max_event_at": "2019-08-08T15:13:02.832000+00:00",
        "entries_min_event_at": "2019-08-08T15:13:02.832000+00:00",
        "version": 1
      },
      "event_at": "2019-08-08T15:13:02.832000+00:00",
      "external_event_ref": "1006/handled",
      "external_obj_id": "taxi/invoice_transaction_cleared/<order_id>/process",
      "journal_entries": [
        {
          "account_id": 1,
          "amount": "120.0",
          "details": {
            "client_id": "string",
            "contract_id": "3928042",
            "due": "2019-10-25T00:00:00.0+00:00",
            "invoice_date": "2019-10-25T00:00:00.0+00:00",
            "payload": {
              "alias_id": "alias_id",
              "base_doc_id": 1006,
              "external_payment_id": "external_payment_id",
              "order_id": "order_id",
              "terminal_id": 123
            },
            "product": "trip_payment",
            "service_id": 124,
            "tariff_class": "econom",
            "transaction_type": "payment"
          },
          "event_at": "2019-08-08T15:13:02.832000+00:00",
          "reason": ""
        },
        {
          "account_id": 2,
          "amount": "10.0",
          "details": {
            "client_id": "string",
            "contract_id": "3928042",
            "due": "2019-10-25T00:00:00.0+00:00",
            "invoice_date": "2019-10-25T00:00:00.0+00:00",
            "payload": {
              "alias_id": "alias_id",
              "base_doc_id": 1006,
              "external_payment_id": "external_payment_id",
              "order_id": "order_id",
              "terminal_id": 123
            },
            "product": "trip_tips",
            "service_id": 125,
            "tariff_class": "econom",
            "transaction_type": "payment"
          },
          "event_at": "2019-08-08T15:13:02.832000+00:00",
          "reason": ""
        }
      ],
      "kind": "journal",
      "service": "billing-calculators",
      "status": "complete"
    }
  ],
  "expected_entities": [
    {
      "external_id": "billing_client_id/string",
      "kind": "client"
    }
  ],
  "expected_tlog_entries": [
    {
      "amount": "120.0",
      "billing_client_id": "string",
      "currency": "RUB",
      "detailed_product": "trip_payment",
      "due": "2019-10-25T00:00:00.0+00:00",
      "event_time": "2019-08-08T15:13:02.832000+00:00",
      "payload": {
        "alias_id": "alias_id",
        "base_doc_id": 1006,
        "external_payment_id": "external_payment_id",
        "order_id": "order_id",
        "terminal_id": 123
      },
      "product": "trip_payment",
      "service_id": 124,
      "service_transaction_id": "20011",
      "topic": "payments",
      "transaction_type": "payment"
    },
    {
      "amount": "10.0",
      "billing_client_id": "string",
      "currency": "RUB",
      "detailed_product": "trip_tips",
      "due": "2019-10-25T00:00:00.0+00:00",
      "event_time": "2019-08-08T15:13:02.832000+00:00",
      "payload": {
        "alias_id": "alias_id",
        "base_doc_id": 1006,
        "external_payment_id": "external_payment_id",
        "order_id": "order_id",
        "terminal_id": 123
      },
      "product": "trip_tips",
      "service_id": 125,
      "service_transaction_id": "20012",
      "topic": "payments",
      "transaction_type": "payment"
    }
  ],
  "reports": {
    "docs/select": {
      "docs": []
    },
    "journal/search": {
      "entries": [
        {
          "account": {
            "account_id": 1,
            "agreement_id": "tlog",
            "currency": "RUB",
            "entity_external_id": "billing_client_id/string",
            "sub_account": "trip_payment"
          },
          "amount": "120.0",
          "details": {
            "billing_client_id": "string",
            "due": "2019-10-25T00:00:00.0+00:00",
            "payload": {
              "alias_id": "alias_id",
              "base_doc_id": 1006,
              "external_payment_id": "external_payment_id",
              "order_id": "order_id",
              "terminal_id": 123
            },
            "product": "trip_payment",
            "service_id": 124,
            "transaction_type": "payment"
          },
          "doc_ref": "2001",
          "entry_id": 20011,
          "event_at": "2019-08-08T15:13:02.832000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 2,
            "agreement_id": "tlog",
            "currency": "RUB",
            "entity_external_id": "billing_client_id/string",
            "sub_account": "trip_tips"
          },
          "amount": "10.0",
          "details": {
            "billing_client_id": "string",
            "due": "2019-10-25T00:00:00.0+00:00",
            "payload": {
              "alias_id": "alias_id",
              "base_doc_id": 1006,
              "external_payment_id": "external_payment_id",
              "order_id": "order_id",
              "terminal_id": 123
            },
            "product": "trip_tips",
            "service_id": 125,
            "transaction_type": "payment"
          },
          "doc_ref": "2001",
          "entry_id": 20012,
          "event_at": "2019-08-08T15:13:02.832000+00:00",
          "reason": ""
        }
      ]
    }
  }
}
