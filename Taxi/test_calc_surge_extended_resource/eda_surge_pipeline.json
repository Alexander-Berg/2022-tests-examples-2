{
  "name": "calc_surge",
  "stages": [
    {
      "conditions": [],
      "in_bindings": [],
      "name": "fetch_extended",
      "resources": [
        {
          "name": "extended_supply"
        }
      ],
      "source_code": "return {extended_supply: [{place_id: 1}]};"
    },
    {
      "conditions": [],
      "in_bindings": [
        {
          "children": [
            {
              "query": "place_id"
            },
            {
              "query": "zone_id"
            }
          ],
          "domain": "input",
          "query": "places.*"
        },
        {
          "domain": "resource",
          "query": "extended_supply[place_id][zone_id].info{result}"
        },
        {
          "domain": "resource",
          "query": "extended_supply[place_id][zone_id].location{location}"
        }
      ],
      "name": "process_data",
      "out_bindings": [
        {
          "alias": "data",
          "query": "places_out[?(@.place_id==place_id && @.zone_id==zone_id)]"
        }
      ],
      "source_code": "return {data: {place_id: place_id, zone_id: zone_id, result: {total: 1,extra: {supply: result || 'undefined', location:location || 'undefined' }}}};"
    }
  ],
  "state": "active"
}
