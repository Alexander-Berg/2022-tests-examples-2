{
  "rules": [
    {
      "@app_name": "android",
      "actions": [
        "#android_ver",
        "#ytaxi_ver",
        "#build"
      ],
      "match": "^(?:android/.+build|(?:yandex-taxi|ru\\.yandex\\.taxi[/\\.]).+android/)"
    },
    {
      "@app_name": "iphone",
      "actions": [
        "#ios_ver",
        "#ytaxi_ver",
        "#build"
      ],
      "match": "^(?:yandex-taxi/|ru\\.yandex\\.ytaxi/|ru\\.yandex\\.taxi\\.).+darwin"
    },
    {
      "@app_name": "yango_android",
      "actions": [
        "#android_ver",
        "#yango_ver",
        "#build"
      ],
      "match": "^yango/.+android/"
    },
    {
      "@app_name": "yango_iphone",
      "actions": [
        "#ios_ver",
        "#yango_ver",
        "#build"
      ],
      "match": "^ru\\.yandex\\.yango[/\\.].+darwin"
    },
    {
      "@app_name": "uber_android",
      "actions": [
        "#android_ver",
        "#uber_ver",
        "#build"
      ],
      "match": "^yandex-uber/.+android/"
    },
    {
      "@app_name": "uber_iphone",
      "actions": [
        "#ios_ver",
        "#uber_ver",
        "#build"
      ],
      "match": "^ru\\.yandex\\.uber[/\\.].+darwin"
    },
    {
      "@app_name": "uber_by_android",
      "actions": [
        "#android_ver",
        "#uber_ver",
        "#build"
      ],
      "match": "^yandex-uber-by/.+android/"
    },
    {
      "@app_name": "uber_by_iphone",
      "actions": [
        "#ios_ver",
        "#uber_ver",
        "#build"
      ],
      "match": "^ru\\.yandex\\.uber-by[/\\.].+darwin"
    },
    {
      "@app_name": "uber_kz_android",
      "actions": [
        "#android_ver",
        "#uber_ver",
        "#build"
      ],
      "match": "^yandex-uber-kz/.+android/"
    },
    {
      "@app_name": "uber_kz_iphone",
      "actions": [
        "#ios_ver",
        "#uber_ver",
        "#build"
      ],
      "match": "^ru\\.yandex\\.uber-kz[/\\.].+darwin"
    },
    {
      "@app_name": "uber_az_android",
      "actions": [
        "#android_ver",
        "#uber_ver",
        "#build"
      ],
      "match": "^yandex-uber-az/.+android/"
    },
    {
      "@app_name": "uber_az_iphone",
      "actions": [
        "#ios_ver",
        "#uber_ver",
        "#build"
      ],
      "match": "^com\\.mlubv\\.uber-az[/\\.].+darwin"
    },
    {
      "@app_name": "win",
      "actions": "#ytaxi_ver",
      "match": "^yandex[-\\.]taxi/.+windows"
    },
    {
      "actions": "#ytaxi_ver",
      "any": [
        {
          "@app_name": "mobileweb_android",
          "actions": [
            "#android_ver",
            "#build"
          ],
          "match": "android"
        },
        {
          "@app_name": "mobileweb_iphone",
          "actions": [
            "#ios_ver",
            "#build"
          ]
        }
      ],
      "match": "^mozilla/.+yandex-taxi/"
    },
    {
      "actions": "#yango_ver",
      "any": [
        {
          "@app_name": "mobileweb_yango_android",
          "actions": [
            "#android_ver",
            "#build"
          ],
          "match": "android"
        },
        {
          "@app_name": "mobileweb_yango_iphone",
          "actions": [
            "#ios_ver",
            "#build"
          ]
        }
      ],
      "match": "^mozilla/.+yango/"
    },
    {
      "actions": "#uber_ver",
      "any": [
        {
          "@app_name": "mobileweb_uber_android",
          "actions": [
            "#android_ver",
            "#build"
          ],
          "match": "android"
        },
        {
          "@app_name": "mobileweb_uber_iphone",
          "actions": [
            "#ios_ver",
            "#build"
          ]
        }
      ],
      "match": "^mozilla/.+uber-ru/"
    },
    {
      "actions": "#uber_ver",
      "any": [
        {
          "@app_name": "mobileweb_uber_by_android",
          "actions": [
            "#android_ver",
            "#build"
          ],
          "match": "android"
        },
        {
          "@app_name": "mobileweb_uber_by_iphone",
          "actions": [
            "#ios_ver",
            "#build"
          ]
        }
      ],
      "match": "^mozilla/.+uber-by/"
    },
    {
      "actions": "#uber_ver",
      "any": [
        {
          "@app_name": "mobileweb_uber_kz_android",
          "actions": [
            "#android_ver",
            "#build"
          ],
          "match": "android"
        },
        {
          "@app_name": "mobileweb_uber_kz_iphone",
          "actions": [
            "#ios_ver",
            "#build"
          ]
        }
      ],
      "match": "^mozilla/.+uber-kz/"
    },
    {
      "actions": "#uber_ver",
      "any": [
        {
          "@app_name": "mobileweb_uber_az_android",
          "actions": [
            "#android_ver",
            "#build"
          ],
          "match": "android"
        },
        {
          "@app_name": "mobileweb_uber_az_iphone",
          "actions": [
            "#ios_ver",
            "#build"
          ]
        }
      ],
      "match": "^mozilla/.+uber-az/"
    },
    {
      "any": [
        {
          "@app_name": "mobileweb_yango",
          "@app_ver1": "2",
          "header": "X-Requested-Uri",
          "match": "yango"
        },
        {
          "@app_name": "mobileweb_uber",
          "@app_ver1": "2",
          "header": "X-Requested-Uri",
          "match": "uber"
        },
        {
          "@app_name": "mobileweb",
          "@app_ver1": "2"
        }
      ],
      "header": "X-Taxi",
      "match": "^mobile$"
    },
    {
      "@app_name": "web_yango",
      "@app_ver1": "2",
      "header": "X-Requested-Uri",
      "match": "yango"
    },
    {
      "@app_name": "web_uber",
      "@app_ver1": "2",
      "header": "X-Requested-Uri",
      "match": "uber"
    },
    {
      "@app_name": "iphone",
      "actions": "#xapp_ver",
      "header": "X-Platform",
      "match": "ios_app"
    },
    {
      "@app_name": "web",
      "actions": "#xapp_ver",
      "header": "X-Platform",
      "match": "desktop_web"
    },
    {
      "@app_name": "super_web",
      "actions": "#xapp_ver",
      "header": "X-Platform",
      "match": "superapp_taxi_web"
    },
    {
      "@app_name": "web",
      "@app_ver1": "2"
    }
  ],
  "subrules": [
    {
      "@platform_ver1": "{1}",
      "@platform_ver2": "{2}",
      "@platform_ver3": "{3}",
      "match": "android/(\\d+)(?:\\.(\\d+))?(?:\\.(\\d+))?",
      "name": "#android_ver"
    },
    {
      "any": [
        {
          "@platform_ver1": "{1}",
          "@platform_ver2": "{2}",
          "@platform_ver3": "{3}",
          "match": "ios (\\d+)(?:\\.(\\d+))?(?:\\.(\\d+))?"
        },
        {
          "@platform_ver1": "{1}",
          "@platform_ver2": "{2}",
          "@platform_ver3": "{3}",
          "match": "iphone os (\\d+)(?:[_\\.](\\d+))?(?:[_\\.](\\d+))?"
        }
      ],
      "name": "#ios_ver"
    },
    {
      "@app_ver1": "{1}",
      "@app_ver2": "{2}",
      "@app_ver3": "{3}",
      "match": "(?:taxi)(?:\\.\\w+)?/(\\d+)\\.(\\d+)\\.(\\d+)",
      "name": "#ytaxi_ver"
    },
    {
      "@app_ver1": "{1}",
      "@app_ver2": "{2}",
      "@app_ver3": "{3}",
      "match": "(?:uber)(?:-\\w\\w)?(?:\\.\\w+)?/(\\d+)\\.(\\d+)\\.(\\d+)",
      "name": "#uber_ver"
    },
    {
      "@app_ver1": "{1}",
      "@app_ver2": "{2}",
      "@app_ver3": "{3}",
      "match": "(?:yango)(?:\\.\\w+)?/(\\d+)\\.(\\d+)\\.(\\d+)",
      "name": "#yango_ver"
    },
    {
      "any": [
        {
          "@app_build": "alpha",
          "match": "\\.alpha/"
        },
        {
          "@app_build": "beta",
          "match": "\\.beta/"
        },
        {
          "@app_build": "release"
        }
      ],
      "name": "#build"
    },
    {
      "@app_ver1": "{1}",
      "@app_ver2": "{2}",
      "@app_ver3": "{3}",
      "header": "X-App-Version",
      "match": "(\\d+)(?:\\.(\\d+))?(?:\\.(\\d+))?",
      "name": "#xapp_ver"
    }
  ]
}
