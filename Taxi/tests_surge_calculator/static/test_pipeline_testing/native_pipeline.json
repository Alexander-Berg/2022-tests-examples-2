{
  "consumer": "taxi-surge",
  "id": "10",
  "name": "native_testing_test",
  "stages": [
    {
      "conditions": [],
      "function": "initialize",
      "in_bindings": [
        {
          "domain": "input",
          "query": "required_categories.*{:category}"
        },
        {
          "children": [
            {
              "children": [
                {
                  "children": [
                    {
                      "query": "method"
                    },
                    {
                      "query": "reason{fixed_reason}"
                    },
                    {
                      "query": "surge_value{fixed_surge_value}"
                    }
                  ],
                  "query": "rules[category]"
                },
                {
                  "query": "balance"
                }
              ],
              "query": "experiment"
            },
            {
              "query": "base_class"
            }
          ],
          "domain": "resource",
          "query": "zone"
        }
      ],
      "name": "native_init",
      "optional": false,
      "out_bindings": [
        {
          "alias": "class_info",
          "query": "classes[category]"
        }
      ]
    },
    {
      "conditions": [],
      "function": "get_count_by_categories_params",
      "in_bindings": [
        {
          "domain": "output",
          "query": "classes"
        },
        {
          "children": [
            {
              "query": "point_a"
            },
            {
              "query": "tariff_zone"
            }
          ],
          "domain": "input",
          "query": "request"
        },
        {
          "domain": "input",
          "query": "layer_meta"
        },
        {
          "domain": "resource",
          "query": "zone.base_class"
        }
      ],
      "name": "resource_fetch",
      "optional": false,
      "resources": [
        {
          "field": "drivers_info",
          "name": "count_by_categories"
        }
      ]
    },
    {
      "conditions": [],
      "in_bindings": [
        {
          "domain": "resource",
          "query": "zone"
        },
        {
          "domain": "resource",
          "query": "drivers_info"
        }
      ],
      "name": "logic_stage",
      "optional": false,
      "out_bindings": [
        {
          "children": [
            {
              "alias": "surge",
              "query": "surge"
            },
            {
              "alias": "name",
              "query": "name"
            },
            {
              "alias": "value_raw",
              "query": "value_raw"
            },
            {
              "alias": "calculation_meta",
              "query": "calculation_meta"
            }
          ],
          "query": "classes.econom"
        }
      ],
      "source_code": "return {surge: {value: 1.05}, name: \"econom\", value_raw: 1, calculation_meta: {counts: {free: 0, free_chain: 0, total: drivers_info.generic.econom.total, pins: 0, radius: 0}}};"
    },
    {
      "conditions": [],
      "function": "round",
      "in_bindings": [
        {
          "domain": "resource",
          "query": "config.surge_coefficient_precision{precision}"
        },
        {
          "domain": "output",
          "query": "classes.*{category:}.surge"
        }
      ],
      "name": "native_round",
      "optional": false,
      "out_bindings": [
        {
          "alias": "surge",
          "query": "classes[category].surge"
        }
      ]
    }
  ]
}
