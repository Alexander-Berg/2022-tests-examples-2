{
  "cargo_claim": {
    "$Doc": {
      "data": {
        "cash_payment": {
          "order_cost": "272.0"
        },
        "claim_info": {
          "billing_at": "2020-12-22T11:48:39.046000+03:00",
          "city_id": "Москва",
          "closed_without_accept": false,
          "completed_at": "2020-12-22T11:48:39.046000+03:00",
          "cost": {
            "amount": "272.0",
            "currency": "RUB"
          },
          "coupon": {
            "is_for_support": false,
            "is_netting_allowed": false,
            "value": {
              "amount": "100",
              "currency": "RUB"
            }
          },
          "discount": {
            "limit_ref": "some_discount_limit_ref",
            "value": "200"
          },
          "donate_multiplier": "1.06",
          "due": "2020-12-22T11:52:00+03:00",
          "fine_code": "some_fine_code",
          "fleet_subscription_level": "level3",
          "geo_hierarchy": "russia/moscow",
          "has_co_branding": false,
          "has_lightbox": false,
          "has_sticker": false,
          "id": "28e560e5a7c26a6bbc3ba9b73ab9657a",
          "ind_bel_nds_rate": "1.2",
          "is_cargo": false,
          "need_dispatcher_acceptance": false,
          "oebs_mvp_id": "MSKc",
          "park_brandings": [],
          "park_ride_sum": "100",
          "payment_type": "card",
          "status": "finished",
          "subvention_geoareas": [
            "area51"
          ],
          "tags": [],
          "tariff_class": "econom",
          "tariff_minimal_cost": "100",
          "taxi_alias_id": "902fe475af72677caea7b8f49db06905",
          "taxi_order_id": "28e560e5a7c26a6bbc3ba9b73ab9657a",
          "taxi_status": "complete",
          "time_zone": "Europe/Moscow",
          "transporting_distance_meters": 10,
          "transporting_time_seconds": 32,
          "zone_name": "moscow"
        },
        "commission": {
          "is_charged": false,
          "subvention_commission_agreement": {
            "acquiring_rate": null,
            "agreement": {
              "branding_discounts": [
                {
                  "marketing_level": [
                    "co_branding",
                    "lightbox"
                  ],
                  "value": "0.04"
                },
                {
                  "marketing_level": [
                    "lightbox"
                  ],
                  "value": "0.02"
                }
              ],
              "cancelation_settings": {
                "billable_cancel_distance": 300,
                "billable_park_interval": {
                  "after_order_due": "420",
                  "before_order_due": "600"
                },
                "billable_user_interval": {
                  "after_order_due": "120",
                  "before_order_due": "600"
                }
              },
              "cost_info": {
                "kind": "boundaries",
                "max_cost": "150000000",
                "min_cost": "0.0000"
              },
              "effective_billing_type": "normal",
              "group": "base",
              "id": "fixed_rate_id",
              "kind": "fixed_rate",
              "rate": {
                "kind": "flat",
                "rate": "0.2300"
              },
              "vat_rate": "1.2"
            }
          }
        },
        "contracts": {
          "items": [
            {
              "currency": "USD",
              "firm_id": 1,
              "id": 1,
              "target": "oebs"
            }
          ],
          "service_to_contract": {
            "137": 1
          }
        },
        "coupon_compensation": {
          "is_compensated": true,
          "payment": {
            "contract_id": 1,
            "contract_value": {
              "amount": "1.06",
              "currency": "USD"
            },
            "currency_rate": "0.01000",
            "detailed_product": "user_support_coupon_compensation",
            "donate_multiplier": "1.0600",
            "is_netting": false,
            "service_id": 137,
            "value": {
              "amount": "100.0000",
              "currency": "RUB"
            }
          }
        },
        "discount_compensation": {
          "is_compensated": true,
          "payment": {
            "contract_id": 1,
            "contract_value": {
              "amount": "2.1200",
              "currency": "USD"
            },
            "currency_rate": "0.01000",
            "donate_multiplier": "1.06",
            "is_netting": false,
            "service_id": 137,
            "value": {
              "amount": "200",
              "currency": "RUB"
            }
          }
        },
        "driver": {
          "activity_points": 50,
          "available_tariff_classes": [
            "selfdriving",
            "econom",
            "business"
          ],
          "billing_client_id": "100500",
          "clid": "643753730233",
          "driver_license_personal_id": "some_driver_license_personal_id",
          "driver_profile_id": "657dde13c5a14ef3a320c58c58a27b19",
          "hired_at": "2020-12-22T11:48:39.046000+03:00",
          "hiring_type": "commercial",
          "park_id": "7f74df331eb04ad78bc2ff25ff88a8f2",
          "profile_payment_type_restrictions": "none",
          "unique_driver_id": "5b05621ee6c22ea2654849f4",
          "zone_name": "tula"
        },
        "driver_mode": {
          "mode": "orders"
        },
        "order_income": {
          "driver_balance_change": {
            "amount": "272.0",
            "currency": "RUB"
          },
          "num_orders": 1,
          "num_orders_completed": 1
        },
        "park_commission": {
          "discounts": {
            "amount": "2"
          },
          "subventions": {
            "amount": "10"
          },
          "total": "12"
        },
        "subvention_antifraud": {
          "antifraud_id": "some_antifraud_id",
          "decision": "pay"
        },
        "subventions": {
          "is_eligible": true,
          "payment": {
            "commission": {
              "amount": "11.04000",
              "contract_amount": "1.32",
              "invoice_date": "2021-06-10T20:00:00+03:00"
            },
            "contract_currency": "USD",
            "contract_id": 1,
            "currency_rate": "0.10000",
            "donate_multiplier": "1.2",
            "is_payable": true,
            "items": [
              {
                "amount": "40",
                "contract_amount": "4.80",
                "invoice_date": "2021-06-10T20:00:00+03:00",
                "kind": "mfg",
                "limit_ref": "<budget_id>",
                "rule_db_id": "<rule_id>"
              }
            ],
            "order_cost_for_subvention": "60",
            "service_id": 137
          },
          "shifts": [
            {
              "data": {
                "is_personal": false,
                "kind": "do_x_get_y",
                "num_orders": 1,
                "rule_group_id": "group_id_dxgy"
              },
              "doc_id": 33333
            },
            {
              "data": {
                "contract_id": 1,
                "counter": "12345:A",
                "kind": "goal",
                "num_orders": 2
              },
              "doc_id": 33334
            },
            {
              "data": {
                "commission": "2",
                "income": "10",
                "kind": "nmfg",
                "num_orders": 1,
                "num_orders_per_promocode": 1,
                "num_orders_per_workshift": 1,
                "promocode_commission": "1",
                "rule_group_id": "group_id_nmfg",
                "subvention_commission": "1",
                "subvention_income": "3"
              },
              "doc_id": 33335
            },
            {
              "data": {
                "income": "10",
                "kind": "geo_booking",
                "on_order_time": "1",
                "rule_id": "geo_booking_rule_id",
                "subvention_income": "3"
              },
              "doc_id": 33336
            },
            {
              "data": {
                "is_personal": true,
                "kind": "do_x_get_y",
                "num_orders": 1,
                "rule_group_id": "p_group_id_dxgy"
              },
              "doc_id": 33337
            }
          ]
        },
        "version": 1
      },
      "entry_ids": [],
      "event_at": {
        "$datetime": "1991-06-18T07:15:00+03:00"
      },
      "external_ref": "1",
      "id": 100,
      "kind": "cargo_claim",
      "process_at": {
        "$datetime": "1991-06-18T07:15:00+03:00"
      },
      "revision": 1,
      "status": "create_entries",
      "topic": "taxi/alias_id/902fe475af72677caea7b8f49db06905"
    }
  },
  "expected_accounts": [
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 1,
        "sub_account": "promocode/compensation"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride+0",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 2,
        "sub_account": "promocode/compensation"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_park_id/7f74df331eb04ad78bc2ff25ff88a8f2",
        "id": 3,
        "sub_account": "promocode/compensation"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/driver_balance",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 4,
        "sub_account": "total"
      }
    },
    {
      "$Account": {
        "agreement_id": "tlog",
        "currency": "USD",
        "entity_external_id": "billing_client_id/100500",
        "id": 5,
        "sub_account": "coupon/user_support_coupon_compensation"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 6,
        "sub_account": "subvention/discount_payback"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride+0",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 7,
        "sub_account": "subvention/discount_payback"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_park_id/7f74df331eb04ad78bc2ff25ff88a8f2",
        "id": 8,
        "sub_account": "subvention/discount_payback"
      }
    },
    {
      "$Account": {
        "agreement_id": "tlog",
        "currency": "USD",
        "entity_external_id": "billing_client_id/100500",
        "id": 9,
        "sub_account": "subsidy_discount_payback"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride+0",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 10,
        "sub_account": "order_cost"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride+0",
        "currency": "XXX",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 11,
        "sub_account": "num_orders/completed"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride+0",
        "currency": "XXX",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 12,
        "sub_account": "num_orders"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_park_id/7f74df331eb04ad78bc2ff25ff88a8f2",
        "id": 13,
        "sub_account": "subvention/mfg"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 14,
        "sub_account": "subvention/mfg"
      }
    },
    {
      "$Account": {
        "agreement_id": "tlog",
        "currency": "USD",
        "entity_external_id": "billing_client_id/100500",
        "id": 15,
        "sub_account": "subsidy_mfg/_id/<rule_id>"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride+0",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 16,
        "sub_account": "subvention/mfg"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_park_id/7f74df331eb04ad78bc2ff25ff88a8f2",
        "id": 17,
        "sub_account": "commission/subvention"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 18,
        "sub_account": "commission/subvention"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride+0",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 19,
        "sub_account": "commission/subvention"
      }
    },
    {
      "$Account": {
        "agreement_id": "tlog",
        "currency": "USD",
        "entity_external_id": "billing_client_id/100500",
        "id": 20,
        "sub_account": "subsidy_commission"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 21,
        "sub_account": "commission/subvention/park"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_park_id/7f74df331eb04ad78bc2ff25ff88a8f2",
        "id": 22,
        "sub_account": "commission/subvention/park"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride+0",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 23,
        "sub_account": "commission/subvention/park"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 24,
        "sub_account": "payment/cash"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_park_id/7f74df331eb04ad78bc2ff25ff88a8f2",
        "id": 25,
        "sub_account": "payment/cash"
      }
    },
    {
      "$Account": {
        "agreement_id": "taxi/yandex_ride+0",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 26,
        "sub_account": "payment/cash"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/default/group_id/group_id_dxgy",
        "currency": "XXX",
        "entity_external_id": "unique_driver_id/5b05621ee6c22ea2654849f4",
        "id": 27,
        "sub_account": "num_orders"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention/counter/12345:A",
        "currency": "XXX",
        "entity_external_id": "unique_driver_id/5b05621ee6c22ea2654849f4",
        "id": 28,
        "sub_account": "num_orders"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention/counter/12345:A/1",
        "currency": "XXX",
        "entity_external_id": "unique_driver_id/5b05621ee6c22ea2654849f4",
        "id": 29,
        "sub_account": "num_orders"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/default/group_id/group_id_nmfg",
        "currency": "XXX",
        "entity_external_id": "unique_driver_id/5b05621ee6c22ea2654849f4",
        "id": 30,
        "sub_account": "num_orders"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/default/group_id/group_id_nmfg",
        "currency": "RUB",
        "entity_external_id": "unique_driver_id/5b05621ee6c22ea2654849f4",
        "id": 31,
        "sub_account": "income"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/default/group_id/group_id_nmfg",
        "currency": "RUB",
        "entity_external_id": "unique_driver_id/5b05621ee6c22ea2654849f4",
        "id": 32,
        "sub_account": "commission_total"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/default/group_id/group_id_nmfg",
        "currency": "XXX",
        "entity_external_id": "unique_driver_id/5b05621ee6c22ea2654849f4",
        "id": 33,
        "sub_account": "num_orders_per_promocode"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/default/group_id/group_id_nmfg",
        "currency": "XXX",
        "entity_external_id": "unique_driver_id/5b05621ee6c22ea2654849f4",
        "id": 34,
        "sub_account": "num_orders_per_workshift"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/default/group_id/group_id_nmfg",
        "currency": "RUB",
        "entity_external_id": "unique_driver_id/5b05621ee6c22ea2654849f4",
        "id": 35,
        "sub_account": "promocode_commission"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/default/_id/geo_booking_rule_id",
        "currency": "XXX",
        "entity_external_id": "unique_driver_id/5b05621ee6c22ea2654849f4",
        "id": 36,
        "sub_account": "time/on_order_minutes"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/default/_id/geo_booking_rule_id",
        "currency": "RUB",
        "entity_external_id": "unique_driver_id/5b05621ee6c22ea2654849f4",
        "id": 37,
        "sub_account": "income"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/personal/group_id/p_group_id_dxgy",
        "currency": "XXX",
        "entity_external_id": "unique_driver_id/5b05621ee6c22ea2654849f4",
        "id": 38,
        "sub_account": "num_orders"
      }
    }
  ],
  "expected_journal": [
    {
      "$AppendedEntry": {
        "account_id": 1,
        "amount": {
          "$decimal": "100.00"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "firm_id": 1
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 1,
        "idempotency_key": "coupon/2/1"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 2,
        "amount": {
          "$decimal": "100.00"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 2,
        "idempotency_key": "coupon/2/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 3,
        "amount": {
          "$decimal": "100.00"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "driver": {
            "driver_uuid": "657dde13c5a14ef3a320c58c58a27b19"
          },
          "firm_id": 1
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 3,
        "idempotency_key": "coupon/2/3"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 4,
        "amount": {
          "$decimal": "100.00"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 4,
        "idempotency_key": "coupon/2/4"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 5,
        "amount": {
          "$decimal": "1.06"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "agglomeration": "MSKc",
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "billing_client_id": "100500",
          "contract_id": "1",
          "detailed_product": "user_support_coupon_compensation",
          "due": "2020-12-22T11:52:00+03:00",
          "external_ref": "alias_id/902fe475af72677caea7b8f49db06905",
          "handled_in_trust_flow": false,
          "invoice_date": "2020-12-22T11:48:39.046000+03:00",
          "is_payable": true,
          "order_id": "28e560e5a7c26a6bbc3ba9b73ab9657a",
          "payload": {
            "amount_details": {
              "base_amount": "100.0000",
              "base_currency": "RUB",
              "contract_currency_rate": "0.01000",
              "donate_multiplier": "1.0600"
            },
            "base_doc_id": 100,
            "driver_details": {
              "clid": "643753730233",
              "db_id": "7f74df331eb04ad78bc2ff25ff88a8f2",
              "uuid": "657dde13c5a14ef3a320c58c58a27b19"
            },
            "nearest_zone": "moscow"
          },
          "product": "coupon",
          "service_id": 137,
          "target": "oebs",
          "tariff_class": "econom",
          "transaction_type": "payment"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 5,
        "idempotency_key": "coupon/2/5"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 6,
        "amount": {
          "$decimal": "200.00"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "firm_id": 1
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 6,
        "idempotency_key": "discount/2/1"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 7,
        "amount": {
          "$decimal": "200.00"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 7,
        "idempotency_key": "discount/2/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 8,
        "amount": {
          "$decimal": "200.00"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "driver": {
            "driver_uuid": "657dde13c5a14ef3a320c58c58a27b19"
          },
          "firm_id": 1
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 8,
        "idempotency_key": "discount/2/3"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 4,
        "amount": {
          "$decimal": "200.00"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 9,
        "idempotency_key": "discount/2/4"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 9,
        "amount": {
          "$decimal": "2.1200"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "agglomeration": "MSKc",
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "billing_client_id": "100500",
          "contract_id": "1",
          "detailed_product": "subsidy_discount_payback",
          "due": "2020-12-22T11:52:00+03:00",
          "external_ref": "alias_id/902fe475af72677caea7b8f49db06905",
          "handled_in_trust_flow": false,
          "invoice_date": "2020-12-22T11:48:39.046000+03:00",
          "is_payable": true,
          "limits": {
            "amount": "200",
            "currency": "RUB",
            "limit_ref": "some_discount_limit_ref"
          },
          "order_id": "28e560e5a7c26a6bbc3ba9b73ab9657a",
          "payload": {
            "amount_details": {
              "base_amount": "200",
              "base_currency": "RUB",
              "contract_currency_rate": "0.01000",
              "donate_multiplier": "1.06"
            },
            "base_doc_id": 100,
            "driver_details": {
              "clid": "643753730233",
              "db_id": "7f74df331eb04ad78bc2ff25ff88a8f2",
              "uuid": "657dde13c5a14ef3a320c58c58a27b19"
            },
            "nearest_zone": "moscow"
          },
          "product": "subvention",
          "service_id": 137,
          "target": "oebs",
          "tariff_class": "econom",
          "transaction_type": "payment"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 10,
        "idempotency_key": "discount/2/5"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 10,
        "amount": {
          "$decimal": "272.0"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 11,
        "idempotency_key": "order_cost/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 11,
        "amount": {
          "$decimal": "1"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 12,
        "idempotency_key": "num_orders/completed/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 12,
        "amount": {
          "$decimal": "1"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 13,
        "idempotency_key": "num_orders/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 13,
        "amount": {
          "$decimal": "40.00"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "driver": {
            "driver_uuid": "657dde13c5a14ef3a320c58c58a27b19"
          },
          "firm_id": 1
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 14,
        "idempotency_key": "subvention/<rule_id>/2/park"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 14,
        "amount": {
          "$decimal": "40.00"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "firm_id": 1
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 15,
        "idempotency_key": "subvention/<rule_id>/2/driver"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 15,
        "amount": {
          "$decimal": "4.80"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "agglomeration": "MSKc",
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "billing_client_id": "100500",
          "contract_id": "1",
          "detailed_product": "subsidy_mfg",
          "due": "2020-12-22T11:52:00+03:00",
          "external_ref": "alias_id/902fe475af72677caea7b8f49db06905",
          "handled_in_trust_flow": false,
          "invoice_date": "2021-06-10T20:00:00+03:00",
          "is_payable": true,
          "limits": {
            "amount": "40",
            "currency": "RUB",
            "limit_ref": "<budget_id>"
          },
          "order_id": "28e560e5a7c26a6bbc3ba9b73ab9657a",
          "payload": {
            "amount_details": {
              "base_amount": "40",
              "base_currency": "RUB",
              "contract_currency_rate": "0.10000",
              "donate_multiplier": "1.2"
            },
            "base_doc_id": 100,
            "driver_details": {
              "clid": "643753730233",
              "db_id": "7f74df331eb04ad78bc2ff25ff88a8f2",
              "uuid": "657dde13c5a14ef3a320c58c58a27b19"
            },
            "nearest_zone": "moscow",
            "rule_db_id": "<rule_id>"
          },
          "product": "subsidy",
          "service_id": 137,
          "target": "oebs",
          "tariff_class": "econom",
          "transaction_type": "payment"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 16,
        "idempotency_key": "subvention/<rule_id>/2/tlog/137"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 16,
        "amount": {
          "$decimal": "40.00"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 17,
        "idempotency_key": "subvention/<rule_id>/2/+0"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 4,
        "amount": {
          "$decimal": "40.00"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 18,
        "idempotency_key": "subvention/<rule_id>/2/total"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 17,
        "amount": {
          "$decimal": "-11.04"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "driver": {
            "driver_uuid": "657dde13c5a14ef3a320c58c58a27b19"
          },
          "firm_id": 1
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 19,
        "idempotency_key": "subvention_commission/2/park"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 18,
        "amount": {
          "$decimal": "-11.04"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "firm_id": 1
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 20,
        "idempotency_key": "subvention_commission/2/driver"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 19,
        "amount": {
          "$decimal": "-11.04"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 21,
        "idempotency_key": "subvention_commission/2/+0"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 4,
        "amount": {
          "$decimal": "-11.04"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 22,
        "idempotency_key": "subvention_commission/2/total"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 20,
        "amount": {
          "$decimal": "-1.32"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "agglomeration": "MSKc",
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "billing_client_id": "100500",
          "contract_id": "1",
          "detailed_product": "subsidy_commission",
          "due": "2020-12-22T11:52:00+03:00",
          "external_ref": "alias_id/902fe475af72677caea7b8f49db06905",
          "handled_in_trust_flow": false,
          "invoice_date": "2021-06-10T20:00:00+03:00",
          "is_payable": true,
          "order_id": "28e560e5a7c26a6bbc3ba9b73ab9657a",
          "payload": {
            "amount_details": {
              "base_amount": "11.04000",
              "base_currency": "RUB",
              "contract_currency_rate": "0.10000",
              "donate_multiplier": "1.2"
            },
            "base_doc_id": 100,
            "driver_details": {
              "clid": "643753730233",
              "db_id": "7f74df331eb04ad78bc2ff25ff88a8f2",
              "uuid": "657dde13c5a14ef3a320c58c58a27b19"
            },
            "nearest_zone": "moscow"
          },
          "product": "subsidy",
          "service_id": 137,
          "target": "oebs",
          "tariff_class": "econom",
          "transaction_type": "refund"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 23,
        "idempotency_key": "subvention_commission/2/tlog"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 21,
        "amount": {
          "$decimal": "-12"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 24,
        "idempotency_key": "subvention_park_commission/2/1"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 22,
        "amount": {
          "$decimal": "-12"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "driver": {
            "driver_uuid": "657dde13c5a14ef3a320c58c58a27b19"
          }
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 25,
        "idempotency_key": "subvention_park_commission/2/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 4,
        "amount": {
          "$decimal": "-12"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 26,
        "idempotency_key": "subvention_park_commission/2/3"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 23,
        "amount": {
          "$decimal": "-12"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 27,
        "idempotency_key": "subvention_park_commission/2/4"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 24,
        "amount": {
          "$decimal": "272.0"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 28,
        "idempotency_key": "cash_payment/2/payment/driver"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 25,
        "amount": {
          "$decimal": "272.0"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "driver": {
            "driver_uuid": "657dde13c5a14ef3a320c58c58a27b19"
          }
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "id": 29,
        "idempotency_key": "cash_payment/2/payment/park"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 26,
        "amount": {
          "$decimal": "272.0"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 30,
        "idempotency_key": "cash_payment/2/payment/yandex_ride+0"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 27,
        "amount": {
          "$decimal": "1.0000"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "order_id": "28e560e5a7c26a6bbc3ba9b73ab9657a"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 31,
        "idempotency_key": "dxgy_num_orders/group_id_dxgy/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 28,
        "amount": {
          "$decimal": "2.0000"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "order_id": "28e560e5a7c26a6bbc3ba9b73ab9657a"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:48:39.046000+00:00"
        },
        "id": 32,
        "idempotency_key": "goal_num_orders/12345:A/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 29,
        "amount": {
          "$decimal": "2.0000"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "order_id": "28e560e5a7c26a6bbc3ba9b73ab9657a"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:48:39.046000+00:00"
        },
        "id": 33,
        "idempotency_key": "goal_num_orders_per_contract/12345:A/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 30,
        "amount": {
          "$decimal": "1.0000"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "order_id": "28e560e5a7c26a6bbc3ba9b73ab9657a"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 34,
        "idempotency_key": "nmfg_num_orders/group_id_nmfg/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 31,
        "amount": {
          "$decimal": "10"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "income_type": "order"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 35,
        "idempotency_key": "nmfg_income/group_id_nmfg/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 31,
        "amount": {
          "$decimal": "3"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905",
          "income_type": "subvention"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 36,
        "idempotency_key": "nmfg_subv_income/group_id_nmfg/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 32,
        "amount": {
          "$decimal": "1"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 37,
        "idempotency_key": "nmfg_subv_comm_total/group_id_nmfg/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 32,
        "amount": {
          "$decimal": "2"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 38,
        "idempotency_key": "nmfg_commission_total/group_id_nmfg/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 33,
        "amount": {
          "$decimal": "1.0000"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 39,
        "idempotency_key": "nmfg_nrides_per_coupon/group_id_nmfg/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 34,
        "amount": {
          "$decimal": "1.0000"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 40,
        "idempotency_key": "nmfg_nrides_per_wshift/group_id_nmfg/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 35,
        "amount": {
          "$decimal": "1"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "902fe475af72677caea7b8f49db06905"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 41,
        "idempotency_key": "nmfg_coupon_commission/group_id_nmfg/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 36,
        "amount": {
          "$decimal": "1"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "order_id": "28e560e5a7c26a6bbc3ba9b73ab9657a"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:48:39.046000+00:00"
        },
        "id": 42,
        "idempotency_key": "geo_booking_on_order_min/geo_booking_rule_id/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 37,
        "amount": {
          "$decimal": "10"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {},
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:48:39.046000+00:00"
        },
        "id": 43,
        "idempotency_key": "geo_booking_income/geo_booking_rule_id/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 37,
        "amount": {
          "$decimal": "3"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "order_id": "28e560e5a7c26a6bbc3ba9b73ab9657a"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:48:39.046000+00:00"
        },
        "id": 44,
        "idempotency_key": "geo_booking_subv_income/geo_booking_rule_id/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 38,
        "amount": {
          "$decimal": "1"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "order_id": "28e560e5a7c26a6bbc3ba9b73ab9657a"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:52:00+00:00"
        },
        "id": 45,
        "idempotency_key": "p_dxgy_num_orders/p_group_id_dxgy/2"
      }
    }
  ],
  "expected_results": {
    "$Results": {
      "doc_update": {
        "$LastEntries": {
          "adopted_entry_ids": [],
          "entry_ids": [
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9,
            10,
            11,
            12,
            13,
            14,
            15,
            16,
            17,
            18,
            19,
            20,
            21,
            22,
            23,
            24,
            25,
            26,
            27,
            28,
            29,
            30,
            31,
            32,
            33,
            34,
            35,
            36,
            37,
            38,
            39,
            40,
            41,
            42,
            43,
            44,
            45
          ],
          "history_doc_id": 1,
          "reversal_entry_ids": []
        }
      },
      "entry_ids": [
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12,
        13,
        14,
        15,
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        24,
        25,
        26,
        27,
        28,
        29,
        30,
        31,
        32,
        33,
        34,
        35,
        36,
        37,
        38,
        39,
        40,
        41,
        42,
        43,
        44,
        45
      ],
      "eta": null,
      "is_completed": true,
      "is_postponed": false,
      "next_status": "forward_tlog_entries"
    }
  }
}
