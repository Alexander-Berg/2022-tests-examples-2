{
  "bsx_v1_rules_match_responses": [
    {
      "match": []
    },
    {
      "match": []
    }
  ],
  "bsx_v2_rules_match_responses": [
    {
      "matches": []
    }
  ],
  "doc": {
    "$load_py_json": "cargo_claim.json"
  },
  "expected_query": {
    "$Query": {
      "acquiring_commission_agreement_rate": null,
      "call_center_surcharge_inc_vat": {
        "$decimal": "0"
      },
      "commissions": [
        {
          "$Commission": {
            "group": {
              "$commission_group": "base"
            },
            "value": {
              "$decimal": "61.3333"
            },
            "vat": {
              "$decimal": "73.6000"
            }
          }
        }
      ],
      "contracts": [
        {
          "$Contract": {
            "currency": "USD",
            "firm_id": 42,
            "id": 1,
            "target": "oebs"
          }
        }
      ],
      "doc_ref": 1234567890,
      "driver": {
        "$Driver": {
          "activity_points": 50,
          "available_tariff_classes": [
            "econom"
          ],
          "billing_client_id": "100500",
          "clid": "643753730233",
          "driver_license_personal_id": "some_driver_license_personal_id",
          "driver_profile_id": "some_driver_profile_id",
          "hired_at": {
            "$datetime": "2020-12-22T11:48:39.046000+03:00"
          },
          "hiring_type": "commercial",
          "park_id": "some_park_id",
          "profile_payment_type_restrictions": "none",
          "tariff_zone": "tula",
          "unique_driver_id": "5b05621ee6c22ea2654849f4"
        }
      },
      "goal_precheck_enabled": false,
      "multiply_instant_payments_by_counter": true,
      "netting_config": {
        "$netting_config": {}
      },
      "order": {
        "$Order": {
          "accepted_by_driver_at": {
            "$datetime": "2020-12-22T08:48:39.046000+00:00"
          },
          "cancel_distance": null,
          "cancelled_at": null,
          "cancelled_with_captcha": false,
          "city_id": "Москва",
          "closed_without_accept": false,
          "commission_limit_if_promocode": {
            "$decimal": 1
          },
          "completed_at": {
            "$datetime": "2020-12-22T08:48:39.046000+00:00"
          },
          "cost": {
            "$decimal": "272"
          },
          "cost_for_driver": null,
          "counter_multiplier": 2,
          "country_code": "rus",
          "currency": "RUB",
          "discount": {
            "$decimal": "200"
          },
          "driver_with_promocode": false,
          "driver_with_workshift": false,
          "due": {
            "$datetime": "2020-12-22T08:52:00+00:00"
          },
          "id": "some_order_id",
          "ind_bel_nds_rate": {
            "$decimal": "1.2"
          },
          "is_cargo": false,
          "marketing_level": {
            "$frozenset": []
          },
          "need_dispatcher_acceptance": false,
          "oebs_mvp_id": "MSKc",
          "park_corp_vat": {
            "$decimal": "1.3"
          },
          "park_ride_sum": {
            "$decimal": 100
          },
          "payment_type": {
            "$payment_type": "card"
          },
          "rebate_rate": {
            "$decimal": "1.4"
          },
          "source": null,
          "status": "finished",
          "tariff_class": "econom",
          "tariff_zone": "moscow",
          "taxi_status": "complete",
          "time_zone": "Europe/Moscow",
          "transporting_distance_meters": 10,
          "transporting_time_seconds": 32
        }
      },
      "rules": [],
      "service_to_contract": {
        "$int_key_mapping": {
          "137": 1
        }
      },
      "shifts_config": {
        "$ShiftsConfig": {
          "ignore_on_order_time": true,
          "ignore_order_income": false,
          "shift_processing_delay": {
            "$timedelta": {
              "hours": 4
            }
          },
          "should_schedule_shift_ended": {
            "$true_or_reason": {
              "reason": null,
              "value": true
            }
          }
        }
      },
      "single_ride_af_decisions_end": {
        "$time": "04:00"
      },
      "subvention_commission_agreement": {
        "$Agreement": {
          "branding_discounts": [
            {
              "$BrandingDiscount": {
                "marketing_level": {
                  "$frozenset": [
                    "lightbox",
                    "co_branding"
                  ]
                },
                "value": {
                  "$decimal": "0.04"
                }
              }
            },
            {
              "$BrandingDiscount": {
                "marketing_level": {
                  "$frozenset": [
                    "lightbox"
                  ]
                },
                "value": {
                  "$decimal": "0.02"
                }
              }
            }
          ],
          "cancellation_settings": {
            "$CancellationSettings": {
              "billable_cancel_distance": 300,
              "billable_park_interval": {
                "$CancellationInterval": {
                  "after_order_due": {
                    "$timedelta": {
                      "seconds": 420
                    }
                  },
                  "before_order_due": {
                    "$timedelta": {
                      "seconds": 600
                    }
                  }
                }
              },
              "billable_user_interval": {
                "$CancellationInterval": {
                  "after_order_due": {
                    "$timedelta": {
                      "seconds": 120
                    }
                  },
                  "before_order_due": {
                    "$timedelta": {
                      "seconds": 600
                    }
                  }
                }
              }
            }
          },
          "category": null,
          "cost_info": {
            "$CostInfoBoundaries": {
              "max_cost": {
                "$decimal": "150000000"
              },
              "min_cost": {
                "$decimal": "0.0000"
              }
            }
          },
          "effective_billing_type": "normal",
          "group": "base",
          "id": "fixed_rate_id",
          "kind": "fixed_rate",
          "rate": {
            "$RateFlat": {
              "value": {
                "$decimal": "0.2300"
              }
            }
          },
          "settings": null,
          "support_info": null,
          "unrealized_rate": null,
          "vat_rate": {
            "$decimal": "1.2"
          }
        }
      },
      "use_bulk_af": false
    }
  },
  "expected_v1_rules_match_requests": [
    {
      "activity_points": 50,
      "driver_branding": "no_branding",
      "geoareas": [
        "area51"
      ],
      "profile_payment_type_restrictions": "none",
      "profile_tariff_classes": [
        "econom"
      ],
      "reference_time": "2020-12-22T08:52:00+00:00",
      "rule_types": [
        "nmfg",
        "do_x_get_y"
      ],
      "tags": [
        "some_tag"
      ],
      "tariff_class": "econom",
      "time_zone": "Europe/Moscow",
      "unique_driver_id": "5b05621ee6c22ea2654849f4",
      "zone_name": "moscow"
    },
    {
      "activity_points": 50,
      "driver_branding": "no_branding",
      "geoareas": [
        "area51"
      ],
      "profile_payment_type_restrictions": "none",
      "profile_tariff_classes": [
        "econom"
      ],
      "reference_time": "2020-12-22T08:48:39.046000+00:00",
      "rule_types": [
        "booking_geo"
      ],
      "tags": [
        "some_tag"
      ],
      "tariff_class": "econom",
      "time_zone": "Europe/Moscow",
      "zone_name": "moscow"
    }
  ],
  "expected_v2_rules_match_requests": [
    {
      "activity_points": 50,
      "geoareas": [
        "area51"
      ],
      "geonode": "russia/moscow",
      "has_lightbox": false,
      "has_sticker": false,
      "reference_time": "2020-12-22T08:48:39.046000+00:00",
      "tags": [
        "some_tag"
      ],
      "tariff_class": "econom",
      "timezone": "Europe/Moscow",
      "unique_driver_id": "5b05621ee6c22ea2654849f4",
      "zone": "tula"
    }
  ]
}
