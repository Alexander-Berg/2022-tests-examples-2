{
  "cargo_order": {
    "$Doc": {
      "data": {
        "contracts": {
          "items": [
            {
              "currency": "USD",
              "firm_id": null,
              "id": 1
            }
          ],
          "service_to_contract": {
            "137": 1
          }
        },
        "driver": {
          "activity_points": 50,
          "available_tariff_classes": [
            "selfdriving",
            "econom",
            "business"
          ],
          "billing_client_id": "100500",
          "clid": "643753730233",
          "driver_license_personal_id": "some_driver_license_personal_id",
          "driver_profile_id": "657dde13c5a14ef3a320c58c58a27b19",
          "park_id": "7f74df331eb04ad78bc2ff25ff88a8f2",
          "profile_payment_type_restrictions": "none",
          "unique_driver_id": "5b05621ee6c22ea2654849f4"
        },
        "driver_fix": {
          "agreement_id": "subvention_agreement/1/default/_id/new_rule_id/subscription/doc_id/123456",
          "balances_change": {
            "guarantee": "50",
            "intervals": [
              {
                "duration_min": "10.2",
                "rate_per_min": "1.0"
              }
            ],
            "minutes_on_order": "2.28"
          },
          "shift_ended_doc_id": 12345
        },
        "driver_mode": {
          "mode": "driver_fix"
        },
        "order_info": {
          "billing_at": "2020-12-22T11:48:39.046000+03:00",
          "city_id": "Москва",
          "claims": [
            {
              "taxi_alias_id": "some_alias_id_1",
              "taxi_order_id": "some_order_id_1"
            }
          ],
          "completed_at": "2020-12-22T11:49:39.046000+03:00",
          "due": "2020-12-22T11:52:00+03:00",
          "has_lightbox": false,
          "has_sticker": false,
          "id": "28e560e5a7c26a6bbc3ba9b73ab9657a",
          "is_cargo": false,
          "need_dispatcher_acceptance": false,
          "oebs_mvp_id": "MSKc",
          "payment_type": "cash",
          "started_at": "2020-12-22T11:48:39.046000+03:00",
          "status": "finished",
          "subvention_geoareas": [
            "area51"
          ],
          "tags": [],
          "tariff_class": "econom",
          "taxi_status": "complete",
          "time_zone": "Europe/Moscow",
          "zone_name": "moscow"
        },
        "subventions": {
          "is_eligible": false,
          "skip_reason": "no_matching_rules"
        },
        "version": 1
      },
      "entry_ids": [],
      "event_at": {
        "$datetime": "1991-06-18T07:15:00+03:00"
      },
      "external_ref": "1",
      "id": 100,
      "kind": "cargo_order",
      "process_at": {
        "$datetime": "1991-06-18T07:15:00+03:00"
      },
      "revision": 1,
      "status": "create_entries",
      "topic": "taxi/alias_id/902fe475af72677caea7b8f49db06905"
    }
  },
  "expected_accounts": [
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/default/_id/new_rule_id/subscription/doc_id/123456",
        "currency": "XXX",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 1,
        "sub_account": "guarantee"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/default/_id/new_rule_id/subscription/doc_id/123456",
        "currency": "XXX",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 2,
        "sub_account": "guarantee/on_order"
      }
    },
    {
      "$Account": {
        "agreement_id": "subvention_agreement/1/default/_id/new_rule_id/subscription/doc_id/123456",
        "currency": "XXX",
        "entity_external_id": "taximeter_driver_id/7f74df331eb04ad78bc2ff25ff88a8f2/657dde13c5a14ef3a320c58c58a27b19",
        "id": 3,
        "sub_account": "time/on_order_minutes"
      }
    }
  ],
  "expected_journal": [
    {
      "$AppendedEntry": {
        "account_id": 1,
        "amount": {
          "$decimal": "50"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "intervals": [
            {
              "duration_min": "10.2",
              "rate_per_min": "1.0"
            }
          ]
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:48:39.046000+00:00"
        },
        "id": 1,
        "idempotency_key": "df_guarantee/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 2,
        "amount": {
          "$decimal": "50"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "intervals": [
            {
              "duration_min": "10.2",
              "rate_per_min": "1.0"
            }
          ]
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:48:39.046000+00:00"
        },
        "id": 2,
        "idempotency_key": "df_guarantee_on_order/2"
      }
    },
    {
      "$AppendedEntry": {
        "account_id": 3,
        "amount": {
          "$decimal": "2.28"
        },
        "created": {
          "$datetime": "2021-05-18T00:00:00+00:00"
        },
        "details": {
          "alias_id": "some_alias_id_1",
          "order_completed_at": "2020-12-22T11:49:39.046000+03:00",
          "order_id": "some_order_id_1"
        },
        "doc_ref": 100,
        "event_at": {
          "$datetime": "2020-12-22T08:48:39.046000+00:00"
        },
        "id": 3,
        "idempotency_key": "df_on_order_min/2"
      }
    }
  ],
  "expected_results": {
    "$Results": {
      "doc_update": {
        "$LastEntries": {
          "adopted_entry_ids": [],
          "entry_ids": [
            1,
            2,
            3
          ],
          "history_doc_id": 1,
          "reversal_entry_ids": []
        }
      },
      "entry_ids": [
        1,
        2,
        3
      ],
      "eta": null,
      "is_completed": true,
      "is_postponed": false,
      "next_status": "complete"
    }
  }
}
