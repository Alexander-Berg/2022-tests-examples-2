{
  "currency_rates": {
    "RUBUSD": {
      "2021-04-21": "0.01"
    }
  },
  "expected": {
    "fee": {
      "driver_balance_change": "97.7883",
      "items": [
        {
          "agreement_id": "fixed_rate_id",
          "amount": "0.0000",
          "contract_currency": "USD",
          "contract_id": 1,
          "currency_rate": "0.01000",
          "gross": {
            "amount": "0.0000",
            "contract_amount": "0.0000",
            "vat": "0.0000"
          },
          "group": "base",
          "order_cost": "0.0000",
          "service_id": 128,
          "vat": "0.0000"
        },
        {
          "agreement_id": "custom_fine_id",
          "amount": "22.0000",
          "category": "fine",
          "contract_currency": "USD",
          "contract_id": 1,
          "currency_rate": "0.01000",
          "fine_code": "fine!!!",
          "gross": {
            "amount": "22.0000",
            "contract_amount": "0.2200",
            "vat": "3.9600"
          },
          "group": "custom_fine",
          "service_id": 128,
          "vat": "3.9600"
        }
      ],
      "park_commission": "14.4016",
      "value": "25.6882",
      "value_inc_vat_park_only": "30.4259",
      "vat": "4.7376"
    },
    "is_charged": true,
    "subvention_commission_agreement": {
      "acquiring_rate": "0.02",
      "agreement": {
        "branding_discounts": [
          {
            "marketing_level": [
              "co_branding",
              "lightbox"
            ],
            "value": "0.04"
          },
          {
            "marketing_level": [
              "lightbox"
            ],
            "value": "0.02"
          }
        ],
        "cancelation_settings": {
          "billable_cancel_distance": 300,
          "billable_park_interval": {
            "after_order_due": "420",
            "before_order_due": "600"
          },
          "billable_user_interval": {
            "after_order_due": "120",
            "before_order_due": "600"
          }
        },
        "cost_info": {
          "kind": "boundaries",
          "max_cost": "150000000",
          "min_cost": "0.0000"
        },
        "effective_billing_type": "normal",
        "group": "base",
        "id": "fixed_rate_id",
        "kind": "fixed_rate",
        "rate": {
          "kind": "flat",
          "rate": "0.2300"
        },
        "vat_rate": "1.2"
      }
    },
    "support_info_doc_id": 1001
  },
  "expected_billing_types": [
    "cancel",
    "normal"
  ],
  "query": {
    "$Query": {
      "calculate_expired_rate_from_status": false,
      "categories_ignoring_drivershift": [],
      "categories_ignoring_promocode": [],
      "commission_limit_if_promocode": {
        "$decimal": "1"
      },
      "contracts": [
        {
          "$Contract": {
            "currency": "USD",
            "id": 1
          }
        }
      ],
      "doc_id": 1,
      "driver": {
        "$Driver": {
          "hiring_info": {
            "$HiringInfo": {
              "hired_at": {
                "$datetime": "2021-04-20T00:00:00+00:00"
              },
              "hiring_type": {
                "$hiring_type": "commercial"
              }
            }
          },
          "mode": {
            "$driver_mode": "orders"
          },
          "tags": [
            "some_tag"
          ]
        }
      },
      "is_testing_migration_mode": false,
      "order": {
        "$Order": {
          "alias_id": "some_alias_id",
          "call_center": null,
          "cancel_distance": 9,
          "cancelled_at": {
            "$datetime": "2021-04-21T00:00:00+00:00"
          },
          "cancelled_with_captcha": false,
          "cost": {
            "$decimal": "0"
          },
          "cost_for_driver": {
            "$decimal": "100"
          },
          "currency": "RUB",
          "discount": {
            "$decimal": "10"
          },
          "driver_promocode": null,
          "due": {
            "$datetime": "2021-04-21T00:00:00+00:00"
          },
          "fine_code": "some_fine_code",
          "fleet_subscription_level": "level3",
          "ind_bel_vat_rate": null,
          "is_cargo": false,
          "is_mqc": false,
          "marketing_level": {
            "$frozenset": [
              "lightbox"
            ]
          },
          "need_dispatcher_acceptance": false,
          "park_corp_vat": {
            "$decimal": "1.1"
          },
          "park_ride_sum": {
            "$decimal": "100"
          },
          "payment_type": {
            "$payment_type": "applepay"
          },
          "rebate_rate": null,
          "source": "call_center",
          "status": "cancelled",
          "tariff_class": "econom",
          "tariff_minimal_cost": {
            "$decimal": "50"
          },
          "tariff_zone": "moscow",
          "taxi_status": "complete",
          "time_zone": "Europe/Moscow",
          "with_driver_workshift": false
        }
      },
      "order_park_commission_rule": {
        "$ParkCommissionRule": {
          "amount_fixed": "0.0000",
          "amount_rate": "0.1333",
          "is_commission_if_platform_commission_is_null_enabled": true,
          "is_platfrom_commission_enabled": true,
          "kind": "order",
          "rule_type_id": "4964b852670045b196e526d59915b777",
          "work_rule_id": "e26a3cf21acfe01198d50030487e046b"
        }
      },
      "service_to_contract": {
        "$int_key_mapping": {
          "111": 1,
          "128": 1
        }
      },
      "should_calc_gaap_commission": false,
      "use_call_center_cost": false,
      "use_minimal_tariff_cost": false
    }
  },
  "support_info_items_to_save": {
    "alias_id": "some_alias_id",
    "data": {
      "agreements": [
        {
          "data": {
            "commission": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "0",
                      "currency": "RUB"
                    }
                  ],
                  "details": {
                    "cancel_distance": 9,
                    "canceler": "user",
                    "min_cancel_distance_to_take_commission": 300
                  },
                  "op": "set",
                  "reason": "set_from_close_distance_cancel",
                  "value": {
                    "amount": "0",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "0",
                "currency": "RUB"
              }
            },
            "contract_id": "acquiring_id",
            "vat": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "0",
                      "currency": "RUB"
                    }
                  ],
                  "details": {
                    "cancel_distance": 9,
                    "canceler": "user",
                    "min_cancel_distance_to_take_commission": 300
                  },
                  "op": "set",
                  "reason": "set_from_close_distance_cancel",
                  "value": {
                    "amount": "0",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "0",
                "currency": "RUB"
              }
            },
            "vat_rate": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "1",
                      "currency": "XXX"
                    }
                  ],
                  "op": "set",
                  "reason": "set_from_acquiring",
                  "value": {
                    "amount": "1",
                    "currency": "XXX"
                  }
                }
              ],
              "value": {
                "amount": "1",
                "currency": "XXX"
              }
            }
          },
          "kind": "acquiring"
        },
        {
          "data": {
            "commission": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "0",
                      "currency": "RUB"
                    }
                  ],
                  "details": {
                    "cancel_distance": 9,
                    "canceler": "user",
                    "min_cancel_distance_to_take_commission": 300
                  },
                  "op": "set",
                  "reason": "set_from_close_distance_cancel",
                  "value": {
                    "amount": "0",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "0",
                "currency": "RUB"
              }
            },
            "contract_id": "fixed_rate_id",
            "vat": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "0",
                      "currency": "RUB"
                    }
                  ],
                  "details": {
                    "cancel_distance": 9,
                    "canceler": "user",
                    "min_cancel_distance_to_take_commission": 300
                  },
                  "op": "set",
                  "reason": "set_from_close_distance_cancel",
                  "value": {
                    "amount": "0",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "0",
                "currency": "RUB"
              }
            },
            "vat_rate": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "1.2",
                      "currency": "XXX"
                    }
                  ],
                  "op": "set",
                  "reason": "set_from_contract_rate",
                  "value": {
                    "amount": "1.2",
                    "currency": "XXX"
                  }
                }
              ],
              "value": {
                "amount": "1.2",
                "currency": "XXX"
              }
            }
          },
          "kind": "base"
        },
        {
          "data": {
            "commission": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "0",
                      "currency": "RUB"
                    }
                  ],
                  "details": {
                    "cancel_distance": 9,
                    "canceler": "user",
                    "min_cancel_distance_to_take_commission": 300
                  },
                  "op": "set",
                  "reason": "set_from_close_distance_cancel",
                  "value": {
                    "amount": "0",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "0",
                "currency": "RUB"
              }
            },
            "contract_id": "hiring_contract_id",
            "vat": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "0",
                      "currency": "RUB"
                    }
                  ],
                  "details": {
                    "cancel_distance": 9,
                    "canceler": "user",
                    "min_cancel_distance_to_take_commission": 300
                  },
                  "op": "set",
                  "reason": "set_from_close_distance_cancel",
                  "value": {
                    "amount": "0",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "0",
                "currency": "RUB"
              }
            },
            "vat_rate": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "1.2",
                      "currency": "XXX"
                    }
                  ],
                  "op": "set",
                  "reason": "set_from_contract_rate",
                  "value": {
                    "amount": "1.2",
                    "currency": "XXX"
                  }
                }
              ],
              "value": {
                "amount": "1.2",
                "currency": "XXX"
              }
            }
          },
          "kind": "hiring"
        },
        {
          "data": {
            "commission": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "0",
                      "currency": "RUB"
                    }
                  ],
                  "details": {
                    "cancel_distance": 9,
                    "canceler": "user",
                    "min_cancel_distance_to_take_commission": 300
                  },
                  "op": "set",
                  "reason": "set_from_close_distance_cancel",
                  "value": {
                    "amount": "0",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "0",
                "currency": "RUB"
              }
            },
            "contract_id": "reposition_id",
            "vat": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "0",
                      "currency": "RUB"
                    }
                  ],
                  "details": {
                    "cancel_distance": 9,
                    "canceler": "user",
                    "min_cancel_distance_to_take_commission": 300
                  },
                  "op": "set",
                  "reason": "set_from_close_distance_cancel",
                  "value": {
                    "amount": "0",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "0",
                "currency": "RUB"
              }
            },
            "vat_rate": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "1.2",
                      "currency": "XXX"
                    }
                  ],
                  "op": "set",
                  "reason": "set_from_contract_rate",
                  "value": {
                    "amount": "1.2",
                    "currency": "XXX"
                  }
                }
              ],
              "value": {
                "amount": "1.2",
                "currency": "XXX"
              }
            }
          },
          "kind": "custom_core"
        },
        {
          "data": {
            "commission": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "0",
                      "currency": "RUB"
                    }
                  ],
                  "details": {
                    "cancel_distance": 9,
                    "canceler": "user",
                    "min_cancel_distance_to_take_commission": 300
                  },
                  "op": "set",
                  "reason": "set_from_close_distance_cancel",
                  "value": {
                    "amount": "0",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "0",
                "currency": "RUB"
              }
            },
            "contract_id": "taximeter_id",
            "vat": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "0",
                      "currency": "RUB"
                    }
                  ],
                  "details": {
                    "cancel_distance": 9,
                    "canceler": "user",
                    "min_cancel_distance_to_take_commission": 300
                  },
                  "op": "set",
                  "reason": "set_from_close_distance_cancel",
                  "value": {
                    "amount": "0",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "0",
                "currency": "RUB"
              }
            },
            "vat_rate": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "1.2",
                      "currency": "XXX"
                    }
                  ],
                  "op": "set",
                  "reason": "set_from_contract_rate",
                  "value": {
                    "amount": "1.2",
                    "currency": "XXX"
                  }
                }
              ],
              "value": {
                "amount": "1.2",
                "currency": "XXX"
              }
            }
          },
          "kind": "taximeter"
        },
        {
          "data": {
            "commission": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "22",
                      "currency": "RUB"
                    }
                  ],
                  "op": "set",
                  "reason": "set_from_value",
                  "value": {
                    "amount": "22",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "22",
                "currency": "RUB"
              }
            },
            "contract_id": "custom_fine_id",
            "fine_code": "fine!!!",
            "vat": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "3.96",
                      "currency": "RUB"
                    }
                  ],
                  "op": "set",
                  "reason": "set_from_mul_by_vat_rate",
                  "value": {
                    "amount": "3.96",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "3.96",
                "currency": "RUB"
              }
            },
            "vat_rate": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "1.18",
                      "currency": "XXX"
                    }
                  ],
                  "op": "set",
                  "reason": "set_from_contract_rate",
                  "value": {
                    "amount": "1.18",
                    "currency": "XXX"
                  }
                }
              ],
              "value": {
                "amount": "1.18",
                "currency": "XXX"
              }
            }
          },
          "kind": "custom_fine"
        },
        {
          "data": {
            "commission": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "0",
                      "currency": "RUB"
                    }
                  ],
                  "details": {
                    "cancel_distance": 9,
                    "canceler": "user",
                    "min_cancel_distance_to_take_commission": 300
                  },
                  "op": "set",
                  "reason": "set_from_close_distance_cancel",
                  "value": {
                    "amount": "0",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "0",
                "currency": "RUB"
              }
            },
            "contract_id": "software_subscription_id",
            "vat": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "0",
                      "currency": "RUB"
                    }
                  ],
                  "details": {
                    "cancel_distance": 9,
                    "canceler": "user",
                    "min_cancel_distance_to_take_commission": 300
                  },
                  "op": "set",
                  "reason": "set_from_close_distance_cancel",
                  "value": {
                    "amount": "0",
                    "currency": "RUB"
                  }
                }
              ],
              "value": {
                "amount": "0",
                "currency": "RUB"
              }
            },
            "vat_rate": {
              "calculations": [
                {
                  "args": [
                    {
                      "amount": "1.2",
                      "currency": "XXX"
                    }
                  ],
                  "op": "set",
                  "reason": "set_from_contract_rate",
                  "value": {
                    "amount": "1.2",
                    "currency": "XXX"
                  }
                }
              ],
              "value": {
                "amount": "1.2",
                "currency": "XXX"
              }
            },
            "withdraw_from_driver_account": false
          },
          "kind": "software_subscription"
        }
      ],
      "search_params": {
        "due": "2021-04-21T03:00:00+03:00",
        "payment_type": "card",
        "tags": [
          "some_tag"
        ],
        "tariff_class": "econom",
        "zone_name": "moscow"
      }
    },
    "doc_id": 1
  }
}
