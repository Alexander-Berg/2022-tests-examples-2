upstream taxi_lbs_proxy_tst {
    server lbs-cloud-proxy.taxi.tst.yandex.net max_fails=0;
}

upstream taxi_s3_pinpoi {
    server s3.mds.yandex.net max_fails=10 fail_timeout=2s;
    keepalive 2;
}

upstream driver_login_tst {
    server driver-login.taxi.tst.yandex.net:80 max_fails=0;
    server driver-login.taxi.tst.yandex.net:80 max_fails=0;
    keepalive 8;
}

upstream driver_launch_tst {
    server driver-launch.taxi.tst.yandex.net:80 max_fails=0;
    server driver-launch.taxi.tst.yandex.net:80 max_fails=0;
    keepalive 8;
}

upstream driver_referrals_upstream_tst {
    server driver-referrals.taxi.tst.yandex.net:80 max_fails=0;
    server driver-referrals.taxi.tst.yandex.net:80 max_fails=0;
    keepalive 8;
}

upstream driver_support_tst {
    server driver-support.taxi.tst.yandex.net:80 max_fails=0;
    server driver-support.taxi.tst.yandex.net:80 max_fails=0;
    keepalive 8;
}

upstream selfreg_upstream_tst {
    server selfreg.taxi.tst.yandex.net:80 max_fails=0;
    server selfreg.taxi.tst.yandex.net:80 max_fails=0;
    keepalive 8;
}

upstream driver_profile_view_upstream_tst {
    server driver-profile-view.taxi.tst.yandex.net:80 max_fails=0;
    server driver-profile-view.taxi.tst.yandex.net:80 max_fails=0;
    keepalive 8;
}

upstream driver_wall_upstream_tst {
    server driver-wall.taxi.tst.yandex.net:80 max_fails=0;
    server driver-wall.taxi.tst.yandex.net:80 max_fails=0;
    keepalive 8;
}

upstream basis_minor_upstream_tst {
    server taximeter-basis-minor.taxi.tst.yandex.net:80 max_fails=0;
    server taximeter-basis-minor.taxi.tst.yandex.net:80 max_fails=0;
    keepalive 8;
}

upstream cashbox_integration_upstream_tst {
    server cashbox-integration.taxi.tst.yandex.net:80 max_fails=0;
    server cashbox-integration.taxi.tst.yandex.net:80 max_fails=0;
    keepalive 8;
}

server {

    include listen;


    server_name core-yandex.taxi.tst.yandex.net;
    server_name taximeter-core.tst.mobile.yandex.net;


    client_max_body_size 100m;
    large_client_header_buffers 4 16k;

    set_real_ip_from 2a02:6b8:c00::/40;
    real_ip_header X-Real-IP;

    location /taxi {
        return 404;
    }

    location = /mirror_tst_dp {

        internal;

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For-Y $remote_addr;
        proxy_set_header Host "driver-protocol.taxi.tst.yandex.net";
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://driver-protocol.taxi.tst.yandex.net$request_uri;

    }

    location /driver/settings/locale {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /lbs {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header Host lbs-cloud-proxy.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_lbs_proxy_tst/lbs;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /lbs_batch {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header Host lbs-cloud-proxy.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_lbs_proxy_tst/lbs_batch;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /ptom {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host pro-test-order-maker.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://pro-test-order-maker.taxi.tst.yandex.net;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/money/order {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/v1/driver/money/order;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /driver/pays/list {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/v1/driver/pays/list;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /v2/driver/money/order {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /v1/driver/money/ {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /v1/driver/shown-tooltips {
        client_max_body_size   1m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /v1/driver/deals-available {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /v1/parks/orders/receipt/request {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream/v1/parks/orders/receipt/request;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /v1/parks/orders/receipt {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header Host cashbox-integration.taxi.tst.yandex.net;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://cashbox_integration_upstream_tst/v1/parks/orders/receipt;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/authorization/login/new {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Remote-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-login.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://driver_login_tst/v1/driver/login;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/v1/login/v2/passport {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Remote-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-login.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://driver_login_tst;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/authorization/logout/new {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Remote-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-login.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://driver_login_tst/v1/logout;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/seen/setcar {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/v1/seen;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /driver/status/set {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/feeds/add {

        client_max_body_size   1m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/v1/driver-feedback/v1/feedback;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/taxi/drivercheck {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/check;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location = /driver/session/token {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;

        proxy_pass http://taxi_driver_authproxy_upstream/driver/v1/partner/v1/client-notify/subscribe;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location = /driver/session/token/xiva {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;

        proxy_pass http://taxi_driver_authproxy_upstream/driver/v1/partner/v1/client-notify/subscribe;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/topics {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream/driver/v1/ucommunications/notification/topics;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/v1/events/v1/pull {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host client-events.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header Connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream/pro/v1/pull;

        proxy_redirect off;
        proxy_intercept_errors on;
    }

    location /get-taximeter/wall-images {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-wall.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        rewrite /get-taximeter/wall-images/(.*) /driver/v1/driver-wall/image/$1 break;
        proxy_pass http://driver-wall.taxi.tst.yandex.net;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/wall/get {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream/driver/v1/driver-wall/messages;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/wall {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        rewrite /driver/wall/(.*) /driver/v1/driver-wall/$1 break;
        proxy_pass http://taxi_driver_authproxy_upstream;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/taxi/launch {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Remote-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-launch.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://driver_launch_tst/v1/launch;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/polling/state {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/polling/subventions_status {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/v1/status;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    #no session needed for homesuggest
    location /driver/homesuggest {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-protocol.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://driver-protocol.taxi.tst.yandex.net;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/reverse_geocoding {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/queue {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/biometry/photo {
        #https://st.yandex-team.ru/TAXIACCESSDATA-51
        return 404;
    }

    location /driver/biometry/store {
        #https://st.yandex-team.ru/TAXIACCESSDATA-51
        return 404;
    }

    location /surge/region_id {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host heatmap-surge-api.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;

        proxy_pass http://heatmap-surge-api.taxi.tst.yandex.net/region_id;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /surge/zones {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host heatmap-surge-api.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;

        proxy_pass http://heatmap-surge-api.taxi.tst.yandex.net/zones;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /surge/map_meta {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host heatmap-surge-api.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;

        proxy_pass http://heatmap-surge-api.taxi.tst.yandex.net/map_meta;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /surge/tile {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host heatmap-renderer.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;

        proxy_pass http://heatmap-renderer.taxi.tst.yandex.net/tile;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /surge/heatmap {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host heatmap-renderer.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;

        proxy_pass http://heatmap-renderer.taxi.tst.yandex.net/heatmap;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driverstats {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/v1/driver/stats;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    #https://st.yandex-team.ru/TAXIADMIN-4415
    location /pinpoi
    {
	proxy_set_header connection "";
	proxy_http_version 1.1;
	proxy_set_header Host s3.mds.yandex.net;
	proxy_pass http://taxi_s3_pinpoi;
    }

    location /driver/balance/partner-onhold {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/balance/partner-main {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/balance/main/filtered {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream/v1/driver/balance/main/filtered;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/balance/partner-payment-details {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /driver/requestconfirm/set {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/v1/orders-app-api/v1/requestconfirm;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_set_header       X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header       X-Original-Host $Host;
        proxy_set_header       X-NginX-Proxy true;
        proxy_set_header       connection "";

        proxy_http_version     1.1;
        proxy_connect_timeout  30s;

        proxy_redirect off;
        proxy_intercept_errors on;
        error_page 429 =503 /503_unavailable;
    }

    location = /503_unavailable {
        server_tokens off;
        return 503;
    }

    location /driver/v1/order-offer/offer {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/v1/orders-offer/offer;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /driver/requestconfirm/route_points {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/v1/route-points;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /driver/requestconfirm/cancelpaying {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location / {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host taximeter-basis-minor.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://basis_minor_upstream_tst;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/polling/order {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/polling/cost {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/requestconfirm/fine/cost {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/strings {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/reaction_test_result {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/qc {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/settings/keywords {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/taxi/personal-subvention-groups {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/v1/personal/status;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/taxi/driver-payment-type {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/payment-type;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/taxi/drivercost {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/cost;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/company/get {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/taxi/get-driver-payment-type {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/payment-type;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/taxi/order-cost {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/order-cost;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/order/assign {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/external/code-dispatch/v1/order/assign;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/rating/item {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-profile-view.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://driver_profile_view_upstream_tst/driver/v1/rating/item;

        proxy_redirect off;
        proxy_intercept_errors on;
    }

    location /code-dispatch/v1/assignment/status {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/external/code-dispatch/v1/assignment/status;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /code-dispatch/v1/assignment/set-driver {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/external/code-dispatch/v1/assignment/set-driver;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/taxi/track-order-cost {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/track-order-cost;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/marketplace/auth {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/activity {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/activity_list {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/promocode/activate {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/support/phones {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/car/brands {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/car/models {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/car/colors {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/driver-profiles/car-bindings {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/park/cars {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/park/car-create {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/quality-card {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/performance-card {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/road-accident {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/robot {

        client_max_body_size   16m;
        rewrite /driver/robot/(.*) /v1/categories/$1 break;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/subvention-groups {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/v1/nmfg/status;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/whatsnew {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/photo/get {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/photo/set {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/taxi/onorder-subvention-groups {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/v1/schedule;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/lessons {

        client_max_body_size   1m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/v1/driver-lessons/v1/lessons;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_set_header       X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header       X-Original-Host $Host;
        proxy_set_header       X-NginX-Proxy true;
        proxy_set_header       connection "";

        proxy_http_version     1.1;
        proxy_connect_timeout  30s;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/referrals {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/v1/driver-referrals/driver;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/referrals/status {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/v1/driver-referrals/driver/status;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /v1/appstore/redirect {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-referrals.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://driver_referrals_upstream_tst/v1/appstore/redirect;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/self-employment {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/taxi/available-payment-types {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/available-payment-types;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/priority/screen {

        client_max_body_size   1m;
        proxy_pass             http://taxi_driver_authproxy_upstream/v1/priority/screen;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/polling/priority {

        client_max_body_size   1m;
        proxy_pass             http://taxi_driver_authproxy_upstream/v1/polling/priority;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }


    location = /driver/loyalty/v1/bank-driver-id {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream;

        proxy_redirect off;
        proxy_intercept_errors on;
    }

    location /driver/loyalty {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host loyalty.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream/driver/v1/loyalty;

        proxy_redirect off;
        proxy_intercept_errors on;
    }

    location /driver/v1/offer {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }


    location /reposition/v2/reposition/start {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream/v2/reposition/start;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /reposition/v2/reposition/stop {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream/v2/reposition/stop;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /reposition/v2/reposition/locations {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream/v2/reposition/locations;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/rescue {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream/driver/rescue;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/music {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/music-auth {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/profile-view/v1 {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-profile-view.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://driver_profile_view_upstream_tst/driver/profile-view/v1;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/cctv-map/v1/zones {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream/driver/cctv-map/v1/zones;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /driver/voiceforwarding {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/voiceforwarding;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/v2/status {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-status.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://taxi_driver_authproxy_upstream/v2/status/client;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /support_chat {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-support.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;

        proxy_pass http://driver_support_tst/v1$request_uri;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /selfreg/v1 {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Remote-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host selfreg.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://selfreg_upstream_tst;

        proxy_redirect off;
        proxy_intercept_errors off;
    }

    location /selfreg/fns-se {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host selfreg.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://selfreg_upstream_tst/selfreg/fns-se;

        proxy_redirect off;
        proxy_intercept_errors off;
    }

    location /selfreg/cities {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host selfreg.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://selfreg_upstream_tst/selfreg/v1/cities/suggest;

        proxy_redirect off;
        proxy_intercept_errors off;
    }

    location /selfreg/courier {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host selfreg.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://selfreg_upstream_tst/selfreg/courier;

        proxy_redirect off;
        proxy_intercept_errors off;
    }

    location /selfreg/park {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host selfreg.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://selfreg_upstream_tst;

        proxy_redirect off;
        proxy_intercept_errors off;
    }

    # SelfReg V2.0 will use new API,
    # but park choice confirmation reuses old handle `selfreg/park/choose`
    location /selfreg/v1/parks/choose {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host selfreg.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://selfreg_upstream_tst/selfreg/park/choose;

        proxy_redirect off;
        proxy_intercept_errors off;
    }

    location /selfreg/v1/profile-view/v1/park {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-profile-view.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://driver_profile_view_upstream_tst;

        proxy_redirect off;
        proxy_intercept_errors off;
    }

    location /selfreg/commit {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Remote-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host selfreg.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://selfreg_upstream_tst/selfreg/v1/commit;

        proxy_redirect off;
        proxy_intercept_errors off;
    }

    location /selfreg/checkcar {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Remote-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host selfreg.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://selfreg_upstream_tst/selfreg/v1/car/check;

        proxy_redirect off;
        proxy_intercept_errors off;
    }

    location /selfreg/newcar {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Remote-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host selfreg.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://selfreg_upstream_tst/selfreg/v1/car/new;

        proxy_redirect off;
        proxy_intercept_errors off;
    }

    location /selfreg/newdriver {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Remote-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host selfreg.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://selfreg_upstream_tst/selfreg/v1/driver-license;

        proxy_redirect off;
        proxy_intercept_errors off;
    }

    location /selfreg/validatelicense {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Remote-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host selfreg.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://selfreg_upstream_tst/selfreg/v1/validate-license;

        proxy_redirect off;
        proxy_intercept_errors off;
    }

    location /callback_request {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-support.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;

        proxy_pass http://driver_support_tst/v1$request_uri;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /bug_reports {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host driver-support.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;

        proxy_pass http://driver_support_tst/v1$request_uri;

        proxy_redirect off;
        proxy_intercept_errors on;

    }

    location /v1/driver/parks/certifications/list {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /v1/mode/set_by_session {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /v1/view/available_offers {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /v1/view/status {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/events {

        client_max_body_size   1m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/v1/driver-fix/v1/view/events;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /driver/subventions_summary {

        client_max_body_size   1m;
        proxy_pass             http://taxi_driver_authproxy_upstream/driver/v1/subvention-view/v1/view/summary;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }


    location /v1/get_tariff_info {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /v1/get_modifications {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /v1/fallback/get_modifications {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }

    location /v1/order/recalculate {

        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;

    }


    location = /ping-auth {
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /driver/ {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /driver/v1/ {
        client_max_body_size   16m;
        proxy_pass             http://taxi_driver_authproxy_upstream;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /driver/v1/shuttle-control/v1/shuttle/start_trip {
        proxy_pass http://taxi_driver_authproxy_upstream/driver/v1/shuttle-control/v1/shuttle/start_trip;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /driver/v1/shuttle-control/v1/shuttle/stop_trip {
        proxy_pass http://taxi_driver_authproxy_upstream/driver/v1/shuttle-control/v1/shuttle/stop_trip;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /driver/v1/shuttle-control/v1/shuttle/status {
        client_max_body_size   16m;
        proxy_pass http://taxi_driver_authproxy_upstream/driver/v1/shuttle-control/v1/shuttle/status;
        proxy_set_header       X-Real-IP $remote_addr;
        proxy_http_version     1.1;
        proxy_set_header       Connection "";
        proxy_connect_timeout  30s;
    }

    location /pro-marketplace {
        # https://st.yandex-team.ru/PROMARKETPLACE-35
        proxy_set_header Accept-Encoding "";

        rewrite     .* /pro-marketplace/index.html break;
        proxy_pass  https://taxi-mvp.s3.mdst.yandex.net/;
    }

    location /marketplace/v1/payment {

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host contractor-merch-payments.taxi.tst.yandex.net;
        proxy_set_header X-Original-Host $Host;
        proxy_set_header X-NginX-Proxy true;
        proxy_set_header connection "";
        proxy_http_version 1.1;

        proxy_pass http://contractor-merch-payments.taxi.tst.yandex.net/marketplace/v1/payment;
    }

    set $hsts "max-age=31536000";
    add_header Strict-Transport-Security $hsts;

}
