{
  "name": "calc_surge_grocery",
  "stages": [
    {
      "conditions": [],
      "in_bindings": [
        {
          "domain": "input",
          "query": "places"
        }
      ],
      "name": "resource_fetch",
      "resources": [
        {
          "field": "workload",
          "name": "warehouse_load"
        }
      ],
      "source_code": "let ids = []; for(let i in places) { ids.push(places[i].place_id); }; return {workload: {'place_ids': ids}};"
    },
    {
      "conditions": [],
      "in_bindings": [],
      "name": "init_out_array",
      "out_bindings": [
        {
          "alias": "places_out",
          "query": "places_out"
        }
      ],
      "source_code": "return {places_out: []};"
    },
    {
      "conditions": [],
      "in_bindings": [
        {
          "children": [
            {
              "query": "place_id"
            }
          ],
          "domain": "input",
          "query": "places.*{idx:}"
        },
        {
          "domain": "resource",
          "query": "workload[place_id]{load}"
        }
      ],
      "name": "use_resource",
      "out_bindings": [
        {
          "alias": "data",
          "query": "places_out[idx]"
        }
      ],
      "source_code": "log.debug('load ' + JSON.stringify(load)); return {data: {place_id: place_id, result: {orders: load.orders}}};"
    }
  ],
  "state": "active"
}
