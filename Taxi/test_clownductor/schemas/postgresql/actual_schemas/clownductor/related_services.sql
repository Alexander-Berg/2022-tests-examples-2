CREATE TABLE clownductor.related_services (
    service_id INTEGER NOT NULL REFERENCES
        clownductor.services (id) ON DELETE CASCADE,
    related_service_id INTEGER NOT NULL REFERENCES
        clownductor.services (id) ON DELETE CASCADE,
    PRIMARY KEY (service_id, related_service_id)
);

CREATE INDEX clownductor_related_services_related_service_id
    ON clownductor.related_services (related_service_id);

CREATE TYPE RELATION_TYPE AS ENUM (
    'service_database',
    'alias_main_service'
);

ALTER TABLE clownductor.related_services
    ADD COLUMN relation_type RELATION_TYPE NOT NULL DEFAULT 'service_database';

ALTER TABLE clownductor.related_services
    ADD COLUMN is_autogenerated BOOLEAN NOT NULL DEFAULT TRUE;
