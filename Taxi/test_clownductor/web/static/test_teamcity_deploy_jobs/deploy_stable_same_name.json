{
  "expected_jobs": [
    {
      "id": 4,
      "inited_variables": {
        "aliases": [
          {
            "branch_id": 12,
            "image": "taxi/test_service_4/production:0.0.1",
            "logbroker_configuration": null,
            "nanny_name": "test_eda_project_service_4_stable",
            "service_id": 5
          },
          {
            "branch_id": 14,
            "image": "taxi/test_service_5/production:0.0.1",
            "logbroker_configuration": null,
            "nanny_name": "test_project_service_5_stable",
            "service_id": 6
          },
          {
            "branch_id": 16,
            "image": "taxi/test_service_5/production:0.0.1",
            "logbroker_configuration": null,
            "nanny_name": "test_eda_project_service_5_stable",
            "service_id": 7
          }
        ],
        "changelog": "test deploy",
        "comment": "Automatically created release",
        "configs_branch_ids": [
          10,
          12,
          14,
          16
        ],
        "configs_info": [],
        "image": "taxi/test_service_4/production:0.0.1",
        "is_rollback": false,
        "lock_names": [
          "Deploy.test_eda_project_service_4_stable",
          "Deploy.test_eda_project_service_5_stable",
          "Deploy.test_project_service_4_stable",
          "Deploy.test_project_service_5_stable"
        ],
        "logbroker_configuration": null,
        "name": "test_project_service_4_stable",
        "prestable_aliases": [
          {
            "branch_id": 12,
            "image": "taxi/test_service_4/production:0.0.1",
            "nanny_name": "test_eda_project_service_pre_4_stable",
            "service_id": 5
          },
          {
            "branch_id": 14,
            "image": "taxi/test_service_5/production:0.0.1",
            "nanny_name": "test_project_service_pre_5_stable",
            "service_id": 6
          },
          {
            "branch_id": 16,
            "image": "taxi/test_service_5/production:0.0.1",
            "nanny_name": "test_eda_project_service_pre_5_stable",
            "service_id": 7
          }
        ],
        "prestable_name": "test_project_service_pre_4_stable",
        "project_names": [
          "test_eda_project",
          "test_project"
        ],
        "release_ticket_st": "TAXIREL-13",
        "sandbox_resources": null
      },
      "name": "DeployNannyServiceWithApprove",
      "stages": [
        {
          "appended_variables": {},
          "name": "InternalCubeCheckAndNotifyDeployments"
        },
        {
          "appended_variables": {},
          "name": "InternalBatchGetLock"
        },
        {
          "appended_variables": {
            "job_branch_id": 10,
            "job_project_id": 1,
            "job_project_name": "test_project",
            "job_service_id": 4,
            "job_service_name": "test_service_4"
          },
          "name": "InternalJobGetInformation"
        },
        {
          "appended_variables": {},
          "name": "UpdateServiceYamlParams"
        },
        {
          "appended_variables": {
            "sync_job_ids": []
          },
          "name": "StartSyncRemoteParams"
        },
        {
          "appended_variables": {},
          "name": "MetaCubeWaitForJobsCommon"
        },
        {
          "appended_variables": {
            "current_diff_aliases_jobs": [],
            "current_diff_job_id": null
          },
          "name": "FindCurrentDiff"
        },
        {
          "appended_variables": {
            "current_diff_comment": null,
            "current_diff_skip": true
          },
          "name": "CurrentDiffCommentGenerate"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeOptionalLiteEnsureComment"
        },
        {
          "appended_variables": {},
          "name": "WaitChangeSubsystem"
        },
        {
          "appended_variables": {},
          "ignore_variables": [
            "approving_managers",
            "approving_developers",
            "sandbox_approve_flow",
            "summonees",
            "responsible_managers"
          ],
          "name": "ApproveCubeGetApprovers"
        },
        {
          "appended_variables": {
            "aliases_diff_configs": null,
            "diff_comment": null,
            "diff_config": null,
            "diff_resolve_id": null,
            "diff_skip": true,
            "ok_diff_phrase": null,
            "parameters_errors_comment": null,
            "reject_diff_phrase": null
          },
          "name": "CheckDiffForDeploy"
        },
        {
          "appended_variables": {},
          "name": "StartrekCubeAddComment"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeOptionalLiteEnsureComment"
        },
        {
          "appended_variables": {
            "diff_approve_type": null,
            "diff_author": null
          },
          "name": "WaitForDiffCommentApprove"
        },
        {
          "appended_variables": {
            "aliases_diff_drafts": null,
            "diff_draft_id": null
          },
          "name": "CreateDiffDraft"
        },
        {
          "appended_variables": {
            "apply_diff_comment": null
          },
          "name": "ApplyDiffDraftCommentGenerate"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeOptionalLiteEnsureComment"
        },
        {
          "appended_variables": {
            "aliases_diff_jobs": null,
            "diff_job_id": null,
            "linked_tickets": null,
            "started_diff_jobs": null
          },
          "name": "WaitForDiffDraftApply"
        },
        {
          "appended_variables": {
            "st_comment": null
          },
          "name": "GenerateCommentWaitDiffResolve"
        },
        {
          "appended_variables": {},
          "name": "StartrekCubeAddComment"
        },
        {
          "appended_variables": {},
          "name": "WaitChangeSubsystem"
        },
        {
          "appended_variables": {
            "end_diff_comment": null
          },
          "name": "EndDiffCommentGenerate"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeOptionalLiteEnsureComment"
        },
        {
          "appended_variables": {
            "logbroker_operations": null
          },
          "name": "LogbrokerConfigurationStart"
        },
        {
          "appended_variables": {},
          "name": "LogbrokerConfigurationPoll"
        },
        {
          "appended_variables": {
            "deploy_delay": 0,
            "deploy_delay_message": ""
          },
          "name": "InternalCubeMissingDutyCheck"
        },
        {
          "appended_variables": {},
          "name": "StartrekCubeAddComment"
        },
        {
          "appended_variables": {},
          "name": "InternalCubeSleep"
        },
        {
          "appended_variables": {
            "finished_deploy_msg": "Deployment of the release in pre with internal id release:4 finished.",
            "release_id": "release:4",
            "release_key_phrase": "PRESTABLE OK for release:4",
            "skip_prestable": false,
            "summoned_assignee": null
          },
          "ignore_variables": [
            "border_comment",
            "started_deploy_msg"
          ],
          "name": "ApproveCubeLiteGeneratePreApproveId"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeOptionalLiteEnsureComment"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeLiteWaitForDevelopersApprove"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeOptionalLiteEnsureComment"
        },
        {
          "appended_variables": {},
          "name": "NotificationsCubeLenta"
        },
        {
          "appended_variables": {},
          "name": "NotifyHejmdalDeployEvent"
        },
        {
          "appended_variables": {
            "prestable_job_ids": [
              8,
              9,
              10,
              11
            ]
          },
          "meta": [
            {
              "id": 8,
              "inited_variables": {
                "changelog": "test deploy",
                "comment": "Automatically created release",
                "image": "taxi/test_service_4/production:0.0.1",
                "link_to_changelog": "/services/1/edit/4/jobs?jobId=4&isClownJob=true",
                "nanny_name": "test_project_service_pre_4_stable",
                "sandbox_resources": null
              },
              "name": "DeployOneNannyService",
              "stages": [
                {
                  "appended_variables": {
                    "job_branch_id": 10,
                    "job_project_id": 1,
                    "job_project_name": "test_project",
                    "job_service_id": 4,
                    "job_service_name": "test_service_4"
                  },
                  "name": "InternalJobGetInformation"
                },
                {
                  "appended_variables": {
                    "environment": "stable"
                  },
                  "name": "InternalGetBranchInformation"
                },
                {
                  "appended_variables": {},
                  "name": "UpdateHosts"
                },
                {
                  "appended_variables": {
                    "snapshot_id": "5c26609053b7c34a9ad5a283f48ae03c79853d58"
                  },
                  "name": "NannyCubeCreateSnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeDeploySnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyTryDestroyExtraSnapshots"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeWaitForDeploy"
                },
                {
                  "appended_variables": {},
                  "name": "SendCallback"
                }
              ]
            },
            {
              "id": 9,
              "inited_variables": {
                "changelog": "test deploy",
                "comment": "Automatically created release",
                "image": "taxi/test_service_4/production:0.0.1",
                "link_to_changelog": "/services/1/edit/4/jobs?jobId=4&isClownJob=true",
                "nanny_name": "test_eda_project_service_pre_4_stable",
                "sandbox_resources": null
              },
              "name": "DeployOneNannyService",
              "stages": [
                {
                  "appended_variables": {
                    "job_branch_id": 12,
                    "job_project_id": 2,
                    "job_project_name": "test_eda_project",
                    "job_service_id": 5,
                    "job_service_name": "test_service_4"
                  },
                  "name": "InternalJobGetInformation"
                },
                {
                  "appended_variables": {
                    "environment": "stable"
                  },
                  "name": "InternalGetBranchInformation"
                },
                {
                  "appended_variables": {},
                  "name": "UpdateHosts"
                },
                {
                  "appended_variables": {
                    "snapshot_id": "5c26609053b7c34a9ad5a283f48ae03c79853d58"
                  },
                  "name": "NannyCubeCreateSnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeDeploySnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyTryDestroyExtraSnapshots"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeWaitForDeploy"
                },
                {
                  "appended_variables": {},
                  "name": "SendCallback"
                }
              ]
            },
            {
              "id": 10,
              "inited_variables": {
                "changelog": "test deploy",
                "comment": "Automatically created release",
                "image": "taxi/test_service_5/production:0.0.1",
                "link_to_changelog": "/services/1/edit/4/jobs?jobId=4&isClownJob=true",
                "nanny_name": "test_project_service_pre_5_stable",
                "sandbox_resources": null
              },
              "name": "DeployOneNannyService",
              "stages": [
                {
                  "appended_variables": {
                    "job_branch_id": 14,
                    "job_project_id": 1,
                    "job_project_name": "test_project",
                    "job_service_id": 6,
                    "job_service_name": "test_service_5"
                  },
                  "name": "InternalJobGetInformation"
                },
                {
                  "appended_variables": {
                    "environment": "stable"
                  },
                  "name": "InternalGetBranchInformation"
                },
                {
                  "appended_variables": {},
                  "name": "UpdateHosts"
                },
                {
                  "appended_variables": {
                    "snapshot_id": "5c26609053b7c34a9ad5a283f48ae03c79853d58"
                  },
                  "name": "NannyCubeCreateSnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeDeploySnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyTryDestroyExtraSnapshots"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeWaitForDeploy"
                },
                {
                  "appended_variables": {},
                  "name": "SendCallback"
                }
              ]
            },
            {
              "id": 11,
              "inited_variables": {
                "changelog": "test deploy",
                "comment": "Automatically created release",
                "image": "taxi/test_service_5/production:0.0.1",
                "link_to_changelog": "/services/1/edit/4/jobs?jobId=4&isClownJob=true",
                "nanny_name": "test_eda_project_service_pre_5_stable",
                "sandbox_resources": null
              },
              "name": "DeployOneNannyService",
              "stages": [
                {
                  "appended_variables": {
                    "job_branch_id": 16,
                    "job_project_id": 2,
                    "job_project_name": "test_eda_project",
                    "job_service_id": 7,
                    "job_service_name": "test_service_5"
                  },
                  "name": "InternalJobGetInformation"
                },
                {
                  "appended_variables": {
                    "environment": "stable"
                  },
                  "name": "InternalGetBranchInformation"
                },
                {
                  "appended_variables": {},
                  "name": "UpdateHosts"
                },
                {
                  "appended_variables": {
                    "snapshot_id": "5c26609053b7c34a9ad5a283f48ae03c79853d58"
                  },
                  "name": "NannyCubeCreateSnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeDeploySnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyTryDestroyExtraSnapshots"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeWaitForDeploy"
                },
                {
                  "appended_variables": {},
                  "name": "SendCallback"
                }
              ]
            }
          ],
          "name": "MetaStartDeployNannyServices"
        },
        {
          "appended_variables": {},
          "name": "MetaCubeWaitForJobsCommon"
        },
        {
          "appended_variables": {},
          "name": "NotificationsCubeLenta"
        },
        {
          "appended_variables": {},
          "name": "NotifyHejmdalDeployEvent"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeOptionalLiteEnsureComment"
        },
        {
          "appended_variables": {
            "instruction_after_deploy": null
          },
          "name": "ApproveGenerateInstruction"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeOptionalLiteEnsureComment"
        },
        {
          "appended_variables": {
            "close_ticket_phrase": "CLOSE TICKET for release:4",
            "finished_deploy_msg": "Deployment of the release with internal id release:4 is finished.\n\nEnsure the service works properly in stable, then leave a message\n%%\nCLOSE TICKET for release:4\n%%\nto close this ticket.\n\nIf the assignee is unable to leave this message,\nmanagers or developers are also able to do that:\nкто:bruno, кто:mvpetrov",
            "managers_ok_received_msg": "**Stable:**\nManagers approved release with internal id release:4.\nWaiting for developers approve.\n**Developers should write:**\n%%\nOK for release:4\n%%\nin the comments to this ticket.\n\nSee the instruction for the deploy ((https://wiki.yandex-team.ru/taxi/backend/basichowto/deploy/ here)).",
            "release_id": "release:4",
            "release_key_phrase": "OK for release:4",
            "single_approve": false
          },
          "ignore_variables": [
            "border_comment",
            "started_deploy_msg"
          ],
          "name": "ApproveCubeLiteGenerateApproveId"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeLiteEnsureComment"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeLiteWaitForManagersApprove"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeLiteEnsureComment"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeLiteWaitForDevelopersApprove"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeLiteWaitForSingleApprove"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeLiteEnsureComment"
        },
        {
          "appended_variables": {},
          "name": "NotificationsCubeLenta"
        },
        {
          "appended_variables": {},
          "name": "NotifyHejmdalDeployEvent"
        },
        {
          "appended_variables": {
            "job_ids": [
              12,
              13,
              14,
              15
            ]
          },
          "meta": [
            {
              "id": 12,
              "inited_variables": {
                "changelog": "test deploy",
                "comment": "Automatically created release",
                "image": "taxi/test_service_4/production:0.0.1",
                "link_to_changelog": "/services/1/edit/4/jobs?jobId=4&isClownJob=true",
                "nanny_name": "test_project_service_4_stable",
                "sandbox_resources": null
              },
              "name": "DeployOneNannyService",
              "stages": [
                {
                  "appended_variables": {
                    "job_branch_id": 10,
                    "job_project_id": 1,
                    "job_project_name": "test_project",
                    "job_service_id": 4,
                    "job_service_name": "test_service_4"
                  },
                  "name": "InternalJobGetInformation"
                },
                {
                  "appended_variables": {
                    "environment": "stable"
                  },
                  "name": "InternalGetBranchInformation"
                },
                {
                  "appended_variables": {},
                  "name": "UpdateHosts"
                },
                {
                  "appended_variables": {
                    "snapshot_id": "5c26609053b7c34a9ad5a283f48ae03c79853d58"
                  },
                  "name": "NannyCubeCreateSnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeDeploySnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyTryDestroyExtraSnapshots"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeWaitForDeploy"
                },
                {
                  "appended_variables": {},
                  "name": "SendCallback"
                }
              ]
            },
            {
              "id": 13,
              "inited_variables": {
                "changelog": "test deploy",
                "comment": "Automatically created release",
                "image": "taxi/test_service_4/production:0.0.1",
                "link_to_changelog": "/services/1/edit/4/jobs?jobId=4&isClownJob=true",
                "nanny_name": "test_eda_project_service_4_stable",
                "sandbox_resources": null
              },
              "name": "DeployOneNannyService",
              "stages": [
                {
                  "appended_variables": {
                    "job_branch_id": 12,
                    "job_project_id": 2,
                    "job_project_name": "test_eda_project",
                    "job_service_id": 5,
                    "job_service_name": "test_service_4"
                  },
                  "name": "InternalJobGetInformation"
                },
                {
                  "appended_variables": {
                    "environment": "stable"
                  },
                  "name": "InternalGetBranchInformation"
                },
                {
                  "appended_variables": {},
                  "name": "UpdateHosts"
                },
                {
                  "appended_variables": {
                    "snapshot_id": "5c26609053b7c34a9ad5a283f48ae03c79853d58"
                  },
                  "name": "NannyCubeCreateSnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeDeploySnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyTryDestroyExtraSnapshots"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeWaitForDeploy"
                },
                {
                  "appended_variables": {},
                  "name": "SendCallback"
                }
              ]
            },
            {
              "id": 14,
              "inited_variables": {
                "changelog": "test deploy",
                "comment": "Automatically created release",
                "image": "taxi/test_service_5/production:0.0.1",
                "link_to_changelog": "/services/1/edit/4/jobs?jobId=4&isClownJob=true",
                "nanny_name": "test_project_service_5_stable",
                "sandbox_resources": null
              },
              "name": "DeployOneNannyService",
              "stages": [
                {
                  "appended_variables": {
                    "job_branch_id": 14,
                    "job_project_id": 1,
                    "job_project_name": "test_project",
                    "job_service_id": 6,
                    "job_service_name": "test_service_5"
                  },
                  "name": "InternalJobGetInformation"
                },
                {
                  "appended_variables": {
                    "environment": "stable"
                  },
                  "name": "InternalGetBranchInformation"
                },
                {
                  "appended_variables": {},
                  "name": "UpdateHosts"
                },
                {
                  "appended_variables": {
                    "snapshot_id": "5c26609053b7c34a9ad5a283f48ae03c79853d58"
                  },
                  "name": "NannyCubeCreateSnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeDeploySnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyTryDestroyExtraSnapshots"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeWaitForDeploy"
                },
                {
                  "appended_variables": {},
                  "name": "SendCallback"
                }
              ]
            },
            {
              "id": 15,
              "inited_variables": {
                "changelog": "test deploy",
                "comment": "Automatically created release",
                "image": "taxi/test_service_5/production:0.0.1",
                "link_to_changelog": "/services/1/edit/4/jobs?jobId=4&isClownJob=true",
                "nanny_name": "test_eda_project_service_5_stable",
                "sandbox_resources": null
              },
              "name": "DeployOneNannyService",
              "stages": [
                {
                  "appended_variables": {
                    "job_branch_id": 16,
                    "job_project_id": 2,
                    "job_project_name": "test_eda_project",
                    "job_service_id": 7,
                    "job_service_name": "test_service_5"
                  },
                  "name": "InternalJobGetInformation"
                },
                {
                  "appended_variables": {
                    "environment": "stable"
                  },
                  "name": "InternalGetBranchInformation"
                },
                {
                  "appended_variables": {},
                  "name": "UpdateHosts"
                },
                {
                  "appended_variables": {
                    "snapshot_id": "5c26609053b7c34a9ad5a283f48ae03c79853d58"
                  },
                  "name": "NannyCubeCreateSnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeDeploySnapshot"
                },
                {
                  "appended_variables": {},
                  "name": "NannyTryDestroyExtraSnapshots"
                },
                {
                  "appended_variables": {},
                  "name": "NannyCubeWaitForDeploy"
                },
                {
                  "appended_variables": {},
                  "name": "SendCallback"
                }
              ]
            }
          ],
          "name": "MetaStartDeployNannyServices"
        },
        {
          "appended_variables": {},
          "name": "MetaCubeWaitForJobsCommon"
        },
        {
          "appended_variables": {},
          "name": "NotificationsCubeLenta"
        },
        {
          "appended_variables": {},
          "name": "NotifyHejmdalDeployEvent"
        },
        {
          "appended_variables": {},
          "name": "ApproveCubeLiteEnsureComment"
        },
        {
          "appended_variables": {},
          "name": "InternalCubeUpdateServiceConfigs"
        },
        {
          "appended_variables": {
            "skip_closure_status": true
          },
          "name": "ApproveCubeWaitForClosureStatus"
        },
        {
          "appended_variables": {},
          "name": "StartrekCubeCloseTicket"
        },
        {
          "appended_variables": {
            "skip_closure": false
          },
          "name": "ApproveCubeWaitForClosureApproval"
        },
        {
          "appended_variables": {},
          "name": "StartrekCubeCloseTicket"
        },
        {
          "appended_variables": {},
          "name": "InternalBatchReleaseLock"
        }
      ]
    }
  ],
  "request_data": {
    "aliases": [
      "test_service_5"
    ],
    "changelog": "test deploy",
    "configs": [
      "TEST_CONFIG_1"
    ],
    "docker_image": "taxi/test_service_4/production:0.0.1",
    "env": "production",
    "release_ticket": "TAXIREL-13",
    "service_name": "test_service_4"
  }
}
