{
  "test_samples": [
    {
      "comment": " Searching by tag that does not exist",
      "expected_response": {
        "docs": {
          "abcdef": []
        }
      },
      "request": {
        "event_at_begin": "2018-01-01T00:00:00.000000+00:00",
        "event_at_end": "2020-01-01T00:00:00.000000+00:00",
        "tags": [
          "abcdef"
        ]
      }
    },
    {
      "comment": " Searching in an unpopulated date range",
      "expected_response": {
        "docs": {
          "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79": []
        }
      },
      "request": {
        "event_at_begin": "2016-01-01T00:00:00.000000+00:00",
        "event_at_end": "2017-01-01T00:00:00.000000+00:00",
        "tags": [
          "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
        ]
      }
    },
    {
      "comment": " Searching without limit, expecting the handle to use the default. limit of 100, thus retrieving all the docs.",
      "expected_response": {
        "docs": {
          "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79": [
            {
              "created": "2018-09-09T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 50002,
              "entry_ids": [],
              "event_at": "2018-09-09T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/1/subvention_handled",
              "external_obj_id": "alias_id/ee2c3590533744cda11b5e5fc00ffebf",
              "kind": "subvention_journal",
              "process_at": "2018-09-09T07:07:52.019582+00:00",
              "revision": 5,
              "service": "billing-docs",
              "status": "complete",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            },
            {
              "created": "2018-09-10T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 20000,
              "entry_ids": [],
              "event_at": "2018-09-10T07:07:52.019582+00:00",
              "external_event_ref": "ride_order_amended",
              "external_obj_id": "alias_id/10b3a1c7dff04f0cb17a2374ef1bfe4d",
              "kind": "subvention_journal",
              "process_at": "2018-09-10T07:07:52.019582+00:00",
              "revision": 2,
              "service": "billing-docs",
              "status": "new",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            },
            {
              "created": "2018-09-10T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 60004,
              "entry_ids": [],
              "event_at": "2018-09-10T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/1/subvention_handled",
              "external_obj_id": "alias_id/6c41503787c149cbb7b650ab3d6ea44c",
              "kind": "subvention_journal",
              "process_at": "2018-09-10T07:07:52.019582+00:00",
              "revision": 7,
              "service": "billing-docs",
              "status": "complete",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            },
            {
              "created": "2018-09-11T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 60002,
              "entry_ids": [],
              "event_at": "2018-09-11T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/2/subvention_handled",
              "external_obj_id": "alias_id/ee2c3590533744cda11b5e5fc00ffebf",
              "kind": "subvention_journal",
              "process_at": "2018-09-11T07:07:52.019582+00:00",
              "revision": 6,
              "service": "billing-docs",
              "status": "complete",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            },
            {
              "created": "2018-09-12T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 70004,
              "entry_ids": [],
              "event_at": "2018-09-12T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/2/subvention_handled",
              "external_obj_id": "alias_id/6c41503787c149cbb7b650ab3d6ea44c",
              "kind": "subvention_journal",
              "process_at": "2018-09-12T07:07:52.019582+00:00",
              "revision": 8,
              "service": "billing-docs",
              "status": "complete",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            },
            {
              "created": "2018-09-13T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 70002,
              "entry_ids": [],
              "event_at": "2018-09-13T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/3/subvention_handled",
              "external_obj_id": "alias_id/ee2c3590533744cda11b5e5fc00ffebf",
              "kind": "subvention_journal",
              "process_at": "2018-09-13T07:07:52.019582+00:00",
              "revision": 7,
              "service": "billing-docs",
              "status": "complete",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            },
            {
              "created": "2018-09-14T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 80004,
              "entry_ids": [],
              "event_at": "2018-09-14T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/3/subvention_handled",
              "external_obj_id": "alias_id/6c41503787c149cbb7b650ab3d6ea44c",
              "kind": "subvention_journal",
              "process_at": "2018-09-14T07:07:52.019582+00:00",
              "revision": 9,
              "service": "billing-docs",
              "status": "complete",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            }
          ]
        }
      },
      "request": {
        "event_at_begin": "2018-09-09T00:00:00.000000+00:00",
        "event_at_end": "2019-01-01T00:00:00.000000+00:00",
        "tags": [
          "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
        ]
      }
    },
    {
      "comment": " We expect the handle to skip over non-existent docs and retrieve",
      "expected_response": {
        "docs": {
          "taxi/unique_driver_id/5c6527563fd6940450db7483": [
            {
              "created": "2018-09-04T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 40001,
              "entry_ids": [],
              "event_at": "2018-09-04T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/4/subvention_handled",
              "external_obj_id": "alias_id/b078333377f94f9b8c30e13c783906d7",
              "kind": "subvention_journal",
              "process_at": "2018-09-04T07:07:52.019582+00:00",
              "revision": 1,
              "service": "billing-docs",
              "status": "new",
              "tags": [
                "taxi/unique_driver_id/5c6527563fd6940450db7483"
              ]
            },
            {
              "created": "2018-09-05T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 50001,
              "entry_ids": [],
              "event_at": "2018-09-05T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/5/subvention_handled",
              "external_obj_id": "alias_id/b078333377f94f9b8c30e13c783906d7",
              "kind": "subvention_journal",
              "process_at": "2018-09-05T07:07:52.019582+00:00",
              "revision": 2,
              "service": "billing-docs",
              "status": "new",
              "tags": [
                "taxi/unique_driver_id/5c6527563fd6940450db7483"
              ]
            },
            {
              "created": "2018-09-06T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 60001,
              "entry_ids": [],
              "event_at": "2018-09-06T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/6/subvention_handled",
              "external_obj_id": "alias_id/b078333377f94f9b8c30e13c783906d7",
              "kind": "subvention_journal",
              "process_at": "2018-09-06T07:07:52.019582+00:00",
              "revision": 3,
              "service": "billing-docs",
              "status": "new",
              "tags": [
                "taxi/unique_driver_id/5c6527563fd6940450db7483"
              ]
            }
          ]
        }
      },
      "request": {
        "event_at_begin": "2018-01-01T00:00:00.000000+00:00",
        "event_at_end": "2019-01-01T00:00:00.000000+00:00",
        "tags": [
          "taxi/unique_driver_id/5c6527563fd6940450db7483"
        ]
      }
    },
    {
      "comment": " We expect the handle to perform query over 2 tags and 2 shards",
      "expected_response": {
        "docs": {
          "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79": [
            {
              "created": "2018-09-09T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 50002,
              "entry_ids": [],
              "event_at": "2018-09-09T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/1/subvention_handled",
              "external_obj_id": "alias_id/ee2c3590533744cda11b5e5fc00ffebf",
              "kind": "subvention_journal",
              "process_at": "2018-09-09T07:07:52.019582+00:00",
              "revision": 5,
              "service": "billing-docs",
              "status": "complete",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            },
            {
              "created": "2018-09-10T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 20000,
              "entry_ids": [],
              "event_at": "2018-09-10T07:07:52.019582+00:00",
              "external_event_ref": "ride_order_amended",
              "external_obj_id": "alias_id/10b3a1c7dff04f0cb17a2374ef1bfe4d",
              "kind": "subvention_journal",
              "process_at": "2018-09-10T07:07:52.019582+00:00",
              "revision": 2,
              "service": "billing-docs",
              "status": "new",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            },
            {
              "created": "2018-09-10T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 60004,
              "entry_ids": [],
              "event_at": "2018-09-10T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/1/subvention_handled",
              "external_obj_id": "alias_id/6c41503787c149cbb7b650ab3d6ea44c",
              "kind": "subvention_journal",
              "process_at": "2018-09-10T07:07:52.019582+00:00",
              "revision": 7,
              "service": "billing-docs",
              "status": "complete",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            },
            {
              "created": "2018-09-11T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 60002,
              "entry_ids": [],
              "event_at": "2018-09-11T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/2/subvention_handled",
              "external_obj_id": "alias_id/ee2c3590533744cda11b5e5fc00ffebf",
              "kind": "subvention_journal",
              "process_at": "2018-09-11T07:07:52.019582+00:00",
              "revision": 6,
              "service": "billing-docs",
              "status": "complete",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            },
            {
              "created": "2018-09-12T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 70004,
              "entry_ids": [],
              "event_at": "2018-09-12T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/2/subvention_handled",
              "external_obj_id": "alias_id/6c41503787c149cbb7b650ab3d6ea44c",
              "kind": "subvention_journal",
              "process_at": "2018-09-12T07:07:52.019582+00:00",
              "revision": 8,
              "service": "billing-docs",
              "status": "complete",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            },
            {
              "created": "2018-09-13T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 70002,
              "entry_ids": [],
              "event_at": "2018-09-13T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/3/subvention_handled",
              "external_obj_id": "alias_id/ee2c3590533744cda11b5e5fc00ffebf",
              "kind": "subvention_journal",
              "process_at": "2018-09-13T07:07:52.019582+00:00",
              "revision": 7,
              "service": "billing-docs",
              "status": "complete",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            },
            {
              "created": "2018-09-14T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 80004,
              "entry_ids": [],
              "event_at": "2018-09-14T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/3/subvention_handled",
              "external_obj_id": "alias_id/6c41503787c149cbb7b650ab3d6ea44c",
              "kind": "subvention_journal",
              "process_at": "2018-09-14T07:07:52.019582+00:00",
              "revision": 9,
              "service": "billing-docs",
              "status": "complete",
              "tags": [
                "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
              ]
            }
          ],
          "taxi/unique_driver_id/5c6527563fd6940450db7483": [
            {
              "created": "2018-09-04T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 40001,
              "entry_ids": [],
              "event_at": "2018-09-04T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/4/subvention_handled",
              "external_obj_id": "alias_id/b078333377f94f9b8c30e13c783906d7",
              "kind": "subvention_journal",
              "process_at": "2018-09-04T07:07:52.019582+00:00",
              "revision": 1,
              "service": "billing-docs",
              "status": "new",
              "tags": [
                "taxi/unique_driver_id/5c6527563fd6940450db7483"
              ]
            },
            {
              "created": "2018-09-05T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 50001,
              "entry_ids": [],
              "event_at": "2018-09-05T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/5/subvention_handled",
              "external_obj_id": "alias_id/b078333377f94f9b8c30e13c783906d7",
              "kind": "subvention_journal",
              "process_at": "2018-09-05T07:07:52.019582+00:00",
              "revision": 2,
              "service": "billing-docs",
              "status": "new",
              "tags": [
                "taxi/unique_driver_id/5c6527563fd6940450db7483"
              ]
            },
            {
              "created": "2018-09-06T07:07:52.019582+00:00",
              "data": {},
              "doc_id": 60001,
              "entry_ids": [],
              "event_at": "2018-09-06T07:07:52.019582+00:00",
              "external_event_ref": "order_subvention_changed/6/subvention_handled",
              "external_obj_id": "alias_id/b078333377f94f9b8c30e13c783906d7",
              "kind": "subvention_journal",
              "process_at": "2018-09-06T07:07:52.019582+00:00",
              "revision": 3,
              "service": "billing-docs",
              "status": "new",
              "tags": [
                "taxi/unique_driver_id/5c6527563fd6940450db7483"
              ]
            }
          ]
        }
      },
      "request": {
        "event_at_begin": "2018-01-01T00:00:00.000000+00:00",
        "event_at_end": "2019-01-01T00:00:00.000000+00:00",
        "tags": [
          "taxi/unique_driver_id/5c6527563fd6940450db7483",
          "taxi/unique_driver_id/5c615efb3fd6947b66fc2e79"
        ]
      }
    }
  ]
}
