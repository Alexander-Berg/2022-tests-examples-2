{
  "accounts": [
    {
      "account": {
        "account_id": 123004,
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "currency": "XXX",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "time/free_minutes"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.0+03:00",
          "balance": "15",
          "last_created": "2019-09-17T23:59:00.0+00:00",
          "last_entry_id": 34603004
        },
        {
          "accrued_at": "2019-09-17T12:00:00+00:00",
          "balance": "6",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.0+03:00",
          "balance": "5",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 123005,
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "income"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.0+03:00",
          "balance": "1000",
          "last_created": "2019-09-17T23:59:00.0+00:00",
          "last_entry_id": 34603004
        },
        {
          "accrued_at": "2019-09-17T12:00:00+00:00",
          "balance": "6",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.0+03:00",
          "balance": "5",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 123006,
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "currency": "XXX",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "time/on_order_minutes"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.0+03:00",
          "balance": "25",
          "last_created": "2019-09-17T23:59:00.0+00:00",
          "last_entry_id": 34603004
        },
        {
          "accrued_at": "2019-09-17T12:00:00+00:00",
          "balance": "6",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.0+03:00",
          "balance": "5",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 123007,
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "guarantee"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.0+03:00",
          "balance": "1500",
          "last_created": "2019-09-17T23:59:00.0+00:00",
          "last_entry_id": 34603004
        },
        {
          "accrued_at": "2019-09-17T12:00:00+00:00",
          "balance": "6",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.0+03:00",
          "balance": "5",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 123008,
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "income/cash"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.0+03:00",
          "balance": "500",
          "last_created": "2019-09-17T23:59:00.0+00:00",
          "last_entry_id": 34603004
        },
        {
          "accrued_at": "2019-09-17T12:00:00+00:00",
          "balance": "6",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.0+03:00",
          "balance": "5",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 124004,
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "currency": "XXX",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "time/free_minutes"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.0+03:00",
          "balance": "20",
          "last_created": "2019-09-17T23:59:00.0+00:00",
          "last_entry_id": 34603004
        },
        {
          "accrued_at": "2019-09-17T12:00:00+00:00",
          "balance": "5",
          "last_created": "2019-09-17T12:00:00+00:00",
          "last_entry_id": 34601004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.0+03:00",
          "balance": "6",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 124005,
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "income"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.0+03:00",
          "balance": "1000",
          "last_created": "2019-09-17T23:59:00.0+00:00",
          "last_entry_id": 34603004
        },
        {
          "accrued_at": "2019-09-17T12:00:00+00:00",
          "balance": "100",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.0+03:00",
          "balance": "6",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 124006,
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "currency": "XXX",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "time/on_order_minutes"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.0+03:00",
          "balance": "25",
          "last_created": "2019-09-17T23:59:00.0+00:00",
          "last_entry_id": 34603004
        },
        {
          "accrued_at": "2019-09-17T12:00:00+00:00",
          "balance": "5",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.0+03:00",
          "balance": "0",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 124007,
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "guarantee"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.0+03:00",
          "balance": "1300",
          "last_created": "2019-09-17T23:59:00.0+00:00",
          "last_entry_id": 34603004
        },
        {
          "accrued_at": "2019-09-17T12:00:00+00:00",
          "balance": "10",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.0+03:00",
          "balance": "6",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 124008,
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "income/cash"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.0+03:00",
          "balance": "500",
          "last_created": "2019-09-17T23:59:00.0+00:00",
          "last_entry_id": 34603004
        },
        {
          "accrued_at": "2019-09-17T12:00:00+00:00",
          "balance": "100",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.0+03:00",
          "balance": "6",
          "last_created": "2019-09-16T23:59:00.0+00:00",
          "last_entry_id": 34601004
        }
      ]
    }
  ],
  "expected_balances_request": {
    "accounts": [
      {
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "income"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "guarantee"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "guarantee/on_order"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "time/free_minutes"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "time/on_order_minutes"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "income/cash"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "discounts"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "promocodes/marketing"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/FIRST/6",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "promocodes/support"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "income"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "guarantee"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "guarantee/on_order"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "time/free_minutes"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "time/on_order_minutes"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "income/cash"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "discounts"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "promocodes/marketing"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/SECOND/28",
        "entity_external_id": "taximeter_driver_id/dbid/uuid",
        "sub_account": "promocodes/support"
      }
    ],
    "accrued_at": [
      "2019-09-16T21:00:00+00:00",
      "2019-09-17T12:00:00+00:00",
      "2019-09-17T21:00:00+00:00"
    ],
    "use_master": false
  },
  "expected_response": {
    "subventions": [
      {
        "commission_info": {
          "payoff_commission": {
            "amount": "0.000000",
            "currency": "RUB"
          }
        },
        "details": {
          "accounted_time_seconds": 1800,
          "cash_commission": {
            "amount": "0.000000",
            "currency": "RUB"
          },
          "cash_income": {
            "amount": "495.000000",
            "currency": "RUB"
          },
          "guarantee": {
            "amount": "1495.000000",
            "currency": "RUB"
          },
          "total_income": {
            "amount": "995.000000",
            "currency": "RUB"
          }
        },
        "payoff": {
          "amount": "500.000000",
          "currency": "RUB"
        },
        "period": {
          "end": "2019-09-17T21:00:00+00:00",
          "start": "2019-09-16T21:00:00+00:00"
        },
        "subvention_rule_id": "_id/FIRST",
        "type": "driver_fix"
      },
      {
        "commission_info": {
          "payoff_commission": {
            "amount": "0.000000",
            "currency": "RUB"
          }
        },
        "details": {
          "accounted_time_seconds": 2100,
          "cash_commission": {
            "amount": "0.000000",
            "currency": "RUB"
          },
          "cash_income": {
            "amount": "400.000000",
            "currency": "RUB"
          },
          "guarantee": {
            "amount": "1290.000000",
            "currency": "RUB"
          },
          "total_income": {
            "amount": "900.000000",
            "currency": "RUB"
          }
        },
        "payoff": {
          "amount": "390.000000",
          "currency": "RUB"
        },
        "period": {
          "end": "2019-09-17T21:00:00+00:00",
          "start": "2019-09-17T12:00:00+00:00"
        },
        "subvention_rule_id": "_id/SECOND",
        "type": "driver_fix"
      }
    ]
  },
  "request": {
    "driver": {
      "db_id": "dbid",
      "uuid": "uuid"
    }
  },
  "shift_ended_docs": {
    "taxi/shift_ended/taximeter_driver_id/dbid/uuid": [
      {
        "created": "2019-09-17T10:00:00.000000+03:00",
        "data": {
          "agreement_ref": "subvention_agreement/1/default/_id/FIRST",
          "antifraud_rule": {
            "days_span": 1,
            "kind": "driver_fix",
            "last_shift_date": "2019-09-17"
          },
          "commission_input": null,
          "last_date": "2019-09-17",
          "pay_after": "2019-09-17T21:00:00+00:00",
          "pay_to": {
            "external_id": "taximeter_driver_id/dbid/uuid",
            "kind": "driver"
          },
          "payment_id": "2019-09-17",
          "possible_frauder": null,
          "rule_data": {
            "data": {
              "currency": "RUB",
              "end": "2019-11-19T11:00:00.000000+03:00",
              "geoarea": "moscow_center",
              "group_id": "driver_fix_id_1",
              "id": "FIRST",
              "profile_payment_type_restrictions": "any",
              "profile_tariff_classes": [
                "econom"
              ],
              "rates": [
                {
                  "rate_per_minute": "1",
                  "starts_at": {
                    "hour": 12,
                    "iso_week_day": 1,
                    "minute": 0
                  }
                }
              ],
              "timezone_id": "Europe/Moscow",
              "zone_name": "moscow"
            },
            "subvention_type": "driver_fix"
          },
          "shift": {
            "end": "2019-09-18T00:00:00.000000+03:00",
            "start": "2019-09-17T00:00:00.000000+03:00"
          },
          "subscription_ref": "6",
          "use_stats_of": {
            "external_id": "taximeter_driver_id/dbid/uuid",
            "kind": "driver"
          }
        },
        "doc_id": 1234567890,
        "event_at": "2019-09-17T10:00:00.000000+03:00",
        "external_event_ref": "some_external_event_ref",
        "external_obj_id": "taxi/shift_ended/subvention_agreement/1/default/_id/FIRST/unique_driver_id/0123456789abcdef00000001/2018-05-10",
        "kind": "shift_ended",
        "process_at": "2019-09-17T10:00:00.000000+03:00",
        "reason": "reason",
        "service": "some-service",
        "status": "new",
        "tags": []
      },
      {
        "created": "2019-09-17T10:00:00.000000+03:00",
        "data": {
          "agreement_ref": "subvention_agreement/1/default/_id/SECOND",
          "antifraud_rule": {
            "days_span": 1,
            "kind": "driver_fix",
            "last_shift_date": "2019-09-17"
          },
          "commission_input": null,
          "last_date": "2019-09-17",
          "pay_after": "2019-09-17T21:00:00+00:00",
          "pay_to": {
            "external_id": "taximeter_driver_id/dbid/uuid",
            "kind": "driver"
          },
          "payment_id": "2019-09-17",
          "possible_frauder": null,
          "rule_data": {
            "data": {
              "currency": "RUB",
              "end": "2019-11-19T11:00:00.000000+03:00",
              "geoarea": "moscow_center",
              "group_id": "driver_fix_id_2",
              "id": "SECOND",
              "profile_payment_type_restrictions": "any",
              "profile_tariff_classes": [
                "econom"
              ],
              "rates": [
                {
                  "rate_per_minute": "1",
                  "starts_at": {
                    "hour": 12,
                    "iso_week_day": 1,
                    "minute": 0
                  }
                }
              ],
              "timezone_id": "Europe/Moscow",
              "zone_name": "moscow"
            },
            "subvention_type": "driver_fix"
          },
          "shift": {
            "end": "2019-09-18T00:00:00.000000+03:00",
            "start": "2019-09-17T15:00:00.000000+03:00"
          },
          "subscription_ref": "28",
          "use_stats_of": {
            "external_id": "taximeter_driver_id/dbid/uuid",
            "kind": "driver"
          }
        },
        "doc_id": 1234567890,
        "event_at": "2019-09-17T10:00:00.000000+03:00",
        "external_event_ref": "some_external_event_ref",
        "external_obj_id": "taxi/shift_ended/subvention_agreement/1/default/_id/SECOND/unique_driver_id/0123456789abcdef00000001/2018-05-10",
        "kind": "shift_ended",
        "process_at": "2019-09-17T10:00:00.000000+03:00",
        "reason": "reason",
        "service": "some-service",
        "status": "new",
        "tags": []
      }
    ]
  }
}
