{
  "$blueprint:rule_event_handled": {
    "full_subvention_details": [
      {
        "$full_subvention_details": {
          "activity_points": null,
          "clear_time": null,
          "decline_reasons": [],
          "is_bonus": true,
          "is_fake": false,
          "is_holded": false,
          "is_once": false,
          "kind": null,
          "limit_ref": null,
          "matches": true,
          "paid_amount": {
            "$decimal": "10"
          },
          "payment_type": {
            "$payment_type": "discount_payback"
          },
          "rule_amount": {
            "$decimal": "0"
          },
          "rule_display_in_taximeter": false,
          "rule_id": {
            "$identity": {
              "group_id": "discount",
              "id_": {
                "$oid": "000000000000000000000000"
              }
            }
          },
          "rule_type": {
            "$subvention_type": "discount_payback"
          },
          "sub_commission": false,
          "subvention_geoareas": []
        }
      }
    ],
    "journal_entries": [
      {
        "$journal_entry": {
          "agreement_id": "subvention_agreement/1/default/group_id/daily_guarantee_rule_group_id",
          "all_reasons": [],
          "delta": {
            "$money": "300 RUB"
          },
          "details": {
            "$journal_entry_details": {
              "alias_id": "some_alias_id",
              "income_type": "order"
            }
          },
          "entity": {
            "$factory:driver_entity": {
              "external_id": "unique_driver_id/5bab4bf979b9e5513fe5ec4a"
            }
          },
          "event_at": {
            "$datetime": "2018-05-11T00:00:00+00:00"
          },
          "sub_account": "income"
        }
      },
      {
        "$journal_entry": {
          "agreement_id": "subvention_agreement/1/default/group_id/daily_guarantee_rule_group_id",
          "all_reasons": [],
          "delta": {
            "$money": "1 XXX"
          },
          "details": {
            "$journal_entry_details": {
              "alias_id": "some_alias_id",
              "order_id": "some_order_id"
            }
          },
          "entity": {
            "$factory:driver_entity": {
              "external_id": "unique_driver_id/5bab4bf979b9e5513fe5ec4a"
            }
          },
          "event_at": {
            "$datetime": "2018-05-11T00:00:00+00:00"
          },
          "sub_account": "num_orders"
        }
      },
      {
        "$journal_entry": {
          "agreement_id": "subvention_agreement/1/default/group_id/goal_rule_group_id",
          "all_reasons": [],
          "delta": {
            "$money": "1 XXX"
          },
          "details": {
            "$journal_entry_details": {
              "order_id": "some_order_id"
            }
          },
          "entity": {
            "$factory:driver_entity": {
              "external_id": "unique_driver_id/5bab4bf979b9e5513fe5ec4a"
            }
          },
          "event_at": {
            "$datetime": "2018-05-11T00:00:00+00:00"
          },
          "sub_account": "num_orders"
        }
      },
      {
        "$journal_entry": {
          "agreement_id": "subvention_agreement/1/default/_id/000000000000000000000000",
          "all_reasons": [],
          "delta": {
            "$money": "10 RUB"
          },
          "details": null,
          "entity": {
            "$factory:driver_entity": {
              "external_id": "taximeter_driver_id/some_db_id/some_uuid"
            }
          },
          "event_at": {
            "$datetime": "2018-05-11T00:00:00+00:00"
          },
          "sub_account": "dry/migration/subvention"
        }
      },
      {
        "$journal_entry": {
          "agreement_id": "subvention_agreement/1/default/_id/geo_booking",
          "all_reasons": [],
          "delta": {
            "$money": "300 RUB"
          },
          "details": null,
          "entity": {
            "$factory:driver_entity": {
              "external_id": "unique_driver_id/5bab4bf979b9e5513fe5ec4a"
            }
          },
          "event_at": {
            "$datetime": "2018-05-10T23:59:00+00:00"
          },
          "sub_account": "income"
        }
      },
      {
        "$journal_entry": {
          "agreement_id": "subvention_agreement/1/default/_id/geo_booking",
          "all_reasons": [],
          "delta": {
            "$money": "16 XXX"
          },
          "details": {
            "$journal_entry_details": {
              "order_id": "some_order_id"
            }
          },
          "entity": {
            "$factory:driver_entity": {
              "external_id": "unique_driver_id/5bab4bf979b9e5513fe5ec4a"
            }
          },
          "event_at": {
            "$datetime": "2018-05-10T23:59:00+00:00"
          },
          "sub_account": "time/on_order_minutes"
        }
      }
    ],
    "shift_ended_events": [
      {
        "$blueprint:shift_ended": {
          "agreement_ref": {
            "$agreement_ref": "subvention_agreement/1/default/group_id/daily_guarantee_rule_group_id"
          },
          "antifraud_rule": {
            "$antifraud_rule": {
              "days_span": 1,
              "kind": "daily_guarantee",
              "last_shift_date": {
                "$date": "2018-05-11"
              },
              "zone_name": "moscow"
            }
          },
          "commission_input": {
            "$commission_input": {
              "apply_rebate_to_paid_orders_only": true,
              "billing_type": "normal_billing_type",
              "cost_for_client": {
                "$money": "300 RUB"
              },
              "cost_for_commission_var": {
                "$blueprint:var:with_calculations": {
                  "calculations": [],
                  "value": {
                    "$money": "0 RUB"
                  }
                }
              },
              "cost_for_rebate": {
                "$money": "0 RUB"
              },
              "currency": "RUB",
              "driver_promocode_min_commission": null,
              "due": {
                "$datetime": "2018-05-11T00:00:00+03:00"
              },
              "extra_commission": {
                "$money": "0 RUB"
              },
              "hired_at": null,
              "hiring_type": null,
              "ind_bel_nds_applied_to_all_commissions": false,
              "marketing_level": {
                "$frozenset": []
              },
              "park_corp_vat": null,
              "park_ride_sum": {
                "$money": "0 RUB"
              },
              "payment_type": "cash",
              "rebate_rate": {
                "$decimal": "0"
              },
              "source": null,
              "with_driver_promocode": false,
              "with_driver_workshift": false
            }
          },
          "driver": null,
          "last_date": {
            "$date": "2018-05-11"
          },
          "pay_after": {
            "$datetime": "2018-05-12T04:00:00+03:00"
          },
          "pay_to": {
            "$entity": {
              "external_id": "taximeter_driver_id/some_db_id/some_uuid",
              "kind": "driver"
            }
          },
          "payment_id": "2018-05-11",
          "possible_frauder": {
            "$antifraud_driver": {
              "driver_license_personal_ids": [
                "8hd93jdlakhf84030ejd9390z"
              ],
              "driver_licenses": [
                "some_driver_license"
              ],
              "unique_driver_id": {
                "$oid": "5bab4bf979b9e5513fe5ec4a"
              }
            }
          },
          "rule_data": {
            "$shift_ended_rule_data": {
              "data": {
                "currency": "RUB",
                "group_id": "daily_guarantee_rule_group_id",
                "has_commission": false,
                "is_net": false,
                "steps": [
                  {
                    "group_member_id": "num_orders/10/week_days/1,2,3,4,5,6,7",
                    "guarantee_amount": "1000",
                    "id": "daily_guarantee_rule_id",
                    "num_orders": 10
                  },
                  {
                    "group_member_id": "num_orders/20/week_days/1,2,3,4,5,6,7",
                    "guarantee_amount": "2000",
                    "id": "daily_guarantee_rule_id_second",
                    "num_orders": 20
                  }
                ],
                "zone_name": "moscow"
              },
              "subvention_type": {
                "$subvention_type": "nmfg"
              }
            }
          },
          "use_stats_of": {
            "$entity": {
              "external_id": "unique_driver_id/5bab4bf979b9e5513fe5ec4a",
              "kind": "driver"
            }
          }
        }
      },
      {
        "$blueprint:shift_ended": {
          "agreement_ref": {
            "$agreement_ref": "subvention_agreement/1/default/group_id/goal_rule_group_id"
          },
          "antifraud_rule": {
            "$antifraud_rule": {
              "days_span": 1,
              "kind": "goal",
              "last_shift_date": {
                "$date": "2018-05-11"
              },
              "zone_name": "moscow"
            }
          },
          "commission_input": null,
          "driver": null,
          "last_date": {
            "$date": "2018-05-11"
          },
          "pay_after": {
            "$datetime": "2018-05-12T04:00:00+03:00"
          },
          "pay_to": {
            "$entity": {
              "external_id": "taximeter_driver_id/some_db_id/some_uuid",
              "kind": "driver"
            }
          },
          "payment_id": "2018-05-11",
          "possible_frauder": {
            "$antifraud_driver": {
              "driver_license_personal_ids": [
                "8hd93jdlakhf84030ejd9390z"
              ],
              "driver_licenses": [
                "some_driver_license"
              ],
              "unique_driver_id": {
                "$oid": "5bab4bf979b9e5513fe5ec4a"
              }
            }
          },
          "rule_data": {
            "$shift_ended_rule_data": {
              "data": {
                "currency": "RUB",
                "group_id": "goal_rule_group_id",
                "steps": [
                  {
                    "bonus_amount": "1000",
                    "group_member_id": "goal_rule_id",
                    "id": "goal_rule_id",
                    "max_num_orders_exc": 20,
                    "min_num_orders": 10
                  },
                  {
                    "bonus_amount": "2000",
                    "group_member_id": "goal_rule_second_id",
                    "id": "goal_rule_second_id",
                    "min_num_orders": 20
                  }
                ],
                "zone_name": "moscow"
              },
              "subvention_type": {
                "$subvention_type": "do_x_get_y"
              }
            }
          },
          "use_stats_of": {
            "$entity": {
              "external_id": "unique_driver_id/5bab4bf979b9e5513fe5ec4a",
              "kind": "driver"
            }
          }
        }
      },
      {
        "$blueprint:shift_ended": {
          "agreement_ref": {
            "$agreement_ref": "subvention_agreement/1/default/_id/geo_booking"
          },
          "antifraud_rule": {
            "$antifraud_rule": {
              "days_span": 1,
              "kind": "geo_booking",
              "last_shift_date": {
                "$date": "2018-05-11"
              },
              "zone_name": "moscow"
            }
          },
          "commission_input": null,
          "driver": {
            "$blueprint:driver": {}
          },
          "last_date": {
            "$date": "2018-05-11"
          },
          "migration_time": {
            "$datetime": "2018-05-11T00:00:00+03:00"
          },
          "migration_zone": "moscow",
          "pay_after": {
            "$datetime": "2018-05-12T04:00:00+03:00"
          },
          "pay_to": {
            "$entity": {
              "external_id": "taximeter_driver_id/some_db_id/some_uuid",
              "kind": "driver"
            }
          },
          "payment_id": "2018-05-11",
          "possible_frauder": {
            "$antifraud_driver": {
              "driver_license_personal_ids": [
                "8hd93jdlakhf84030ejd9390z"
              ],
              "driver_licenses": [],
              "unique_driver_id": {
                "$oid": "5bab4bf979b9e5513fe5ec4a"
              }
            }
          },
          "rule_data": {
            "$shift_ended_rule_data": {
              "data": {
                "currency": "RUB",
                "end": "2018-11-30T00:15:00.000000+00:00",
                "geoarea": "msk",
                "group_id": "some_group_id",
                "id": "geo_booking",
                "min_activity_points": 80,
                "min_online_minutes": 0,
                "profile_payment_type_restrictions": "any",
                "profile_tariff_classes": [],
                "rate_free_per_minute": "15.0",
                "rate_on_order_per_minute": "5.5",
                "rule_type": "add",
                "tags": [],
                "timezone_id": "Europe/Moscow",
                "workshift": {
                  "end": "03:15",
                  "start": "00:00"
                },
                "zone_name": "moscow"
              },
              "subvention_type": {
                "$subvention_type": "booking_geo_on_top"
              }
            }
          },
          "use_stats_of": {
            "$entity": {
              "external_id": "unique_driver_id/5bab4bf979b9e5513fe5ec4a",
              "kind": "driver"
            }
          }
        }
      }
    ]
  }
}
