{
  "expected_payout": {
    "base_doc_id": 3117140162,
    "dry_mode": false,
    "entries": [
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "200.0",
        "currency": "RUB",
        "details": {
          "alias_id": "b00eb91d68453b8787dfc554e6a88368"
        },
        "entity_external_id": "taximeter_driver_id/7ad36bc7560449998acbe2c57a75c293/24deba79c4efecc229acdb1e5017296d",
        "entity_kind": "driver",
        "entry_id": null,
        "sub_account": "subvention/ridecount_mfg_geo"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "200.0",
        "currency": "RUB",
        "details": {
          "alias_id": "b00eb91d68453b8787dfc554e6a88368",
          "driver": {
            "driver_uuid": "24deba79c4efecc229acdb1e5017296d"
          }
        },
        "entity_external_id": "taximeter_park_id/7ad36bc7560449998acbe2c57a75c293",
        "entity_kind": "park",
        "entry_id": null,
        "sub_account": "subvention/ridecount_mfg_geo"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "100.0",
        "currency": "RUB",
        "details": {
          "alias_id": "b00eb91d68453b8787dfc554e6a88368"
        },
        "entity_external_id": "taximeter_driver_id/7ad36bc7560449998acbe2c57a75c293/24deba79c4efecc229acdb1e5017296d",
        "entity_kind": "driver",
        "entry_id": null,
        "sub_account": "subvention/nmfg"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "100.0",
        "currency": "RUB",
        "details": {
          "alias_id": "b00eb91d68453b8787dfc554e6a88368",
          "driver": {
            "driver_uuid": "24deba79c4efecc229acdb1e5017296d"
          }
        },
        "entity_external_id": "taximeter_park_id/7ad36bc7560449998acbe2c57a75c293",
        "entity_kind": "park",
        "entry_id": null,
        "sub_account": "subvention/nmfg"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "91.0",
        "currency": "RUB",
        "details": {
          "alias_id": "b00eb91d68453b8787dfc554e6a88368"
        },
        "entity_external_id": "taximeter_driver_id/7ad36bc7560449998acbe2c57a75c293/24deba79c4efecc229acdb1e5017296d",
        "entity_kind": "driver",
        "entry_id": null,
        "sub_account": "subvention/misc"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "91.0",
        "currency": "RUB",
        "details": {
          "alias_id": "b00eb91d68453b8787dfc554e6a88368",
          "driver": {
            "driver_uuid": "24deba79c4efecc229acdb1e5017296d"
          }
        },
        "entity_external_id": "taximeter_park_id/7ad36bc7560449998acbe2c57a75c293",
        "entity_kind": "park",
        "entry_id": null,
        "sub_account": "subvention/misc"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "-10.0000",
        "currency": "RUB",
        "details": {
          "alias_id": "b00eb91d68453b8787dfc554e6a88368"
        },
        "entity_external_id": "taximeter_driver_id/7ad36bc7560449998acbe2c57a75c293/24deba79c4efecc229acdb1e5017296d",
        "entity_kind": "driver",
        "entry_id": null,
        "sub_account": "commission/subvention"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "-10.0000",
        "currency": "RUB",
        "details": {
          "alias_id": "b00eb91d68453b8787dfc554e6a88368",
          "driver": {
            "driver_uuid": "24deba79c4efecc229acdb1e5017296d"
          }
        },
        "entity_external_id": "taximeter_park_id/7ad36bc7560449998acbe2c57a75c293",
        "entity_kind": "park",
        "entry_id": null,
        "sub_account": "commission/subvention"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "-5.0000",
        "currency": "RUB",
        "details": {
          "alias_id": "b00eb91d68453b8787dfc554e6a88368"
        },
        "entity_external_id": "taximeter_driver_id/7ad36bc7560449998acbe2c57a75c293/24deba79c4efecc229acdb1e5017296d",
        "entity_kind": "driver",
        "entry_id": null,
        "sub_account": "commission/subvention/park"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "-5.0000",
        "currency": "RUB",
        "details": {
          "alias_id": "b00eb91d68453b8787dfc554e6a88368",
          "driver": {
            "driver_uuid": "24deba79c4efecc229acdb1e5017296d"
          }
        },
        "entity_external_id": "taximeter_park_id/7ad36bc7560449998acbe2c57a75c293",
        "entity_kind": "park",
        "entry_id": null,
        "sub_account": "commission/subvention/park"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/driver_balance",
        "amount": "376.0000",
        "currency": "RUB",
        "details": {},
        "entity_external_id": "taximeter_driver_id/7ad36bc7560449998acbe2c57a75c293/24deba79c4efecc229acdb1e5017296d",
        "entity_kind": "driver",
        "entry_id": null,
        "sub_account": "total"
      },
      {
        "account_id": null,
        "agreement_id": "tlog",
        "amount": "200.0000",
        "currency": "RUB",
        "details": {
          "agglomeration": "mvp",
          "alias_id": "b00eb91d68453b8787dfc554e6a88368",
          "billing_client_id": "billing_client_id",
          "contract_id": "3928042",
          "detailed_product": "subsidy_ridecount_mfg_geo",
          "due": "2019-04-01T07:46:00.000000+00:00",
          "external_ref": "alias_id/b00eb91d68453b8787dfc554e6a88368",
          "handled_in_trust_flow": false,
          "invoice_date": "2019-04-01T07:46:00.000000+00:00",
          "is_payable": false,
          "order_id": "12345",
          "payload": {
            "amount_details": {
              "base_amount": "200.0000",
              "base_currency": "RUB",
              "contract_currency_rate": "1",
              "donate_multiplier": "1.00"
            },
            "base_doc_id": 3117140162,
            "driver_details": {
              "clid": "100500",
              "db_id": "7ad36bc7560449998acbe2c57a75c293",
              "uuid": "24deba79c4efecc229acdb1e5017296d"
            },
            "is_b2b": true,
            "nearest_zone": "narofominsk",
            "rule_db_id": "_id/5800ee9321586f10fe17171e"
          },
          "product": "subvention",
          "service_id": 111,
          "target": "oebs",
          "transaction_type": "payment"
        },
        "entity_external_id": "billing_client_id/billing_client_id",
        "entity_kind": "client",
        "entry_id": null,
        "sub_account": "subsidy_ridecount_mfg_geo/_id/5800ee9321586f10fe17171e"
      },
      {
        "account_id": null,
        "agreement_id": "tlog",
        "amount": "100.0000",
        "currency": "RUB",
        "details": {
          "agglomeration": "mvp",
          "alias_id": "b00eb91d68453b8787dfc554e6a88368",
          "billing_client_id": "billing_client_id",
          "contract_id": "3928042",
          "detailed_product": "subsidy_nmfg",
          "due": "2019-04-01T07:46:00.000000+00:00",
          "external_ref": "alias_id/b00eb91d68453b8787dfc554e6a88368",
          "handled_in_trust_flow": false,
          "invoice_date": "2019-04-01T07:46:00.000000+00:00",
          "is_payable": false,
          "order_id": "12345",
          "payload": {
            "amount_details": {
              "base_amount": "100.0000",
              "base_currency": "RUB",
              "contract_currency_rate": "1",
              "donate_multiplier": "1.00"
            },
            "base_doc_id": 3117140162,
            "driver_details": {
              "clid": "100500",
              "db_id": "7ad36bc7560449998acbe2c57a75c293",
              "uuid": "24deba79c4efecc229acdb1e5017296d"
            },
            "is_b2b": true,
            "nearest_zone": "narofominsk",
            "rule_db_id": "nmfg_0"
          },
          "product": "subvention",
          "service_id": 111,
          "target": "oebs",
          "transaction_type": "payment"
        },
        "entity_external_id": "billing_client_id/billing_client_id",
        "entity_kind": "client",
        "entry_id": null,
        "sub_account": "subsidy_nmfg/group_id/nmfg_id/nmfg_0"
      },
      {
        "account_id": null,
        "agreement_id": "tlog",
        "amount": "91.0000",
        "currency": "RUB",
        "details": {
          "agglomeration": "mvp",
          "alias_id": "b00eb91d68453b8787dfc554e6a88368",
          "billing_client_id": "billing_client_id",
          "contract_id": "3928042",
          "detailed_product": "subsidy_misc",
          "due": "2019-04-01T07:46:00.000000+00:00",
          "external_ref": "alias_id/b00eb91d68453b8787dfc554e6a88368",
          "handled_in_trust_flow": false,
          "invoice_date": "2019-04-01T07:46:00.000000+00:00",
          "is_payable": false,
          "order_id": "12345",
          "payload": {
            "amount_details": {
              "base_amount": "91.0000",
              "base_currency": "RUB",
              "contract_currency_rate": "1",
              "donate_multiplier": "1.00"
            },
            "base_doc_id": 3117140162,
            "driver_details": {
              "clid": "100500",
              "db_id": "7ad36bc7560449998acbe2c57a75c293",
              "uuid": "24deba79c4efecc229acdb1e5017296d"
            },
            "is_b2b": true,
            "nearest_zone": "narofominsk"
          },
          "product": "subvention",
          "service_id": 111,
          "target": "oebs",
          "transaction_type": "payment"
        },
        "entity_external_id": "billing_client_id/billing_client_id",
        "entity_kind": "client",
        "entry_id": null,
        "sub_account": "subsidy_misc"
      },
      {
        "account_id": null,
        "agreement_id": "tlog",
        "amount": "-10.0000",
        "currency": "RUB",
        "details": {
          "agglomeration": "mvp",
          "alias_id": "b00eb91d68453b8787dfc554e6a88368",
          "billing_client_id": "billing_client_id",
          "contract_id": "3928042",
          "detailed_product": "subsidy_commission",
          "due": "2019-04-01T07:46:00.000000+00:00",
          "external_ref": "alias_id/b00eb91d68453b8787dfc554e6a88368",
          "handled_in_trust_flow": false,
          "invoice_date": "2019-04-01T07:46:00.000000+00:00",
          "is_payable": false,
          "order_id": "12345",
          "payload": {
            "amount_details": {
              "base_amount": "10.0000",
              "base_currency": "RUB",
              "contract_currency_rate": "1",
              "donate_multiplier": "1.00",
              "unrealized": "1.00"
            },
            "base_doc_id": 3117140162,
            "driver_details": {
              "clid": "100500",
              "db_id": "7ad36bc7560449998acbe2c57a75c293",
              "uuid": "24deba79c4efecc229acdb1e5017296d"
            },
            "is_b2b": true,
            "nearest_zone": "narofominsk"
          },
          "product": "subvention",
          "service_id": 111,
          "target": "oebs",
          "transaction_type": "refund"
        },
        "entity_external_id": "billing_client_id/billing_client_id",
        "entity_kind": "client",
        "entry_id": null,
        "sub_account": "subsidy_commission"
      }
    ],
    "event_at": "2019-02-27T09:28:04.000000+00:00",
    "external_obj_id": "alias_id/b00eb91d68453b8787dfc554e6a88368/subvention/process",
    "kind": "subvention",
    "payout_doc_id": 1050,
    "post_processing_actions": [
      {
        "func": "send_to_tlog",
        "keywords": {}
      },
      {
        "func": "send_to_taximeter",
        "keywords": {
          "additional_data": {
            "billing_park_commission_flow": true
          },
          "alias_id": "b00eb91d68453b8787dfc554e6a88368",
          "db_id": "7ad36bc7560449998acbe2c57a75c293",
          "driver_uuid": "24deba79c4efecc229acdb1e5017296d",
          "kind": "subvention"
        }
      },
      {
        "func": "create_income_journal",
        "keywords": {
          "income_event_at": "2019-04-01T07:46:00.000000+00:00"
        }
      },
      {
        "func": "send_to_limits",
        "keywords": {}
      },
      {
        "func": "send_balance_update",
        "keywords": {}
      },
      {
        "func": "send_income_entries",
        "keywords": {}
      }
    ],
    "reversal_data": {
      "contracts": [
        {
          "firm_id": 13,
          "id": 3928042,
          "target": "oebs"
        }
      ]
    },
    "tags": [
      "taxi/alias_id/b00eb91d68453b8787dfc554e6a88368"
    ],
    "topic_begin_at": "2019-04-01T07:46:00.000000+00:00",
    "version": 12345678
  },
  "expected_taximeter_entries_count": 4,
  "expected_tlog_entries_count": 4,
  "input_doc": {
    "data": {
      "base_doc_id": 3117140162,
      "contracts": [
        {
          "firm_id": 13,
          "id": 3928042,
          "target": "oebs"
        }
      ],
      "driver_income": {
        "alias_id": "b00eb91d68453b8787dfc554e6a88368",
        "components": [
          {
            "amount": "200.0",
            "currency": "RUB",
            "kind": "subvention/ridecount_mfg_geo"
          },
          {
            "amount": "100.0",
            "currency": "RUB",
            "kind": "subvention/nmfg"
          },
          {
            "amount": "91.0",
            "currency": "RUB",
            "kind": "subvention/misc"
          },
          {
            "amount": "-10.0000",
            "currency": "RUB",
            "kind": "commission/subvention"
          },
          {
            "amount": "-5.0000",
            "currency": "RUB",
            "kind": "commission/subvention/park"
          }
        ],
        "driver": {
          "db_id": "7ad36bc7560449998acbe2c57a75c293",
          "driver_uuid": "24deba79c4efecc229acdb1e5017296d"
        },
        "order_event_at": "2019-04-01T07:46:00.000000+00:00",
        "payload": {
          "billing_park_commission_flow": true
        }
      },
      "entries": [],
      "event_version": 12345678,
      "payments": [
        {
          "amount": "200.0000",
          "billing_client_id": "billing_client_id",
          "contract_id": "3928042",
          "currency": "RUB",
          "invoice_date": "2019-04-01T07:46:00.000000+00:00",
          "payload": {
            "agglomeration": "mvp",
            "alias_id": "b00eb91d68453b8787dfc554e6a88368",
            "detailed_product": "subsidy_ridecount_mfg_geo",
            "due": "2019-04-01T07:46:00.000000+00:00",
            "is_payable": false,
            "order_id": "12345",
            "payload": {
              "amount_details": {
                "base_amount": "200.0000",
                "base_currency": "RUB",
                "contract_currency_rate": "1",
                "donate_multiplier": "1.00"
              },
              "base_doc_id": 3117140162,
              "driver_details": {
                "clid": "100500",
                "db_id": "7ad36bc7560449998acbe2c57a75c293",
                "uuid": "24deba79c4efecc229acdb1e5017296d"
              },
              "is_b2b": true,
              "nearest_zone": "narofominsk",
              "rule_db_id": "_id/5800ee9321586f10fe17171e"
            },
            "rule": {
              "db_id": "5800ee9321586f10fe17171e",
              "ref": "_id/5800ee9321586f10fe17171e"
            },
            "transaction_type": "payment"
          },
          "payment_kind": "subvention"
        },
        {
          "amount": "100.0000",
          "billing_client_id": "billing_client_id",
          "contract_id": "3928042",
          "currency": "RUB",
          "invoice_date": "2019-04-01T07:46:00.000000+00:00",
          "payload": {
            "agglomeration": "mvp",
            "alias_id": "b00eb91d68453b8787dfc554e6a88368",
            "detailed_product": "subsidy_nmfg",
            "due": "2019-04-01T07:46:00.000000+00:00",
            "is_payable": false,
            "order_id": "12345",
            "payload": {
              "amount_details": {
                "base_amount": "100.0000",
                "base_currency": "RUB",
                "contract_currency_rate": "1",
                "donate_multiplier": "1.00"
              },
              "base_doc_id": 3117140162,
              "driver_details": {
                "clid": "100500",
                "db_id": "7ad36bc7560449998acbe2c57a75c293",
                "uuid": "24deba79c4efecc229acdb1e5017296d"
              },
              "is_b2b": true,
              "nearest_zone": "narofominsk",
              "rule_db_id": "nmfg_0"
            },
            "rule": {
              "db_id": "nmfg_0",
              "ref": "group_id/nmfg_id"
            },
            "transaction_type": "payment"
          },
          "payment_kind": "subvention"
        },
        {
          "amount": "91.0000",
          "billing_client_id": "billing_client_id",
          "contract_id": "3928042",
          "currency": "RUB",
          "invoice_date": "2019-04-01T07:46:00.000000+00:00",
          "payload": {
            "agglomeration": "mvp",
            "alias_id": "b00eb91d68453b8787dfc554e6a88368",
            "detailed_product": "subsidy_misc",
            "due": "2019-04-01T07:46:00.000000+00:00",
            "is_payable": false,
            "order_id": "12345",
            "payload": {
              "amount_details": {
                "base_amount": "91.0000",
                "base_currency": "RUB",
                "contract_currency_rate": "1",
                "donate_multiplier": "1.00"
              },
              "base_doc_id": 3117140162,
              "driver_details": {
                "clid": "100500",
                "db_id": "7ad36bc7560449998acbe2c57a75c293",
                "uuid": "24deba79c4efecc229acdb1e5017296d"
              },
              "is_b2b": true,
              "nearest_zone": "narofominsk"
            },
            "transaction_type": "payment"
          },
          "payment_kind": "subvention"
        },
        {
          "amount": "-10.0000",
          "billing_client_id": "billing_client_id",
          "contract_id": "3928042",
          "currency": "RUB",
          "invoice_date": "2019-04-01T07:46:00.000000+00:00",
          "payload": {
            "agglomeration": "mvp",
            "alias_id": "b00eb91d68453b8787dfc554e6a88368",
            "detailed_product": "subsidy_commission",
            "due": "2019-04-01T07:46:00.000000+00:00",
            "is_payable": false,
            "order_id": "12345",
            "payload": {
              "amount_details": {
                "base_amount": "10.0000",
                "base_currency": "RUB",
                "contract_currency_rate": "1",
                "donate_multiplier": "1.00",
                "unrealized": "1.00"
              },
              "base_doc_id": 3117140162,
              "driver_details": {
                "clid": "100500",
                "db_id": "7ad36bc7560449998acbe2c57a75c293",
                "uuid": "24deba79c4efecc229acdb1e5017296d"
              },
              "is_b2b": true,
              "nearest_zone": "narofominsk"
            },
            "transaction_type": "refund"
          },
          "payment_kind": "subvention_commission"
        }
      ],
      "schema_version": "v3",
      "topic_begin_at": "2019-04-01T07:46:00.000000+00:00"
    },
    "doc_id": 1050,
    "event_at": "2019-02-27T09:28:04.000000+00:00",
    "external_event_ref": "12345678",
    "external_obj_id": "alias_id/b00eb91d68453b8787dfc554e6a88368/subvention",
    "kind": "subvention",
    "tags": [
      "taxi/alias_id/b00eb91d68453b8787dfc554e6a88368"
    ]
  }
}
