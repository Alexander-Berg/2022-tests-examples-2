{
  "expected_payout": {
    "base_doc_id": 1006,
    "dry_mode": false,
    "entries": [
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "100.0",
        "currency": "RUB",
        "details": {
          "alias_id": "<alias_id>"
        },
        "entity_external_id": "taximeter_driver_id/<db_id>/<driver_uuid>",
        "entity_kind": "driver",
        "entry_id": null,
        "sub_account": "promocode/compensation"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "100.0",
        "currency": "RUB",
        "details": {
          "alias_id": "<alias_id>",
          "driver": {
            "driver_uuid": "<driver_uuid>"
          }
        },
        "entity_external_id": "taximeter_park_id/<db_id>",
        "entity_kind": "park",
        "entry_id": null,
        "sub_account": "promocode/compensation"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/driver_balance",
        "amount": "100.0",
        "currency": "RUB",
        "details": {},
        "entity_external_id": "taximeter_driver_id/<db_id>/<driver_uuid>",
        "entity_kind": "driver",
        "entry_id": null,
        "sub_account": "total"
      },
      {
        "account_id": null,
        "agreement_id": "tlog",
        "amount": "25.00",
        "currency": "USD",
        "details": {
          "alias_id": "<alias_id>",
          "billing_client_id": "<billing_client_id>",
          "detailed_product": "coupon_personal_wallet",
          "due": "2019-11-11T11:11:11.000000+00:00",
          "handled_in_trust_flow": false,
          "invoice_date": "2019-11-11T11:11:11.000000+00:00",
          "is_payable": true,
          "order_id": "<order_id>",
          "payload": {
            "amount_details": {
              "base_amount": "100.0000",
              "base_currency": "RUB",
              "contract_currency_rate": "0.50000",
              "donate_multiplier": "0.5"
            },
            "base_doc_id": 12345678,
            "driver_details": {
              "clid": "<clid>",
              "db_id": "<db_id>",
              "uuid": "<driver_uuid>"
            },
            "nearest_zone": "spb"
          },
          "service_id": 137,
          "transaction_type": "payment"
        },
        "entity_external_id": "billing_client_id/<billing_client_id>",
        "entity_kind": "client",
        "entry_id": null,
        "sub_account": "coupon"
      }
    ],
    "event_at": "2019-11-28T11:11:11.000000+00:00",
    "external_obj_id": "taxi/promocode/<alias_id>/process",
    "kind": "promocode",
    "payout_doc_id": 1006,
    "post_processing_actions": [
      {
        "func": "send_to_tlog",
        "keywords": {}
      },
      {
        "func": "send_to_taximeter",
        "keywords": {
          "alias_id": "<alias_id>",
          "db_id": "<db_id>",
          "driver_uuid": "<driver_uuid>",
          "kind": "promocode"
        }
      },
      {
        "func": "create_income_journal",
        "keywords": {
          "income_event_at": "2019-11-11T11:11:11.000000+00:00"
        }
      },
      {
        "func": "send_balance_update",
        "keywords": {}
      },
      {
        "func": "send_income_entries",
        "keywords": {}
      }
    ],
    "tags": [
      "taxi/alias_id/<alias_id>"
    ],
    "topic_begin_at": "2019-11-11T11:11:11.000000+00:00",
    "version": 1
  },
  "expected_taximeter_entries_count": 1,
  "expected_tlog_entries_count": 1,
  "input_doc": {
    "data": {
      "driver_income": {
        "alias_id": "<alias_id>",
        "components": [
          {
            "amount": "100.0",
            "currency": "RUB",
            "kind": "promocode"
          }
        ],
        "driver": {
          "db_id": "<db_id>",
          "driver_uuid": "<driver_uuid>"
        },
        "order_event_at": "2019-11-11T11:11:11.000000+00:00"
      },
      "dry_mode": false,
      "entries": [],
      "payments": [
        {
          "amount": "100.0",
          "billing_client_id": "<billing_client_id>",
          "contract_id": "123456",
          "currency": "RUB",
          "invoice_date": "2019-11-11T11:11:11.000000+00:00",
          "payload": {
            "alias_id": "<alias_id>",
            "base_doc_id": 12345678,
            "contract_currency": "USD",
            "contract_currency_rate": "0.5",
            "detailed_product": "coupon_personal_wallet",
            "donate_multiplier": "0.5",
            "driver": {
              "clid": "<clid>",
              "db_id": "<db_id>",
              "driver_uuid": "<driver_uuid>"
            },
            "due": "2019-11-11T11:11:11.000000+00:00",
            "is_netting": false,
            "nearest_zone": "spb",
            "order_id": "<order_id>",
            "transaction_type": "payment"
          },
          "payment_kind": "coupon"
        }
      ],
      "schema_version": "v2",
      "topic_begin_at": "2019-11-11T11:11:11.000000+00:00",
      "version": 1
    },
    "doc_id": 1006,
    "event_at": "2019-11-28T11:11:11.000000+00:00",
    "external_event_ref": "<payment_id>",
    "external_obj_id": "taxi/promocode/<alias_id>",
    "journal_entries": [],
    "kind": "promocode",
    "service": "billing-calculators",
    "status": "new",
    "tags": [
      "taxi/alias_id/<alias_id>"
    ]
  }
}
