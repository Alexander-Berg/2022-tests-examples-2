{
  "billing_commission_response": {
    "agreement": {
      "base_rule_id": "some_base_rule_id",
      "cancellation_settings": {
        "park_billable_cancel_interval": [
          "420",
          "600"
        ],
        "pickup_location_radius": 300,
        "user_billable_cancel_interval": [
          "120",
          "600"
        ]
      },
      "cost_info": {
        "kind": "boundaries",
        "max_cost": "6000",
        "min_cost": "0"
      },
      "id": "2abf062a-b607-11ea-998e-07e60204cbdf",
      "rate": {
        "kind": "flat",
        "rate": "0.04"
      },
      "vat": "1.18"
    }
  },
  "expected_payout": {
    "base_doc_id": 1006,
    "dry_mode": false,
    "entries": [
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "500.0",
        "currency": "RUB",
        "details": {
          "alias_id": "fced2eb3fb063a07a961971753f564d6"
        },
        "entity_external_id": "taximeter_driver_id/some_db_id/driver-test",
        "entity_kind": "driver",
        "entry_id": null,
        "sub_account": "payment/corp"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/yandex_ride",
        "amount": "500.0",
        "currency": "RUB",
        "details": {
          "alias_id": "fced2eb3fb063a07a961971753f564d6",
          "driver": {
            "driver_uuid": "driver-test"
          }
        },
        "entity_external_id": "taximeter_park_id/some_db_id",
        "entity_kind": "park",
        "entry_id": null,
        "sub_account": "payment/corp"
      },
      {
        "account_id": null,
        "agreement_id": "taxi/driver_balance",
        "amount": "500.0",
        "currency": "RUB",
        "details": {},
        "entity_external_id": "taximeter_driver_id/some_db_id/driver-test",
        "entity_kind": "driver",
        "entry_id": null,
        "sub_account": "total"
      },
      {
        "account_id": null,
        "agreement_id": "tlog",
        "amount": "540.0",
        "currency": "RUB",
        "details": {
          "agglomeration": "MSKc",
          "billing_client_id": "billing_id_1234",
          "contract_id": "3928042",
          "detailed_product": "multi_park_b2b_trip_payment",
          "due": "2016-08-04T20:00:00.000000+00:00",
          "external_ref": "alias_id/fced2eb3fb063a07a961971753f564d6",
          "handled_in_trust_flow": false,
          "invoice_date": "2016-08-04T20:00:00.000000+00:00",
          "is_payable": true,
          "payload": {
            "alias_id": "fced2eb3fb063a07a961971753f564d6",
            "amount_details": {
              "base_amount": "500.0",
              "base_currency": "RUB",
              "contract_currency_rate": "1",
              "vat": "0.0"
            },
            "base_doc_id": 1006,
            "driver_details": {
              "clid": "park-test",
              "db_id": "some_db_id",
              "uuid": "driver-test"
            },
            "nearest_zone": "moscow",
            "order_id": "order-tlog1"
          },
          "product": "cargo_park_b2b_trip_payment",
          "service_id": 651,
          "target": "oebs",
          "tariff_class": "econom"
        },
        "entity_external_id": "billing_client_id/billing_id_1234",
        "entity_kind": "client",
        "entry_id": null,
        "sub_account": "cargo_park_b2b_trip_payment/multi_park_b2b_trip_payment"
      },
      {
        "account_id": null,
        "agreement_id": "tlog",
        "amount": "-20.000",
        "currency": "RUB",
        "details": {
          "agglomeration": "MSKc",
          "billing_client_id": "billing_id_1234",
          "contract_id": "3928042",
          "detailed_product": "multi_rebate_b2b_trip_payment",
          "due": "2016-08-04T20:00:00.000000+00:00",
          "external_ref": "alias_id/fced2eb3fb063a07a961971753f564d6",
          "handled_in_trust_flow": false,
          "invoice_date": "2016-08-04T20:00:00.000000+00:00",
          "is_payable": true,
          "payload": {
            "alias_id": "fced2eb3fb063a07a961971753f564d6",
            "amount_details": {
              "base_amount": "20.0000",
              "base_currency": "RUB",
              "contract_currency_rate": "1.00000",
              "vat": "0.0000"
            },
            "base_doc_id": 1006,
            "driver_details": {
              "clid": "park-test",
              "db_id": "some_db_id",
              "uuid": "driver-test"
            },
            "nearest_zone": "moscow",
            "order_id": "order-tlog1"
          },
          "product": "cargo_park_b2b_trip_payment",
          "service_id": 651,
          "target": "oebs",
          "tariff_class": "econom",
          "transaction_type": "refund"
        },
        "entity_external_id": "billing_client_id/billing_id_1234",
        "entity_kind": "client",
        "entry_id": null,
        "sub_account": "cargo_park_b2b_trip_payment/multi_rebate_b2b_trip_payment"
      }
    ],
    "event_at": "2016-08-04T20:00:00.000000+00:00",
    "external_obj_id": "taxi/b2b_partner_payment/fced2eb3fb063a07a961971753f564d6/process",
    "kind": "b2b_partner_payment",
    "payout_doc_id": 1006,
    "post_processing_actions": [
      {
        "func": "send_to_tlog",
        "keywords": {}
      },
      {
        "func": "send_to_taximeter",
        "keywords": {
          "alias_id": "fced2eb3fb063a07a961971753f564d6",
          "db_id": "some_db_id",
          "driver_uuid": "driver-test",
          "kind": "balance_change"
        }
      },
      {
        "func": "create_income_journal",
        "keywords": {
          "income_event_at": "2016-08-04T20:00:00.000000+00:00"
        }
      },
      {
        "func": "send_to_limits",
        "keywords": {}
      },
      {
        "func": "send_balance_update",
        "keywords": {}
      },
      {
        "func": "send_income_entries",
        "keywords": {}
      }
    ],
    "reversal_data": {
      "contracts": [
        {
          "firm_id": 13,
          "id": 3928042,
          "target": "oebs"
        }
      ]
    },
    "tags": [
      "taxi/alias_id/fced2eb3fb063a07a961971753f564d6"
    ],
    "topic_begin_at": "2016-08-04T20:00:00.000000+00:00",
    "version": 1
  },
  "expected_taximeter_entries_count": 1,
  "expected_tlog_entries_count": 2,
  "input_doc": {
    "data": {
      "contracts": [
        {
          "firm_id": 13,
          "id": 3928042,
          "target": "oebs"
        }
      ],
      "driver_income": {
        "alias_id": "fced2eb3fb063a07a961971753f564d6",
        "components": [
          {
            "amount": "500.0",
            "currency": "RUB",
            "kind": "payment/corp"
          }
        ],
        "driver": {
          "db_id": "some_db_id",
          "driver_uuid": "driver-test"
        },
        "order_event_at": "2016-08-04T20:00:00+00:00"
      },
      "driver_mode": "orders",
      "event_version": 1,
      "payments": [
        {
          "amount": "540.0",
          "billing_client_id": "billing_id_1234",
          "contract_id": "3928042",
          "currency": "RUB",
          "invoice_date": "2016-08-04T20:00:00+00:00",
          "payload": {
            "agglomeration": "MSKc",
            "alias_id": "fced2eb3fb063a07a961971753f564d6",
            "amount_details": {
              "base_amount": "500.0",
              "base_currency": "RUB",
              "contract_currency_rate": "1",
              "vat": "0.0"
            },
            "driver_details": {
              "clid": "park-test",
              "db_id": "some_db_id",
              "uuid": "driver-test"
            },
            "nearest_zone": "moscow",
            "order_id": "order-tlog1",
            "tariff_class": "econom"
          },
          "payment_kind": "cargo_multi_park_b2b_trip_payment"
        },
        {
          "amount": "-10.000",
          "billing_client_id": "billing_id_1234",
          "contract_id": "3928042",
          "currency": "RUB",
          "invoice_date": "2016-08-04T20:00:00+00:00",
          "payload": {
            "agglomeration": "MSKc",
            "alias_id": "fced2eb3fb063a07a961971753f564d6",
            "amount_details": {
              "base_amount": "10.0000",
              "base_currency": "RUB",
              "contract_currency_rate": "1.00000",
              "vat": "0.0000"
            },
            "driver_details": {
              "clid": "park-test",
              "db_id": "some_db_id",
              "uuid": "driver-test"
            },
            "nearest_zone": "moscow",
            "order_id": "order-tlog1",
            "tariff_class": "econom",
            "transaction_type": "refund"
          },
          "payment_kind": "cargo_multi_rebate_park_b2b_trip_payment"
        }
      ],
      "schema_version": "v1",
      "topic_begin_at": "2016-08-04T20:00:00+00:00"
    },
    "doc_id": 1006,
    "event_at": "2016-08-04T20:00:00+00:00",
    "external_event_ref": "1",
    "external_obj_id": "taxi/b2b_partner_payment/fced2eb3fb063a07a961971753f564d6",
    "journal_entries": [],
    "kind": "b2b_partner_payment",
    "service": "billing-orders",
    "status": "new",
    "tags": [
      "taxi/alias_id/fced2eb3fb063a07a961971753f564d6"
    ]
  },
  "parks_replica_response": {
    "parks": [
      {
        "data": {
          "corp_vats": [
            {
              "begin": "2016-11-18T21:00:00.000",
              "end": "2018-11-22T21:00:00.000",
              "value": 10000
            },
            {
              "begin": "2018-11-22T21:00:00.000",
              "value": 12000
            }
          ]
        },
        "park_id": "park-test"
      }
    ]
  }
}
