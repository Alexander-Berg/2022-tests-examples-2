{
  "name": "test_pipeline_name",
  "stages": [
    {
      "conditions": [],
      "in_bindings": [
        {
          "domain": "input",
          "query": "request.point_a"
        },
        {
          "domain": "input",
          "query": "request.tariff_zone"
        },
        {
          "domain": "input",
          "query": "layer_meta"
        }
      ],
      "name": "resource_fetch",
      "resources": [
        {
          "field": "candidates",
          "name": "free_drivers_graph"
        }
      ],
      "source_code": "return {candidates: {drivers_count: JSON.parse(tariff_zone).drivers_count || null, request: {allowed_classes: ['econom'], class_limits: {econom: 400}, max_distance: 2500, max_route_distance: 2500, point: point_a, zone_id: 'moscow'}, chain_settings: {max_medium_time: 600, max_short_time: 300}, eta_limits: [1, 10, 20, 50]}};"
    },
    {
      "conditions": [],
      "in_bindings": [
        {
          "children": [
            {
              "query": "generic.econom{counts}"
            },
            {
              "query": "drivers"
            }
          ],
          "domain": "resource",
          "query": "candidates"
        }
      ],
      "name": "use_resource",
      "out_bindings": [
        {
          "alias": "data",
          "query": "classes.econom"
        }
      ],
      "source_code": "let eta_groups = counts.eta_groups || null; let free_chain = counts.free_chain_groups ? counts.free_chain_groups.short + counts.free_chain_groups.medium * 10 + counts.free_chain_groups.long * 100 : 0; return {data: {name: 'econom', surge: {value: 42}, value_raw: 42, calculation_meta: {reason: JSON.stringify({eta_groups: eta_groups, drivers: drivers}), counts: {radius: 0, pins: 0, free: counts.free, free_chain: free_chain, total: 0}}}};"
    }
  ],
  "state": "active"
}
