[
  {
    "_id": "pending-invoice",
    "_shard_id": 0,
    "billing_tech": {
      "refresh_attempts_count": 3,
      "service_orders": {},
      "transactions": [],
      "version": 1
    },
    "created": {
      "$date": "2019-01-01T00:00:00.0"
    },
    "invoice_payment_tech": {
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "sum_to_pay": {},
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "notification_payload": {
            "debt_id": "some_debt_id",
            "service": "taxi"
          },
          "originator": "processing",
          "status": "init",
          "trust_additional_properties": {
            "mit": {
              "create": true
            }
          },
          "type": "update"
        }
      ],
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_email_id": "personal-email-id",
      "personal_phone_id": "personal-phone-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "payment_tech": {
      "hold_initiated": true
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "pending-invoice-applepay",
    "_shard_id": 0,
    "billing_tech": {
      "refresh_attempts_count": 3,
      "service_orders": {},
      "transactions": [],
      "version": 1
    },
    "created": {
      "$date": "2019-01-01T00:00:00.0"
    },
    "invoice_payment_tech": {
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234-applepay",
      "main_card_payment_id": "card-x1324-applepay",
      "sum_to_pay": {},
      "type": "applepay"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "notification_payload": {
            "debt_id": "some_debt_id",
            "service": "taxi"
          },
          "originator": "processing",
          "status": "init",
          "type": "update"
        }
      ],
      "pass_params": {},
      "payment": {
        "billing_id": "x1324-applepay",
        "method": "card-x1324-applepay",
        "type": "applepay"
      },
      "personal_email_id": "personal-email-id",
      "personal_phone_id": "personal-phone-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "payment_tech": {
      "hold_initiated": true
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "pending-invoice-with-saved-service-orders",
    "_shard_id": 0,
    "billing_tech": {
      "refresh_attempts_count": 3,
      "service_orders": {
        "ride": "<alias_id>_will_be_rewritten"
      },
      "transactions": [],
      "version": 1
    },
    "invoice_payment_tech": {
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "sum_to_pay": {},
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "originator": "processing",
          "status": "init",
          "type": "update"
        }
      ],
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_email_id": "personal-email-id",
      "personal_phone_id": "personal-phone-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "payment_tech": {
      "hold_initiated": true
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "hold-pending",
    "_shard_id": 0,
    "billing_tech": {
      "service_orders": {
        "ride": "order-ride"
      },
      "transactions": [
        {
          "billing_response": {
            "foo": "bar"
          },
          "card_billing_id": "x1234",
          "card_owner_uid": "123456",
          "card_payment_id": "card-x1324",
          "created": {
            "$dateDiff": -60
          },
          "payment_method_type": "card",
          "request_id": "1",
          "status": "hold_init",
          "trust_payment_id": "tr1234"
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "items": [],
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "metric_namespaces": [
        "isr"
      ],
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "originator": "processing",
          "status": "init",
          "type": "update"
        }
      ],
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "hold-pending-old-not-found-transaction",
    "_shard_id": 0,
    "billing_tech": {
      "service_orders": {
        "ride": "order-ride"
      },
      "transactions": [
        {
          "billing_response": {
            "foo": "bar"
          },
          "card_owner_uid": "123456",
          "created": {
            "$dateDiff": -7600
          },
          "payment_method_type": "card",
          "request_id": "1",
          "status": "hold_init",
          "trust_payment_id": "tr1234"
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "items": [],
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "type": "card"
    },
    "invoice_request": {
      "antifraud_payload": {},
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "originator": "processing",
          "status": "failed",
          "type": "update"
        }
      ],
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "hold-success",
    "_shard_id": 0,
    "billing_tech": {
      "refresh_attempts_count": 3,
      "service_orders": {
        "ride": "order-ride"
      },
      "transactions": [
        {
          "card_owner_uid": "transaction-uid",
          "created": {
            "$date": "2019-01-01T00:00:00.0"
          },
          "payment_method_type": "card",
          "request_id": "1",
          "status": "hold_success",
          "sum": {
            "ride": "100"
          },
          "trust_payment_id": "tr1234"
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "clear_eta": {
        "$dateDiff": -1000
      },
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "sum_to_pay": {
        "ride": "100"
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "notification_payload": {
            "debt_id": "some_debt_id",
            "service": "taxi"
          },
          "originator": "processing",
          "status": "done",
          "type": "update"
        }
      ],
      "originator": "processing",
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "payment_tech": {
      "hold_initiated": true
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "hold-success-check-transaction-originator",
    "_shard_id": 0,
    "billing_tech": {
      "refresh_attempts_count": 3,
      "service_orders": {
        "ride": "order-ride"
      },
      "transactions": [
        {
          "card_owner_uid": "transaction-uid",
          "created": {
            "$date": "2019-01-01T00:00:00.0"
          },
          "payment_method_type": "card",
          "request_id": "1",
          "status": "hold_success",
          "sum": {
            "ride": "100"
          },
          "trust_payment_id": "tr1234"
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "clear_eta": {
        "$dateDiff": -1000
      },
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "sum_to_pay": {
        "ride": "100"
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "notification_payload": {
            "debt_id": "some_debt_id",
            "service": "taxi"
          },
          "originator": "processing",
          "status": "done",
          "type": "update"
        }
      ],
      "originator": "debt_collector",
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "payment_tech": {
      "hold_initiated": true
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "hold-success-automatic-clear-delay",
    "_shard_id": 0,
    "billing_tech": {
      "service_orders": {
        "ride": "order-ride"
      },
      "transactions": [
        {
          "card_owner_uid": "123456",
          "holded": {
            "$date": "2019-11-30T21:00:00.0"
          },
          "payment_method_type": "card",
          "request_id": "1",
          "status": "hold_success",
          "sum": {
            "ride": "100"
          },
          "trust_payment_id": "tr1234",
          "updated": {
            "$date": "2019-11-30T21:00:00.0"
          }
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "automatic_clear_delay": 10800,
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "sum_to_pay": {
        "ride": "100"
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "callbacks": [
            {
              "payload": {
                "arbitrary": "data"
              },
              "queue": "callback_with_payload"
            },
            {
              "queue": "callback_without_payload"
            }
          ],
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "notification_payload": {
            "debt_id": "some_debt_id",
            "service": "taxi"
          },
          "originator": "processing",
          "status": "done"
        }
      ],
      "originator": "processing",
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "need-cvn",
    "_shard_id": 0,
    "billing_tech": {
      "service_orders": {},
      "transactions": [],
      "version": 1
    },
    "invoice_payment_tech": {
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "sum_to_pay": {},
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "need_cvn": true,
          "originator": "processing",
          "status": "init",
          "type": "update"
        }
      ],
      "originator": "processing",
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "need-cvn-with-explicit-timeout",
    "_shard_id": 0,
    "billing_tech": {
      "service_orders": {},
      "transactions": [],
      "version": 1
    },
    "invoice_payment_tech": {
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "sum_to_pay": {},
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "need_cvn": true,
          "originator": "processing",
          "payment_timeout": 180,
          "status": "init",
          "type": "update"
        }
      ],
      "originator": "processing",
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "ride-and-tips",
    "_shard_id": 0,
    "billing_tech": {
      "service_orders": {
        "ride": "order-ride"
      },
      "transactions": [
        {
          "payment_method_type": "card",
          "request_id": "1",
          "status": "hold_success",
          "sum": {
            "ride": "100"
          },
          "trust_payment_id": "tr1234"
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "clear_eta": {
        "$dateDiff": -1000
      },
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "sum_to_pay": {
        "ride": "100",
        "tips": "25"
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            },
            {
              "amount": "25",
              "item_id": "tips"
            }
          ],
          "originator": "processing",
          "status": "done",
          "type": "update"
        }
      ],
      "originator": "processing",
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "payment-tech-with-old-fields",
    "_shard_id": 0,
    "billing_tech": {
      "service_orders": {
        "ride": "order-ride"
      },
      "transactions": [
        {
          "payment_method_type": "card",
          "request_id": "1",
          "status": "hold_success",
          "sum": {
            "ride": "100"
          },
          "trust_payment_id": "tr1234"
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "clear_eta": {
        "$date": "2019-12-31T21:00:00.0"
      },
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "some_old_field": "heyhey",
      "sum_to_pay": {
        "ride": "100",
        "tips": "25"
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            },
            {
              "amount": "25",
              "item_id": "tips"
            }
          ],
          "originator": "processing",
          "status": "done",
          "type": "update"
        }
      ],
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "clear-success-for-update-contains-same-amount",
    "_shard_id": 0,
    "billing_tech": {
      "service_orders": {
        "ride": "order-ride"
      },
      "transactions": [
        {
          "payment_method_type": "card",
          "request_id": "1",
          "status": "clear_success",
          "sum": {
            "ride": "100"
          },
          "trust_payment_id": "tr1234"
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "clear_eta": {
        "$dateDiff": -1000
      },
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "sum_to_pay": {
        "ride": "100"
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "originator": "processing",
          "status": "done",
          "type": "update"
        }
      ],
      "originator": "processing",
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "noop-invoice",
    "_shard_id": 0,
    "billing_tech": {
      "transactions": [],
      "version": 1
    },
    "invoice_payment_tech": {
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1234",
      "sum_to_pay": {
        "ride": 0
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "operations": []
    }
  },
  {
    "_id": "notify-invoice",
    "_shard_id": 0,
    "billing_tech": {
      "transactions": [],
      "version": 1
    },
    "invoice_payment_tech": {
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1234",
      "sum_to_pay": {
        "ride": 0
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "id_namespace": "some_id_namespace",
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": 0,
              "item_id": "ride"
            }
          ],
          "originator": "processing",
          "status": "processing",
          "type": "update"
        }
      ],
      "version": 1
    }
  },
  {
    "_id": "notify-with-callbacks-invoice",
    "_shard_id": 0,
    "billing_tech": {
      "transactions": [],
      "version": 1
    },
    "invoice_payment_tech": {
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1234",
      "sum_to_pay": {
        "ride": 0
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "id_namespace": "some_id_namespace",
      "operations": [
        {
          "callbacks": [
            {
              "payload": {
                "arbitrary": "data"
              },
              "queue": "callback_with_payload"
            },
            {
              "queue": "callback_without_payload"
            }
          ],
          "id": "1",
          "items": [
            {
              "amount": 0,
              "item_id": "ride"
            }
          ],
          "originator": "processing",
          "status": "processing",
          "type": "update"
        }
      ],
      "version": 1
    }
  },
  {
    "_id": "clear-invoice",
    "_shard_id": 0,
    "billing_tech": {
      "transactions": [
        {
          "holded": {
            "$date": "2019-06-03T09:00:00.0"
          },
          "payment_method_type": "card",
          "status": "hold_success",
          "sum": {
            "ride": 1000000
          }
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "automatic_clear_delay": 10800,
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1234",
      "sum_to_pay": {
        "ride": 1000000
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "operations": []
    }
  },
  {
    "_id": "debt-invoice",
    "_shard_id": 0,
    "billing_tech": {
      "transactions": [],
      "version": 1
    },
    "invoice_payment_tech": {
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1234",
      "sum_to_pay": {
        "ride": 0
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "operations": []
    },
    "payment_tech": {
      "debt": true
    }
  },
  {
    "_id": "for_test_notify_on_fiscal_receipt",
    "_shard_id": 0,
    "billing_tech": {
      "service_orders": {
        "ride": "order-ride"
      },
      "transactions": [
        {
          "billing_response": {
            "foo": "bar"
          },
          "card_billing_id": "x1234",
          "card_payment_id": "card-x1324",
          "created": {
            "$dateDiff": -60
          },
          "request_id": "1",
          "status": "clear_success",
          "sum": {
            "ride": 1230000
          },
          "trust_payment_id": "tr1",
          "updated": {
            "$dateDiff": -60
          }
        },
        {
          "billing_response": {
            "foo": "bar"
          },
          "card_billing_id": "x1234",
          "card_payment_id": "card-x1324",
          "created": {
            "$dateDiff": -60
          },
          "request_id": "1",
          "status": "clear_success",
          "sum": {
            "ride": 1230000
          },
          "trust_payment_id": "tr2",
          "updated": {
            "$dateDiff": -60
          }
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "items_by_payment_type": [
        {
          "items": [
            {
              "amount": "246",
              "item_id": "ride",
              "product_id": "ride-product-id"
            }
          ],
          "payment_type": "card"
        }
      ],
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "payments": [
        {
          "billing_id": "x1234",
          "method": "card-x1324",
          "type": "card"
        }
      ],
      "sum_to_pay": {},
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "originator": "processing",
          "status": "done",
          "type": "update"
        }
      ],
      "originator": "processing",
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "payment_tech": {
      "type": "card"
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "clear-pending",
    "_shard_id": 0,
    "billing_tech": {
      "service_orders": {
        "ride": "order-ride"
      },
      "transactions": [
        {
          "billing_response": {
            "foo": "bar"
          },
          "card_billing_id": "x1234",
          "card_owner_uid": "123456",
          "card_payment_id": "card-x1324",
          "created": {
            "$dateDiff": -60
          },
          "payment_method_type": "card",
          "request_id": "1",
          "status": "clear_init",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "tr1234"
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "items": [],
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "originator": "processing",
          "status": "init",
          "type": "update"
        }
      ],
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "expired-operation",
    "_shard_id": 0,
    "billing_tech": {
      "transactions": [],
      "version": 1
    },
    "invoice_payment_tech": {
      "items_by_payment_type": [],
      "payments": []
    },
    "invoice_request": {
      "operations": [
        {
          "created": {
            "$date": "2020-01-01T00:00:00.0"
          },
          "items_by_payment_type": [
            {
              "items": [
                {
                  "amount": "246",
                  "item_id": "ride",
                  "product_id": "ride-product-id"
                }
              ],
              "payment_type": "card"
            }
          ],
          "originator": "processing",
          "payments": [
            {
              "billing_id": "x1234",
              "method": "card-x1324",
              "type": "card"
            }
          ],
          "status": "init",
          "ttl": 359
        }
      ],
      "version": 1
    }
  },
  {
    "_id": "for_test_notify_on_terminated_operations",
    "_shard_id": 0,
    "billing_tech": {
      "transactions": [],
      "version": 1
    },
    "invoice_payment_tech": {
      "items_by_payment_type": [],
      "payments": []
    },
    "invoice_request": {
      "operations": [],
      "terminated_operations": [
        {
          "id": "error-1",
          "notify_ts": {
            "$date": "2019-06-02T12:00:00.0"
          },
          "operation_id": "op-id-1",
          "terminated_at": {
            "$date": "2019-06-02T12:00:00.0"
          },
          "termination_context": {
            "foo": "bar"
          }
        },
        {
          "id": "error-2",
          "operation_id": "op-id-2",
          "terminated_at": {
            "$date": "2019-06-02T12:00:00.0"
          },
          "termination_context": {
            "baz": "xyzzy"
          }
        }
      ],
      "version": 1
    }
  },
  {
    "_id": "clear_pending",
    "_shard_id": 0,
    "billing_tech": {
      "refresh_attempts_count": 3,
      "service_orders": {
        "ride": "order-ride"
      },
      "transactions": [
        {
          "billing_response": {
            "payment_status": "authorized",
            "purchase_token": "trust-basket-token",
            "status": "success",
            "terminal": {
              "id": 12345
            }
          },
          "card_owner_uid": "transaction-uid",
          "created": {
            "$date": "2019-01-01T00:00:00.0"
          },
          "payment_method_type": "card",
          "request_id": "1",
          "status": "clear_pending",
          "sum": {
            "ride": "100"
          },
          "trust_payment_id": "tr1234",
          "updated": {
            "$date": "2019-01-01T00:00:00.0"
          }
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "clear_eta": {
        "$dateDiff": -1000
      },
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "sum_to_pay": {
        "ride": "100"
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "originator": "processing",
          "status": "done",
          "type": "update"
        }
      ],
      "originator": "processing",
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "payment_tech": {
      "hold_initiated": true
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  },
  {
    "_id": "refund_pending",
    "_shard_id": 0,
    "billing_tech": {
      "billing_response": {
        "payment_status": "cleared",
        "purchase_token": "trust-basket-token",
        "status": "success",
        "terminal": {
          "id": 12345
        }
      },
      "refresh_attempts_count": 3,
      "service_orders": {
        "ride": "order-ride"
      },
      "transactions": [
        {
          "card_owner_uid": "transaction-uid",
          "created": {
            "$date": "2019-01-01T00:00:00.0"
          },
          "payment_method_type": "card",
          "refunds": [
            {
              "billing_response": {},
              "created": {
                "$date": "2019-01-01T00:00:00.0"
              },
              "refund_made_at": {
                "$date": "2019-01-01T00:00:00.0"
              },
              "request_id": "operation-1",
              "status": "refund_waiting",
              "sum": {
                "ride": 1000000
              },
              "trust_refund_id": "tri234",
              "updated": {
                "$date": "2019-01-01T00:00:00.0"
              }
            }
          ],
          "request_id": "1",
          "status": "refund_pending",
          "sum": {
            "ride": "100"
          },
          "trust_payment_id": "tr1234",
          "updated": {
            "$date": "2019-01-01T00:00:00.0"
          }
        }
      ],
      "version": 1
    },
    "invoice_payment_tech": {
      "clear_eta": {
        "$dateDiff": -1000
      },
      "last_known_ip": "127.0.0.1",
      "main_card_billing_id": "x1234",
      "main_card_payment_id": "card-x1324",
      "sum_to_pay": {
        "ride": "0"
      },
      "type": "card"
    },
    "invoice_request": {
      "billing_service": "card",
      "currency": "RUR",
      "invoice_due": {
        "$dateDiff": -60
      },
      "operations": [
        {
          "id": "1",
          "items": [
            {
              "amount": "100",
              "item_id": "ride"
            }
          ],
          "originator": "processing",
          "status": "done",
          "type": "update"
        }
      ],
      "originator": "processing",
      "pass_params": {},
      "payment": {
        "billing_id": "x1324",
        "method": "card-x1324",
        "type": "card"
      },
      "personal_phone_id": "personal-id",
      "products": {
        "ride": "123"
      },
      "version": 2,
      "yandex_uid": "123"
    },
    "payment_tech": {
      "hold_initiated": true
    },
    "performer": {
      "taxi_alias": {
        "id": "<alias_id>"
      }
    },
    "yandex_uid": "123"
  }
]
