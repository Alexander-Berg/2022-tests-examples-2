{
  "existing_accounts": [
    {
      "account_id": 1,
      "agreement_id": "taxi/yandex_ride",
      "currency": "RUB",
      "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
      "sub_account": "subvention/discount_payback"
    },
    {
      "account_id": 2,
      "agreement_id": "taxi/yandex_ride",
      "currency": "RUB",
      "entity_external_id": "taximeter_park_id/7f74df",
      "sub_account": "subvention/discount_payback"
    },
    {
      "account_id": 3,
      "agreement_id": "taxi/driver_balance",
      "currency": "RUB",
      "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
      "sub_account": "total"
    },
    {
      "account_id": 4,
      "agreement_id": "taxi/driver_balance",
      "currency": "RUB",
      "entity_external_id": "taximeter_park_id/7f74df",
      "sub_account": "total/driver_id/1086f4"
    },
    {
      "account_id": 5,
      "agreement_id": "tlog",
      "currency": "USD",
      "entity_external_id": "billing_client_id/77777",
      "sub_account": "subsidy_discount_payback/_id/dp_id"
    },
    {
      "account_id": 10,
      "agreement_id": "taxi/yandex_ride+0",
      "currency": "RUB",
      "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
      "sub_account": "subvention/discount_payback"
    }
  ],
  "existing_docs": [
    {
      "data": {
        "entries_count": 5,
        "version": 1
      },
      "doc_id": 12343,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "external_event_ref": "12342/reversed",
      "external_obj_id": "taxi/some_event/event_id/process",
      "journal_entries": [
        {
          "account": {
            "account_id": 1,
            "agreement_id": "taxi/yandex_ride",
            "currency": "RUB",
            "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
            "sub_account": "subvention/discount_payback"
          },
          "amount": "-50.0",
          "details": {
            "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
            "reverse_entry_id": 11
          },
          "entry_id": 12,
          "event_at": "2019-09-13T13:00:00.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 2,
            "agreement_id": "taxi/yandex_ride",
            "currency": "RUB",
            "entity_external_id": "taximeter_park_id/7f74df",
            "sub_account": "subvention/discount_payback"
          },
          "amount": "-50.0",
          "details": {
            "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
            "driver": {
              "driver_uuid": "1086f4"
            },
            "reverse_entry_id": 21
          },
          "entry_id": 22,
          "event_at": "2019-09-13T13:00:00.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 3,
            "agreement_id": "taxi/driver_balance",
            "currency": "RUB",
            "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
            "sub_account": "total"
          },
          "amount": "-50.0",
          "details": {
            "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
            "reverse_entry_id": 31
          },
          "entry_id": 32,
          "event_at": "2019-09-13T13:00:00.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 4,
            "agreement_id": "taxi/driver_balance",
            "currency": "RUB",
            "entity_external_id": "taximeter_park_id/7f74df",
            "sub_account": "total/driver_id/1086f4"
          },
          "amount": "-50.0",
          "details": {
            "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
            "driver": {
              "driver_uuid": "1086f4"
            },
            "reverse_entry_id": 41
          },
          "entry_id": 42,
          "event_at": "2019-09-13T13:00:00.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 5,
            "agreement_id": "tlog",
            "currency": "USD",
            "entity_external_id": "billing_client_id/77777",
            "sub_account": "subsidy_discount_payback/_id/dp_id"
          },
          "amount": "-1.5",
          "details": {
            "alias_id": "abcdef",
            "billing_client_id": 77777,
            "detailed_product": "subsidy_discount_payback",
            "due": "2019-09-12T11:30:00.000000+00:00",
            "handled_in_trust_flow": true,
            "is_payable": false,
            "product": "subvention",
            "reverse_entry_id": 51,
            "service_id": 123,
            "service_transaction_id": 1234567890,
            "transaction_type": "refund"
          },
          "entry_id": 52,
          "event_at": "2019-09-13T13:00:00.000000+00:00",
          "reason": ""
        }
      ],
      "kind": "journal/reversal",
      "service": "billing-calculators",
      "status": "complete"
    },
    {
      "data": {
        "entries_count": 5,
        "version": 1
      },
      "doc_id": 12347,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "external_event_ref": "12345/handled",
      "external_obj_id": "taxi/some_event/event_id/process",
      "journal_entries": [
        {
          "account": {
            "account_id": 1,
            "agreement_id": "taxi/yandex_ride",
            "currency": "RUB",
            "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
            "sub_account": "subvention/discount_payback"
          },
          "amount": "100.0",
          "details": {
            "alias_id": "300226c453c54b099f3f5aa64fbc1ac4"
          },
          "entry_id": 13,
          "event_at": "2019-09-13T13:00:00.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 2,
            "agreement_id": "taxi/yandex_ride",
            "currency": "RUB",
            "entity_external_id": "taximeter_park_id/7f74df",
            "sub_account": "subvention/discount_payback"
          },
          "amount": "100.00",
          "details": {
            "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
            "driver": {
              "driver_uuid": "1086f4"
            }
          },
          "entry_id": 23,
          "event_at": "2019-09-13T13:00:00.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 3,
            "agreement_id": "taxi/driver_balance",
            "currency": "RUB",
            "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
            "sub_account": "total"
          },
          "amount": "100.0",
          "details": {
            "alias_id": "300226c453c54b099f3f5aa64fbc1ac4"
          },
          "entry_id": 33,
          "event_at": "2019-09-13T13:00:00.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 4,
            "agreement_id": "taxi/driver_balance",
            "currency": "RUB",
            "entity_external_id": "taximeter_park_id/7f74df",
            "sub_account": "total/driver_id/1086f4"
          },
          "amount": "100.0",
          "details": {
            "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
            "driver": {
              "driver_uuid": "1086f4"
            }
          },
          "entry_id": 43,
          "event_at": "2019-09-13T13:00:00.000000+00:00",
          "reason": ""
        },
        {
          "account": {
            "account_id": 5,
            "agreement_id": "tlog",
            "currency": "USD",
            "entity_external_id": "billing_client_id/77777",
            "sub_account": "subsidy_discount_payback/_id/dp_id"
          },
          "amount": "2.5",
          "details": {
            "alias_id": "abcdef",
            "billing_client_id": 77777,
            "detailed_product": "subsidy_discount_payback",
            "due": "2019-09-12T11:30:00.000000+00:00",
            "handled_in_trust_flow": true,
            "is_payable": false,
            "product": "subvention",
            "service_id": 123,
            "service_transaction_id": 1234567890,
            "transaction_type": "payment"
          },
          "entry_id": 53,
          "event_at": "2019-09-13T13:00:00.000000+00:00",
          "reason": ""
        }
      ],
      "kind": "journal",
      "service": "billing-calculators",
      "status": "complete"
    }
  ],
  "expected_docs": [
    {
      "data": {
        "based_on_doc_id": 666666,
        "driver": {
          "db_id": "<db_id>",
          "driver_uuid": "<driver_uuid>"
        },
        "kind": "subvention",
        "order_cost": "1000.0",
        "payments": [
          {
            "agreement": "taxi/yandex_ride",
            "amount": "-50.0",
            "currency": "RUB",
            "entry_id": 12,
            "payload": {
              "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
              "reverse_entry_id": 11
            },
            "sub_account": "subvention/discount_payback"
          },
          {
            "agreement": "taxi/yandex_ride",
            "amount": "100.0",
            "currency": "RUB",
            "entry_id": 13,
            "payload": {
              "alias_id": "300226c453c54b099f3f5aa64fbc1ac4"
            },
            "sub_account": "subvention/discount_payback"
          }
        ],
        "transaction_id": "doc/666666"
      },
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "external_event_ref": "666666/taximeter_request_created",
      "external_obj_id": "taxi/some_event/event_id/process/taximeter_request",
      "journal_entries": [],
      "kind": "taximeter_request",
      "service": "billing-calculators",
      "status": "new",
      "tags": [
        "some_event_tag"
      ]
    },
    {
      "data": {
        "entries_count": 1
      },
      "event_at": "2019-09-09T09:00:00.000000+00:00",
      "external_event_ref": "666666/income_entries_created",
      "external_obj_id": "taxi/some_event/event_id/process",
      "journal_entries": [
        {
          "account_id": 10,
          "amount": "50.0",
          "details": {},
          "event_at": "2019-09-09T09:00:00.000000+00:00",
          "reason": ""
        }
      ],
      "kind": "income_journal",
      "service": "billing-calculators",
      "status": "new",
      "tags": [
        "some_event_tag"
      ]
    }
  ],
  "expected_tlog_entries": [
    {
      "alias_id": "abcdef",
      "amount": "-1.5",
      "billing_client_id": "77777",
      "currency": "USD",
      "detailed_product": "subsidy_discount_payback",
      "due": "2019-09-12T11:30:00.000000+00:00",
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "handled_in_trust_flow": true,
      "is_payable": false,
      "journal_entry_id": 52,
      "product": "subvention",
      "reverse_entry_id": 51,
      "service_id": 123,
      "service_transaction_id": "1234567890",
      "transaction_type": "refund"
    },
    {
      "alias_id": "abcdef",
      "amount": "2.5",
      "billing_client_id": "77777",
      "currency": "USD",
      "detailed_product": "subsidy_discount_payback",
      "due": "2019-09-12T11:30:00.000000+00:00",
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "handled_in_trust_flow": true,
      "is_payable": false,
      "journal_entry_id": 53,
      "product": "subvention",
      "service_id": 123,
      "service_transaction_id": "1234567890",
      "transaction_type": "payment"
    }
  ],
  "payout": {
    "base_doc_id": 123456,
    "entries": [
      {
        "agreement_id": "taxi/yandex_ride",
        "amount": "100.0",
        "currency": "RUB",
        "details": {
          "alias_id": "300226c453c54b099f3f5aa64fbc1ac4"
        },
        "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
        "entity_kind": "driver",
        "sub_account": "promocode/compensation"
      },
      {
        "agreement_id": "taxi/yandex_ride",
        "amount": "100.00",
        "currency": "RUB",
        "details": {
          "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
          "driver": {
            "driver_uuid": "1086f4"
          }
        },
        "entity_external_id": "taximeter_park_id/7f74df",
        "entity_kind": "park",
        "sub_account": "promocode/compensation"
      },
      {
        "agreement_id": "taxi/driver_balance",
        "amount": "100.0",
        "currency": "RUB",
        "details": {
          "alias_id": "300226c453c54b099f3f5aa64fbc1ac4"
        },
        "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
        "entity_kind": "driver",
        "sub_account": "total"
      },
      {
        "agreement_id": "taxi/driver_balance",
        "amount": "100.0",
        "currency": "RUB",
        "details": {
          "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
          "driver": {
            "driver_uuid": "1086f4"
          }
        },
        "entity_external_id": "taximeter_park_id/7f74df",
        "entity_kind": "park",
        "sub_account": "total/driver_id/1086f4"
      },
      {
        "agreement_id": "tlog",
        "amount": "2.5",
        "currency": "USD",
        "details": {
          "alias_id": "abcdef",
          "billing_client_id": 77777,
          "due": "2019-09-12T11:30:00.000000+00:00",
          "is_payable": false,
          "service_id": 123,
          "service_transaction_id": 1234567890
        },
        "entity_external_id": "billing_client_id/77777",
        "entity_kind": "client",
        "sub_account": "coupon"
      }
    ],
    "event_at": "2019-09-13T13:00:00.000000+00:00",
    "external_obj_id": "taxi/some_event/event_id/process",
    "kind": "some_event",
    "payout_doc_id": 666666,
    "tags": [
      "some_event_tag"
    ],
    "topic_begin_at": "2019-09-13T09:00:00.000000+00:00",
    "version": 1
  }
}
