[
  {
    "data": {
      "description": "Старое описание",
      "enable_bulk_buffering": false,
      "is_critical": true,
      "queue_name": "example_queue",
      "shards": [
        {
          "collection": "example_queue_0",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [
            "taxi-stq-sas-06.taxi.yandex.net",
            "taxi-stq-vla-06.taxi.yandex.net"
          ],
          "state": "disabled"
        },
        {
          "collection": "example_queue_1",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [
            "taxi-stq-sas-06.taxi.yandex.net",
            "taxi-stq-vla-06.taxi.yandex.net"
          ],
          "state": "enabled"
        }
      ],
      "state": "disabled",
      "version": 3,
      "worker_configs": {
        "instances": 10,
        "max_execution_time": 120,
        "max_tasks": 100,
        "polling_interval": 0.5
      },
      "write_concern": false
    },
    "expected_new": {
      "description": "Старое описание",
      "disable_tracing_capturing": false,
      "enable_bulk_buffering": false,
      "grafana_url": "grafana/example_queue",
      "is_critical": true,
      "monitoring_thresholds": {
        "total": {
          "critical": 5,
          "warning": 1
        }
      },
      "queue_name": "example_queue",
      "shards": [
        {
          "collection": "example_queue_0",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [
            "taxi-stq-sas-06.taxi.yandex.net",
            "taxi-stq-vla-06.taxi.yandex.net"
          ],
          "state": "enabled"
        },
        {
          "collection": "example_queue_1",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [
            "taxi-stq-sas-06.taxi.yandex.net",
            "taxi-stq-vla-06.taxi.yandex.net"
          ],
          "state": "enabled"
        }
      ],
      "state": "disabled",
      "updated": "2019-01-02T03:00:00+03:00",
      "version": 4,
      "worker_configs": {
        "instances": 10,
        "max_execution_time": 120,
        "max_tasks": 100,
        "polling_interval": 0.5
      },
      "write_concern": false
    }
  },
  {
    "data": {
      "description": "Новое описание",
      "disable_tracing_capturing": false,
      "queue_name": "example_queue",
      "shards": [
        {
          "collection": "example_queue_0",
          "connection_name": "stq",
          "database": "dbstqorder0",
          "hostnames": [],
          "state": "disabled"
        },
        {
          "collection": "example_queue_1",
          "connection_name": "stq",
          "database": "dbstqorder0",
          "hostnames": [],
          "state": "enabled"
        }
      ],
      "state": "enabled",
      "version": 3,
      "worker_configs": {
        "instances": 10,
        "max_execution_time": 120,
        "max_tasks": 100,
        "polling_interval": 0.5
      },
      "write_concern": true
    },
    "expected_new": {
      "description": "Новое описание",
      "disable_tracing_capturing": false,
      "grafana_url": "grafana/example_queue",
      "monitoring_thresholds": {
        "total": {
          "critical": 5,
          "warning": 1
        }
      },
      "queue_name": "example_queue",
      "shards": [
        {
          "collection": "example_queue_0",
          "connection_name": "stq",
          "database": "dbstqorder0",
          "hostnames": [],
          "state": "disabled"
        },
        {
          "collection": "example_queue_1",
          "connection_name": "stq",
          "database": "dbstqorder0",
          "hostnames": [],
          "state": "enabled"
        }
      ],
      "state": "enabled",
      "updated": "2019-01-02T03:00:00+03:00",
      "version": 4,
      "worker_configs": {
        "instances": 10,
        "max_execution_time": 120,
        "max_tasks": 100,
        "polling_interval": 0.5
      },
      "write_concern": true
    }
  },
  {
    "data": {
      "balancing_enabled": true,
      "description": "Новое описание",
      "queue_name": "example_queue",
      "shards": [
        {
          "collection": "example_queue_0",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [
            "taxi-stq-sas-06.taxi.yandex.net",
            "taxi-stq-vla-06.taxi.yandex.net"
          ],
          "state": "disabled"
        },
        {
          "collection": "example_queue_1",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [
            "taxi-stq-sas-06.taxi.yandex.net",
            "taxi-stq-vla-06.taxi.yandex.net"
          ],
          "state": "enabled"
        }
      ],
      "state": "enabled",
      "version": 3,
      "worker_configs": {
        "instances": 10,
        "max_execution_time": 120,
        "max_tasks": 500
      },
      "workers_guarantee": 20,
      "write_concern": true
    },
    "expected_new": {
      "balancer_settings": {
        "hosts": [
          {
            "name": "taxi-stq-sas-06.taxi.yandex.net",
            "shards": [
              {
                "index": 0,
                "max_tasks": 250
              },
              {
                "index": 1,
                "max_tasks": 250
              }
            ],
            "worker_configs": {
              "instances": 10
            }
          },
          {
            "name": "taxi-stq-vla-06.taxi.yandex.net",
            "shards": [
              {
                "index": 0,
                "max_tasks": 250
              },
              {
                "index": 1,
                "max_tasks": 250
              }
            ],
            "worker_configs": {
              "instances": 10
            }
          }
        ]
      },
      "balancing_enabled": true,
      "description": "Новое описание",
      "disable_tracing_capturing": false,
      "grafana_url": "grafana/example_queue",
      "monitoring_thresholds": {
        "total": {
          "critical": 5,
          "warning": 1
        }
      },
      "queue_name": "example_queue",
      "shards": [
        {
          "collection": "example_queue_0",
          "connection_name": "stq",
          "database": "dbstq",
          "state": "disabled"
        },
        {
          "collection": "example_queue_1",
          "connection_name": "stq",
          "database": "dbstq",
          "state": "enabled"
        }
      ],
      "state": "enabled",
      "updated": "2019-01-02T03:00:00+03:00",
      "version": 4,
      "worker_configs": {
        "instances": 10,
        "max_execution_time": 120,
        "max_tasks": 500
      },
      "workers_guarantee": 20,
      "write_concern": true
    }
  },
  {
    "data": {
      "balancing_enabled": true,
      "description": "Новое описание",
      "queue_name": "queue_without_hosts",
      "shards": [
        {
          "collection": "queue_without_hosts_0",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [],
          "state": "enabled"
        }
      ],
      "state": "enabled",
      "version": 3,
      "worker_configs": {
        "instances": 10,
        "max_execution_time": 120,
        "max_tasks": 500
      },
      "workers_guarantee": 20,
      "write_concern": true
    },
    "expected_new": {
      "balancing_enabled": true,
      "description": "Новое описание",
      "disable_tracing_capturing": false,
      "grafana_url": "grafana/queue_without_hosts",
      "monitoring_thresholds": {
        "total": {
          "critical": 5,
          "warning": 1
        }
      },
      "queue_name": "queue_without_hosts",
      "shards": [
        {
          "collection": "queue_without_hosts_0",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [],
          "state": "enabled"
        }
      ],
      "state": "enabled",
      "updated": "2019-01-02T03:00:00+03:00",
      "version": 4,
      "worker_configs": {
        "instances": 10,
        "max_execution_time": 120,
        "max_tasks": 500
      },
      "workers_guarantee": 20,
      "write_concern": true
    }
  },
  {
    "data": {
      "balancing_enabled": false,
      "enable_bulk_buffering": true,
      "queue_name": "processing",
      "shards": [
        {
          "collection": "processing_0",
          "connection_name": "stq_order0",
          "database": "dbstqorder0",
          "state": "enabled"
        },
        {
          "collection": "processing_1",
          "connection_name": "stq_order0",
          "database": "dbstqorder0",
          "state": "enabled"
        }
      ],
      "state": "enabled",
      "version": 27,
      "worker_configs": {
        "instances": 20,
        "max_execution_time": 120,
        "max_tasks": 900
      },
      "workers_guarantee": 6,
      "write_concern": false
    },
    "expected_new": {
      "balancing_enabled": false,
      "disable_tracing_capturing": false,
      "enable_bulk_buffering": true,
      "grafana_url": "grafana/processing",
      "monitoring_thresholds": {
        "total": {
          "critical": 5,
          "warning": 1
        }
      },
      "queue_name": "processing",
      "shards": [
        {
          "collection": "processing_0",
          "connection_name": "stq_order0",
          "database": "dbstqorder0",
          "hostnames": [
            "taxi-stq-sas-06.taxi.yandex.net"
          ],
          "state": "enabled"
        },
        {
          "collection": "processing_1",
          "connection_name": "stq_order0",
          "database": "dbstqorder0",
          "hostnames": [
            "taxi-stq-sas-06.taxi.yandex.net"
          ],
          "state": "enabled"
        }
      ],
      "state": "enabled",
      "version": 28,
      "worker_configs": {
        "instances": 20,
        "max_execution_time": 120,
        "max_tasks": 900
      },
      "workers_guarantee": 6,
      "write_concern": false
    }
  },
  {
    "data": {
      "balancing_enabled": false,
      "description": "test",
      "queue_name": "test_no_balancer_settings",
      "shards": [
        {
          "collection": "test_no_balancer_settings_0",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [],
          "state": "enabled"
        }
      ],
      "state": "disabled",
      "version": 5,
      "worker_configs": {
        "instances": 2,
        "max_execution_time": 300,
        "max_tasks": 2
      },
      "workers_guarantee": 4,
      "write_concern": false
    },
    "expected_new": {
      "balancing_enabled": false,
      "description": "test",
      "disable_tracing_capturing": false,
      "grafana_url": "grafana/test_no_balancer_settings",
      "monitoring_thresholds": {
        "total": {
          "critical": 5,
          "warning": 1
        }
      },
      "queue_name": "test_no_balancer_settings",
      "shards": [
        {
          "collection": "test_no_balancer_settings_0",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [],
          "state": "enabled"
        }
      ],
      "state": "disabled",
      "updated": "2019-09-10T14:43:25.199000+03:00",
      "version": 6,
      "worker_configs": {
        "instances": 2,
        "max_execution_time": 300,
        "max_tasks": 2
      },
      "workers_guarantee": 4,
      "write_concern": false
    }
  },
  {
    "data": {
      "balancing_enabled": false,
      "description": "new desc",
      "queue_name": "processing",
      "shards": [
        {
          "collection": "processing_0",
          "connection_name": "stq_order0",
          "database": "dbstqorder0",
          "hostnames": [
            "taxi-stq-sas-06.taxi.yandex.net"
          ],
          "state": "enabled"
        },
        {
          "collection": "processing_1",
          "connection_name": "stq_order0",
          "database": "dbstqorder0",
          "hostnames": [
            "taxi-stq-sas-06.taxi.yandex.net"
          ],
          "state": "enabled"
        }
      ],
      "state": "enabled",
      "version": 27,
      "worker_configs": {
        "instances": 20,
        "max_execution_time": 120,
        "max_tasks": 900
      },
      "workers_guarantee": 6,
      "write_concern": false
    },
    "expected_new": {
      "balancing_enabled": false,
      "description": "new desc",
      "disable_tracing_capturing": false,
      "grafana_url": "grafana/processing",
      "monitoring_thresholds": {
        "total": {
          "critical": 5,
          "warning": 1
        }
      },
      "queue_name": "processing",
      "shards": [
        {
          "collection": "processing_0",
          "connection_name": "stq_order0",
          "database": "dbstqorder0",
          "hostnames": [
            "taxi-stq-sas-06.taxi.yandex.net"
          ],
          "state": "enabled"
        },
        {
          "collection": "processing_1",
          "connection_name": "stq_order0",
          "database": "dbstqorder0",
          "hostnames": [
            "taxi-stq-sas-06.taxi.yandex.net"
          ],
          "state": "enabled"
        }
      ],
      "state": "enabled",
      "version": 28,
      "worker_configs": {
        "instances": 20,
        "max_execution_time": 120,
        "max_tasks": 900
      },
      "workers_guarantee": 6,
      "write_concern": false
    }
  },
  {
    "data": {
      "queue_name": "queue_with_old_shards",
      "shards": [
        {
          "collection": "queue_with_old_shards_0",
          "connection_name": "stq",
          "database": "dbstqorder0",
          "hostnames": [],
          "state": "disabled"
        },
        {
          "collection": "queue_with_old_shards_1",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [],
          "state": "enabled"
        },
        {
          "collection": "queue_with_old_shards_2",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [],
          "state": "enabled"
        }
      ],
      "state": "enabled",
      "version": 3,
      "worker_configs": {
        "instances": 10,
        "max_execution_time": 120,
        "max_tasks": 100,
        "polling_interval": 0.5
      },
      "write_concern": true
    },
    "expected_new": {
      "disable_tracing_capturing": false,
      "grafana_url": "grafana/queue_with_old_shards",
      "monitoring_thresholds": {
        "total": {
          "critical": 5,
          "warning": 1
        }
      },
      "queue_name": "queue_with_old_shards",
      "shards": [
        {
          "collection": "queue_with_old_shards_0",
          "connection_name": "stq",
          "database": "dbstqorder0",
          "hostnames": [],
          "state": "disabled"
        },
        {
          "collection": "queue_with_old_shards_1",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [],
          "state": "enabled"
        },
        {
          "collection": "queue_with_old_shards_2",
          "connection_name": "stq",
          "database": "dbstq",
          "hostnames": [],
          "state": "enabled"
        }
      ],
      "state": "enabled",
      "updated": "2019-01-02T03:00:00+03:00",
      "version": 4,
      "worker_configs": {
        "instances": 10,
        "max_execution_time": 120,
        "max_tasks": 100,
        "polling_interval": 0.5
      },
      "write_concern": true
    }
  }
]
