FUNC(getMainStringFromExperiment,ARGS((exp,std::unordered_map<std::string,lang::variables::ExperimentSubValue>)),B(CR(str=T(B("main",in,FA(exp,std::unordered_map<std::string,lang::variables::ExperimentSubValue>)),T(U(?,B(B(FA(exp,std::unordered_map<std::string,lang::variables::ExperimentSubValue>),.,"main"),.,F(str))),U(*,B(B(FA(exp,std::unordered_map<std::string,lang::variables::ExperimentSubValue>),.,"main"),.,F(str)))," ")," "))));IF(U(?,B(fix,.,F(discount))),IF(B(B(B(U(*,B(fix,.,F(discount))),.,F(restrictions)),.,F(recalc_type)),==,clients::discounts::RecalcType::kBasicPrice),CR(boarding=B(B(ride,.,F(price)),.,F(boarding)),destination_waiting=B(B(ride,.,F(price)),.,F(destination_waiting)),distance=B(B(ride,.,F(price)),.,F(distance)),requirements=B(B(ride,.,F(price)),.,F(requirements)),time=B(B(ride,.,F(price)),.,F(time)),transit_waiting=B(B(ride,.,F(price)),.,F(transit_waiting)),waiting=B(B(ride,.,F(price)),.,F(waiting)))));IF(B(B(fix,.,F(zone)),==,"boryasvo"),CR(boarding=B(B(ride,.,F(price)),.,F(boarding)),destination_waiting=B(B(ride,.,F(price)),.,F(destination_waiting)),distance=B(B(ride,.,F(price)),.,F(distance)),requirements=B(B(ride,.,F(price)),.,F(requirements)),time=B(B(ride,.,F(price)),.,F(time)),transit_waiting=B(B(ride,.,F(price)),.,F(transit_waiting)),waiting=B(B(ride,.,F(price)),.,F(waiting))));SV(DEFAULT_ALPHA,1.000000);SV(DEFAULT_BETA,0.000000);SV(DEFAULT_SURCHARGE,0.000000);SV(orig_surge,B(B(fix,.,F(surge_params)),.,F(value)));SV(alpha,T(B(VA(orig_surge),>=,1.000000),T(U(?,B(B(fix,.,F(surge_params)),.,F(surcharge_alpha))),U(*,B(B(fix,.,F(surge_params)),.,F(surcharge_alpha))),VA(DEFAULT_ALPHA)),VA(DEFAULT_ALPHA)));SV(beta,T(B(VA(orig_surge),>=,1.000000),T(U(?,B(B(fix,.,F(surge_params)),.,F(surcharge_beta))),U(*,B(B(fix,.,F(surge_params)),.,F(surcharge_beta))),VA(DEFAULT_BETA)),VA(DEFAULT_BETA)));SV(surcharge,T(B(VA(orig_surge),>=,1.000000),T(U(?,B(B(fix,.,F(surge_params)),.,F(surcharge))),U(*,B(B(fix,.,F(surge_params)),.,F(surcharge))),VA(DEFAULT_SURCHARGE)),VA(DEFAULT_SURCHARGE)));SV(surge,T(B(VA(orig_surge),>=,1.000000),VA(orig_surge),1.000000));SV(alpha_surge_beta,B(B(VA(alpha),*,VA(surge)),+,VA(beta)));SV(is_cargo_category,B(B("cargo_categories_list",in,B(fix,.,F(exps))),&&,B(B(fix,.,F(category)),in,B(B(fix,.,F(exps)),.,"cargo_categories_list"))));SV(waitings_coeff,T(B(B(B(fix,.,F(country_code2)),==,"RU"),&&,U(!,VA(is_cargo_category))),VA(surge),1.000000));SV(boarding,B(B(VA(alpha_surge_beta),*,B(B(ride,.,F(price)),.,F(boarding))),+,B(VA(beta),*,VA(surcharge))));SV(distance,B(VA(alpha_surge_beta),*,B(B(ride,.,F(price)),.,F(distance))));SV(time,B(VA(alpha_surge_beta),*,B(B(ride,.,F(price)),.,F(time))));SV(requirements,B(VA(alpha_surge_beta),*,B(B(ride,.,F(price)),.,F(requirements))));SV(waiting,B(VA(waitings_coeff),*,B(B(ride,.,F(price)),.,F(waiting))));SV(transit_waiting,B(VA(waitings_coeff),*,B(B(ride,.,F(price)),.,F(transit_waiting))));SV(destination_waiting,B(VA(waitings_coeff),*,B(B(ride,.,F(price)),.,F(destination_waiting))));SV(delta,B(B(B(B(B(B(B(VA(boarding),+,VA(distance)),+,VA(time)),+,VA(requirements)),+,VA(waiting)),+,VA(transit_waiting)),+,VA(destination_waiting)),-,U(*,B(ride,.,F(price)))));SV(round_delta,B(VA(delta),round_to,B(fix,.,F(rounding_factor))));E("surge_delta_raw",VA(delta));E("surge_delta",VA(round_delta));SV(fact_surge,T(B(U(*,B(ride,.,F(price))),>,0.000010),B(B(U(*,B(ride,.,F(price))),+,VA(delta)),/,U(*,B(ride,.,F(price)))),1.000000));SV(round_fact_surge,B(B(VA(fact_surge),-,0.050000),round_to,0.100000));IF(B("setcar_show_surge_or_surcharge",in,B(fix,.,F(exps))),IF(B(B(B(FC(getMainStringFromExperiment,NT(exp=B(B(fix,.,F(exps)),.,"setcar_show_surge_or_surcharge")),R(str=std::string)),.,TF(str)),==,"show_surge"),&&,B(VA(round_fact_surge),>,1.000100)),E("setcar.show_surge",VA(round_fact_surge)));IF(B(B(B(FC(getMainStringFromExperiment,NT(exp=B(B(fix,.,F(exps)),.,"setcar_show_surge_or_surcharge")),R(str=std::string)),.,TF(str)),==,"show_surcharge"),&&,B(VA(round_delta),>,0.000100)),E("setcar.show_surcharge",VA(round_delta))));CR(boarding=VA(boarding),destination_waiting=VA(destination_waiting),distance=VA(distance),requirements=VA(requirements),time=VA(time),transit_waiting=VA(transit_waiting),waiting=VA(waiting))