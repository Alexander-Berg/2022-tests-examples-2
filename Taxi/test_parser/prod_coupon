IF(U(?,B(fix,.,F(coupon))),IF(B(U(*,B(fix,.,F(coupon))),.,F(valid)),SV(price,U(*,B(ride,.,F(price))));E("price_before_coupon",B(VA(price),round_to,B(fix,.,F(rounding_factor))));IF(B(VA(price),>=,0.000100),SV(percent_value,T(U(?,B(U(*,B(fix,.,F(coupon))),.,F(percent))),B(B(VA(price),*,U(*,B(U(*,B(fix,.,F(coupon))),.,F(percent)))),/,100.000000),0.000000));SV(coupon_value,T(U(?,B(U(*,B(fix,.,F(coupon))),.,F(percent))),T(U(?,B(U(*,B(fix,.,F(coupon))),.,F(limit))),B(FC(min,NT(a=U(*,B(U(*,B(fix,.,F(coupon))),.,F(limit))),b=VA(percent_value)),R(res=double)),.,TF(res)),VA(percent_value)),B(U(*,B(fix,.,F(coupon))),.,F(value))));SV(new_total_price,B(B(B(B(B(B(B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(boarding)),+,B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(distance))),+,B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(time))),+,B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(requirements))),+,B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(waiting))),+,B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(transit_waiting))),+,B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(destination_waiting))));E("coupon_value",B(B(VA(price),round_to,B(fix,.,F(rounding_factor))),-,B(VA(new_total_price),round_to,B(fix,.,F(rounding_factor)))));CR(boarding=B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(boarding)),destination_waiting=B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(destination_waiting)),distance=B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(distance)),requirements=B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(requirements)),time=B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(time)),transit_waiting=B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(transit_waiting)),waiting=B(FC(subtractValueFromCompositePrice,NT(price=B(ride,.,F(price)),value=VA(coupon_value)),R(boarding=double,destination_waiting=double,distance=double,requirements=double,time=double,transit_waiting=double,waiting=double)),.,TF(waiting))))));CR(boarding=B(B(ride,.,F(price)),.,F(boarding)),destination_waiting=B(B(ride,.,F(price)),.,F(destination_waiting)),distance=B(B(ride,.,F(price)),.,F(distance)),requirements=B(B(ride,.,F(price)),.,F(requirements)),time=B(B(ride,.,F(price)),.,F(time)),transit_waiting=B(B(ride,.,F(price)),.,F(transit_waiting)),waiting=B(B(ride,.,F(price)),.,F(waiting)))