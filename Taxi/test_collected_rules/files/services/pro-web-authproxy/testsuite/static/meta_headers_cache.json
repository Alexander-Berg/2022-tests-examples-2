[
  {
    "meta": {
      "input_urls": [
        {
          "url": "https://pro-web-authproxy.taxi.yandex.net/test"
        }
      ],
      "upstream_url": {
        "url": "http://example.com/test"
      },
      "variants": [
        {
          "description": "Запрос со стороны браузера (обычно JS)",
          "input_data": {
            "parameters": [
              {
                "description": "User-Agent",
                "example-value": "yandex-taxi/4.36.0.dev_denistimoshin_ Android/9 (Xiaomi; Redmi Note 7)",
                "name": "User-Agent",
                "required": true,
                "type": "header"
              },
              {
                "description": "Сессия браузера.\n",
                "example-value": "3:1622106996.5.0.1622106996604:GiiVVxWBABINVALIDAYCKg:9.1|4053884789.0.2|348276.52732.yl_vdokwSOMESOMESOMEe9efbJE",
                "name": "Session_id",
                "required": true,
                "type": "cookie"
              }
            ]
          },
          "name": "Запрос браузера",
          "upstream_data": {
            "parameters": [
              {
                "description": "Локаль пользователя, полученная из HTTP header \"Accept-Langauge\",\nнапример \"ru\" или \"en\".\nРезультат работы функции `http::language::ParseLocale()`.\n",
                "example-value": "ru",
                "name": "X-Request-Language",
                "required": true,
                "type": "header"
              },
              {
                "description": "Регион пользователя, полученный из HTTP header \"Accept-Langauge\",\nнапример \"RU\" или \"US\".\nРезультат работы функции `http::language::ParseRegion()`.\n",
                "example-value": "RU",
                "name": "X-Request-Language-Region",
                "required": true,
                "type": "header"
              },
              {
                "description": "Информация о пользовательском приложении.\nПредставляет из себя список пар ключ=значение,\nразделенных запятыми.\nРезультат работы `ua_parser::DetectApplication()`.\n",
                "example-value": "app_brand=yauber,app_name=mobileweb_uber_kz_android,app_build=release,platform_ver1=9,app_ver1=3,app_ver2=85,app_ver3=1",
                "name": "X-Request-Application",
                "required": true,
                "type": "header"
              },
              {
                "description": "IP-адрес пользовательского приложения/браузера\n(не прокси, а именно приложения).\nТо же самое, что и X-Forwarded-For-Y.\n",
                "example-value": "56.32.44.17",
                "name": "X-Remote-IP",
                "required": true,
                "type": "header"
              },
              {
                "description": "IP-адрес пользовательского приложения/браузера\n(не прокси, а именно приложения).\nТо же самое, что и X-Remote-IP.\n",
                "example-value": "56.32.44.17",
                "name": "X-Forwarded-For-Y",
                "required": true,
                "type": "header"
              },
              {
                "description": "TVM service ticket.",
                "example-value": "3:serv:CBAQ__________9_IgUIlAMQZQ:Dp-l02wKq6RMvh5VMkux17_8ES7EUAsAEvp88BYHzwCYOL6cNKKGHA21BhE5J-ePB6KdNNHpbYE2KqIDY7kssiJ2TDMQ79qlQX8qwLDlVR0QGRMuwt6C2DVhY2V9CbDaamvHTjRozKJMAJd1kX_UFCegkRYdlC-1FN18CozWrJQ",
                "name": "X-Ya-Service-Ticket",
                "required": true,
                "type": "header"
              },
              {
                "description": "Первоначальное значение 'Host' HTTP header.\n",
                "example-value": "example.com",
                "name": "X-Forwarded-Host",
                "required": true,
                "type": "header"
              },
              {
                "description": "[TVM user ticket](https://wiki.yandex-team.ru/taxi/backend/userver/tvm/user/).\nВыписан на имя uid пользователя (default uid в тикете),\nкоторый авторизован проксей.\n",
                "example-value": "3:user:CA0Q__________9_Gg4KAggBEAEg0oXYzAQoAQ:QnebQMbHdRoF04l985knaMHBnhh5SaFE2klzWiZW4f88V2MSzZ7KhIjIewFDe6jSKB1UXY2j0tGkDPZc6_jEdDl8WBOWjKYfie8jvYi_kj5SsJQAoUcNqMzm2b-2O8h__fm79_8s_EIsWjgDssEutAFpuC0IbJFcjtsomhTMl-w",
                "name": "X-Ya-User-Ticket",
                "required": true,
                "type": "header"
              }
            ]
          }
        }
      ]
    },
    "rule": {
      "input": {
        "description": "",
        "maintained_by": "partner_product_backend_1",
        "prefix": "/test",
        "priority": 100,
        "rule_name": "/test"
      },
      "output": {
        "attempts": 1,
        "timeout_ms": 100,
        "tvm_service": "mock",
        "upstream": "http://example.com"
      },
      "proxy": {
        "auth_type": "session_id",
        "proxy_401": false
      },
      "rule_type": "pro-web-authproxy"
    }
  },
  {
    "meta": {
      "input_urls": [
        {
          "url": "https://pro-web-authproxy.taxi.yandex.net/test401"
        }
      ],
      "upstream_url": {
        "url": "http://example.com/test401"
      },
      "variants": [
        {
          "description": "Запрос со стороны браузера (обычно JS)",
          "input_data": {
            "parameters": [
              {
                "description": "User-Agent",
                "example-value": "yandex-taxi/4.36.0.dev_denistimoshin_ Android/9 (Xiaomi; Redmi Note 7)",
                "name": "User-Agent",
                "required": true,
                "type": "header"
              },
              {
                "description": "Сессия браузера.\n",
                "example-value": "3:1622106996.5.0.1622106996604:GiiVVxWBABINVALIDAYCKg:9.1|4053884789.0.2|348276.52732.yl_vdokwSOMESOMESOMEe9efbJE",
                "name": "Session_id",
                "required": true,
                "type": "cookie"
              }
            ]
          },
          "name": "Запрос браузера",
          "upstream_data": {
            "parameters": [
              {
                "description": "Локаль пользователя, полученная из HTTP header \"Accept-Langauge\",\nнапример \"ru\" или \"en\".\nРезультат работы функции `http::language::ParseLocale()`.\n",
                "example-value": "ru",
                "name": "X-Request-Language",
                "required": true,
                "type": "header"
              },
              {
                "description": "Регион пользователя, полученный из HTTP header \"Accept-Langauge\",\nнапример \"RU\" или \"US\".\nРезультат работы функции `http::language::ParseRegion()`.\n",
                "example-value": "RU",
                "name": "X-Request-Language-Region",
                "required": true,
                "type": "header"
              },
              {
                "description": "Информация о пользовательском приложении.\nПредставляет из себя список пар ключ=значение,\nразделенных запятыми.\nРезультат работы `ua_parser::DetectApplication()`.\n",
                "example-value": "app_brand=yauber,app_name=mobileweb_uber_kz_android,app_build=release,platform_ver1=9,app_ver1=3,app_ver2=85,app_ver3=1",
                "name": "X-Request-Application",
                "required": true,
                "type": "header"
              },
              {
                "description": "IP-адрес пользовательского приложения/браузера\n(не прокси, а именно приложения).\nТо же самое, что и X-Forwarded-For-Y.\n",
                "example-value": "56.32.44.17",
                "name": "X-Remote-IP",
                "required": true,
                "type": "header"
              },
              {
                "description": "IP-адрес пользовательского приложения/браузера\n(не прокси, а именно приложения).\nТо же самое, что и X-Remote-IP.\n",
                "example-value": "56.32.44.17",
                "name": "X-Forwarded-For-Y",
                "required": true,
                "type": "header"
              },
              {
                "description": "TVM service ticket.",
                "example-value": "3:serv:CBAQ__________9_IgUIlAMQZQ:Dp-l02wKq6RMvh5VMkux17_8ES7EUAsAEvp88BYHzwCYOL6cNKKGHA21BhE5J-ePB6KdNNHpbYE2KqIDY7kssiJ2TDMQ79qlQX8qwLDlVR0QGRMuwt6C2DVhY2V9CbDaamvHTjRozKJMAJd1kX_UFCegkRYdlC-1FN18CozWrJQ",
                "name": "X-Ya-Service-Ticket",
                "required": true,
                "type": "header"
              },
              {
                "description": "Первоначальное значение 'Host' HTTP header.\n",
                "example-value": "example.com",
                "name": "X-Forwarded-Host",
                "required": true,
                "type": "header"
              },
              {
                "description": "[TVM user ticket](https://wiki.yandex-team.ru/taxi/backend/userver/tvm/user/).\nВыписан на имя uid пользователя (default uid в тикете),\nкоторый авторизован проксей.\n",
                "example-value": "3:user:CA0Q__________9_Gg4KAggBEAEg0oXYzAQoAQ:QnebQMbHdRoF04l985knaMHBnhh5SaFE2klzWiZW4f88V2MSzZ7KhIjIewFDe6jSKB1UXY2j0tGkDPZc6_jEdDl8WBOWjKYfie8jvYi_kj5SsJQAoUcNqMzm2b-2O8h__fm79_8s_EIsWjgDssEutAFpuC0IbJFcjtsomhTMl-w",
                "name": "X-Ya-User-Ticket",
                "required": true,
                "type": "header"
              }
            ]
          }
        },
        {
          "description": "Запрос без session/token или неавторизованной session/token.",
          "input_data": {
            "parameters": []
          },
          "name": "Неавторизованный запрос",
          "upstream_data": {
            "parameters": [
              {
                "description": "Локаль пользователя, полученная из HTTP header \"Accept-Langauge\",\nнапример \"ru\" или \"en\".\nРезультат работы функции `http::language::ParseLocale()`.\n",
                "example-value": "ru",
                "name": "X-Request-Language",
                "required": true,
                "type": "header"
              },
              {
                "description": "Регион пользователя, полученный из HTTP header \"Accept-Langauge\",\nнапример \"RU\" или \"US\".\nРезультат работы функции `http::language::ParseRegion()`.\n",
                "example-value": "RU",
                "name": "X-Request-Language-Region",
                "required": true,
                "type": "header"
              },
              {
                "description": "Информация о пользовательском приложении.\nПредставляет из себя список пар ключ=значение,\nразделенных запятыми.\nРезультат работы `ua_parser::DetectApplication()`.\n",
                "example-value": "app_brand=yauber,app_name=mobileweb_uber_kz_android,app_build=release,platform_ver1=9,app_ver1=3,app_ver2=85,app_ver3=1",
                "name": "X-Request-Application",
                "required": true,
                "type": "header"
              },
              {
                "description": "IP-адрес пользовательского приложения/браузера\n(не прокси, а именно приложения).\nТо же самое, что и X-Forwarded-For-Y.\n",
                "example-value": "56.32.44.17",
                "name": "X-Remote-IP",
                "required": true,
                "type": "header"
              },
              {
                "description": "IP-адрес пользовательского приложения/браузера\n(не прокси, а именно приложения).\nТо же самое, что и X-Remote-IP.\n",
                "example-value": "56.32.44.17",
                "name": "X-Forwarded-For-Y",
                "required": true,
                "type": "header"
              },
              {
                "description": "TVM service ticket.",
                "example-value": "3:serv:CBAQ__________9_IgUIlAMQZQ:Dp-l02wKq6RMvh5VMkux17_8ES7EUAsAEvp88BYHzwCYOL6cNKKGHA21BhE5J-ePB6KdNNHpbYE2KqIDY7kssiJ2TDMQ79qlQX8qwLDlVR0QGRMuwt6C2DVhY2V9CbDaamvHTjRozKJMAJd1kX_UFCegkRYdlC-1FN18CozWrJQ",
                "name": "X-Ya-Service-Ticket",
                "required": true,
                "type": "header"
              },
              {
                "description": "Первоначальное значение 'Host' HTTP header.\n",
                "example-value": "example.com",
                "name": "X-Forwarded-Host",
                "required": true,
                "type": "header"
              }
            ]
          }
        }
      ]
    },
    "rule": {
      "input": {
        "description": "",
        "maintained_by": "partner_product_backend_1",
        "prefix": "/test401",
        "priority": 100,
        "rule_name": "/test401"
      },
      "output": {
        "attempts": 1,
        "timeout_ms": 100,
        "tvm_service": "mock",
        "upstream": "http://example.com"
      },
      "proxy": {
        "auth_type": "session_id",
        "proxy_401": true
      },
      "rule_type": "pro-web-authproxy"
    }
  },
  {
    "meta": {
      "input_urls": [
        {
          "url": "https://pro-web-authproxy.taxi.yandex.net/rewritetest"
        }
      ],
      "upstream_url": {
        "url": "http://example.com/rewritten"
      },
      "variants": [
        {
          "description": "Запрос со стороны браузера (обычно JS)",
          "input_data": {
            "parameters": [
              {
                "description": "User-Agent",
                "example-value": "yandex-taxi/4.36.0.dev_denistimoshin_ Android/9 (Xiaomi; Redmi Note 7)",
                "name": "User-Agent",
                "required": true,
                "type": "header"
              },
              {
                "description": "Сессия браузера.\n",
                "example-value": "3:1622106996.5.0.1622106996604:GiiVVxWBABINVALIDAYCKg:9.1|4053884789.0.2|348276.52732.yl_vdokwSOMESOMESOMEe9efbJE",
                "name": "Session_id",
                "required": true,
                "type": "cookie"
              }
            ]
          },
          "name": "Запрос браузера",
          "upstream_data": {
            "parameters": [
              {
                "description": "Локаль пользователя, полученная из HTTP header \"Accept-Langauge\",\nнапример \"ru\" или \"en\".\nРезультат работы функции `http::language::ParseLocale()`.\n",
                "example-value": "ru",
                "name": "X-Request-Language",
                "required": true,
                "type": "header"
              },
              {
                "description": "Регион пользователя, полученный из HTTP header \"Accept-Langauge\",\nнапример \"RU\" или \"US\".\nРезультат работы функции `http::language::ParseRegion()`.\n",
                "example-value": "RU",
                "name": "X-Request-Language-Region",
                "required": true,
                "type": "header"
              },
              {
                "description": "Информация о пользовательском приложении.\nПредставляет из себя список пар ключ=значение,\nразделенных запятыми.\nРезультат работы `ua_parser::DetectApplication()`.\n",
                "example-value": "app_brand=yauber,app_name=mobileweb_uber_kz_android,app_build=release,platform_ver1=9,app_ver1=3,app_ver2=85,app_ver3=1",
                "name": "X-Request-Application",
                "required": true,
                "type": "header"
              },
              {
                "description": "IP-адрес пользовательского приложения/браузера\n(не прокси, а именно приложения).\nТо же самое, что и X-Forwarded-For-Y.\n",
                "example-value": "56.32.44.17",
                "name": "X-Remote-IP",
                "required": true,
                "type": "header"
              },
              {
                "description": "IP-адрес пользовательского приложения/браузера\n(не прокси, а именно приложения).\nТо же самое, что и X-Remote-IP.\n",
                "example-value": "56.32.44.17",
                "name": "X-Forwarded-For-Y",
                "required": true,
                "type": "header"
              },
              {
                "description": "TVM service ticket.",
                "example-value": "3:serv:CBAQ__________9_IgUIlAMQZQ:Dp-l02wKq6RMvh5VMkux17_8ES7EUAsAEvp88BYHzwCYOL6cNKKGHA21BhE5J-ePB6KdNNHpbYE2KqIDY7kssiJ2TDMQ79qlQX8qwLDlVR0QGRMuwt6C2DVhY2V9CbDaamvHTjRozKJMAJd1kX_UFCegkRYdlC-1FN18CozWrJQ",
                "name": "X-Ya-Service-Ticket",
                "required": true,
                "type": "header"
              },
              {
                "description": "Первоначальное значение 'Host' HTTP header.\n",
                "example-value": "example.com",
                "name": "X-Forwarded-Host",
                "required": true,
                "type": "header"
              },
              {
                "description": "[TVM user ticket](https://wiki.yandex-team.ru/taxi/backend/userver/tvm/user/).\nВыписан на имя uid пользователя (default uid в тикете),\nкоторый авторизован проксей.\n",
                "example-value": "3:user:CA0Q__________9_Gg4KAggBEAEg0oXYzAQoAQ:QnebQMbHdRoF04l985knaMHBnhh5SaFE2klzWiZW4f88V2MSzZ7KhIjIewFDe6jSKB1UXY2j0tGkDPZc6_jEdDl8WBOWjKYfie8jvYi_kj5SsJQAoUcNqMzm2b-2O8h__fm79_8s_EIsWjgDssEutAFpuC0IbJFcjtsomhTMl-w",
                "name": "X-Ya-User-Ticket",
                "required": true,
                "type": "header"
              }
            ]
          }
        }
      ]
    },
    "rule": {
      "input": {
        "description": "",
        "maintained_by": "partner_product_backend_1",
        "prefix": "/rewritetest",
        "priority": 100,
        "rule_name": "/rewritetest"
      },
      "output": {
        "attempts": 1,
        "rewrite_path_prefix": "/rewritten",
        "timeout_ms": 100,
        "tvm_service": "mock",
        "upstream": "http://example.com"
      },
      "proxy": {
        "auth_type": "session_id",
        "proxy_401": false
      },
      "rule_type": "pro-web-authproxy"
    }
  },
  {
    "meta": {
      "input_urls": [
        {
          "url": "https://pro-web-authproxy.taxi.yandex.net/csrf_token"
        }
      ],
      "upstream_url": {
        "url": "http://nowhere/csrf_token"
      },
      "variants": [
        {
          "description": "Запрос CSRF-токена, который не приводит к обращению в upstream,\nна запрос отвечает сам авторизационный прокси.\nПодробную информацию про режим работы можно найти [на вики](https://wiki.yandex-team.ru/taxi/backend/authproxies/#csrftoken).\nРучка настраивается через [конфиг PRO_WEB_AUTHPROXY_CSRF_TOKEN_SETTINGS](https://tariff-editor.taxi.yandex-team.ru/dev/configs/edit/PRO_WEB_AUTHPROXY_CSRF_TOKEN_SETTINGS).\n",
          "input_data": {
            "parameters": []
          },
          "name": "CSRF Token generator",
          "upstream_data": {
            "parameters": []
          }
        }
      ]
    },
    "rule": {
      "input": {
        "description": "",
        "maintained_by": "partner_product_backend_1",
        "prefix": "/csrf_token",
        "priority": 1200,
        "rule_name": "/csrf_token"
      },
      "output": {
        "attempts": 1,
        "timeout_ms": 100,
        "tvm_service": "mock",
        "upstream": "http://nowhere"
      },
      "proxy": {
        "auth_type": "csrf-token-generator",
        "proxy_401": false
      },
      "rule_type": "pro-web-authproxy"
    }
  }
]
