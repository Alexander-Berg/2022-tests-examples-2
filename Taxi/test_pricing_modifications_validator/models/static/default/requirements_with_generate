IF(B(B(B(B(B(fix,.,F(category)),==,"cargo"),||,B(B(fix,.,F(category)),==,"cargocorp")),||,B(B(fix,.,F(category)),==,"express")),||,B(B(fix,.,F(category)),==,"courier")),GENERATE(L(req,B(B(fix,.,F(requirements)),.,F(simple))),I(meta1=MAP(),simple_cost=0.000000),C(SV(rprice,T(B(GV(req),in,B(B(fix,.,F(tariff)),.,F(requirement_prices))),B(B(B(fix,.,F(tariff)),.,F(requirement_prices)),.,GV(req)),0.000000));SV(cmeta,MAP(B(B("req:",+,GV(req)),+,":count")=1.000000,B(B("req:",+,GV(req)),+,":per_unit")=B(VA(rprice),round_to,B(fix,.,F(rounding_factor))),B(B("req:",+,GV(req)),+,":price")=B(VA(rprice),round_to,B(fix,.,F(rounding_factor)))))),U(meta1=B(GV(meta1),+,VA(cmeta)),simple_cost=B(GV(simple_cost),+,VA(rprice))));GENERATE(L(req,B(B(fix,.,F(requirements)),.,F(select))),I(meta2=MAP(),select_cost=0.000000),C(SV(rname,B(GV(req),.,F(first)));GENERATE(L(opt,B(GV(req),.,F(second))),I(imeta=MAP(),options_cost=0.000000),C(SV(fullname,B(B(VA(rname),+,"."),+,B(GV(opt),.,F(name))));SV(oname,T(B(GV(opt),.,F(independent)),VA(fullname),VA(rname)));SV(ocost,T(B(VA(oname),in,B(B(fix,.,F(tariff)),.,F(requirement_prices))),B(B(B(fix,.,F(tariff)),.,F(requirement_prices)),.,VA(oname)),0.000000));GENERATE(L(opt2,B(GV(req),.,F(second))),I(opt_count=0.000000),C(),U(opt_count=B(GV(opt_count),+,T(B(B(GV(opt),.,F(name)),==,B(GV(opt2),.,F(name))),1.000000,0.000000))));SV(cmeta,MAP(B(B("req:",+,VA(fullname)),+,":count")=GV(opt_count),B(B("req:",+,VA(fullname)),+,":per_unit")=B(VA(ocost),round_to,B(fix,.,F(rounding_factor))),B(B("req:",+,VA(fullname)),+,":price")=B(B(GV(opt_count),*,VA(ocost)),round_to,B(fix,.,F(rounding_factor)))))),U(imeta=B(GV(imeta),+,VA(cmeta)),options_cost=B(GV(options_cost),+,VA(ocost))))),U(meta2=B(GV(meta2),+,GV(imeta)),select_cost=B(GV(select_cost),+,T(B(VA(rname),!=,"hourly_rental"),GV(options_cost),0.000000))));CR(metadata=B(GV(meta1),+,GV(meta2)),requirements=B(B(B(B(ride,.,F(price)),.,F(requirements)),+,GV(simple_cost)),+,GV(select_cost))),GENERATE(L(req,B(B(fix,.,F(requirements)),.,F(simple))),I(meta1=MAP(),simple_cost=0.000000),C(SV(rprice,T(B(GV(req),in,B(B(fix,.,F(tariff)),.,F(requirement_prices))),B(B(B(fix,.,F(tariff)),.,F(requirement_prices)),.,GV(req)),0.000000));SV(cmeta,MAP(B(B("req:",+,GV(req)),+,":count")=1.000000,B(B("req:",+,GV(req)),+,":per_unit")=B(VA(rprice),round_to,B(fix,.,F(rounding_factor))),B(B("req:",+,GV(req)),+,":price")=B(VA(rprice),round_to,B(fix,.,F(rounding_factor)))))),U(meta1=B(GV(meta1),+,VA(cmeta)),simple_cost=B(GV(simple_cost),+,VA(rprice))));GENERATE(L(req,B(B(fix,.,F(requirements)),.,F(select))),I(meta2=MAP(),select_cost=0.000000),C(SV(rname,B(GV(req),.,F(first)));GENERATE(L(opt,B(GV(req),.,F(second))),I(included_most_expensive="<none>",included_most_expensive_cost=0.000000,meta3=MAP(),options_cost=0.000000),C(SV(fullname,B(B(VA(rname),+,"."),+,B(GV(opt),.,F(name))));SV(oname,T(B(GV(opt),.,F(independent)),VA(fullname),VA(rname)));SV(ocost,T(B(VA(oname),in,B(B(fix,.,F(tariff)),.,F(requirement_prices))),B(B(B(fix,.,F(tariff)),.,F(requirement_prices)),.,VA(oname)),0.000000));SV(ocost_if_included,T(U(?,B(B(fix,.,F(tariff)),.,F(requirements_included_one_of))),T(B(VA(oname),in,U(*,B(B(fix,.,F(tariff)),.,F(requirements_included_one_of)))),VA(ocost),0.000000),0.000000));GENERATE(L(opt2,B(GV(req),.,F(second))),I(opt_count=0.000000),C(),U(opt_count=B(GV(opt_count),+,T(B(B(GV(opt),.,F(name)),==,B(GV(opt2),.,F(name))),1.000000,0.000000))));SV(cmeta,MAP(B(B("req:",+,VA(fullname)),+,":count")=GV(opt_count),B(B("req:",+,VA(fullname)),+,":per_unit")=B(VA(ocost),round_to,B(fix,.,F(rounding_factor))),B(B("req:",+,VA(fullname)),+,":price")=B(VA(ocost),round_to,B(fix,.,F(rounding_factor)))))),U(included_most_expensive=T(B(VA(ocost_if_included),>,GV(included_most_expensive_cost)),VA(fullname),GV(included_most_expensive)),included_most_expensive_cost=T(B(VA(ocost_if_included),>,GV(included_most_expensive_cost)),VA(ocost_if_included),GV(included_most_expensive_cost)),meta3=B(GV(meta3),+,VA(cmeta)),options_cost=B(GV(options_cost),+,VA(ocost))));SV(cmeta,T(B(GV(included_most_expensive),!=,"<none>"),MAP(B(B("req:",+,GV(included_most_expensive)),+,":included")=1.000000),MAP()))),U(meta2=B(B(GV(meta2),+,GV(meta3)),+,VA(cmeta)),select_cost=B(GV(select_cost),+,T(B(VA(rname),!=,"hourly_rental"),B(GV(options_cost),-,GV(included_most_expensive_cost)),0.000000))));CR(metadata=B(GV(meta1),+,GV(meta2)),requirements=B(B(B(B(ride,.,F(price)),.,F(requirements)),+,GV(simple_cost)),+,GV(select_cost))))
