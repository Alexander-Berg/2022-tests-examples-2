FUNC(getMainValueFromExperiment,ARGS((exp,std::unordered_map<std::string,lang::variables::ExperimentSubValue>)),B(CR(val=SL(2,16,2,72,T(SL(2,17,2,30,B("main",in,FA(exp,std::unordered_map<std::string,lang::variables::ExperimentSubValue>))),SL(2,34,2,69,T(U(?,SL(2,35,2,51,B(B(FA(exp,std::unordered_map<std::string,lang::variables::ExperimentSubValue>),.,SL(2,39,2,45,"main")),.,F(val)))),SL(2,61,2,65,U(*,B(B(FA(exp,std::unordered_map<std::string,lang::variables::ExperimentSubValue>),.,SL(2,39,2,45,"main")),.,F(val)))),SL(2,67,2,69,0.000000))),SL(2,71,2,72,0.000000))))));FUNC(calcCashbackPrice,ARGS((cashback_rate,double)),B(SV(cashback_price,SL(6,23,6,50,B(U(*,B(ride,.,F(price))),*,FA(cashback_rate,double))));SV(round_cashback_price,SL(7,29,7,74,B(VA(cashback_price),round_to,B(fix,.,F(rounding_factor)))));CR(res=SL(8,16,8,36,VA(round_cashback_price)))));FUNC(processCashbackTags,ARGS((elem,std::string),(enabled,bool),(has_result,bool),(rate,double)),B(IF(SL(12,6,12,16,FA(has_result,bool)),CR(enabled=SL(15,16,15,23,FA(enabled,bool)),has_result=SL(14,19,14,29,FA(has_result,bool)),rate=SL(16,13,17,4,FA(rate,double))));IF(SL(20,6,20,48,B("pricing_personal_goals_rates",in,B(fix,.,F(exps)))),SV(exp,SL(21,14,21,54,B(B(fix,.,F(exps)),.,SL(21,23,21,53,"pricing_personal_goals_rates"))));IF(SL(22,8,22,19,B(FA(elem,std::string),in,VA(exp))),SV(category,SL(23,21,23,54,T(U(?,SL(23,22,23,36,B(B(VA(exp),.,SL(23,26,23,30,FA(elem,std::string))),.,F(str)))),SL(23,46,23,50,U(*,B(B(VA(exp),.,SL(23,26,23,30,FA(elem,std::string))),.,F(str)))),SL(23,52,23,54,""))));IF(SL(24,10,24,34,B(VA(category),==,B(fix,.,F(category)))),CR(enabled=SL(27,20,27,24,true),has_result=SL(26,23,26,27,true),rate=SL(28,17,29,8,T(U(?,SL(28,18,28,32,B(B(VA(exp),.,SL(28,22,28,26,FA(elem,std::string))),.,F(val)))),SL(28,42,28,46,U(*,B(B(VA(exp),.,SL(28,22,28,26,FA(elem,std::string))),.,F(val)))),SL(28,48,29,8,0.000000)))))));CR(enabled=SL(36,14,36,21,FA(enabled,bool)),has_result=SL(35,17,35,27,FA(has_result,bool)),rate=SL(37,11,38,2,FA(rate,double)))));FUNC(getPersonalGoalsCashbackRate,ARGS(),B(SV(rate,SL(42,13,46,4,FL(SL(42,18,42,32,B(fix,.,F(user_tags))),elem,NT(enabled=SL(44,16,44,21,false),has_result=SL(43,19,43,24,false),rate=SL(45,13,46,2,0.000000)),FC(processCashbackTags,NT(elem=VA(elem),enabled=VA(enabled),has_result=VA(has_result),rate=VA(rate)),R(enabled=bool,has_result=bool,rate=double)))));IF(SL(48,6,48,65,B(B(B(fix,.,F(user_data)),.,F(has_yaplus)),&&,B(B(fix,.,F(user_data)),.,F(has_cashback_plus)))),CR(enabled=SL(49,20,49,32,B(VA(rate),.,F(enabled))),rate=SL(49,39,49,54,B(B(VA(rate),.,F(rate)),/,0.900000))));CR(enabled=SL(51,18,51,30,B(VA(rate),.,F(enabled))),rate=SL(51,37,51,46,B(VA(rate),.,F(rate))))));FUNC(getMarketingCashbackRate,ARGS(),B(SV(marketing_cashback_business,SL(56,36,56,77,B("marketing_cashback_business",in,B(fix,.,F(exps)))));IF(SL(57,6,57,34,U(!,VA(marketing_cashback_business))),CR(rate=SL(58,17,58,20,0.000000)));IF(SL(62,6,62,65,B(B(B(fix,.,F(category)),!=,"business"),&&,B(B(fix,.,F(category)),!=,"comfortplus"))),CR(rate=SL(63,17,63,20,0.000000)));IF(SL(67,6,67,30,B(B(fix,.,F(user_data)),.,F(has_yaplus))),CR(rate=SL(68,17,68,20,0.000000)));SV(rate,SL(71,13,71,88,B(FC(getMainValueFromExperiment,NT(exp=SL(71,44,71,83,B(B(fix,.,F(exps)),.,SL(71,53,71,82,"marketing_cashback_business")))),R(val=double)),.,F(val))));CR(rate=SL(72,15,72,19,VA(rate)))));IF(SL(76,4,76,29,B(B(fix,.,F(country_code2)),!=,"RU")),CR(boarding=B(SL(77,9,77,19,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(77,9,77,19,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(77,9,77,19,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(77,9,77,19,B(ride,.,F(price))),.,F(requirements)),time=B(SL(77,9,77,19,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(77,9,77,19,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(77,9,77,19,B(ride,.,F(price))),.,F(waiting))));IF(U(?,SL(81,4,81,20,B(fix,.,F(complements)))),CR(boarding=B(SL(82,9,82,19,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(82,9,82,19,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(82,9,82,19,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(82,9,82,19,B(ride,.,F(price))),.,F(requirements)),time=B(SL(82,9,82,19,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(82,9,82,19,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(82,9,82,19,B(ride,.,F(price))),.,F(waiting))));IF(U(?,SL(86,3,86,20,B(fix,.,F(payment_type)))),IF(SL(89,6,91,31,B(B(B(U(*,B(fix,.,F(payment_type))),!=,"card"),&&,B(U(*,B(fix,.,F(payment_type))),!=,"applepay")),&&,B(U(*,B(fix,.,F(payment_type))),!=,"googlepay"))),CR(boarding=B(SL(92,13,92,23,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(92,13,92,23,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(92,13,92,23,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(92,13,92,23,B(ride,.,F(price))),.,F(requirements)),time=B(SL(92,13,92,23,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(92,13,92,23,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(92,13,92,23,B(ride,.,F(price))),.,F(waiting)))));SV(personalGoalsCashback,SL(97,28,97,58,FC(getPersonalGoalsCashbackRate,NT(),R(enabled=bool,rate=double))));SV(marketingCashback,SL(98,24,98,50,FC(getMarketingCashbackRate,NT(),R(rate=double))));SV(rate,SL(99,11,99,62,B(B(VA(marketingCashback),.,F(rate)),+,B(VA(personalGoalsCashback),.,F(rate)))));SV(price,SL(100,12,100,53,B(FC(calcCashbackPrice,NT(cashback_rate=SL(100,44,100,48,VA(rate))),R(res=double)),.,F(res))));IF(SL(101,4,101,39,B(B(VA(rate),>,0.000001),&&,B(VA(price),>,0.000001))),SV(meta,SL(102,15,105,5,MAP("cashback_rate"=VA(rate),"cashback_discount_fixed_value"=VA(price))));SV(meta2,SL(106,16,107,70,T(SL(106,17,106,54,B(B(VA(personalGoalsCashback),.,F(rate)),>,0.000001)),SL(107,6,107,65,MAP("-debug--personal-goals-rate"=B(VA(personalGoalsCashback),.,F(rate)))),SL(107,68,107,70,MAP()))));SV(meta3,SL(108,16,109,71,T(SL(108,17,108,50,B(B(VA(marketingCashback),.,F(rate)),>,0.000001)),SL(109,6,109,66,MAP("marketing_cashback_business_rate"=B(VA(marketingCashback),.,F(rate)))),SL(109,69,109,71,MAP()))));CR(metadata=SL(111,22,111,43,B(B(VA(meta),+,VA(meta2)),+,VA(meta3)))));CR(boarding=B(SL(114,7,114,17,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(114,7,114,17,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(114,7,114,17,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(114,7,114,17,B(ride,.,F(price))),.,F(requirements)),time=B(SL(114,7,114,17,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(114,7,114,17,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(114,7,114,17,B(ride,.,F(price))),.,F(waiting)))
