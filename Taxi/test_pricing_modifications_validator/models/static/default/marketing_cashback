FUNC(getMinimalPrimaryPayment,ARGS(),B(SV(minimal_primary_sum_exp,SL(6,32,6,83,B("composite_payment_minimal_primary_sum",in,B(fix,.,F(exps)))));IF(SL(7,6,7,30,U(!,VA(minimal_primary_sum_exp))),CR(res=SL(8,20,8,21,0.000000)));CR(res=SL(11,16,11,35,B(fix,.,F(rounding_factor))))));FUNC(max,ARGS((a,double),(b,double)),B(CR(res=SL(15,16,15,31,T(SL(15,17,15,22,B(FA(a,double),>,FA(b,double))),SL(15,26,15,28,FA(a,double)),SL(15,30,15,31,FA(b,double)))))));FUNC(min,ARGS((a,double),(b,double)),B(CR(res=SL(19,16,19,31,T(SL(19,17,19,22,B(FA(a,double),<,FA(b,double))),SL(19,26,19,28,FA(a,double)),SL(19,30,19,31,FA(b,double)))))));FUNC(getComposite,ARGS(),B(IF(U(?,SL(23,6,23,22,B(fix,.,F(complements)))),IF(U(?,SL(24,8,24,36,B(U(*,B(fix,.,F(complements))),.,F(personal_wallet)))),SV(min_primary_payment,SL(25,32,25,62,B(FC(getMinimalPrimaryPayment,NT(),R(res=double)),.,F(res))));SV(display_price,SL(27,26,27,81,B(FC(max,NT(a=SL(27,32,27,71,B(U(*,B(ride,.,F(price))),-,B(U(*,B(U(*,B(fix,.,F(complements))),.,F(personal_wallet))),.,F(balance)))),b=SL(27,75,27,76,0.000000)),R(res=double)),.,F(res))));SV(display_price_rounded,SL(28,34,28,78,B(VA(display_price),round_to,B(fix,.,F(rounding_factor)))));SV(display_price_rounded_checked,SL(29,42,29,101,B(FC(max,NT(a=SL(29,50,29,71,VA(display_price_rounded)),b=SL(29,77,29,96,VA(min_primary_payment))),R(res=double)),.,F(res))));CR(enabled=SL(31,22,31,26,true),paid_by_card=SL(32,27,32,56,VA(display_price_rounded_checked)))));CR(enabled=SL(35,18,35,23,false),paid_by_card=SL(36,23,36,24,0.000000))));FUNC(processRate,ARGS((cashback_fix,double),(elem,lang::variables::CashbackRate),(meta,std::unordered_map<std::string,double>),(price,double)),B(SV(cashback_price,SL(40,25,42,25,T(SL(40,26,40,64,B(FA(price,double),>,B(FC(getMinimalPrimaryPayment,NT(),R(res=double)),.,F(res)))),SL(41,24,42,22,B(FA(price,double),*,B(FA(elem,lang::variables::CashbackRate),.,F(rate)))),SL(42,24,42,25,0.000000))));SV(limited_cashback,SL(44,27,46,37,T(U(?,SL(44,28,44,43,B(FA(elem,lang::variables::CashbackRate),.,F(max_value)))),SL(45,23,46,21,B(FC(min,NT(a=SL(45,31,45,40,U(*,B(FA(elem,lang::variables::CashbackRate),.,F(max_value)))),b=SL(45,46,45,60,VA(cashback_price))),R(res=double)),.,F(res))),SL(46,23,46,37,VA(cashback_price)))));SV(round_cashback_price,SL(48,31,48,78,B(VA(limited_cashback),round_to,B(fix,.,F(rounding_factor)))));SV(cmeta,SL(50,16,53,5,MAP(B(B("marketing_cashback:",+,B(FA(elem,lang::variables::CashbackRate),.,F(sponsor))),+,":rate")=B(FA(elem,lang::variables::CashbackRate),.,F(rate)),B(B("marketing_cashback:",+,B(FA(elem,lang::variables::CashbackRate),.,F(sponsor))),+,":fix")=VA(round_cashback_price))));SV(meta2,SL(55,16,56,75,T(U(?,SL(55,17,55,32,B(FA(elem,lang::variables::CashbackRate),.,F(max_value)))),SL(56,6,56,70,MAP(B(B("marketing_cashback:",+,B(FA(elem,lang::variables::CashbackRate),.,F(sponsor))),+,":max_value")=U(*,B(FA(elem,lang::variables::CashbackRate),.,F(max_value))))),SL(56,73,56,75,MAP()))));CR(cashback_fix=SL(59,21,59,56,B(FA(cashback_fix,double),+,VA(round_cashback_price))),meta=SL(61,13,62,4,B(B(FA(meta,std::unordered_map<std::string,double>),+,VA(cmeta)),+,VA(meta2))),price=SL(60,12,60,17,FA(price,double)))));SV(composite,SL(65,16,65,30,FC(getComposite,NT(),R(enabled=bool,paid_by_card=double))));SV(rounded_total_price,SL(66,26,66,68,B(U(*,B(ride,.,F(price))),round_to,B(fix,.,F(rounding_factor)))));SV(rounded_base_price,SL(67,25,69,41,T(SL(67,26,67,43,B(VA(composite),.,F(enabled))),SL(68,22,69,20,B(VA(composite),.,F(paid_by_card))),SL(69,22,69,41,VA(rounded_total_price)))));IF(U(?,SL(71,4,71,23,B(fix,.,F(cashback_rates)))),SV(result,SL(72,17,72,111,FL(SL(72,22,72,37,U(*,B(fix,.,F(cashback_rates)))),elem,NT(cashback_fix=SL(72,73,72,74,0.000000),meta=SL(72,107,72,109,MAP()),price=SL(72,82,72,100,VA(rounded_base_price))),FC(processRate,NT(cashback_fix=VA(cashback_fix),elem=VA(elem),meta=VA(meta),price=VA(price)),R(cashback_fix=double,meta=std::unordered_map<std::string,double>,price=double)))));SV(meta2,SL(74,16,76,5,MAP("marketing_cashback:fix"=B(VA(result),.,F(cashback_fix)))));CR(metadata=SL(79,17,80,4,B(B(VA(result),.,F(meta)),+,VA(meta2)))));CR(boarding=B(SL(83,7,83,17,B(ride,.,F(price))),.,F(boarding)),destination_waiting=B(SL(83,7,83,17,B(ride,.,F(price))),.,F(destination_waiting)),distance=B(SL(83,7,83,17,B(ride,.,F(price))),.,F(distance)),requirements=B(SL(83,7,83,17,B(ride,.,F(price))),.,F(requirements)),time=B(SL(83,7,83,17,B(ride,.,F(price))),.,F(time)),transit_waiting=B(SL(83,7,83,17,B(ride,.,F(price))),.,F(transit_waiting)),waiting=B(SL(83,7,83,17,B(ride,.,F(price))),.,F(waiting)))
