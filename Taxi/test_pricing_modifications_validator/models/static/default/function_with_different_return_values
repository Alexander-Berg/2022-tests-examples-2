FUNC(getExperimentParams,ARGS(),B(SV(exp_name,"high_tariffs_discount");IF(B(B(B(B(VA(exp_name),in,B(fix,.,F(exps))),&&,B("discount_percent",in,B(B(fix,.,F(exps)),.,VA(exp_name)))),&&,B("min_absolute_discount",in,B(B(fix,.,F(exps)),.,VA(exp_name)))),&&,B("min_category_delta_coeff",in,B(B(fix,.,F(exps)),.,VA(exp_name)))),IF(U(?,B(B(B(B(fix,.,F(exps)),.,VA(exp_name)),.,"discount_percent"),.,F(val))),IF(U(?,B(B(B(B(fix,.,F(exps)),.,VA(exp_name)),.,"min_absolute_discount"),.,F(val))),IF(U(?,B(B(B(B(fix,.,F(exps)),.,VA(exp_name)),.,"min_category_delta_coeff"),.,F(val))),CR(discount_coeff=B(U(*,B(B(B(B(fix,.,F(exps)),.,VA(exp_name)),.,"discount_percent"),.,F(val))),/,100.000000),found=true,min_absolute_discount=U(*,B(B(B(B(fix,.,F(exps)),.,VA(exp_name)),.,"min_absolute_discount"),.,F(val))),min_category_delta_coeff=U(*,B(B(B(B(fix,.,F(exps)),.,VA(exp_name)),.,"min_category_delta_coeff"),.,F(val))))))));CR(discount_percent=0.000000,found=false,min_absolute_discount=0.000000,min_category_delta_coeff=1.000000)));IF(B(B(fix,.,F(user_data)),.,F(has_yaplus)),CR(boarding=B(B(ride,.,F(price)),.,F(boarding)),destination_waiting=B(B(ride,.,F(price)),.,F(destination_waiting)),distance=B(B(ride,.,F(price)),.,F(distance)),requirements=B(B(ride,.,F(price)),.,F(requirements)),time=B(B(ride,.,F(price)),.,F(time)),transit_waiting=B(B(ride,.,F(price)),.,F(transit_waiting)),waiting=B(B(ride,.,F(price)),.,F(waiting))));IF(U(?,B(fix,.,F(payment_type))),IF(B(U(*,B(fix,.,F(payment_type))),==,"corp"),CR(boarding=B(B(ride,.,F(price)),.,F(boarding)),destination_waiting=B(B(ride,.,F(price)),.,F(destination_waiting)),distance=B(B(ride,.,F(price)),.,F(distance)),requirements=B(B(ride,.,F(price)),.,F(requirements)),time=B(B(ride,.,F(price)),.,F(time)),transit_waiting=B(B(ride,.,F(price)),.,F(transit_waiting)),waiting=B(B(ride,.,F(price)),.,F(waiting)))));SV(current_price_ww,B(B(B(B(B(ride,.,F(price)),.,F(boarding)),+,B(B(ride,.,F(price)),.,F(distance))),+,B(B(ride,.,F(price)),.,F(time))),+,B(B(ride,.,F(price)),.,F(requirements))));IF(B(B(fix,.,F(category)),==,"econom"),CR(metadata=MAP("price_ww_at_driver_funded_discount_stage"=VA(current_price_ww))));IF(B(B(fix,.,F(category)),!=,"business"),CR(boarding=B(B(ride,.,F(price)),.,F(boarding)),destination_waiting=B(B(ride,.,F(price)),.,F(destination_waiting)),distance=B(B(ride,.,F(price)),.,F(distance)),requirements=B(B(ride,.,F(price)),.,F(requirements)),time=B(B(ride,.,F(price)),.,F(time)),transit_waiting=B(B(ride,.,F(price)),.,F(transit_waiting)),waiting=B(B(ride,.,F(price)),.,F(waiting))));IF(U(?,B(fix,.,F(previously_calculated_categories))),IF(B(B("econom",in,U(*,B(fix,.,F(previously_calculated_categories)))),&&,B("business",in,U(*,B(fix,.,F(previously_calculated_categories))))),SV(econom_meta,B(B(B(B(B(U(*,B(fix,.,F(previously_calculated_categories))),.,"econom"),.,F(user)),.,F(final_prices)),.,"main"),.,F(meta)));SV(prev_calc_meta,B(B(B(B(B(U(*,B(fix,.,F(previously_calculated_categories))),.,"business"),.,F(user)),.,F(final_prices)),.,"main"),.,F(meta)));IF(B(B("discount_delta_raw",in,VA(prev_calc_meta)),&&,B(B(B(VA(prev_calc_meta),.,"discount_delta_raw"),>,0.000000),||,B(B(VA(prev_calc_meta),.,"discount_delta_raw"),<,0.000000))),CR(boarding=B(B(ride,.,F(price)),.,F(boarding)),destination_waiting=B(B(ride,.,F(price)),.,F(destination_waiting)),distance=B(B(ride,.,F(price)),.,F(distance)),requirements=B(B(ride,.,F(price)),.,F(requirements)),time=B(B(ride,.,F(price)),.,F(time)),transit_waiting=B(B(ride,.,F(price)),.,F(transit_waiting)),waiting=B(B(ride,.,F(price)),.,F(waiting))));IF(B("price_ww_at_driver_funded_discount_stage",in,VA(econom_meta)),SV(econom_price_ww,B(VA(econom_meta),.,"price_ww_at_driver_funded_discount_stage"));SV(params,FC(getExperimentParams,NT(),R(discount_coeff=std::optional<double>,discount_percent=std::optional<double>,found=bool,min_absolute_discount=double,min_category_delta_coeff=double)));IF(U(!,B(VA(params),.,F(found))),CR(boarding=B(B(ride,.,F(price)),.,F(boarding)),destination_waiting=B(B(ride,.,F(price)),.,F(destination_waiting)),distance=B(B(ride,.,F(price)),.,F(distance)),requirements=B(B(ride,.,F(price)),.,F(requirements)),time=B(B(ride,.,F(price)),.,F(time)),transit_waiting=B(B(ride,.,F(price)),.,F(transit_waiting)),waiting=B(B(ride,.,F(price)),.,F(waiting))));SV(min_possible_price_ww,B(VA(econom_price_ww),*,B(VA(params),.,F(min_category_delta_coeff))));CR(metadata=MAP("test"=1.000000)))));CR(boarding=B(B(ride,.,F(price)),.,F(boarding)),destination_waiting=B(B(ride,.,F(price)),.,F(destination_waiting)),distance=B(B(ride,.,F(price)),.,F(distance)),requirements=B(B(ride,.,F(price)),.,F(requirements)),time=B(B(ride,.,F(price)),.,F(time)),transit_waiting=B(B(ride,.,F(price)),.,F(transit_waiting)),waiting=B(B(ride,.,F(price)),.,F(waiting)))
