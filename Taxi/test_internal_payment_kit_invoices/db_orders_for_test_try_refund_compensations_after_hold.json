[
  {
    "_id": "some_no_transactions_order_id",
    "billing_tech": {
      "compensations": [],
      "transactions": []
    },
    "invoice": {}
  },
  {
    "_id": "some_hold_fail_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/abc",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_fail",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "some_hold_fail_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "id": "compensation/create/abc"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        }
      ]
    }
  },
  {
    "_id": "some_personal_wallet_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/abc",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "personal_wallet",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "some_personal_wallet_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "id": "compensation/create/abc"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        }
      ]
    }
  },
  {
    "_id": "some_first_refund_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "1998-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/def",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_old_trust_payment_id"
        },
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/ghi",
          "status": "compensation_success",
          "sum": {
            "ride": 1
          },
          "trust_payment_id": "some_very_small_trust_payment_id"
        },
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/abc",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "some_first_refund_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "id": "compensation/create/def"
        },
        {
          "id": "compensation/create/ghi"
        },
        {
          "id": "compensation/create/abc"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        }
      ]
    }
  },
  {
    "_id": "too_many_operations_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "1998-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/def",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_old_trust_payment_id"
        },
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/ghi",
          "status": "compensation_success",
          "sum": {
            "ride": 1
          },
          "trust_payment_id": "some_very_small_trust_payment_id"
        },
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/abc",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "max_invoice_compensation_operations": 0,
      "transactions": [
        {
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "too_many_operations_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "id": "compensation/create/def"
        },
        {
          "id": "compensation/create/ghi"
        },
        {
          "id": "compensation/create/abc"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        }
      ]
    }
  },
  {
    "_id": "some_independent_compensation_py2_order_id",
    "billing_tech": {
      "compensations": [
        {
          "compensation_made_at": "2020-03-01T00:00",
          "created": {
            "$date": "2020-01-01T00:00:00.0"
          },
          "refunds": [],
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "created": {
            "$date": "2020-02-01T00:00:00.0"
          },
          "holded": {
            "$date": "2020-02-01T00:00:00.0"
          },
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "compensation": {
        "operations": [],
        "version": 4
      },
      "id": "some_independent_compensation_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        }
      ]
    }
  },
  {
    "_id": "some_independent_compensation_order_id",
    "billing_tech": {
      "compensations": [
        {
          "compensation_made_at": {
            "$date": "1998-01-01T00:00:00.0"
          },
          "created": {
            "$date": "1998-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/def",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_old_trust_payment_id"
        },
        {
          "compensation_made_at": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/ghi",
          "status": "compensation_success",
          "sum": {
            "ride": 1
          },
          "trust_payment_id": "some_very_small_trust_payment_id"
        },
        {
          "compensation_made_at": {
            "$date": "2020-01-01T00:00:00.0"
          },
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/abc",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "holded": {
            "$date": "2020-02-01T00:00:00.0"
          },
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "compensation": {
        "operations": [
          {
            "created": "2020-01-01T00:00:00.0",
            "id": "compensation/create/abc",
            "status": "done"
          }
        ],
        "version": 4
      },
      "id": "some_independent_compensation_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "created": "2020-01-01T00:00:00.0",
          "id": "compensation/create/def"
        },
        {
          "created": "2020-01-01T00:00:00.0",
          "id": "compensation/create/ghi"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        }
      ]
    }
  },
  {
    "_id": "some_later_independent_compensation_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "1998-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/def",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_old_trust_payment_id"
        },
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/ghi",
          "status": "compensation_success",
          "sum": {
            "ride": 1
          },
          "trust_payment_id": "some_very_small_trust_payment_id"
        },
        {
          "compensation_made_at": {
            "$date": "2020-03-01T00:00:00.0"
          },
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/abc",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "holded": {
            "$date": "2020-02-01T00:00:00.0"
          },
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "compensation": {
        "operations": [
          {
            "created": "2020-03-01T00:00:00.0",
            "id": "compensation/create/abc",
            "status": "done"
          }
        ],
        "version": 4
      },
      "id": "some_later_independent_compensation_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "created": "2020-01-01T00:00:00.0",
          "id": "compensation/create/def"
        },
        {
          "created": "2020-01-01T00:00:00.0",
          "id": "compensation/create/ghi"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        }
      ]
    }
  },
  {
    "_id": "some_transactions_after_py2_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "new_trust_payment_id"
        },
        {
          "created": {
            "$date": "2000-01-01T00:00:00.0"
          },
          "refunds": [],
          "status": "compensation_success",
          "sum": {
            "ride": 999999
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "created": {
            "$date": "2000-01-01T00:00:01.0"
          },
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "some_transactions_after_py2_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        }
      ]
    }
  },
  {
    "_id": "some_compensation_fail_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/abc",
          "status": "compensation_fail",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "some_compensation_fail_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "id": "compensation/create/abc"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        }
      ]
    }
  },
  {
    "_id": "some_hold_before_compensation_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/abc",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "some_hold_before_compensation_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        },
        {
          "id": "compensation/create/abc"
        }
      ]
    }
  },
  {
    "_id": "some_first_refund_cleared_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/abc",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "clear_100",
          "status": "clear_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "some_first_refund_cleared_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "id": "compensation/create/abc"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "clear_100"
        }
      ]
    }
  },
  {
    "_id": "some_split_refund_first_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/first",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "first_trust_payment_id"
        },
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/second",
          "status": "compensation_success",
          "sum": {
            "ride": 1010000
          },
          "trust_payment_id": "second_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "initial_sum": {
            "ride": 2050000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "some_split_refund_first_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "id": "compensation/create/first"
        },
        {
          "id": "compensation/create/second"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        }
      ]
    }
  },
  {
    "_id": "some_rounding_refund_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [
            {
              "request_id": "compensation/refund/tpi/first_trust_payment_id/1",
              "status": "refund_success",
              "sum": {
                "ride": 1000100
              }
            }
          ],
          "request_id": "compensation/create/first",
          "status": "compensation_success",
          "sum": {
            "ride": 1000099
          },
          "trust_payment_id": "first_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "initial_sum": {
            "ride": 1000099
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "some_rounding_refund_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "id": "compensation/create/first"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        },
        {
          "id": "compensation/refund/tpi/first_trust_payment_id/1"
        }
      ]
    }
  },
  {
    "_id": "some_split_refund_second_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [
            {
              "request_id": "compensation/refund/tpi/first_trust_payment_id/1",
              "status": "refund_success",
              "sum": {
                "ride": 1000000
              }
            }
          ],
          "request_id": "compensation/create/first",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "first_trust_payment_id"
        },
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [],
          "request_id": "compensation/create/second",
          "status": "compensation_success",
          "sum": {
            "ride": 1010000
          },
          "trust_payment_id": "second_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "initial_sum": {
            "ride": 2050000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "some_split_refund_second_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "id": "compensation/create/first"
        },
        {
          "id": "compensation/create/second"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        },
        {
          "id": "compensation/refund/tpi/first_trust_payment_id/1"
        }
      ]
    }
  },
  {
    "_id": "some_pending_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [
            {
              "request_id": "compensation/refund/tpi/some_trust_payment_id/1",
              "status": "refund_fail",
              "sum": {
                "ride": 1000000
              }
            }
          ],
          "request_id": "compensation/create/abc",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "compensation": {
        "operations": [
          {
            "id": "some_compensation_op",
            "status": "init"
          }
        ]
      },
      "id": "some_pending_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "id": "compensation/create/abc"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        },
        {
          "id": "compensation/refund/tpi/some_trust_payment_id/1"
        }
      ]
    }
  },
  {
    "_id": "some_refund_fail_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [
            {
              "request_id": "compensation/refund/tpi/some_trust_payment_id/1",
              "status": "refund_fail",
              "sum": {
                "ride": 1000000
              }
            }
          ],
          "request_id": "compensation/create/abc",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "some_refund_fail_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "id": "compensation/create/abc"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        },
        {
          "id": "compensation/refund/tpi/some_trust_payment_id/1"
        }
      ]
    }
  },
  {
    "_id": "some_same_order_id",
    "billing_tech": {
      "compensations": [
        {
          "created": {
            "$date": "2001-01-01T00:00:00.0"
          },
          "refunds": [
            {
              "request_id": "compensation/refund/tpi/some_trust_payment_id/1",
              "status": "refund_success",
              "sum": {
                "ride": 1000000
              }
            }
          ],
          "request_id": "compensation/create/abc",
          "status": "compensation_success",
          "sum": {
            "ride": 1000000
          },
          "trust_payment_id": "some_trust_payment_id"
        }
      ],
      "transactions": [
        {
          "initial_sum": {
            "ride": 1000000
          },
          "payment_method_type": "card",
          "request_id": "hold_100",
          "status": "hold_success",
          "trust_payment_id": "tpi"
        }
      ]
    },
    "invoice": {
      "id": "some_same_order_id",
      "operation_info": {
        "version": 2
      },
      "operations": [
        {
          "id": "compensation/create/abc"
        },
        {
          "created": "2020-02-01T00:00:00.0",
          "id": "hold_100"
        },
        {
          "id": "compensation/refund/tpi/some_trust_payment_id/1"
        }
      ]
    }
  }
]
