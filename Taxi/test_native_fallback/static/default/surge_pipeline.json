{
  "consumer": "taxi-surge",
  "name": "default",
  "stages": [
    {
      "conditions": [],
      "in_bindings": [
        {
          "domain": "input",
          "query": "request.point_a"
        },
        {
          "domain": "input",
          "query": "layer_meta"
        }
      ],
      "name": "candidates_fetch",
      "resources": [
        {
          "field": "candidates",
          "name": "count_by_categories"
        }
      ],
      "source_code": "return {candidates: {request: {allowed_classes: ['econom'], limit: 400, max_distance: 2500, point: point_a, zone_id: 'moscow'}, layer_meta: layer_meta}};"
    },
    {
      "conditions": [],
      "in_bindings": [
        {
          "domain": "input",
          "query": "request.payment_type"
        },
        {
          "domain": "input",
          "query": "required_categories.*{:category}"
        },
        {
          "domain": "resource",
          "query": "zone.experiment.rules[category]{rules}"
        }
      ],
      "name": "main",
      "out_bindings": [
        {
          "alias": "data",
          "query": "classes[category]"
        }
      ],
      "source_code": "if (payment_type === 'local') { throw 'Local fail'; } if (payment_type === 'local_timeout') { while(true); } return {data: {name: category, value_raw: 1.0, surge: {value: rules && rules.surge_value ? rules.surge_value : 1.0}}};"
    }
  ],
  "state": "active"
}
