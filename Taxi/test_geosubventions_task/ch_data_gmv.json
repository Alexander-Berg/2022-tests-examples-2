[
  {
    "data": [
      [
        6
      ]
    ],
    "query": "SELECT COUNT(*)\nFROM atlas.ods_order FINAL\nWHERE dttm_utc_1_min >= toDateTime('2020-12-15 12:20:47', 'UTC')\nAND dttm_utc_1_min < toDateTime('2020-12-29 12:20:47', 'UTC')\nAND car_class\nin ('econom')\nAND nearest_zone in ('kaluga')\n\n;\n\n"
  },
  {
    "data": [
      [
        [
          36.5,
          54.5,
          1.9,
          "2020-12-28",
          3,
          100.0,
          2.7048528241845666,
          342.0,
          8,
          1,
          1.0,
          97.0,
          36.345089,
          54.551935,
          "kaluga"
        ],
        [
          36.5,
          54.5,
          1.9,
          "2020-12-21",
          3,
          200.0,
          2.7048528241845666,
          342.0,
          8,
          1,
          1.0,
          97.0,
          36.345089,
          54.551935,
          "kaluga"
        ],
        [
          35.5,
          54.5,
          1.9,
          "2020-12-28",
          3,
          101.0,
          2.7048528241845666,
          342.0,
          8,
          1,
          1.0,
          97.0,
          35.5,
          54.5,
          "kaluga"
        ],
        [
          36.33401334674184,
          54.54853691357707,
          1.9,
          "2020-12-28",
          3,
          322.0,
          2.7048528241845666,
          342.0,
          18,
          1,
          1.0,
          97.0,
          36.345089,
          54.551935,
          "kaluga"
        ],
        [
          36.5,
          54.5,
          1.9,
          "2020-12-22",
          3,
          200.0,
          2.7048528241845666,
          342.0,
          14,
          2,
          1.0,
          97.0,
          36.345089,
          54.551935,
          "kaluga"
        ],
        [
          36.5,
          54.5,
          1.9,
          "2020-12-22",
          3,
          202.0,
          2.7048528241845666,
          342.0,
          14,
          2,
          1.0,
          97.0,
          36.345089,
          54.551935,
          "kaluga"
        ],
        [
          36.5,
          54.5,
          1.9,
          "2020-12-28",
          3,
          100.0,
          2.7048528241845666,
          342.0,
          8,
          1,
          1.0,
          97.0,
          36.345089,
          54.551935,
          "moscow"
        ],
        [
          36.5,
          54.5,
          1.9,
          "2020-12-21",
          3,
          200.0,
          2.7048528241845666,
          342.0,
          8,
          1,
          1.0,
          97.0,
          36.345089,
          54.551935,
          "moscow"
        ],
        [
          35.5,
          54.5,
          1.9,
          "2020-12-28",
          3,
          101.0,
          2.7048528241845666,
          342.0,
          8,
          1,
          1.0,
          97.0,
          35.5,
          54.5,
          "moscow"
        ],
        [
          36.33401334674184,
          54.54853691357707,
          1.9,
          "2020-12-28",
          3,
          322.0,
          2.7048528241845666,
          342.0,
          18,
          1,
          1.0,
          97.0,
          36.345089,
          54.551935,
          "moscow"
        ],
        [
          36.5,
          54.5,
          1.9,
          "2020-12-22",
          3,
          200.0,
          2.7048528241845666,
          342.0,
          14,
          2,
          1.0,
          97.0,
          36.345089,
          54.551935,
          "moscow"
        ],
        [
          36.5,
          54.5,
          1.9,
          "2020-12-22",
          3,
          202.0,
          2.7048528241845666,
          342.0,
          14,
          2,
          1.0,
          97.0,
          36.345089,
          54.551935,
          "moscow"
        ],
        [
          23,
          23,
          1.9,
          "2020-12-21",
          3,
          500.0,
          2.7048528241845666,
          342.0,
          19,
          3,
          1.0,
          97.0,
          23,
          23,
          "kaluga"
        ],
        [
          23,
          23,
          1.9,
          "2020-12-21",
          3,
          500.0,
          2.7048528241845666,
          342.0,
          19,
          3,
          1.0,
          97.0,
          23,
          23,
          "kaluga"
        ],
        [
          23,
          23,
          1.9,
          "2020-12-21",
          3,
          1.0,
          2.7048528241845666,
          342.0,
          17,
          3,
          1.0,
          97.0,
          23,
          23,
          "kaluga"
        ],
        [
          23,
          23,
          1.9,
          "2020-12-21",
          3,
          2.0,
          2.7048528241845666,
          342.0,
          17,
          3,
          1,
          97.0,
          23,
          23,
          "kaluga"
        ],
        [
          23,
          23,
          1.9,
          "2020-12-21",
          3,
          3.0,
          2.7048528241845666,
          342.0,
          17,
          3,
          1,
          97.0,
          23,
          23,
          "kaluga"
        ],
        [
          23,
          23,
          1.9,
          "2020-12-21",
          3,
          4.0,
          2.7048528241845666,
          342.0,
          17,
          3,
          1,
          97.0,
          23,
          23,
          "kaluga"
        ],
        [
          23,
          23,
          1.9,
          "2020-12-21",
          3,
          5.0,
          2.7048528241845666,
          342.0,
          17,
          3,
          1,
          97.0,
          23,
          23,
          "kaluga"
        ]
      ],
      [
        [
          "order_source_lon"
        ],
        [
          "order_source_lat"
        ],
        [
          "surge_value"
        ],
        [
          "local_dt"
        ],
        [
          "ten_minutes"
        ],
        [
          "order_cost"
        ],
        [
          "cost_weight"
        ],
        [
          "order_cost_before_surge"
        ],
        [
          "hour"
        ],
        [
          "dow"
        ],
        [
          "subv_flag"
        ],
        [
          "driver_points"
        ],
        [
          "driver_lon"
        ],
        [
          "driver_lat"
        ],
        [
          "nearest_zone"
        ]
      ]
    ],
    "query": "WITH (\n    SELECT round(AVG(cost), 2) FROM atlas.ods_order\n    WHERE dttm_utc_1_min >= toDateTime('2020-12-15 12:20:47', 'UTC')\nAND dttm_utc_1_min < toDateTime('2020-12-29 12:20:47', 'UTC')\nAND car_class\nin ('econom')\nAND nearest_zone in ('kaluga')\n\n) AS avg_cost\n\n\nSELECT\n    source_geopoint[1] as order_source_lon,\n    source_geopoint[2] as order_source_lat,\n    surge_value as surge_value,\n    toDate(order_due, 'Europe/Moscow') as local_dt,\n    toInt8(toMinute(order_due, 'Europe/Moscow') / 10) as ten_minutes,\n    cost as order_cost,\n    cost / avg_cost as cost_weight,\n    (cost - COALESCE(surcharge * surge_beta, 0))\n        / (COALESCE(surge_alpha, 1) * greatest(surge_value, 1.0) + COALESCE(surge_beta, 0)) as order_cost_before_surge,\n    toHour(order_due, 'Europe/Moscow') as hour,\n    toDayOfWeek(order_due, 'Europe/Moscow')  as dow,\n    taxi_status == 'complete' and status == 'finished' and (transporting_time > 2) as subv_flag,\n    cand_perf_point[1] as driver_lon,\n    cand_perf_point[2] as driver_lat,\n    nearest_zone as nearest_zone\nFROM atlas.ods_order FINAL\nWHERE dttm_utc_1_min >= toDateTime('2020-12-15 12:20:47', 'UTC')\nAND dttm_utc_1_min < toDateTime('2020-12-29 12:20:47', 'UTC')\nAND car_class\nin ('econom')\nAND nearest_zone in ('kaluga')\n\n    AND 1 = 1\n;\n"
  }
]
