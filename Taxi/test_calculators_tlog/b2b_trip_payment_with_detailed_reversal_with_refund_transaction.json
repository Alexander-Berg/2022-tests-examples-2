{
  "doc_journal_entries": {
    "610": [
      {
        "account": {
          "account_id": 1,
          "agreement_id": "tlog",
          "currency": "RUB",
          "entity_external_id": "billing_client_id/client_billing_id",
          "expired": "9999-12-31T23:59:59.999999+00:00",
          "opened": "2018-10-10T09:56:13.758202Z",
          "sub_account": "client_b2b_trip_payment"
        },
        "amount": "1",
        "created": "2019-04-14T10:17:29.000000+00:00",
        "details": {
          "alias_id": "deadbeef",
          "billing_client_id": "client_billing_id",
          "detailed_product": "client_b2b_trip_payment",
          "due": "2019-04-14T10:17:29.000000+00:00",
          "is_payable": false,
          "order_id": "1",
          "payload": {
            "amount_details": {
              "base_amount": "0.0154",
              "base_currency": "RUB",
              "contract_currency_rate": "0.01540"
            },
            "base_doc_id": 999,
            "driver_details": {
              "clid": "12345",
              "db_id": "01abcdef",
              "uuid": "abcdef01"
            }
          },
          "product": "client_b2b_trip_payment",
          "service_id": 650,
          "service_transaction_id": null
        },
        "entry_id": "1",
        "event_at": "2019-04-14T10:17:29.000000+00:00",
        "reason": ""
      },
      {
        "account": {
          "account_id": 2,
          "agreement_id": "tlog",
          "currency": "RUB",
          "entity_external_id": "billing_client_id/client_billing_id",
          "expired": "9999-12-31T23:59:59.999999+00:00",
          "opened": "2018-10-10T09:56:13.758202Z",
          "sub_account": "client_b2b_trip_payment"
        },
        "amount": "-2",
        "created": "2019-04-14T10:17:29.000000+00:00",
        "details": {
          "alias_id": "deadbeef",
          "billing_client_id": "client_billing_id",
          "detailed_product": "decoupling_b2b_trip_payment",
          "due": "2019-04-14T10:17:29.000000+00:00",
          "is_payable": false,
          "order_id": "1",
          "payload": {
            "amount_details": {
              "base_amount": "0.0380",
              "base_currency": "RUB",
              "contract_currency_rate": "0.01540"
            },
            "base_doc_id": 999,
            "driver_details": {
              "clid": "12345",
              "db_id": "01abcdef",
              "uuid": "abcdef01"
            }
          },
          "product": "client_b2b_trip_payment",
          "service_id": 650,
          "service_transaction_id": null,
          "transaction_type": "refund"
        },
        "entry_id": "2",
        "event_at": "2019-04-14T10:17:29.000000+00:00",
        "reason": ""
      },
      {
        "account": {
          "account_id": 3,
          "agreement_id": "tlog",
          "currency": "RUB",
          "entity_external_id": "billing_client_id/park_billing_id",
          "expired": "9999-12-31T23:59:59.999999+00:00",
          "opened": "2018-10-10T09:56:13.758202Z",
          "sub_account": "park_b2b_trip_payment"
        },
        "amount": "3",
        "created": "2019-04-14T10:17:29.000000+00:00",
        "details": {
          "alias_id": "deadbeef",
          "billing_client_id": "park_billing_id",
          "due": "2019-04-14T10:17:29.000000+00:00",
          "handled_in_trust_flow": false,
          "is_payable": true,
          "order_id": "1",
          "payload": {
            "amount_details": {
              "base_amount": "0.0462",
              "base_currency": "RUB",
              "contract_currency_rate": "0.01540"
            },
            "base_doc_id": 999,
            "driver_details": {
              "clid": "12345",
              "db_id": "01abcdef",
              "uuid": "abcdef01"
            }
          },
          "product": "park_b2b_trip_payment",
          "service_id": 651,
          "service_transaction_id": null
        },
        "entry_id": "3",
        "event_at": "2019-04-14T10:17:29.000000+00:00",
        "reason": ""
      },
      {
        "account": {
          "account_id": 4,
          "agreement_id": "tlog",
          "currency": "RUB",
          "entity_external_id": "billing_client_id/park_billing_id",
          "expired": "9999-12-31T23:59:59.999999+00:00",
          "opened": "2018-10-10T09:56:13.758202Z",
          "sub_account": "rebate_b2b_trip_payment"
        },
        "amount": "-3",
        "created": "2019-04-14T10:17:29.000000+00:00",
        "details": {
          "alias_id": "deadbeef",
          "billing_client_id": "park_billing_id",
          "due": "2019-04-14T10:17:29.000000+00:00",
          "handled_in_trust_flow": false,
          "is_payable": true,
          "order_id": "1",
          "payload": {
            "amount_details": {
              "base_amount": "0.0462",
              "base_currency": "RUB",
              "contract_currency_rate": "0.01540"
            },
            "base_doc_id": 999,
            "driver_details": {
              "clid": "12345",
              "db_id": "01abcdef",
              "uuid": "abcdef01"
            }
          },
          "product": "park_b2b_trip_payment",
          "service_id": 651,
          "service_transaction_id": null
        },
        "entry_id": "3",
        "event_at": "2019-04-14T10:17:29.000000+00:00",
        "reason": ""
      }
    ]
  },
  "docs_chain": [
    {
      "data": {
        "based_on_doc_id": 600,
        "version": 1
      },
      "doc_id": 610,
      "event_at": "2019-04-14T10:17:29.000000+00:00",
      "external_event_ref": "taxi/b2b_trip_payment/deadbeef/1/handled",
      "external_obj_id": "taxi/b2b_trip_payment/deadbeef/journal",
      "journal_entries": [],
      "kind": "b2b_trip_payment_handled",
      "service": "billing-calculators",
      "status": "complete"
    }
  ],
  "event": {
    "created": "2019-04-15T10:30:03.102042+00:00",
    "data": {
      "alias_id": "deadbeef",
      "client_payment": {
        "billing_id": "client_billing_id",
        "contract_currency": "USD",
        "contract_currency_rate": "0.0154",
        "ride_cost": "175.0000"
      },
      "due": "2019-04-14T10:17:29.000000+00:00",
      "nearest_zone": "nz",
      "order_currency": "RUB",
      "order_id": "1",
      "park_payment": {
        "billing_id": "park_billing_id",
        "clid": "12345",
        "contract_currency": "EUR",
        "contract_currency_rate": "0.0143",
        "db_id": "01abcdef",
        "driver_uuid": "abcdef01",
        "rebate": "25.0000",
        "ride_cost": "125.0000",
        "vat": "1.2000"
      },
      "version": 2
    },
    "doc_id": 1000,
    "event_at": "2019-04-14T10:17:29.000000+00:00",
    "external_event_ref": "taxi/b2b_trip_payment/deadbeef/2",
    "external_obj_id": "taxi/b2b_trip_payment/deadbeef",
    "kind": "b2b_trip_payment",
    "process_at": "2019-04-15T10:30:03.102042+00:00",
    "service": "billing-orders",
    "status": "new"
  },
  "expected_accounts": [
    {
      "account_id": 1,
      "agreement_id": "tlog",
      "currency": "USD",
      "entity_external_id": "billing_client_id/client_billing_id",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "client_b2b_trip_payment"
    },
    {
      "account_id": 2,
      "agreement_id": "tlog",
      "currency": "USD",
      "entity_external_id": "billing_client_id/client_billing_id",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "decoupling_b2b_trip_payment"
    },
    {
      "account_id": 3,
      "agreement_id": "tlog",
      "currency": "EUR",
      "entity_external_id": "billing_client_id/park_billing_id",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "park_b2b_trip_payment"
    },
    {
      "account_id": 4,
      "agreement_id": "tlog",
      "currency": "EUR",
      "entity_external_id": "billing_client_id/park_billing_id",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "rebate_b2b_trip_payment"
    }
  ],
  "expected_docs": [
    {
      "data": {
        "alias_id": null,
        "based_on_doc_id": 1000,
        "order_id": null,
        "reverse_doc_id": 610,
        "version": 1
      },
      "doc_id": 6000,
      "event_at": "2019-04-14T10:17:29.000000+00:00",
      "external_event_ref": "reverse_doc_id/610",
      "external_obj_id": "taxi/b2b_trip_payment/deadbeef/journal",
      "journal_entries": [
        {
          "account_id": 1,
          "amount": "-1",
          "details": {
            "alias_id": "deadbeef",
            "billing_client_id": "client_billing_id",
            "contract_id": "650",
            "detailed_product": "client_b2b_trip_payment",
            "due": "2019-04-14T10:17:29.000000+00:00",
            "invoice_date": "2019-04-14T10:17:29.000000+00:00",
            "is_payable": false,
            "order_id": "1",
            "payload": {
              "amount_details": {
                "base_amount": "0.0154",
                "base_currency": "RUB",
                "contract_currency_rate": "0.01540"
              },
              "base_doc_id": 1000,
              "driver_details": {
                "clid": "12345",
                "db_id": "01abcdef",
                "uuid": "abcdef01"
              }
            },
            "product": "client_b2b_trip_payment",
            "reverse_entry_id": "1",
            "service_id": 650,
            "service_transaction_id": null
          },
          "event_at": "2019-04-14T10:17:29.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 2,
          "amount": "2",
          "details": {
            "alias_id": "deadbeef",
            "billing_client_id": "client_billing_id",
            "contract_id": "650",
            "detailed_product": "decoupling_b2b_trip_payment",
            "due": "2019-04-14T10:17:29.000000+00:00",
            "invoice_date": "2019-04-14T10:17:29.000000+00:00",
            "is_payable": false,
            "order_id": "1",
            "payload": {
              "amount_details": {
                "base_amount": "0.0380",
                "base_currency": "RUB",
                "contract_currency_rate": "0.01540"
              },
              "base_doc_id": 1000,
              "driver_details": {
                "clid": "12345",
                "db_id": "01abcdef",
                "uuid": "abcdef01"
              }
            },
            "product": "client_b2b_trip_payment",
            "reverse_entry_id": "2",
            "service_id": 650,
            "service_transaction_id": null,
            "transaction_type": "payment"
          },
          "event_at": "2019-04-14T10:17:29.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 3,
          "amount": "-3",
          "details": {
            "alias_id": "deadbeef",
            "billing_client_id": "park_billing_id",
            "contract_id": "651",
            "due": "2019-04-14T10:17:29.000000+00:00",
            "handled_in_trust_flow": false,
            "invoice_date": "2019-04-14T10:17:29.000000+00:00",
            "is_payable": true,
            "order_id": "1",
            "payload": {
              "amount_details": {
                "base_amount": "0.0462",
                "base_currency": "RUB",
                "contract_currency_rate": "0.01540"
              },
              "base_doc_id": 1000,
              "driver_details": {
                "clid": "12345",
                "db_id": "01abcdef",
                "uuid": "abcdef01"
              }
            },
            "product": "park_b2b_trip_payment",
            "reverse_entry_id": "3",
            "service_id": 651,
            "service_transaction_id": null
          },
          "event_at": "2019-04-14T10:17:29.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 4,
          "amount": "3",
          "details": {
            "alias_id": "deadbeef",
            "billing_client_id": "park_billing_id",
            "contract_id": "651",
            "due": "2019-04-14T10:17:29.000000+00:00",
            "handled_in_trust_flow": false,
            "invoice_date": "2019-04-14T10:17:29.000000+00:00",
            "is_payable": true,
            "order_id": "1",
            "payload": {
              "amount_details": {
                "base_amount": "0.0462",
                "base_currency": "RUB",
                "contract_currency_rate": "0.01540"
              },
              "base_doc_id": 1000,
              "driver_details": {
                "clid": "12345",
                "db_id": "01abcdef",
                "uuid": "abcdef01"
              }
            },
            "product": "park_b2b_trip_payment",
            "reverse_entry_id": "3",
            "service_id": 651,
            "service_transaction_id": null
          },
          "event_at": "2019-04-14T10:17:29.000000+00:00",
          "reason": ""
        }
      ],
      "kind": "journal_reversal",
      "service": "billing-calculators",
      "status": "new"
    },
    {
      "data": {
        "based_on_doc_id": 1000,
        "version": 2
      },
      "doc_id": 6010,
      "event_at": "2019-04-14T10:17:29.000000+00:00",
      "external_event_ref": "taxi/b2b_trip_payment/deadbeef/2/handled",
      "external_obj_id": "taxi/b2b_trip_payment/deadbeef/journal",
      "journal_entries": [
        {
          "account_id": 1,
          "amount": "1.92500000",
          "details": {
            "agglomeration": "mvp",
            "alias_id": "deadbeef",
            "billing_client_id": "client_billing_id",
            "contract_id": "650",
            "detailed_product": "client_b2b_trip_payment",
            "due": "2019-04-14T10:17:29.000000+00:00",
            "is_payable": false,
            "order_id": "1",
            "payload": {
              "amount_details": {
                "base_amount": "125.0000",
                "base_currency": "RUB",
                "contract_currency_rate": "0.01540"
              },
              "base_doc_id": 1000,
              "driver_details": {
                "clid": "12345",
                "db_id": "01abcdef",
                "uuid": "abcdef01"
              },
              "nearest_zone": "nz"
            },
            "product": "client_b2b_trip_payment",
            "service_id": 650,
            "service_transaction_id": null
          },
          "event_at": "2019-04-14T10:17:29.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 2,
          "amount": "0.77000000",
          "details": {
            "agglomeration": "mvp",
            "alias_id": "deadbeef",
            "billing_client_id": "client_billing_id",
            "contract_id": "650",
            "detailed_product": "decoupling_b2b_trip_payment",
            "due": "2019-04-14T10:17:29.000000+00:00",
            "is_payable": false,
            "order_id": "1",
            "payload": {
              "amount_details": {
                "base_amount": "50.0000",
                "base_currency": "RUB",
                "contract_currency_rate": "0.01540"
              },
              "base_doc_id": 1000,
              "driver_details": {
                "clid": "12345",
                "db_id": "01abcdef",
                "uuid": "abcdef01"
              },
              "nearest_zone": "nz"
            },
            "product": "client_b2b_trip_payment",
            "service_id": 650,
            "service_transaction_id": null,
            "transaction_type": "payment"
          },
          "event_at": "2019-04-14T10:17:29.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 3,
          "amount": "2.14",
          "details": {
            "agglomeration": "mvp",
            "alias_id": "deadbeef",
            "billing_client_id": "park_billing_id",
            "contract_id": "651",
            "detailed_product": "park_b2b_trip_payment",
            "due": "2019-04-14T10:17:29.000000+00:00",
            "handled_in_trust_flow": false,
            "is_payable": true,
            "order_id": "1",
            "payload": {
              "amount_details": {
                "base_amount": "125.0000",
                "base_currency": "RUB",
                "contract_currency_rate": "0.01430",
                "vat": "25.0000"
              },
              "base_doc_id": 1000,
              "driver_details": {
                "clid": "12345",
                "db_id": "01abcdef",
                "uuid": "abcdef01"
              },
              "nearest_zone": "nz"
            },
            "product": "park_b2b_trip_payment",
            "service_id": 651,
            "service_transaction_id": null
          },
          "event_at": "2019-04-14T10:17:29.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 4,
          "amount": "-0.43",
          "details": {
            "agglomeration": "mvp",
            "alias_id": "deadbeef",
            "billing_client_id": "park_billing_id",
            "contract_id": "651",
            "detailed_product": "rebate_b2b_trip_payment",
            "due": "2019-04-14T10:17:29.000000+00:00",
            "handled_in_trust_flow": false,
            "is_payable": true,
            "order_id": "1",
            "payload": {
              "amount_details": {
                "base_amount": "25.0000",
                "base_currency": "RUB",
                "contract_currency_rate": "0.01430",
                "vat": "5.0000"
              },
              "base_doc_id": 1000,
              "driver_details": {
                "clid": "12345",
                "db_id": "01abcdef",
                "uuid": "abcdef01"
              },
              "nearest_zone": "nz"
            },
            "product": "park_b2b_trip_payment",
            "service_id": 651,
            "service_transaction_id": null,
            "transaction_type": "refund"
          },
          "event_at": "2019-04-14T10:17:29.000000+00:00",
          "reason": ""
        }
      ],
      "kind": "b2b_trip_payment_handled",
      "service": "billing-calculators",
      "status": "new"
    },
    {
      "data": {
        "based_on_doc_id": 6010,
        "entries_count": 8,
        "reversal_doc_id": 6000
      },
      "doc_id": 6020,
      "event_at": "2019-04-14T10:17:29.000000+00:00",
      "external_event_ref": "tlog_journal_entries_created/deadbeef/2",
      "external_obj_id": "taxi/b2b_trip_payment/deadbeef/journal",
      "journal_entries": [],
      "kind": "tlog_journal_entries_created",
      "service": "billing-calculators",
      "status": "new"
    }
  ],
  "expected_docs_finished": [
    {
      "doc_id": 1000
    }
  ],
  "expected_entities": [
    {
      "external_id": "billing_client_id/client_billing_id",
      "kind": "client"
    },
    {
      "external_id": "billing_client_id/park_billing_id",
      "kind": "client"
    }
  ]
}
