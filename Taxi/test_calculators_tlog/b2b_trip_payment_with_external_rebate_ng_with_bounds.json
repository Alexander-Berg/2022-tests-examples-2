{
  "billing_commission_response": {
    "agreement": {
      "base_rule_id": "some_base_rule_id",
      "cancellation_settings": {
        "park_billable_cancel_interval": [
          "420",
          "600"
        ],
        "pickup_location_radius": 300,
        "user_billable_cancel_interval": [
          "120",
          "600"
        ]
      },
      "cost_info": {
        "kind": "boundaries",
        "max_cost": "60",
        "min_cost": "0"
      },
      "id": "2abf062a-b607-11ea-998e-07e60204cbdf",
      "rate": {
        "kind": "flat",
        "rate": "0.10"
      },
      "vat": "1.18"
    }
  },
  "doc_journal_entries": {},
  "docs_chain": [],
  "event": {
    "created": "2019-04-14T10:30:03.102042+00:00",
    "data": {
      "alias_id": "deadbeef",
      "client_payment": {
        "billing_id": "client_billing_id",
        "contract_currency": "USD",
        "contract_currency_rate": "0.0154",
        "ride_cost": "100"
      },
      "custom_entries": [
        {
          "agreement_id": "taxi/orders",
          "amount": "100.0",
          "currency": "RUB",
          "details": {},
          "entity_external_id": "corp/client/<id>",
          "sub_account": "payment"
        },
        {
          "agreement_id": "taxi/orders",
          "amount": "200.0",
          "currency": "USD",
          "details": {},
          "entity_external_id": "corp/client/<id>",
          "sub_account": "payment"
        }
      ],
      "due": "2019-04-14T10:17:29.000000+00:00",
      "is_test_trip": true,
      "nearest_zone": "nz",
      "order_currency": "RUB",
      "order_id": "1",
      "park_payment": {
        "billing_id": "park_billing_id",
        "contract_currency": "EUR",
        "contract_currency_rate": "0.0143",
        "db_id": "01abcdef",
        "driver_uuid": "abcdef01",
        "rebate": "20",
        "ride_cost": "150.0000",
        "vat": "1.2000"
      },
      "version": 1
    },
    "doc_id": 1000,
    "event_at": "2019-04-14T10:17:29.000000+00:00",
    "external_event_ref": "taxi/b2b_trip_payment/deadbeef/1",
    "external_obj_id": "taxi/b2b_trip_payment/deadbeef",
    "kind": "b2b_trip_payment",
    "process_at": "2019-04-14T10:30:03.102042+00:00",
    "service": "billing-orders",
    "status": "new"
  },
  "expected_accounts": [
    {
      "account_id": 1,
      "agreement_id": "tlog",
      "currency": "USD",
      "entity_external_id": "billing_client_id/client_billing_id",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "client_b2b_trip_payment"
    },
    {
      "account_id": 2,
      "agreement_id": "tlog",
      "currency": "USD",
      "entity_external_id": "billing_client_id/client_billing_id",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "decoupling_b2b_trip_payment"
    },
    {
      "account_id": 3,
      "agreement_id": "tlog",
      "currency": "EUR",
      "entity_external_id": "billing_client_id/park_billing_id",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "park_b2b_trip_payment"
    },
    {
      "account_id": 4,
      "agreement_id": "tlog",
      "currency": "EUR",
      "entity_external_id": "billing_client_id/park_billing_id",
      "expired": "9999-12-31T23:59:59.999999+00:00",
      "opened": "2018-10-10T09:56:13.758202Z",
      "sub_account": "rebate_b2b_trip_payment"
    }
  ],
  "expected_docs": [
    {
      "data": {
        "based_on_doc_id": 1000,
        "version": 1
      },
      "doc_id": 6000,
      "event_at": "2019-04-14T10:17:29.000000+00:00",
      "external_event_ref": "taxi/b2b_trip_payment/deadbeef/1/handled",
      "external_obj_id": "taxi/b2b_trip_payment/deadbeef/journal",
      "journal_entries": [
        {
          "account_id": 1,
          "amount": "2.31000000",
          "details": {
            "agglomeration": "mvp",
            "alias_id": "deadbeef",
            "billing_client_id": "client_billing_id",
            "contract_id": null,
            "detailed_product": "client_b2b_trip_payment",
            "due": "2019-04-14T10:17:29.000000+00:00",
            "is_payable": false,
            "order_id": "1",
            "payload": {
              "amount_details": {
                "base_amount": "150.0000",
                "base_currency": "RUB",
                "contract_currency_rate": "0.01540"
              },
              "base_doc_id": 1000,
              "driver_details": {
                "clid": null,
                "db_id": "01abcdef",
                "uuid": "abcdef01"
              },
              "is_test_trip": true,
              "nearest_zone": "nz"
            },
            "product": "client_b2b_trip_payment",
            "service_id": 650,
            "service_transaction_id": null
          },
          "event_at": "2019-04-14T10:17:29.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 2,
          "amount": "-0.77000000",
          "details": {
            "agglomeration": "mvp",
            "alias_id": "deadbeef",
            "billing_client_id": "client_billing_id",
            "contract_id": null,
            "detailed_product": "decoupling_b2b_trip_payment",
            "due": "2019-04-14T10:17:29.000000+00:00",
            "is_payable": false,
            "order_id": "1",
            "payload": {
              "amount_details": {
                "base_amount": "50.0000",
                "base_currency": "RUB",
                "contract_currency_rate": "0.01540"
              },
              "base_doc_id": 1000,
              "driver_details": {
                "clid": null,
                "db_id": "01abcdef",
                "uuid": "abcdef01"
              },
              "is_test_trip": true,
              "nearest_zone": "nz"
            },
            "product": "client_b2b_trip_payment",
            "service_id": 650,
            "service_transaction_id": null,
            "transaction_type": "refund"
          },
          "event_at": "2019-04-14T10:17:29.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 3,
          "amount": "2.57",
          "details": {
            "agglomeration": "mvp",
            "alias_id": "deadbeef",
            "billing_client_id": "park_billing_id",
            "contract_id": "651",
            "detailed_product": "park_b2b_trip_payment_test",
            "due": "2019-04-14T10:17:29.000000+00:00",
            "handled_in_trust_flow": false,
            "is_payable": true,
            "order_id": "1",
            "payload": {
              "amount_details": {
                "base_amount": "150.0000",
                "base_currency": "RUB",
                "contract_currency_rate": "0.01430",
                "vat": "30.0000"
              },
              "base_doc_id": 1000,
              "driver_details": {
                "clid": null,
                "db_id": "01abcdef",
                "uuid": "abcdef01"
              },
              "nearest_zone": "nz"
            },
            "product": "park_b2b_trip_payment",
            "service_id": 651,
            "service_transaction_id": null
          },
          "event_at": "2019-04-14T10:17:29.000000+00:00",
          "reason": ""
        },
        {
          "account_id": 4,
          "amount": "-0.12",
          "details": {
            "agglomeration": "mvp",
            "alias_id": "deadbeef",
            "billing_client_id": "park_billing_id",
            "contract_id": "651",
            "detailed_product": "rebate_b2b_trip_payment_test",
            "due": "2019-04-14T10:17:29.000000+00:00",
            "handled_in_trust_flow": false,
            "is_payable": true,
            "order_id": "1",
            "payload": {
              "amount_details": {
                "base_amount": "7.2000",
                "base_currency": "RUB",
                "contract_currency_rate": "0.01430",
                "vat": "1.4400"
              },
              "base_doc_id": 1000,
              "driver_details": {
                "clid": null,
                "db_id": "01abcdef",
                "uuid": "abcdef01"
              },
              "nearest_zone": "nz"
            },
            "product": "park_b2b_trip_payment",
            "service_id": 651,
            "service_transaction_id": null,
            "transaction_type": "refund"
          },
          "event_at": "2019-04-14T10:17:29.000000+00:00",
          "reason": ""
        }
      ],
      "kind": "b2b_trip_payment_handled",
      "service": "billing-calculators",
      "status": "new"
    },
    {
      "data": {
        "based_on_doc_id": 6000,
        "entries_count": 4,
        "reversal_doc_id": null
      },
      "doc_id": 6010,
      "event_at": "2019-04-14T10:17:29.000000+00:00",
      "external_event_ref": "tlog_journal_entries_created/deadbeef/1",
      "external_obj_id": "taxi/b2b_trip_payment/deadbeef/journal",
      "journal_entries": [],
      "kind": "tlog_journal_entries_created",
      "service": "billing-calculators",
      "status": "new"
    }
  ],
  "expected_docs_finished": [
    {
      "doc_id": 1000
    }
  ],
  "expected_entities": [
    {
      "external_id": "billing_client_id/client_billing_id",
      "kind": "client"
    },
    {
      "external_id": "billing_client_id/park_billing_id",
      "kind": "client"
    }
  ]
}
