{
  "all_entries": [
    {
      "account": {
        "account_id": 1,
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
        "sub_account": "promocode/compensation"
      },
      "amount": "-50.0",
      "details": {
        "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
        "reverse_entry_id": 11
      },
      "entry_id": 12,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "reason": ""
    },
    {
      "account": {
        "account_id": 2,
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_park_id/7f74df",
        "sub_account": "promocode/compensation"
      },
      "amount": "-50.0",
      "details": {
        "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
        "driver": {
          "driver_uuid": "1086f4"
        },
        "reverse_entry_id": 21
      },
      "entry_id": 22,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "reason": ""
    },
    {
      "account": {
        "account_id": 3,
        "agreement_id": "taxi/driver_balance",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
        "sub_account": "total"
      },
      "amount": "-50.0",
      "details": {
        "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
        "reverse_entry_id": 31
      },
      "entry_id": 32,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "reason": ""
    },
    {
      "account": {
        "account_id": 4,
        "agreement_id": "taxi/driver_balance",
        "currency": "RUB",
        "entity_external_id": "taximeter_park_id/7f74df",
        "sub_account": "total/driver_id/1086f4"
      },
      "amount": "-50.0",
      "details": {
        "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
        "driver": {
          "driver_uuid": "1086f4"
        },
        "reverse_entry_id": 41
      },
      "entry_id": 42,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "reason": ""
    },
    {
      "account": {
        "account_id": 5,
        "agreement_id": "tlog",
        "currency": "USD",
        "entity_external_id": "billing_client_id/77777",
        "sub_account": "coupon"
      },
      "amount": "-1.5",
      "details": {
        "alias_id": "abcdef",
        "billing_client_id": 77777,
        "due": "2019-09-12T11:30:00.000000+00:00",
        "handled_in_trust_flow": true,
        "is_payable": false,
        "limits": {
          "amount": "5.0000",
          "currency": "RUB",
          "limit_ref": "some_limit_ref"
        },
        "reverse_entry_id": 51,
        "service_id": 123,
        "service_transaction_id": 1234567890,
        "transaction_type": "refund"
      },
      "entry_id": 52,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "reason": ""
    },
    {
      "account": {
        "account_id": 1,
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
        "sub_account": "promocode/compensation"
      },
      "amount": "100.0",
      "details": {
        "alias_id": "300226c453c54b099f3f5aa64fbc1ac4"
      },
      "entry_id": 13,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "reason": ""
    },
    {
      "account": {
        "account_id": 2,
        "agreement_id": "taxi/yandex_ride",
        "currency": "RUB",
        "entity_external_id": "taximeter_park_id/7f74df",
        "sub_account": "promocode/compensation"
      },
      "amount": "100.00",
      "details": {
        "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
        "driver": {
          "driver_uuid": "1086f4"
        }
      },
      "entry_id": 23,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "reason": ""
    },
    {
      "account": {
        "account_id": 3,
        "agreement_id": "taxi/driver_balance",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/7f74df/1086f4",
        "sub_account": "total"
      },
      "amount": "100.0",
      "details": {
        "alias_id": "300226c453c54b099f3f5aa64fbc1ac4"
      },
      "entry_id": 33,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "reason": ""
    },
    {
      "account": {
        "account_id": 4,
        "agreement_id": "taxi/driver_balance",
        "currency": "RUB",
        "entity_external_id": "taximeter_park_id/7f74df",
        "sub_account": "total/driver_id/1086f4"
      },
      "amount": "100.0",
      "details": {
        "alias_id": "300226c453c54b099f3f5aa64fbc1ac4",
        "driver": {
          "driver_uuid": "1086f4"
        }
      },
      "entry_id": 43,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "reason": ""
    },
    {
      "account": {
        "account_id": 5,
        "agreement_id": "tlog",
        "currency": "USD",
        "entity_external_id": "billing_client_id/77777",
        "sub_account": "coupon"
      },
      "amount": "2.5",
      "details": {
        "alias_id": "abcdef",
        "billing_client_id": 77777,
        "due": "2019-09-12T11:30:00.000000+00:00",
        "handled_in_trust_flow": true,
        "is_payable": false,
        "limits": {
          "amount": "15.0000",
          "currency": "RUB",
          "limit_ref": "some_limit_ref"
        },
        "service_id": 123,
        "service_transaction_id": 1234567890,
        "transaction_type": "payment"
      },
      "entry_id": 53,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "reason": ""
    },
    {
      "account": {
        "account_id": 6,
        "agreement_id": "tlog",
        "currency": "RUB",
        "entity_external_id": "billing_client_id/77777",
        "sub_account": "coupon"
      },
      "amount": "2.5",
      "details": {
        "alias_id": "abcdef",
        "billing_client_id": 77777,
        "due": "2019-09-12T11:30:00.000000+00:00",
        "handled_in_trust_flow": true,
        "is_payable": false,
        "limits": {
          "amount": "10.0000",
          "currency": "RUB",
          "limit_ref": "another_limit_ref"
        },
        "reverse_entry_id": 51,
        "service_id": 123,
        "service_transaction_id": 1234567890,
        "transaction_type": "payment"
      },
      "entry_id": 53,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "reason": ""
    },
    {
      "account": {
        "account_id": 6,
        "agreement_id": "tlog",
        "currency": "RUB",
        "entity_external_id": "billing_client_id/77777",
        "sub_account": "coupon"
      },
      "amount": "2.5",
      "details": {
        "alias_id": "abcdef",
        "billing_client_id": 77777,
        "due": "2019-09-12T11:30:00.000000+00:00",
        "handled_in_trust_flow": true,
        "is_payable": false,
        "service_id": 123,
        "service_transaction_id": 1234567890,
        "transaction_type": "payment"
      },
      "entry_id": 53,
      "event_at": "2019-09-13T13:00:00.000000+00:00",
      "reason": ""
    }
  ],
  "configs": {
    "BILLING_CALCULATORS_USE_BILLING_FUNCTIONS_LIMITS_QUEUE": true
  },
  "expected_accounts": [],
  "expected_docs": [],
  "expected_entities": [],
  "expected_limits_entries": [],
  "expected_limits_headers": [],
  "expected_limits_stq_calls": [
    {
      "args": [
        "-10.0000",
        "RUB",
        "2019-02-27T09:28:04.000000+00:00",
        "another_limit_ref",
        "36675cae57d934d3b1ccf18b29752429e7231ad8"
      ],
      "eta": null,
      "kwargs": {
        "log_extra": {}
      },
      "queue": "billing_functions_send_to_limits",
      "task_id": "36675cae57d934d3b1ccf18b29752429e7231ad8"
    },
    {
      "args": [
        "10.0000",
        "RUB",
        "2019-02-27T09:28:04.000000+00:00",
        "some_limit_ref",
        "0a473cf7328c3214dff25601ef7474ec38276f6d"
      ],
      "eta": null,
      "kwargs": {
        "log_extra": {}
      },
      "queue": "billing_functions_send_to_limits",
      "task_id": "0a473cf7328c3214dff25601ef7474ec38276f6d"
    }
  ],
  "expected_tlog_entries": [],
  "payout": {
    "base_doc_id": 123456,
    "dry_mode": false,
    "entries": [],
    "event_at": "2019-02-27T09:28:04.000000+00:00",
    "external_obj_id": "alias_id/54321/subvention/process",
    "kind": "subvention",
    "payout_doc_id": 1050,
    "tags": [],
    "topic_begin_at": "2019-04-01T07:46:00.000000+00:00",
    "version": 12345678
  }
}
