#include <api_over_db/cache.hpp>
#include <api_over_db/cache_dumper.hpp>
#include <api_over_db/handlers.hpp>
#include <api_over_db/ping.hpp>
#include <handlers/handlers_list.hpp>
#include <userver/components/common_component_list.hpp>
#include <userver/components/common_server_component_list.hpp>
#include <userver/components/component_list.hpp>
#include <userver/server/component.hpp>
#include <userver/storages/secdist/component.hpp>
#include <userver/utils/daemon_run.hpp>

#include <handlers/dependencies_schema.ipp>

// Defined by user
namespace test_service {
void RegisterUserComponents(::components::ComponentList& component_list);
}

int main(int argc, char* argv[])
{
  auto component_list =
      ::components::ComponentList()
          .AppendComponentList(components::CommonComponentList())
          .AppendComponentList(components::CommonServerComponentList())
          .AppendComponentList(handlers::AutogeneratedHandlersList())
          .Append<api_over_db::components::replica1::Cache>()
          .Append<api_over_db::components::replica1::CacheDumper>()
          .Append<api_over_db::components::replica2::Cache>()
          .Append<api_over_db::components::replica2::CacheDumper>()
          .Append<api_over_db::components::replica3::Cache>()
          .Append<api_over_db::components::replica3::CacheDumper>()
          .Append<api_over_db::handlers::Ping>()
          .Append<api_over_db::handlers::proxy1::ProxyRetrieve>()
          .Append<api_over_db::handlers::replica1::Retrieve>()
          .Append<api_over_db::handlers::replica1::Updates>()
          .Append<api_over_db::handlers::replica2::Retrieve>()
          .Append<api_over_db::handlers::replica2::Updates>()
          .Append<api_over_db::handlers::replica3::Retrieve>()
          .Append<api_over_db::handlers::replica3::Updates>()
          .Append<components::Secdist>();

  test_service::RegisterUserComponents(component_list);

  return ::utils::DaemonMain(argc, argv, component_list);
}
