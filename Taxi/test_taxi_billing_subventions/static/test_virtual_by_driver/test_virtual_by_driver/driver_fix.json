{
  "accounts": [
    {
      "account": {
        "account_id": 123004,
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "currency": "XXX",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "time/free_minutes"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.000000+03:00",
          "balance": "15",
          "last_created": "2019-09-17T23:59:00.000000+00:00",
          "last_entry_id": 34602004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.000000+03:00",
          "balance": "5",
          "last_created": "2019-09-16T23:59:00.000000+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 123005,
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "income"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.000000+03:00",
          "balance": "1000",
          "last_created": "2019-09-17T23:59:00.000000+00:00",
          "last_entry_id": 34602004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.000000+03:00",
          "balance": "0",
          "last_created": "2019-09-16T23:59:00.000000+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 123006,
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "currency": "XXX",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "time/on_order_minutes"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.000000+03:00",
          "balance": "25",
          "last_created": "2019-09-17T23:59:00.000000+00:00",
          "last_entry_id": 34602004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.000000+03:00",
          "balance": "10",
          "last_created": "2019-09-16T23:59:00.000000+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 123007,
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "guarantee"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.000000+03:00",
          "balance": "1500",
          "last_created": "2019-09-17T23:59:00.000000+00:00",
          "last_entry_id": 34602004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.000000+03:00",
          "balance": "0",
          "last_created": "2019-09-16T23:59:00.000000+00:00",
          "last_entry_id": 34601004
        }
      ]
    },
    {
      "account": {
        "account_id": 123008,
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "currency": "RUB",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "income/cash"
      },
      "balances": [
        {
          "accrued_at": "2019-09-18T00:00:00.000000+03:00",
          "balance": "500",
          "last_created": "2019-09-17T23:59:00.000000+00:00",
          "last_entry_id": 34602004
        },
        {
          "accrued_at": "2019-09-17T00:00:00.000000+03:00",
          "balance": "0",
          "last_created": "2019-09-16T23:59:00.000000+00:00",
          "last_entry_id": 34601004
        }
      ]
    }
  ],
  "expected_balances_request": {
    "accounts": [
      {
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "income"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "guarantee"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "guarantee/on_order"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "time/free_minutes"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "time/on_order_minutes"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "income/cash"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "discounts"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "promocodes/marketing"
      },
      {
        "agreement_id": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/quas_wex_exort",
        "entity_external_id": "taximeter_driver_id/some_db_id/some_uuid",
        "sub_account": "promocodes/support"
      }
    ],
    "accrued_at": [
      "2019-09-16T21:00:00.000000+00:00",
      "2019-09-17T21:00:00.000000+00:00"
    ]
  },
  "expected_docs": {
    "docs": {
      "taxi/shift_ended/taximeter_driver_id/quas/wex": [
        {
          "created": "2019-09-17T10:00:00.000000+03:00",
          "data": {
            "agreement_ref": "subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1",
            "antifraud_rule": {
              "days_span": 1,
              "kind": "driver_fix",
              "last_shift_date": "2019-09-17"
            },
            "commission_input": null,
            "last_date": "2019-09-17",
            "pay_after": "2019-09-17T21:00:00+00:00",
            "pay_to": {
              "external_id": "taximeter_driver_id/some_db_id/some_uuid",
              "kind": "driver"
            },
            "payment_id": "2019-09-17",
            "possible_frauder": null,
            "rule_data": {
              "data": {
                "currency": "RUB",
                "end": "2019-11-19T11:00:00.000000+03:00",
                "geoarea": "moscow_center",
                "group_id": "driver_fix_id_1",
                "id": "5dc45e833fd694916ab26be1",
                "profile_payment_type_restrictions": "any",
                "profile_tariff_classes": [
                  "econom"
                ],
                "rates": [
                  {
                    "rate_per_minute": "1",
                    "starts_at": {
                      "hour": 12,
                      "iso_week_day": 1,
                      "minute": 0
                    }
                  },
                  {
                    "rate_per_minute": "2",
                    "starts_at": {
                      "hour": 10,
                      "iso_week_day": 2,
                      "minute": 0
                    }
                  },
                  {
                    "rate_per_minute": "3",
                    "starts_at": {
                      "hour": 12,
                      "iso_week_day": 2,
                      "minute": 0
                    }
                  }
                ],
                "timezone_id": "Europe/Moscow",
                "zone_name": "moscow"
              },
              "subvention_type": "driver_fix"
            },
            "shift": {
              "end": "2019-09-18T00:00:00.000000+03:00",
              "start": "2019-09-17T00:00:00.000000+03:00"
            },
            "subscription_ref": "quas_wex_exort",
            "use_stats_of": {
              "external_id": "taximeter_driver_id/some_db_id/some_uuid",
              "kind": "driver"
            }
          },
          "doc_id": 1234567890,
          "event_at": "2019-09-17T10:00:00.000000+03:00",
          "external_event_ref": "some_external_event_ref",
          "external_obj_id": "taxi/shift_ended/subvention_agreement/1/default/_id/5dc45e833fd694916ab26be1/unique_driver_id/0123456789abcdef00000001/2018-05-10",
          "kind": "shift_ended",
          "process_at": "2019-09-17T10:00:00.000000+03:00",
          "reason": "reason",
          "service": "some-service",
          "status": "new"
        }
      ]
    }
  },
  "expected_docs_requests": {
    "event_at_begin": "2019-09-17T13:48:50.000000+00:00",
    "event_at_end": "2019-12-16T13:48:50.000000+00:00",
    "tags": [
      "taxi/shift_ended/taximeter_driver_id/quas/wex"
    ]
  },
  "expected_result": {
    "subventions": [
      {
        "commission_info": {
          "payoff_commission": {
            "amount": "0",
            "currency": "RUB"
          }
        },
        "details": {
          "accounted_time_minutes": 25,
          "accounted_time_seconds": 1500,
          "cash_commission": {
            "amount": "0",
            "currency": "RUB"
          },
          "cash_income": {
            "amount": "500",
            "currency": "RUB"
          },
          "guarantee": {
            "amount": "1500",
            "currency": "RUB"
          },
          "total_income": {
            "amount": "1000",
            "currency": "RUB"
          }
        },
        "payoff": {
          "amount": "500",
          "currency": "RUB"
        },
        "period": {
          "end_time": "2019-09-17T21:00:00+00:00",
          "start_time": "2019-09-16T21:00:00+00:00"
        },
        "subvention_rule_id": "_id/5dc45e833fd694916ab26be1",
        "type": "driver_fix"
      }
    ]
  },
  "query": {
    "driver": {
      "db_id": "quas",
      "uuid": "wex"
    },
    "types": [
      "driver_fix"
    ]
  }
}
