'use strict';

const { mapTskvToJson } = require('../lib/grep-blockdisplay-log');

describe('grep-blockdisplay-log', () => {
    test('mapTskvToJson', () => {
        // eslint-disable-next-line no-tabs
        const tskvLine = String.raw`tskv	tskv_format=blockstat-log-tskv	unixtime=1621520132	yandexuid=6294986081566308592	yuid_slot_salted=57	request=/	show_id=1621520131.30381.54487.217918	ip=2a02:6b8:0:40c:1069:61b7:85ac:e45f	vhost=v145d0.wdevx.yandex.ru	method=GET	accept_language=en	user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.96 YaBrowser/20.4.0.2442 Yowser/2.5 Safari/537.36	blocks=v14\t9\tbanreq=1\texp=send_beacon,www_no,plain,login_yes\tgeo=213\tgeo_ip=213\tgeo_type=6\tgeoprc=1\tk=1\tlogged=1\tskin=\tv14.user_prefs.disabled_inserts.district_inserts\t0\tv14.user_prefs.disabled_inserts.div_district_inserts\t0\tv14.tech.css.modern\t0\tv14.messenger\t0\tv14.head.region.setup\t0\tv14.head.time\t0\tv14.news.tab.link.news\t0\tv14.news.tab.select.news\t0\tv14.news.tab.link.region\t0\tv14.news.tab.select.region\t0\tv14.news.tab.link.personal\t0\tv14.news.tab.select.personal\t0\tv14.news.news.links.1\t0\tv14.news.news.links.2\t0\tv14.news.news.links.3.main\t0\tv14.news.news.links.4\t0\tv14.news.news.links.animation.1\t0\tv14.news.news.links.animation.2\t0\tv14.news.news.links.animation.3\t0\tv14.news.news.links.animation.4\t0\tv14.news.news.links.animation.5\t0\tv14.news.news.links.animation.6\t0\tv14.news.title\t0\tv14.news_rates_manual.more\t0\tv14.news_rates_manual.id2002\t0\tv14.news_rates_manual.id2000\t0\tv14.news_rates_manual.id1006\t0\tv14.weather.grade\t0\tv14.weather.title\t0\tv14.weather.map\t0\tv14.weather.forecast.0\t0\tv14.weather.forecast.1\t0\tv14.weather.forecast.2\t0\tv14.traffic.ball\t0\tv14.traffic.links.metro.moscow\t0\tv14.traffic.links.rasp.rasp\t0\tv14.traffic.links.taxi.taxi_RU-ALL-ALL\t0\tv14.traffic.title\t0\tv14.banner.tgo.second_title.no\t0\tv14.banner.firstlook_tgo\t0\tv14.services_new.more\t0\tv14.services_new.promo.q\t0\tv14.notifications.mail.login.usermenu.toggle\t0\tv14.notifications.mail.login.usermenu.toggle-icon\t0\tv14.notifications.mail.login.inbox.unread\t0\tv14.notifications.mail.login.disk\t0\tv14.notifications.plus-wallet.card\t0\tv14.notifications.covid.card.0\t0\tv14.notifications.covid.card.1\t0\tv14.notifications.covid.close\t0\tv14.notifications.teaser.link\t0\tv14.market-cart.headline\t0\tv14.head.notifier\t0\tv14.logo.default\t0\tv14.suggest.direct_enabled\t0\tv14.search\t3\tlogged=1\tserp=1\tgeo=213\tv14.keyboard.open\t0\tv14.keyboard.close\t0\tv14.foot.up_arrow\t0\tv14.foot.settings\t0\tv14.head.settings.hidden_blocks\t0\tv14.head.settings.region\t0\tv14.head.settings.other\t0`;

        expect(mapTskvToJson(tskvLine)).toMatchSnapshot();
    });
});
